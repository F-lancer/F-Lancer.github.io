<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>F-lancer</title>
  
  <subtitle>阿忠</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-09-06T16:16:04.002Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>阿忠</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>vue 原理深度剖析（三）</title>
    <link href="http://yoursite.com/2020/09/07/Vue_3_vueSnabbdom/"/>
    <id>http://yoursite.com/2020/09/07/Vue_3_vueSnabbdom/</id>
    <published>2020-09-06T16:11:00.000Z</published>
    <updated>2020-09-06T16:16:04.002Z</updated>
    
    <content type="html"><![CDATA[<h1 id="vue-原理深度剖析（三）"><a href="#vue-原理深度剖析（三）" class="headerlink" title="vue 原理深度剖析（三）"></a>vue 原理深度剖析（三）</h1><blockquote><p>虚拟树在很多时候并不是最优操作方案，但是具有普适性，效率，可维护性之间达到了平衡。</p></blockquote><blockquote><p>如果你的应用交互复杂，需要进行大量的UI变化，使用虚拟树没毛病，否则不如直接操作DOM。<br><a id="more"></a></p></blockquote><h1 id="Virtual-DOM-与-diff"><a href="#Virtual-DOM-与-diff" class="headerlink" title="Virtual DOM 与 diff"></a>Virtual DOM 与 diff</h1><h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><ol><li>利用 <code>innerhtml</code> 构建 虚拟DOM 全局渲染过于繁复。抛出问题，每次只更新修改部分，引入 VNode。</li><li>VNode 模拟真实 Dom，操作 JS对象，只对虚拟 Dom 的差异进行修改。</li><li>修改后，利用diff算法，算出需要修改的最小单位，将视图的最小单位进行更新。</li></ol><h2 id="diff-算法"><a href="#diff-算法" class="headerlink" title="diff 算法"></a>diff 算法</h2><p>寻找前后（新旧）两棵虚拟 dom树 的不同处（便于有效的更新 DOM）时使用。</p><blockquote><p><a href="https://github.com/aooy/blog/issues/2" target="_blank" rel="noopener">https://github.com/aooy/blog/issues/2</a></p></blockquote><p><img src="https://github.com/aooy/blog/blob/master/images/issues-2/diff.png?raw=true" alt="img"></p><p>即，只进行同层级比较：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 之前 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>           <span class="comment">&lt;!-- 层级1 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>            <span class="comment">&lt;!-- 层级2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span> aoy <span class="tag">&lt;/<span class="name">b</span>&gt;</span>   <span class="comment">&lt;!-- 层级3 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>diff<span class="tag">&lt;/<span class="name">Span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">P</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 之后 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>            <span class="comment">&lt;!-- 层级1 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>             <span class="comment">&lt;!-- 层级2 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">b</span>&gt;</span> aoy <span class="tag">&lt;/<span class="name">b</span>&gt;</span>        <span class="comment">&lt;!-- 层级3 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>diff<span class="tag">&lt;/<span class="name">Span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 层级2添加一个，层级3删除一个。</span></span><br><span class="line"><span class="comment">     而不会跨级比较将 层级三移至层级二。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><p>diff过程就是调用 patch函数的过程：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">oldVnode,vnode</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sameVnode(oldVnode,vnode))&#123; <span class="comment">// 判断是否值得判断，不值得直接由新的替换掉旧的。</span></span><br><span class="line">        <span class="comment">// 判断节点是否一致，子节点是否一致等等。子节点不一样调用 updateChildren 函数。</span></span><br><span class="line">        patchVnode(oldVnode,vnode); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 不值得判断，直接由新的替换掉旧的。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="传统diff"><a href="#传统diff" class="headerlink" title="传统diff"></a>传统diff</h3><p>通过循环递归对节点进行依次对比。</p><h3 id="react-diff-策略（了解）"><a href="#react-diff-策略（了解）" class="headerlink" title="react diff 策略（了解）"></a>react diff 策略（了解）</h3><blockquote><p><a href="https://zhuanlan.zhihu.com/p/20346379" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/20346379</a></p></blockquote><ol><li><p>tree diff DOM树的 diff 策略</p><ul><li>对于 DOM树仅进行同层比较，如果不存在，停止比较类似 <code>sameVnode(oldVnode,vnode)</code>。</li><li>当发生跨层级操作，直接<strong>删除</strong>后在另一个层级节点<strong>添加</strong>，即只进行删除添加操作。不会发生想像中的移动操作。</li><li>react 官方不建议进行 DOM节点跨层级 操作，影响性能。</li></ul></li><li><p>component diff 组件的 diff 策略</p><ul><li>同类组件，维持策略进行同层比较。</li><li>两个不同的组件，直接替换。</li><li><code>shouldComponentUpdate()</code> 完全没有变化，利用此方法进行判断，将不进行 diff 运算。</li></ul><blockquote><p>vue 默认会追踪组件树的依赖关系，不会重新渲染。而react会全部进行渲染，但是也可以通过 <code>shouldComponentUpdate()</code> 这个生命周期进行控制。</p></blockquote></li><li><p>element diff</p><ul><li><p>插入移动删除</p></li><li><p>添加唯一 <code>key</code> 值，进行可以移动的操作，优化了性能。</p><blockquote><p>尽量减少将最后一个节点移动到列表首部的操作，因为他移动的原则是将老树前边顺序不一致的移到后面。</p></blockquote></li></ul></li></ol><h2 id="VNode（Virtual-DOM）"><a href="#VNode（Virtual-DOM）" class="headerlink" title="VNode（Virtual DOM）"></a>VNode（Virtual DOM）</h2><p>个人理解：以 <strong>对象</strong> 的形式描述dom文档（对象）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    tag: <span class="string">'div'</span></span><br><span class="line">    data: &#123;</span><br><span class="line">        class: 'test'</span><br><span class="line">    &#125;,</span><br><span class="line">    children: [</span><br><span class="line">        &#123;</span><br><span class="line">            tag: <span class="string">'span'</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                class: 'demo'</span><br><span class="line">            &#125;</span><br><span class="line">            text: <span class="string">'hello,VNode'</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*   等同于</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    hello,VNode</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="Virtual-DOM-作用"><a href="#Virtual-DOM-作用" class="headerlink" title="Virtual DOM 作用"></a>Virtual DOM 作用</h3><p>维护了视图和状态的关系，复杂视图的情况下提升了性能。除了渲染 DOM 以外，还可以实现 SSR（Nuxt.js/Nest.js）、原生应用（Weex/React Native）、小程序（mpvue/uni-app）等。</p><h3 id="Virtual-DOM-库"><a href="#Virtual-DOM-库" class="headerlink" title="Virtual DOM 库"></a>Virtual DOM 库</h3><ol><li>Snabbdom<ul><li>Vue2.x 内部使用的 Virtual DOM 就是改造的 Snabbdom。</li><li>代码精简体积小。</li><li>通过模块可扩展。</li><li>源码使用 TypeScript。</li><li>最快的 Virtual DOM 之一。</li></ul></li><li>virtual-dom</li></ol><h1 id="Snabbdom"><a href="#Snabbdom" class="headerlink" title="Snabbdom"></a>Snabbdom</h1><blockquote><p>精简，通过 Snabbdom 了解 Virtual DOM。<br>打包工具为了方便使用 parcel。</p></blockquote><h2 id="Snabbdom-的基本使用"><a href="#Snabbdom-的基本使用" class="headerlink" title="Snabbdom 的基本使用"></a>Snabbdom 的基本使用</h2><blockquote><p><a href="https://github.com/snabbdom/snabbdom%5D" target="_blank" rel="noopener">[https://github.com/snabbdom/snabbdom]</a><br><a href="https://github.com/coconilu/Blog/issues/152%5D" target="_blank" rel="noopener">[https://github.com/coconilu/Blog/issues/152]</a> 中文过时沿用 CommonJS 引入模块</p></blockquote><blockquote><p>老版本官方文档使用 CommonJS，推荐使用 ESM，（最新版本以使用 ESM）<br>创建项目：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line"></span><br><span class="line">npm i parcel-bundler --save-dev</span><br><span class="line"></span><br><span class="line">npm i snabbdom</span><br><span class="line"></span><br><span class="line">npm i snabbdom@0.7.4  # 使用的老版本，新版本不稳定</span><br></pre></td></tr></table></figure><p>配置 <code>package.json</code> 的 <code>scripts</code>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "dev": "parcel index.html --open",</span><br><span class="line">    "build": "parcel build index.html"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>项目结构：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">|————basicuage.js</span><br><span class="line">index.html    # parcel 入口文件</span><br><span class="line">|</span><br><span class="line">package.json</span><br></pre></td></tr></table></figure><p>导入：（使用的 ESM）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, thunk, init &#125; <span class="keyword">from</span> <span class="string">'snabbdom'</span></span><br></pre></td></tr></table></figure><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Snabbdom 提供了三个核心函数，<code>init()</code>、<code>h()</code>、<code>thunk()</code>：</p><ol><li><p><code>init()</code> 是一个高阶函数，返回 <code>patch()</code> 函数。</p></li><li><p><code>h()</code> 返回一个虚拟节点 VNode，与 VUE 中 h 函数类似。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    store,</span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(APP)</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>thunk()</code> 是一种优化策略，可以在处理不可变数据时使用。</p></li></ol><h3 id="简单案例"><a href="#简单案例" class="headerlink" title="简单案例"></a>简单案例</h3><p>Test <code>index.html</code>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;script src="./src/01snabbdom.js"&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./src/02snabbdom.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>案例一：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, thunk, init &#125; <span class="keyword">from</span> <span class="string">'snabbdom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// init中传入的是模块，返回 patch 函数，</span></span><br><span class="line"><span class="comment">// patch 函数 的作用就是对比两个 虚拟DOM （VNode），将两个VNode差异更新到 真实DOM</span></span><br><span class="line"><span class="keyword">let</span> patch = init([])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数，标签+选择器</span></span><br><span class="line"><span class="comment">// 第二个参数，如果是字符串，就是标签中的内容。</span></span><br><span class="line"><span class="keyword">let</span> vNode = h(<span class="string">'div#container.cls'</span>, <span class="string">'string就是标签中的内容'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// #app 根元素与vue中的 根元素#app 一样，用来占位，之后会被替换</span></span><br><span class="line"><span class="keyword">let</span> app = <span class="built_in">document</span>.querySelector(<span class="string">'#app'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数：可以是 Dom 元素，内部会把 Dom 元素转化为VNode</span></span><br><span class="line"><span class="comment">// 第二个参数：VNode</span></span><br><span class="line"><span class="comment">// 返回值：VNode</span></span><br><span class="line"><span class="comment">// patch会转换并对比两个虚拟dom的区别，并将差异渲染到页面上。</span></span><br><span class="line"><span class="keyword">let</span> oldVNode = patch(app, vNode)  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变 老vNode 测试</span></span><br><span class="line">vNode = h(<span class="string">'div'</span>, <span class="string">'局部改变'</span>)   <span class="comment">// 新建一个虚拟 dom  </span></span><br><span class="line"></span><br><span class="line">patch(oldVNode, vNode)  <span class="comment">// 对比 改变</span></span><br></pre></td></tr></table></figure><p>案例二：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;h, init&#125; <span class="keyword">from</span> <span class="string">'snabbdom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> patch = init([])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建子元素，第二个参数是数组</span></span><br><span class="line"><span class="keyword">let</span> vNode = h(<span class="string">'div#container'</span>, [</span><br><span class="line">    h(<span class="string">'h1'</span>, <span class="string">'我是第一个子元素'</span>),</span><br><span class="line">    h(<span class="string">'p'</span>, <span class="string">'我是第二个子元素'</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="built_in">document</span>.querySelector(<span class="string">'#app'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> oldNode = patch(app, vNode)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试两秒后拿到新的dom元素渲染</span></span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    vNode = h(<span class="string">'div#container'</span>, [</span><br><span class="line">        h(<span class="string">'h1'</span>, <span class="string">'我是第一个子元素'</span>),</span><br><span class="line">        h(<span class="string">'h2'</span>, <span class="string">'我是第二个子元素'</span>)</span><br><span class="line">    ])</span><br><span class="line">    oldNode = patch(oldNode, vNode)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空页面上内容</span></span><br><span class="line">    <span class="comment">// patch(oldNode, null)   官网上这样会报错 无法读取 null 的 key 属性</span></span><br><span class="line">    patch(oldNode, h(<span class="string">'!'</span>))   <span class="comment">// 创建注释节点替换老 vNode</span></span><br><span class="line">&#125;,<span class="number">2000</span>)</span><br></pre></td></tr></table></figure><h3 id="Snabbom-中的模块"><a href="#Snabbom-中的模块" class="headerlink" title="Snabbom 中的模块"></a>Snabbom 中的模块</h3><blockquote><p>Snabbom 的核心库并不能处理元素的属性、样式、事件等， 需要使用模块。</p></blockquote><p>（官方提供了6个）常用模块：</p><ol><li>attributes<ul><li>设置 DOM 元素的属性，使用 <code>setAttribute()</code>。</li><li>处理布尔类型的属性。</li></ul></li><li>props<ul><li>和 attributes 模块相似，设置 DOM 元素的属性 <code>element[attr] = Value</code>。</li><li>不处理布尔类型的属性。</li></ul></li><li>class<ul><li>切换类样式。</li><li>注意：给元素设置类样式是通过 sel 选择器。</li></ul></li><li>dataset<ul><li>设置HTML5中 <code>data-*</code> 的自定义属性。</li></ul></li><li>eventlisteners<ul><li>注册和移除事件。</li></ul></li><li>style<ul><li>设置行内样式，支持动画。内部注册了transition</li><li><code>delayed</code>/<code>remove</code>/<code>destroy</code>。</li></ul></li></ol><h4 id="使用模块"><a href="#使用模块" class="headerlink" title="使用模块"></a>使用模块</h4><p>步骤：导入模块、<code>init()</code> 注册、使用 <code>h()</code> 函数创建 VNode 的时候，把第二个参数设置为对象，其它参数往后移。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;h, init&#125; <span class="keyword">from</span> <span class="string">'snabbdom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'snabbdom/modules/style'</span></span><br><span class="line"><span class="keyword">import</span> eventlisteners <span class="keyword">from</span> <span class="string">'snabbdom/modules/eventlisteners'</span>  <span class="comment">// 导入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> patch = init([       <span class="comment">// 注册</span></span><br><span class="line">    style,</span><br><span class="line">    eventlisteners</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> styleNode = h(<span class="string">'div'</span>,&#123;     <span class="comment">// 写数据，对象形式</span></span><br><span class="line">    style:&#123;</span><br><span class="line">        backgroundColor: <span class="string">'aqua'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    on: &#123;</span><br><span class="line">        click: eventHandler</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, [</span><br><span class="line">    h(<span class="string">'h1'</span>, <span class="string">'我是第一个子元素'</span>),</span><br><span class="line">    h(<span class="string">'p'</span>, <span class="string">'我是第二个子元素'</span>),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventHandler</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'click event'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> oldNode = <span class="built_in">document</span>.querySelector(<span class="string">'#app'</span>)</span><br><span class="line"></span><br><span class="line">patch(oldNode, styleNode)</span><br></pre></td></tr></table></figure><h2 id="Snabbdom-的源码解析"><a href="#Snabbdom-的源码解析" class="headerlink" title="Snabbdom 的源码解析"></a>Snabbdom 的源码解析</h2><blockquote><p>核心解析方向</p></blockquote><p>使用 <code>h()</code> 函数创建 JavaScript 对象（VNode）描述真实 DOM。<br><code>init()</code> 设置模块，创建 <code>patch()</code>。<br><code>patch()</code> 比较新旧两个 VNode。<br>把变化的内容更新到 DOM 树上。</p><blockquote><p>快捷键：F12 、Alt + 左方向键（回退上次位置）、选中+F12。</p></blockquote><h3 id="h"><a href="#h" class="headerlink" title="h()"></a><code>h()</code></h3><p>重载概念：在JS中没有重载的概念。</p><p>java 里重载，即可以定义函数名相同，参数不同的函数，当调用的时候可以自动根据传入的参数判断具体调用哪个函数。</p><p>而javascript是动态的语言，重名的函数会将前者覆盖。但传入的参数不受限制，往往在函数内部做判断，根据不同的参数返回不同类型的返回值。</p><p>typeScript 需要提供一个类型检查机制。它定义了一个重载的列表，但是函数执行的机制函数按照JS来执行的。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重载列表 将最精确（常用）的写在前面。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pickCard</span>(<span class="params">x: &#123;suit: <span class="built_in">string</span>; card: <span class="built_in">number</span>; &#125;[]</span>): <span class="title">number</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pickCard</span>(<span class="params">x: <span class="built_in">number</span></span>): </span>&#123;suit: <span class="built_in">string</span>; card: <span class="built_in">number</span>; &#125;;</span><br><span class="line"><span class="comment">// 函数本体</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pickCard</span>(<span class="params">x</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Check to see if we're working with an object/array</span></span><br><span class="line">    <span class="comment">// if so, they gave us the deck and we'll pick the card</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> x == <span class="string">"object"</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pickedCard = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * x.length);</span><br><span class="line">        <span class="keyword">return</span> pickedCard;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Otherwise just let them pick the card</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> x == <span class="string">"number"</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pickedSuit = <span class="built_in">Math</span>.floor(x / <span class="number">13</span>);</span><br><span class="line">        <span class="keyword">return</span> &#123; suit: suits[pickedSuit], card: x % <span class="number">13</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">h()<span class="string">` 源码：位置 `</span>src/h.ts</span><br><span class="line"><span class="keyword">import</span> &#123;vnode, VNode, VNodeData&#125; <span class="keyword">from</span> <span class="string">'./vnode'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> VNodes = <span class="built_in">Array</span>&lt;VNode&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> VNodeChildElement = VNode | <span class="built_in">string</span> | <span class="built_in">number</span> | <span class="literal">undefined</span> | <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> ArrayOrElement&lt;T&gt; = T | T[];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> VNodeChildren = ArrayOrElement&lt;VNodeChildElement&gt;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> is <span class="keyword">from</span> <span class="string">'./is'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加命名空间 ？</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addNS</span>(<span class="params">data: <span class="built_in">any</span>, children: VNodes | <span class="literal">undefined</span>, sel: <span class="built_in">string</span> | <span class="literal">undefined</span></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  data.ns = <span class="string">'http://www.w3.org/2000/svg'</span>;</span><br><span class="line">  <span class="keyword">if</span> (sel !== <span class="string">'foreignObject'</span> &amp;&amp; children !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">let</span> childData = children[i].data;</span><br><span class="line">      <span class="keyword">if</span> (childData !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        addNS(childData, (children[i] <span class="keyword">as</span> VNode).children <span class="keyword">as</span> VNodes, children[i].sel);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// h() 函数的重载</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">sel: <span class="built_in">string</span></span>): <span class="title">VNode</span></span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">sel: <span class="built_in">string</span>, data: VNodeData</span>): <span class="title">VNode</span></span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">sel: <span class="built_in">string</span>, children: VNodeChildren</span>): <span class="title">VNode</span></span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">sel: <span class="built_in">string</span>, data: VNodeData, children: VNodeChildren</span>): <span class="title">VNode</span></span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">sel: <span class="built_in">any</span>, b?: <span class="built_in">any</span>, c?: <span class="built_in">any</span></span>): <span class="title">VNode</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> data: VNodeData = &#123;&#125;, children: <span class="built_in">any</span>, text: <span class="built_in">any</span>, i: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理参数，实现重载的机制</span></span><br><span class="line">  <span class="keyword">if</span> (c !== <span class="literal">undefined</span>) &#123;  <span class="comment">// c 根据使用 是指 VNodeChildren 子元素</span></span><br><span class="line">    <span class="comment">// 如果c有值，这里处理的是传入三个参数的情况</span></span><br><span class="line"></span><br><span class="line">    data = b;   <span class="comment">//传三个参数 b指 VNodeData，元素属性</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (is.array(c)) &#123; children = c; &#125;         <span class="comment">// 如果 c 是数组 说明是子元素存入 children</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (is.primitive(c)) &#123; text = c; &#125;    <span class="comment">// 如果 c 是字符串或者数字 说明是文本 存入text </span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (c &amp;&amp; c.sel) &#123; children = [c]; &#125;   <span class="comment">// 如果 c 有 sel 属性的时候（VNode），转换成数组放入 children</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b !== <span class="literal">undefined</span>) &#123; <span class="comment">// c 为 undefined，b 不为 undefined，说明传入了两个参数</span></span><br><span class="line">    <span class="comment">// 判断两个参数的情况  与上类似</span></span><br><span class="line">    <span class="keyword">if</span> (is.array(b)) &#123; children = b; &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (is.primitive(b)) &#123; text = b; &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (b &amp;&amp; b.sel) &#123; children = [b]; &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; data = b; &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 子元素存入了 children，处理 children</span></span><br><span class="line">  <span class="keyword">if</span> (children !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; children.length; ++i) &#123;</span><br><span class="line">      <span class="comment">// 如果 children 是字符串（string）或者数字（number） 说明是文本，创建文本节点，用 vnode() 创建。 </span></span><br><span class="line">      <span class="keyword">if</span> (is.primitive(children[i])) children[i] = vnode(<span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, children[i], <span class="literal">undefined</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果传入的是 svg，要给 svg 添加命名空间，调用上面定义的 addNS()</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    sel[<span class="number">0</span>] === <span class="string">'s'</span> &amp;&amp; sel[<span class="number">1</span>] === <span class="string">'v'</span> &amp;&amp; sel[<span class="number">2</span>] === <span class="string">'g'</span> &amp;&amp;</span><br><span class="line">    (sel.length === <span class="number">3</span> || sel[<span class="number">3</span>] === <span class="string">'.'</span> || sel[<span class="number">3</span>] === <span class="string">'#'</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    addNS(data, children, sel);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 调用 vnode，创建 vnode 并返回</span></span><br><span class="line">  <span class="keyword">return</span> vnode(sel, data, children, text, <span class="literal">undefined</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 导出模块</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> h;</span><br></pre></td></tr></table></figure><h4 id="vnode-创建虚拟DOM"><a href="#vnode-创建虚拟DOM" class="headerlink" title="vnode() 创建虚拟DOM"></a><code>vnode()</code> 创建虚拟DOM</h4><p><code>interface：接口</code>：<br>TS核心原则之一：对值所具有的结构进行类型检查。<br>接口的作用：1. 为类型命名、2. 为代码和三方代码约定，及约定好数据类型。</p><p><code>vnode()</code> 源码：位置 <code>src/vnode.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入依赖</span></span><br><span class="line"><span class="keyword">import</span> &#123;Hooks&#125; <span class="keyword">from</span> <span class="string">'./hooks'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;AttachData&#125; <span class="keyword">from</span> <span class="string">'./helpers/attachto'</span></span><br><span class="line"><span class="keyword">import</span> &#123;VNodeStyle&#125; <span class="keyword">from</span> <span class="string">'./modules/style'</span></span><br><span class="line"><span class="keyword">import</span> &#123;On&#125; <span class="keyword">from</span> <span class="string">'./modules/eventlisteners'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Attrs&#125; <span class="keyword">from</span> <span class="string">'./modules/attributes'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Classes&#125; <span class="keyword">from</span> <span class="string">'./modules/class'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Props&#125; <span class="keyword">from</span> <span class="string">'./modules/props'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Dataset&#125; <span class="keyword">from</span> <span class="string">'./modules/dataset'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Hero&#125; <span class="keyword">from</span> <span class="string">'./modules/hero'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Key = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> VNode &#123;         <span class="comment">// vnode 接口 约束实现该接口的对象都拥有相同的属性</span></span><br><span class="line">  <span class="comment">// 选择器</span></span><br><span class="line">  sel: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// 节点数据：属性/样式/事件等</span></span><br><span class="line">  data: VNodeData | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// 子节点，和 text节点 只能互斥</span></span><br><span class="line">  children: <span class="built_in">Array</span>&lt;VNode | <span class="built_in">string</span>&gt; | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// 记录 vNode 对应的真实 DOM</span></span><br><span class="line">  elm: Node | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// 节点中的内容，和 Children 只能互斥 </span></span><br><span class="line">  text: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// 优化使用</span></span><br><span class="line">  key: Key | <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> VNodeData &#123;</span><br><span class="line">  props?: Props;</span><br><span class="line">  attrs?: Attrs;</span><br><span class="line">  <span class="keyword">class</span>?: Classes;</span><br><span class="line">  style?: VNodeStyle;</span><br><span class="line">  dataset?: Dataset;</span><br><span class="line">  on?: On;</span><br><span class="line">  hero?: Hero;</span><br><span class="line">  attachData?: AttachData;</span><br><span class="line">  hook?: Hooks;</span><br><span class="line">  key?: Key;</span><br><span class="line">  ns?: <span class="built_in">string</span>; <span class="comment">// for SVGs</span></span><br><span class="line">  fn?: <span class="function"><span class="params">()</span> =&gt;</span> VNode; <span class="comment">// for thunks</span></span><br><span class="line">  args?: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt;; <span class="comment">// for thunks</span></span><br><span class="line">  [key: <span class="built_in">string</span>]: <span class="built_in">any</span>; <span class="comment">// for any other 3rd party module</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 vnode 对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">vnode</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  sel: <span class="built_in">string</span> | <span class="literal">undefined</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  data: <span class="built_in">any</span> | <span class="literal">undefined</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  children: <span class="built_in">Array</span>&lt;VNode | <span class="built_in">string</span>&gt; | <span class="literal">undefined</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  text: <span class="built_in">string</span> | <span class="literal">undefined</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  elm: Element | Text | <span class="literal">undefined</span></span>): <span class="title">VNode</span> </span>&#123;   <span class="comment">// VNode 就是上面定义的接口，表示该函数的返回值所需要实现的规定（接口）</span></span><br><span class="line">    <span class="keyword">let</span> key = data === <span class="literal">undefined</span> ? <span class="literal">undefined</span> : data.key;   <span class="comment">// 当data有值时，key = data.key</span></span><br><span class="line">    <span class="keyword">return</span> &#123;sel, data, children, text, elm, key&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> vnode;   <span class="comment">// 导出 vnode</span></span><br></pre></td></tr></table></figure><h3 id="snabbdom"><a href="#snabbdom" class="headerlink" title="snabbdom()"></a><code>snabbdom()</code></h3><p>diff 概念：同上</p><ol><li><code>patch(oldVnode, newVnode)</code>。</li><li>打补丁，把新节点中变化的内容渲染到真实DOM，最后返回新节点作为下次处理的旧节点。</li><li>对比新旧 VNode 是否相同节点（节点的 key和sel 相同）。</li><li>如果不是相同节点，删除之前的内容，重新渲染。</li><li>如果是相同的节点，再判断新的 VNode 是否有 text，如果有并且和oldVNode的text不同，直接更新文本内容。</li><li>如果新的 VNode 有 Children，判断子节点是否有变化，判断子节点的过程就是 diff 算法。</li><li>diff 算法只进行同层比较。</li></ol><p>源码：位置：<code>src/snabbdom.ts</code>。核心为 <code>init()</code> 函数，及其中的 <code>patch()</code> 函数。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* global module, document, Node */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 导入依赖模块 */</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 辅助函数 */</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 常量 hooks 存储钩子函数的名字 */</span></span><br><span class="line"><span class="keyword">const</span> hooks: (keyof Module)[] = [<span class="string">'create'</span>, <span class="string">'update'</span>, <span class="string">'remove'</span>, <span class="string">'destroy'</span>, <span class="string">'pre'</span>, <span class="string">'post'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 导出了 h 和 thunk */</span></span><br><span class="line"><span class="keyword">export</span> &#123;h&#125; <span class="keyword">from</span> <span class="string">'./h'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;thunk&#125; <span class="keyword">from</span> <span class="string">'./thunk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义了 init 函数，并导出 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @export</span></span><br><span class="line"><span class="comment"> * @param &#123;Array&lt;Partial&lt;Module&gt;&gt;&#125; modules  模块数组，用来除了样式、属性、事件等等。</span></span><br><span class="line"><span class="comment"> * @param &#123;DOMAPI&#125; [domApi] 执行dom操作，未赋值，在内部会赋 htmlDomApi，一些转换 虚拟 dom 的 API。</span></span><br><span class="line"><span class="comment"> * @returns 返回了 patch() 函数，把vnode渲染成真实dom，并返回vnode。</span></span><br><span class="line"><span class="comment"> * 使用高阶函数的优点： 形成闭包外部使用 patch() 可以直接使用 init 传入的这两个模块。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">modules: <span class="built_in">Array</span>&lt;Partial&lt;Module&gt;&gt;, domApi?: DOMAPI</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> i: <span class="built_in">number</span>, j: <span class="built_in">number</span>, cbs = (&#123;&#125; <span class="keyword">as</span> ModuleHooks);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化转换虚拟节点的 api</span></span><br><span class="line">    <span class="keyword">const</span> api: DOMAPI = domApi !== <span class="literal">undefined</span> ? domApi : htmlDomApi;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 官方给的几个模块（./modules）都满足 module.ts 中规定的接口，即必须具有上面的钩子函数一个或几个。</span></span><br><span class="line">    <span class="comment">// 把传入的所有模块的钩子函数，统一存储到 cbs 对象中</span></span><br><span class="line">    <span class="comment">// 最终构建的 cbs 对象的形式 cbs =&#123; create: [fn1, fn2], update: [], ... &#125;</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; hooks.length; ++i) &#123;   <span class="comment">// 遍历钩子</span></span><br><span class="line">        cbs[hooks[i]] = [];                  <span class="comment">// 钩子作为cbs的key，初始化为数组</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; modules.length; ++j) &#123;  <span class="comment">// 遍历模块</span></span><br><span class="line">            <span class="keyword">const</span> hook = modules[j][hooks[i]];</span><br><span class="line">            <span class="keyword">if</span> (hook !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                (cbs[hooks[i]] <span class="keyword">as</span> <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt;).push(hook);   <span class="comment">// 将模块一次放入 刚刚初始化的数组</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 内部辅助函数 */</span>  </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>没有使用 <code>export default</code> 导出，导入要用 <code>import {} from &#39;./../&#39;</code></p></blockquote><h4 id="patch"><a href="#patch" class="headerlink" title="patch()"></a><code>patch()</code></h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在 init() 内部返回了 patch() 函数，把vnode渲染成真实dom，并返回vnode。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;(VNode | Element)&#125; oldVnode</span></span><br><span class="line"><span class="comment">   * @param &#123;VNode&#125; vnode</span></span><br><span class="line"><span class="comment">   * @returns &#123;VNode&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">oldVnode: VNode | Element, vnode: VNode</span>): <span class="title">VNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> i: <span class="built_in">number</span>, elm: Node, parent: Node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存新插入节点的队列，为了触发钩子函数</span></span><br><span class="line">    <span class="keyword">const</span> insertedVnodeQueue: VNodeQueue = [];</span><br><span class="line">    <span class="comment">// 执行模块的 pre 钩子函数 pre 就是预处理的钩子</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; cbs.pre.length; ++i) cbs.pre[i]();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断是不是虚拟节点（判断是否有 sel 属性）</span></span><br><span class="line">    <span class="keyword">if</span> (!isVnode(oldVnode)) &#123;</span><br><span class="line">        oldVnode = emptyNodeAt(oldVnode); </span><br><span class="line">        <span class="comment">// 如果是真实dom，创建vnode，即将dom元素转换为空虚拟dom</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据key（节点唯一值）、sel（节点选择器）判断两个节点是否是相同节点</span></span><br><span class="line">    <span class="keyword">if</span> (sameVnode(oldVnode, vnode)) &#123;</span><br><span class="line">        <span class="comment">// 是相同节点，找差异更新到节点上</span></span><br><span class="line">        patchVnode(oldVnode, vnode, insertedVnodeQueue);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果不一样，新节点 vnode 创建对应的 DOM</span></span><br><span class="line">        elm = oldVnode.elm <span class="keyword">as</span> Node;     <span class="comment">// 获取老节点元素</span></span><br><span class="line">        parent = api.parentNode(elm);   <span class="comment">// 获取老节点父结点</span></span><br><span class="line"></span><br><span class="line">        createElm(vnode, insertedVnodeQueue); </span><br><span class="line">        <span class="comment">// 给新节点创建vnode并触发 init/create 钩子函数。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 父结点不为空</span></span><br><span class="line">        <span class="keyword">if</span> (parent !== <span class="literal">null</span>) &#123; </span><br><span class="line">            <span class="comment">// 新节点vnode对应的dom插入到文档中</span></span><br><span class="line">            api.insertBefore(parent, vnode.elm <span class="keyword">as</span> Node, api.nextSibling(elm));</span><br><span class="line">            <span class="comment">// 移除老节点</span></span><br><span class="line">            removeVnodes(parent, [oldVnode], <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行用户设置的 insert 钩子函数</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insertedVnodeQueue.length; ++i) &#123;  <span class="comment">//遍历新插入的节点</span></span><br><span class="line">        (((insertedVnodeQueue[i].data <span class="keyword">as</span> VNodeData).hook <span class="keyword">as</span> Hooks).insert <span class="keyword">as</span> <span class="built_in">any</span>)(insertedVnodeQueue[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行模块的 post 钩子函数</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; cbs.post.length; ++i) cbs.post[i]();</span><br><span class="line">    <span class="comment">// 返回 vnode</span></span><br><span class="line">    <span class="keyword">return</span> vnode;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><code>!</code> ts语法是指该处是 100% 有值的。</p></blockquote><blockquote><p><code>createElm()</code>：把vNode转换为dom元素，此处并未渲染到页面上。<code>insertBefore()</code> 才插入到文档上去。</p></blockquote><h4 id="createElm"><a href="#createElm" class="headerlink" title="createElm()"></a><code>createElm()</code></h4><p><code>createElm()</code> 源码：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElm</span>(<span class="params">vnode: VNode, insertedVnodeQueue: VNodeQueue</span>): <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="comment">// vnode.data h()函数传入的一个参数对象形式，里面是标签样式属性类等</span></span><br><span class="line">    <span class="keyword">let</span> i: <span class="built_in">any</span>, data = vnode.data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="comment">// 执行用户设置的 init() 钩子函数</span></span><br><span class="line">        <span class="keyword">if</span> (isDef(i = data.hook) &amp;&amp; isDef(i = i.init)) &#123;  <span class="comment">// isDef() 判断函数是否已定义</span></span><br><span class="line">            i(vnode);  <span class="comment">// data.hook.init(vnode)</span></span><br><span class="line">            data = vnode.data; <span class="comment">// 重新赋值是由于，用户可能在init里重新修改data值</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把 vnode 转换成真实 DOM 对象（并未渲染到页面上）</span></span><br><span class="line">    <span class="keyword">let</span> children = vnode.children, sel = vnode.sel;</span><br><span class="line">    <span class="keyword">if</span> (sel === <span class="string">'!'</span>) &#123;    <span class="comment">// 如果选择器是感叹号，会创建注释节点。</span></span><br><span class="line">        <span class="keyword">if</span> (isUndef(vnode.text)) &#123;</span><br><span class="line">            vnode.text = <span class="string">''</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 调用 document.createComment(text) 创造空注释节点</span></span><br><span class="line">        vnode.elm = api.createComment(vnode.text <span class="keyword">as</span> <span class="built_in">string</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sel !== <span class="literal">undefined</span>) &#123;    <span class="comment">// sel 不为空，创建对应的 DOM 元素</span></span><br><span class="line">        <span class="comment">// Parse selector  如果选择器不为空 解析选择器</span></span><br><span class="line">        <span class="comment">// 找到'#''.'的位置，解析出标签名</span></span><br><span class="line">        <span class="keyword">const</span> hashIdx = sel.indexOf(<span class="string">'#'</span>);</span><br><span class="line">        <span class="keyword">const</span> dotIdx = sel.indexOf(<span class="string">'.'</span>, hashIdx);</span><br><span class="line">        <span class="keyword">const</span> hash = hashIdx &gt; <span class="number">0</span> ? hashIdx : sel.length;</span><br><span class="line">        <span class="keyword">const</span> dot = dotIdx &gt; <span class="number">0</span> ? dotIdx : sel.length;</span><br><span class="line">        <span class="keyword">const</span> tag = hashIdx !== <span class="number">-1</span> || dotIdx !== <span class="number">-1</span> ? sel.slice(<span class="number">0</span>, <span class="built_in">Math</span>.min(hash, dot)) : sel;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// isDef(data.ns) data是否有命名空间（？）createElementNS创建带有命名空间的元素，一般为SVG，</span></span><br><span class="line">        <span class="comment">// 否则创建一般元素</span></span><br><span class="line">        <span class="keyword">const</span> elm = vnode.elm = isDef(data) &amp;&amp; isDef(i = (data <span class="keyword">as</span> VNodeData).ns)                </span><br><span class="line">                                ? api.createElementNS(i, tag): api.createElement(tag);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果有id class，设置 id class 属性</span></span><br><span class="line">        <span class="keyword">if</span> (hash &lt; dot) elm.setAttribute(<span class="string">'id'</span>, sel.slice(hash + <span class="number">1</span>, dot)); </span><br><span class="line">        <span class="keyword">if</span> (dotIdx &gt; <span class="number">0</span>) elm.setAttribute(<span class="string">'class'</span>, sel.slice(dot + <span class="number">1</span>).replace(<span class="regexp">/\./g</span>, <span class="string">' '</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行模块的 create 钩子函数</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; cbs.create.length; ++i) cbs.create[i](emptyNode, vnode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果 vnode 中有子节点，创建vnode对应的DOM元素并追加到DOM树上</span></span><br><span class="line">        <span class="keyword">if</span> (is.array(children)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; children.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">const</span> ch = children[i];</span><br><span class="line">                <span class="keyword">if</span> (ch != <span class="literal">null</span>) &#123;</span><br><span class="line">                    api.appendChild(elm, createElm(ch <span class="keyword">as</span> VNode, insertedVnodeQueue)); <span class="comment">// 递归调用 createElm()</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (is.primitive(vnode.text)) &#123; <span class="comment">// 如果是文本节点，创建并追加到DOM树上</span></span><br><span class="line">            api.appendChild(elm, api.createTextNode(vnode.text));</span><br><span class="line">        &#125;</span><br><span class="line">        i = (vnode.data <span class="keyword">as</span> VNodeData).hook; <span class="comment">// Reuse variable 重用变量 i </span></span><br><span class="line">        <span class="keyword">if</span> (isDef(i)) &#123;</span><br><span class="line">            <span class="comment">// 如果用户传入了钩子函数</span></span><br><span class="line">            <span class="keyword">if</span> (i.create) i.create(emptyNode, vnode);  <span class="comment">// 有create调用create 创造空节点</span></span><br><span class="line">            <span class="comment">// 有insert调用insert 将当前节点追加到队列里，patch()函数有使用到该队列</span></span><br><span class="line">            <span class="keyword">if</span> (i.insert) insertedVnodeQueue.push(vnode); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;   <span class="comment">// sel 为空，说明是文本节点，创建文本节点</span></span><br><span class="line">        vnode.elm = api.createTextNode(vnode.text <span class="keyword">as</span> <span class="built_in">string</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建的新 DOM 存在 vnode.elm 属性里并返回</span></span><br><span class="line">    <span class="keyword">return</span> vnode.elm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>理解使用用户定义的钩子函数，test：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// h函数的第二个参数可以定义钩子函数</span></span><br><span class="line"><span class="keyword">let</span> vnode = h(<span class="string">'div#container.cls'</span>, &#123;</span><br><span class="line">    hook: &#123;</span><br><span class="line">        init(vnode)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(vnode.elm)</span><br><span class="line">        &#125;,</span><br><span class="line">        create(vnode)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(vnode.elm)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">'使用用户定义的钩子函数'</span>)</span><br></pre></td></tr></table></figure><h4 id="patchVnode"><a href="#patchVnode" class="headerlink" title="patchVnode()"></a><code>patchVnode()</code></h4><p>对比新旧两个节点，更新它们的差异：</p><ul><li>调用钩子函数 prepatch 钩子函数。</li><li>触发 update 钩子函数。</li></ul><p>对比：</p><ul><li>新节点有 text 属性，且不等于旧节点的 text 属性。<ul><li>如果节点有 children，移除老节点 children 对应的DOM元素</li><li>设置新节点对应DOM元素的 textContent</li></ul></li><li>新老节点都有children，且不相等<ul><li>调用 <code>updateChildren()</code></li><li>对比子节点，并更新差异</li></ul></li><li>只有新节点有children属性<ul><li>如果老节点有text属性 清空对应DOM元素的textContent</li><li>添加所有的子节点</li></ul></li><li>只有老节点有children属性<ul><li>移除所有老节点。</li></ul></li><li>只有来节点有 text 属性<ul><li>移除所有的老节点</li></ul></li><li>触发 postpatch 钩子函数。</li></ul><p>源码：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *对比两节点的差异，并跟新真实dom</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;VNode&#125; oldVnode</span></span><br><span class="line"><span class="comment">   * @param &#123;VNode&#125; vnode</span></span><br><span class="line"><span class="comment">   * @param &#123;VNodeQueue&#125; insertedVnodeQueue</span></span><br><span class="line"><span class="comment">   * @returns</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchVnode</span>(<span class="params">oldVnode: VNode, vnode: VNode, insertedVnodeQueue: VNodeQueue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> i: <span class="built_in">any</span>, hook: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 首先执行用户设置的 prepatch 钩子函数</span></span><br><span class="line">    <span class="keyword">if</span> (isDef(i = vnode.data) &amp;&amp; isDef(hook = i.hook) &amp;&amp; isDef(i = hook.prepatch)) &#123;</span><br><span class="line">        i(oldVnode, vnode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> elm = vnode.elm = (oldVnode.elm <span class="keyword">as</span> Node);</span><br><span class="line">    <span class="keyword">let</span> oldCh = oldVnode.children;</span><br><span class="line">    <span class="keyword">let</span> ch = vnode.children;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果新老 vnode 相同返回</span></span><br><span class="line">    <span class="keyword">if</span> (oldVnode === vnode) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (vnode.data !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="comment">// 执行模块的 update 钩子函数</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; cbs.update.length; ++i) cbs.update[i](oldVnode, vnode);</span><br><span class="line">        i = vnode.data.hook;</span><br><span class="line">        <span class="comment">// 执行用户设置的 update 钩子函数</span></span><br><span class="line">        <span class="keyword">if</span> (isDef(i) &amp;&amp; isDef(i = i.update)) i(oldVnode, vnode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果 vnode.text 未定义</span></span><br><span class="line">    <span class="keyword">if</span> (isUndef(vnode.text)) &#123;</span><br><span class="line">        <span class="comment">// 新老节点都有孩子</span></span><br><span class="line">        <span class="keyword">if</span> (isDef(oldCh) &amp;&amp; isDef(ch)) &#123;</span><br><span class="line">            <span class="comment">// 使用 diff 算法对比子节点更新子节点</span></span><br><span class="line">            <span class="keyword">if</span> (oldCh !== ch) updateChildren(elm, oldCh <span class="keyword">as</span> <span class="built_in">Array</span>&lt;VNode&gt;, ch <span class="keyword">as</span> <span class="built_in">Array</span>&lt;VNode&gt;, insertedVnodeQueue);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDef(ch)) &#123;</span><br><span class="line">            <span class="comment">// 如果新节点有 children，老节点没有 children</span></span><br><span class="line">            <span class="comment">// 如果老节点有 text，清空 dom 元素的内容</span></span><br><span class="line">            <span class="keyword">if</span> (isDef(oldVnode.text)) api.setTextContent(elm, <span class="string">''</span>);</span><br><span class="line">            <span class="comment">// 批量添加子节点</span></span><br><span class="line">            addVnodes(elm, <span class="literal">null</span>, ch <span class="keyword">as</span> <span class="built_in">Array</span>&lt;VNode&gt;, <span class="number">0</span>, (ch <span class="keyword">as</span> <span class="built_in">Array</span>&lt;VNode&gt;).length - <span class="number">1</span>, insertedVnodeQueue);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDef(oldCh)) &#123;</span><br><span class="line">            <span class="comment">// 批量移除老节点</span></span><br><span class="line">            removeVnodes(elm, oldCh <span class="keyword">as</span> <span class="built_in">Array</span>&lt;VNode&gt;, <span class="number">0</span>, (oldCh <span class="keyword">as</span> <span class="built_in">Array</span>&lt;VNode&gt;).length - <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDef(oldVnode.text)) &#123;</span><br><span class="line">            <span class="comment">// 老节点有 text ，清空 DOM 元素</span></span><br><span class="line">            api.setTextContent(elm, <span class="string">''</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldVnode.text !== vnode.text) &#123;</span><br><span class="line">        <span class="comment">// 如果没有设置 vnode.text</span></span><br><span class="line">        <span class="keyword">if</span> (isDef(oldCh)) &#123;</span><br><span class="line">            <span class="comment">// 老节点有 children 移除</span></span><br><span class="line">            removeVnodes(elm, oldCh <span class="keyword">as</span> <span class="built_in">Array</span>&lt;VNode&gt;, <span class="number">0</span>, (oldCh <span class="keyword">as</span> <span class="built_in">Array</span>&lt;VNode&gt;).length - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 设置 DOM 元素的 textContent 为 vnode.text</span></span><br><span class="line">        api.setTextContent(elm, vnode.text <span class="keyword">as</span> <span class="built_in">string</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最后执行用户设置的 postpatch 钩子函数</span></span><br><span class="line">    <span class="keyword">if</span> (isDef(hook) &amp;&amp; isDef(i = hook.postpatch)) &#123;</span><br><span class="line">        i(oldVnode, vnode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="updateChildren"><a href="#updateChildren" class="headerlink" title="updateChildren()"></a><code>updateChildren()</code></h4><p><code>updateChildren()</code>：对比新老节点的子节点，并更新子节点（是 diff 算法的核心）</p><p>执行过程：</p><ul><li>要对比两棵树的差异，一个节点对应整棵树比较的事件复杂度为 O(n^3)。</li><li>由于在Dom操作的时候很少会把父节点移动更新到子节点。</li><li>采用同层比较，即一层对应一层比较，时间复杂度是 O(n)。</li><li>在进行同层比较的时候会首先对新老节点数组的开始和结尾节点设置索引标记，遍历的过程中移动索引。</li><li>在对开始结束的节点进行比较的时候，总共有四种情况：<ul><li><code>oldStartVnode</code> / <code>newStartVnode</code>（旧开始节点/新开始节点）</li><li><code>oldEndVnode</code> / <code>newEndVnode</code>（旧结束节点/新结束节点）</li><li><code>oldStartVnode</code> / <code>newEndVnode</code>（旧开始节点/新结束节点）</li><li><code>oldEndVnode</code> / <code>newStartVnode</code>（旧结束节点/新开始节点）</li></ul></li><li>如果四种情况都不满足，采用唯一 key 值比较。</li><li>结束时的情况也分为两种：<ul><li>老节点数组结束，新节点数组未结束，说明新增了节点，将新增节点补充到老节点。</li><li>老节点数组未结束，新节点数组结束，说明删除了节点，将节点删除</li></ul></li></ul><p>源码：源码位置（<code>src/snabbdom.ts</code>）</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对比新老节点的子节点，并更新子节点</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param &#123;Node&#125; parentElm   父元素</span></span><br><span class="line"><span class="comment"> * @param &#123;Array&lt;VNode&gt;&#125; oldCh 老节点</span></span><br><span class="line"><span class="comment"> * @param &#123;Array&lt;VNode&gt;&#125; newCh 新节点</span></span><br><span class="line"><span class="comment"> * @param &#123;VNodeQueue&#125; insertedVnodeQueue  节点队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateChildren</span>(<span class="params">parentElm: Node,</span></span></span><br><span class="line"><span class="function"><span class="params">                         oldCh: <span class="built_in">Array</span>&lt;VNode&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">                         newCh: <span class="built_in">Array</span>&lt;VNode&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">                         insertedVnodeQueue: VNodeQueue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> oldStartIdx = <span class="number">0</span>, newStartIdx = <span class="number">0</span>;   <span class="comment">// 新老开始索引</span></span><br><span class="line">    <span class="keyword">let</span> oldEndIdx = oldCh.length - <span class="number">1</span>;       <span class="comment">// 老结束  </span></span><br><span class="line">    <span class="keyword">let</span> oldStartVnode = oldCh[<span class="number">0</span>];           <span class="comment">// 根据索引老开始节点</span></span><br><span class="line">    <span class="keyword">let</span> oldEndVnode = oldCh[oldEndIdx];     <span class="comment">// 老结束节点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newEndIdx = newCh.length - <span class="number">1</span>;        </span><br><span class="line">    <span class="keyword">let</span> newStartVnode = newCh[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> newEndVnode = newCh[newEndIdx];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> oldKeyToIdx: <span class="built_in">any</span>;</span><br><span class="line">    <span class="keyword">let</span> idxInOld: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">let</span> elmToMove: VNode;</span><br><span class="line">    <span class="keyword">let</span> before: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同层比较 结束条件，新老索引有一个结束则结束</span></span><br><span class="line">    <span class="keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">        <span class="comment">// 节为空移动索引</span></span><br><span class="line">        <span class="keyword">if</span> (oldStartVnode == <span class="literal">null</span>) &#123;</span><br><span class="line">            oldStartVnode = oldCh[++oldStartIdx]; <span class="comment">// Vnode might have been moved left</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldEndVnode == <span class="literal">null</span>) &#123;</span><br><span class="line">            oldEndVnode = oldCh[--oldEndIdx];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newStartVnode == <span class="literal">null</span>) &#123;</span><br><span class="line">            newStartVnode = newCh[++newStartIdx];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newEndVnode == <span class="literal">null</span>) &#123;</span><br><span class="line">            newEndVnode = newCh[--newEndIdx];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 四种对比情况 patchVnode()调用对比差异更新dom </span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">            patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue);  </span><br><span class="line">            oldStartVnode = oldCh[++oldStartIdx];</span><br><span class="line">            newStartVnode = newCh[++newStartIdx];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">            patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue);</span><br><span class="line">            oldEndVnode = oldCh[--oldEndIdx];</span><br><span class="line">            newEndVnode = newCh[--newEndIdx];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldStartVnode, newEndVnode)) &#123; <span class="comment">// Vnode moved right</span></span><br><span class="line">            patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue);</span><br><span class="line">            api.insertBefore(parentElm, oldStartVnode.elm <span class="keyword">as</span> Node, api.nextSibling(oldEndVnode.elm <span class="keyword">as</span> Node));</span><br><span class="line">            oldStartVnode = oldCh[++oldStartIdx];</span><br><span class="line">            newEndVnode = newCh[--newEndIdx];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldEndVnode, newStartVnode)) &#123; <span class="comment">// Vnode moved left</span></span><br><span class="line">            patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue);</span><br><span class="line">            api.insertBefore(parentElm, oldEndVnode.elm <span class="keyword">as</span> Node, oldStartVnode.elm <span class="keyword">as</span> Node);</span><br><span class="line">            oldEndVnode = oldCh[--oldEndIdx];</span><br><span class="line">            newStartVnode = newCh[++newStartIdx];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 开始结束节点四种情况都不满足，采用 key 值对比</span></span><br><span class="line">            <span class="keyword">if</span> (oldKeyToIdx === <span class="literal">undefined</span>) &#123;</span><br><span class="line">                <span class="comment">// oldKeyToIdx 未定义就赋值</span></span><br><span class="line">                <span class="comment">// 将老节点的 key 作为属性，所谓作为属性的值</span></span><br><span class="line">                oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx);  </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 在老节点中找相同的key值</span></span><br><span class="line">            idxInOld = oldKeyToIdx[newStartVnode.key <span class="keyword">as</span> <span class="built_in">string</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isUndef(idxInOld)) &#123; <span class="comment">// New element 没找到为新元素</span></span><br><span class="line">                api.insertBefore(parentElm, createElm(newStartVnode, insertedVnodeQueue), oldStartVnode.elm <span class="keyword">as</span> Node);</span><br><span class="line">                <span class="comment">// 移动指针指向新的下一个节点</span></span><br><span class="line">                newStartVnode = newCh[++newStartIdx];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 找到了，存储到 elmToMove</span></span><br><span class="line">                elmToMove = oldCh[idxInOld];</span><br><span class="line">                <span class="keyword">if</span> (elmToMove.sel !== newStartVnode.sel) &#123;</span><br><span class="line">                    <span class="comment">// 根据sel判断两个节点是否被修改过，不同表示修改过，创建新DOM,插入到老的开始节点之前</span></span><br><span class="line">                    api.insertBefore(parentElm, createElm(newStartVnode, insertedVnodeQueue), oldStartVnode.elm <span class="keyword">as</span> Node);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 相同节点，对比两节点的差异</span></span><br><span class="line">                    patchVnode(elmToMove, newStartVnode, insertedVnodeQueue);</span><br><span class="line">                    oldCh[idxInOld] = <span class="literal">undefined</span> <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line">                    api.insertBefore(parentElm, (elmToMove.elm <span class="keyword">as</span> Node), oldStartVnode.elm <span class="keyword">as</span> Node);</span><br><span class="line">                &#125;</span><br><span class="line">                newStartVnode = newCh[++newStartIdx];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环结束的两种情况的代码  有一个数组未遍历完，处理剩余元素</span></span><br><span class="line">    <span class="keyword">if</span> (oldStartIdx &lt;= oldEndIdx || newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">            before = newCh[newEndIdx+<span class="number">1</span>] == <span class="literal">null</span> ? <span class="literal">null</span> : newCh[newEndIdx+<span class="number">1</span>].elm;</span><br><span class="line">            <span class="comment">// 把剩余新节点插到老节点后面</span></span><br><span class="line">            addVnodes(parentElm, before, newCh, newStartIdx, newEndIdx, insertedVnodeQueue);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 删除多余老节点</span></span><br><span class="line">            removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="模块源码"><a href="#模块源码" class="headerlink" title="模块源码"></a>模块源码</h3><blockquote><p>核心源码执行过程：patch() ——&gt; patchVnode() ——&gt; updateChildren()。<br>snabbdom 为了代码精简，将处理的元素的属性/事件/样式等工作，放到了模块中。模块可以按需引入。</p></blockquote><p>模块的核心是基于Hooks：</p><p>源码：位置 <code>src/hooks.ts</code></p><h1 id="vue-react-区别先略"><a href="#vue-react-区别先略" class="headerlink" title="vue/react 区别先略"></a>vue/react 区别先略</h1><ol><li>组件树的渲染策略。</li><li>vue 可以直接在单文件中写 <code>css/html</code>。react 是使用<code>JSX</code>。（vue也可以使用render函数和JSX）</li><li>react <code>props</code> 单一数据源???。</li><li>vue：<code>vue-router/vueX</code> 团队维护。react：<code>react-router/react-redux</code> 社区成员维护。</li><li>React Native，手机上创建原生应用听说很nice，vue的 <code>weex</code> 听说高开低走不行，vue3.0也要出来了，so…</li></ol><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p>vue-vs-react：[<a href="https://deliciousbrains.com/vue-vs-react-battle-javascript/" target="_blank" rel="noopener">https://deliciousbrains.com/vue-vs-react-battle-javascript/</a>]</p></blockquote><blockquote><p>vue-vs-react：[<a href="http://caibaojian.com/vue-vs-react.html" target="_blank" rel="noopener">http://caibaojian.com/vue-vs-react.html</a>]</p></blockquote><blockquote><p>虚拟dom与diff实现：[<a href="https://github.com/answershuto/learnVue/blob/master/docs/VirtualDOM%E4%B8%8Ediff(Vue%E5%AE%9E%E7%8E%B0).MarkDown" target="_blank" rel="noopener">https://github.com/answershuto/learnVue/blob/master/docs/VirtualDOM%E4%B8%8Ediff(Vue%E5%AE%9E%E7%8E%B0).MarkDown</a>]</p></blockquote><blockquote><p>VNode：[<a href="https://github.com/answershuto/learnVue/blob/master/docs/VNode%E8%8A%82%E7%82%B9.MarkDown" target="_blank" rel="noopener">https://github.com/answershuto/learnVue/blob/master/docs/VNode%E8%8A%82%E7%82%B9.MarkDown</a>]</p></blockquote><blockquote><p>回流重绘虚拟DOM：[<a href="https://blog.usejournal.com/what-the-heck-is-repaint-and-reflow-in-the-browser-b2d0fb980c08?gi=8bc0f4c14faa" target="_blank" rel="noopener">https://blog.usejournal.com/what-the-heck-is-repaint-and-reflow-in-the-browser-b2d0fb980c08?gi=8bc0f4c14faa</a>]</p></blockquote><blockquote><p>[<a href="https://github.com/aooy/blog/issues/2" target="_blank" rel="noopener">https://github.com/aooy/blog/issues/2</a>]</p></blockquote><blockquote><p>[<a href="https://zhuanlan.zhihu.com/p/20346379" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/20346379</a>]</p></blockquote><blockquote><p><a href="https://github.com/Matt-Esch/virtual-dom%5D" target="_blank" rel="noopener">[https://github.com/Matt-Esch/virtual-dom]</a></p></blockquote><blockquote><p>vscode：<a href="https://segmentfault.com/a/1190000012047237%5D" target="_blank" rel="noopener">[https://segmentfault.com/a/1190000012047237]</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;vue-原理深度剖析（三）&quot;&gt;&lt;a href=&quot;#vue-原理深度剖析（三）&quot; class=&quot;headerlink&quot; title=&quot;vue 原理深度剖析（三）&quot;&gt;&lt;/a&gt;vue 原理深度剖析（三）&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;虚拟树在很多时候并不是最优操作方案，但是具有普适性，效率，可维护性之间达到了平衡。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;如果你的应用交互复杂，需要进行大量的UI变化，使用虚拟树没毛病，否则不如直接操作DOM。&lt;br&gt;
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="vue" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/vue/"/>
    
      <category term="vueVNode" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/vue/vueVNode/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="vue" scheme="http://yoursite.com/tags/vue/"/>
    
      <category term="vnode/diff" scheme="http://yoursite.com/tags/vnode-diff/"/>
    
      <category term="Snabbdom" scheme="http://yoursite.com/tags/Snabbdom/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://yoursite.com/2020/09/01/%E8%BF%99%E6%98%AFnull12/"/>
    <id>http://yoursite.com/2020/09/01/这是null12/</id>
    <published>2020-09-01T13:49:04.964Z</published>
    <updated>2020-09-01T13:49:04.965Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>vue 原理深度剖析（二）</title>
    <link href="http://yoursite.com/2020/09/01/Vue_2_vueReact/"/>
    <id>http://yoursite.com/2020/09/01/Vue_2_vueReact/</id>
    <published>2020-09-01T13:41:00.000Z</published>
    <updated>2020-09-01T13:48:36.082Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>vue 响应式原理… <a id="more"></a></p></blockquote><h1 id="响应式原理"><a href="#响应式原理" class="headerlink" title="响应式原理"></a>响应式原理</h1><h2 id="数据驱动"><a href="#数据驱动" class="headerlink" title="数据驱动"></a>数据驱动</h2><blockquote><p>数据驱动、双向绑定、数据响应式</p></blockquote><p>数据响应式：数据模型仅仅是普通的 JS 对象，当修改数据时，视图会进行更新，避免操作 DOM，提高开发效率。</p><p>双向绑定：数据改变，视图改变；视图改变，数据随之改变。可以使用 <code>v-model</code> 在表单元素上创建双向数据绑定。</p><p>数据驱动：使得开发者，仅需关注数据本身，不需要关心数据是如何渲染到视图。</p><p><img src="https://image.fundebug.com/2019-07-10-03.png" alt="img"></p><h2 id="响应式核心原理"><a href="#响应式核心原理" class="headerlink" title="响应式核心原理"></a>响应式核心原理</h2><h3 id="Vue2-x"><a href="#Vue2-x" class="headerlink" title="Vue2.x"></a>Vue2.x</h3><p><a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener">深入响应式原理 官网</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener">defineProperty</a></p><blockquote><p>ES5新增的，兼容 IE8 以上。</p></blockquote><p><a href="https://cn.vuejs.org/images/data.png%5D" target="_blank" rel="noopener">[https://cn.vuejs.org/images/data.png]</a></p><p><code>defineProperty()</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h1"</span>&gt;</span></span><br><span class="line">    hello</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> data = &#123;</span></span><br><span class="line"><span class="javascript">        msg: <span class="string">'hello'</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 模拟 Vue 实例</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> vm = &#123;&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 数据劫持  当访问或者设置 vm 中的成员的时候，做一些干预操作</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">Object</span>.defineProperty(vm, <span class="string">'msg'</span>, &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        enumerable: <span class="literal">true</span>,    <span class="comment">// 可枚举（可遍历）</span></span></span><br><span class="line"><span class="javascript">        configurable: <span class="literal">true</span>,  <span class="comment">// 可配置（可以使用 delete 删除，可以通过 defineProperty 重新定义）</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">get</span>: () =&gt; &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'get:'</span>,data.msg)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> data.msg</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">set</span>: (newVal) =&gt; &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'set:'</span>,data.msg)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (newVal === data.msg)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            data.msg = newVal</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementsByClassName(<span class="string">'h1'</span>)[<span class="number">0</span>].textContent = data.msg</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="javascript">    <span class="comment">// vm.msg = 'Hello World'</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(vm.msg)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>多值时需要遍历：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h1"</span>&gt;</span></span><br><span class="line">    hello</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> data = &#123;</span></span><br><span class="line"><span class="javascript">    msg: <span class="string">'hello'</span>,</span></span><br><span class="line"><span class="javascript">    tip: <span class="string">'hello world'</span></span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// 模拟 Vue 实例</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> vm = &#123;&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">proxyData(data)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">proxyData</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 遍历 data 中的所有属性</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 把 data 中的属性，转换为 vm 中的 getter/setter</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 数据劫持  当访问或者设置 vm 中的成员的时候，做一些干预操作</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">Object</span>.defineProperty(vm, <span class="string">'msg'</span>, &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            enumerable: <span class="literal">true</span>,    <span class="comment">// 可枚举（可遍历）</span></span></span><br><span class="line"><span class="javascript">            configurable: <span class="literal">true</span>,  <span class="comment">// 可配置（可以使用 delete 删除，可以通过 defineProperty 重新定义）</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">get</span>: () =&gt; &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'get:'</span>,data.msg)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> data.msg</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="keyword">set</span>: (newVal) =&gt; &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'set:'</span>,data.msg)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (newVal === data.msg)&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span></span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">                data.msg = newVal</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.getElementsByClassName(<span class="string">'h1'</span>)[<span class="number">0</span>].textContent = data.msg</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// vm.msg = 'Hello World'</span></span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(vm.msg)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Vue3-x"><a href="#Vue3-x" class="headerlink" title="Vue3.x"></a>Vue3.x</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener">proxy</a><br>它直接监听对象，而非属性。<br>ES6 中新增的，不兼容 IE，性能由浏览器优化。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h1"</span>&gt;</span></span><br><span class="line">    hello</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> data = &#123;</span></span><br><span class="line"><span class="javascript">    msg: <span class="string">'hello'</span>,</span></span><br><span class="line"><span class="javascript">    tip: <span class="string">'hello world'</span></span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// 创建代理对象 vm，获取 msg 属性可以通过 代理属性 vm 获取</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> vmp = <span class="keyword">new</span> <span class="built_in">Proxy</span>(data, &#123; <span class="comment">// 第一个属性被代理的对象，第二个参数是一个包含了代理行为的对象</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">get</span> (target, key)&#123;   <span class="comment">// target 被代理对象，key 要访问对象属性</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> target[key]</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    <span class="keyword">set</span> (target, key, newValue) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(target[key] === newValue) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        target[key] = newValue</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementsByClassName(<span class="string">'h2'</span>)[<span class="number">0</span>].textContent = target[key]    </span></span><br><span class="line"><span class="javascript">        <span class="comment">// 可直接访问多个属性</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="发布-订阅模式"><a href="#发布-订阅模式" class="headerlink" title="发布/订阅模式"></a>发布/订阅模式</h2><p>发布订阅模式：订阅者、发布者、信号中心。</p><blockquote><p>当某个任务执行完成，就像信号中心“发布”（publish）一个信号，其它任务可以向信号中心“订阅”（subscribe）这个信号，<br>从而知道自己什么时候可以开始执行，这就叫“发布订阅模式”（publish-subscribe pattern）。</p></blockquote><blockquote><p><a href="https://cn.vuejs.org/v2/guide/components-custom-events.html" target="_blank" rel="noopener">Vue 的自定义事件</a>，以及 node 中的事件机制，都是基于发布/订阅模式的。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    let vm = new Vue()</span><br><span class="line"></span><br><span class="line">    vm.$on(&apos;dataChange&apos;, () =&gt; &#123;</span><br><span class="line">        console.log(&apos;dataChange&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    vm.$on(&apos;dataChange&apos;, () =&gt; &#123;     // 触发后的监听</span><br><span class="line">        console.log(&apos;dataChange1&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    vm.$emit(&apos;dataChange&apos;)   // 触发</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>兄弟组件通信过程：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    // eventBus.js</span><br><span class="line">    // 事件中心</span><br><span class="line">    let eventHub = new Vue()</span><br><span class="line"></span><br><span class="line">    // ComponentA.vue</span><br><span class="line">    // 发布者</span><br><span class="line">    addTodo: function() &#123;</span><br><span class="line">        // 发布消息事件</span><br><span class="line">        eventHub.$emit(&apos;add-todo&apos;, &#123; text: this.newTodoText &#125;)</span><br><span class="line">        this.newTodoText = &apos;&apos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ComponentB.vue</span><br><span class="line">    // 订阅者</span><br><span class="line">    created: function() &#123;</span><br><span class="line">        // 订阅者事件</span><br><span class="line">        eventHub.$on(&apos;add-todo&apos;, this.addTodo)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>模拟自定义事件的实现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    let vm = new Vue()</span><br><span class="line"></span><br><span class="line">    // 注册事件（订阅消息）</span><br><span class="line">    vm.$on(&apos;dataChange&apos;, () =&gt; &#123;</span><br><span class="line">        console.log(&apos;dataChange&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 触发事件（发布消息）</span><br><span class="line">    vm.$on(&apos;dataChange&apos;, () =&gt; &#123;     // 触发后的监听</span><br><span class="line">        console.log(&apos;dataChange1&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    vm.$emit(&apos;dataChange&apos;)   // 触发</span><br><span class="line"></span><br><span class="line">    // $on: &#123; &apos;click&apos;: [fn1, fn2, fn3], &apos;change&apos;: [fn] &#125;</span><br><span class="line">    // $emit : 根据属性名称找到对应的函数之后依次执行</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // 事件触发器</span><br><span class="line">    class EventEmitter &#123;</span><br><span class="line">        constructor () &#123;</span><br><span class="line">            // &#123; &apos;click&apos;: [fn1, fn2, fn3], &apos;change&apos;: [fn] &#125;</span><br><span class="line">            this.subs = Object.create(null)   // &#123;&#125;, null 表示不需要原型，提高性能 </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 注册事件</span><br><span class="line">        $on(eventType, handler) &#123;</span><br><span class="line">            this.subs[eventType] = this.subs[eventType] || []</span><br><span class="line">            this.subs[eventType].push(handler)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 触发事件</span><br><span class="line">        $emit(eventType) &#123;</span><br><span class="line">            if (this.subs[eventType]) &#123;</span><br><span class="line">                this.subs[eventType].forEach(handler=&gt;&#123;</span><br><span class="line">                    handler()</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let em = new EventEmitter()</span><br><span class="line">    em.$on(&apos;click&apos;, () =&gt; &#123;</span><br><span class="line">        console.log(&apos;click1&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    em.$on(&apos;click&apos;, () =&gt; &#123;</span><br><span class="line">        console.log(&apos;click2&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line">    em.$emit(&apos;click&apos;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p>观察者（订阅者）：Watcher</p><ul><li>update(): 当事件发生时，具体要做的事情。</li></ul><p>目标（发布者）：Dep</p><ul><li>subs 数组：存储所有的观察者。</li><li>addSub()：添加观察者。</li><li>notify()：当事件发生，调用所有观察者的 update() 方法。</li></ul><p>没有事件中心</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    // 发布者 —— 目标</span><br><span class="line">    class Dep &#123;</span><br><span class="line">        constructor () &#123;</span><br><span class="line">            // 记录所有的订阅者</span><br><span class="line">            this.subs = []</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        addSub (sub) &#123;    // 用来添加观察者</span><br><span class="line">            if (sub &amp;&amp; sub.update) &#123;    // sub 订阅者存在，并且订阅者有 update 方法</span><br><span class="line">                this.subs.push(sub)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        notify () &#123;    // 当事件发生，调用所有观察者的 update() 方法。</span><br><span class="line">            this.subs.forEach(sub =&gt; &#123;</span><br><span class="line">                sub.update()</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 订阅者 —— 观察者</span><br><span class="line">    class Watcher &#123;</span><br><span class="line">        update () &#123;</span><br><span class="line">            console.log(&apos;Watcher update&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 测试</span><br><span class="line">    let dep = new Dep()</span><br><span class="line">    let watcher = new Watcher()</span><br><span class="line"></span><br><span class="line">    dep.addSub(watcher)</span><br><span class="line">    dep.notify()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>观察者模式、发布订阅者模式的区别：</p><p>观察者模式：是由具体目标调度，比如当前事件触发，Dep 就会去调用观察者的方法，所以观察者模式的订阅者与发布者之间是存在依赖的。</p><p>发布订阅者模式：由统一调度中心调度，因此发布者和订阅者不需要知道对方的存在。</p><h1 id="VUE-响应式原理模拟"><a href="#VUE-响应式原理模拟" class="headerlink" title="VUE 响应式原理模拟"></a>VUE 响应式原理模拟</h1><blockquote><p>所要模拟的项 Vue、Compiler（解析指令）、Observer（数据劫持）、Watcher（观察者）、Dep（发布者）。</p><p>打印Vue实例可以看出，构造函数内部会把data中的数据转换为 <code>getter/setter</code> 注入到Vue实例上。<br>这样在其他地方使用的时候就可以用使用 this 来调用了。</p><p><code>$data</code> 中记录了data并转换为了 <code>getter/setter</code>，它是真正监听数据变化的地方。</p><p><code>$options</code> 中记录了构造函数的参数。</p><p><code>_data</code> 和 <code>$data</code> 指向的是同一个对象。<code>_data</code>私有成员，<code>$data</code>公共成员。</p><p><code>$el</code> 对应选项中的 el。注意 el选项可以是选择器，也可以说是DOM对象。</p></blockquote><p>测试代码：<br><code>test.html</code>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>差值表达式<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-text<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-text</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-model<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"msg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"count"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/dep.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/watcher.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/compiler.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/observer.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/vue.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">'#app'</span>,</span></span><br><span class="line"><span class="undefined">        data: &#123;</span></span><br><span class="line"><span class="javascript">            msg: <span class="string">'你好'</span>,</span></span><br><span class="line"><span class="undefined">            count: 100,</span></span><br><span class="line"><span class="javascript">            person: &#123; <span class="attr">name</span>: <span class="string">'zs'</span> &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(vm)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="模拟Vue"><a href="#模拟Vue" class="headerlink" title="模拟Vue"></a>模拟Vue</h2><p>实现功能：</p><ol><li>负责接收初始化的参数（选项）。</li><li>负责把 data 中的属性注入到 Vue 实例，转换为 getter/setter。</li><li>负责调用 observer 监听 data 中所有属性的变化。</li><li>负责调用 compiler 解析指令、差值表达式。</li></ol><p>结构：<br>Vue: <code>$option</code> / <code>$el</code> / <code>$data</code> 和 <code>_proxyData()</code>。</p><p>代码：</p><p><code>vue.js</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">        <span class="comment">// 1. 通过属性保存选项的数据。</span></span><br><span class="line">        <span class="comment">// 2. 把 data 中的成员转换成 getter/setter。</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.$options = options || &#123;&#125;</span><br><span class="line">        <span class="keyword">this</span>.$data = options.data || &#123;&#125;</span><br><span class="line">        <span class="keyword">this</span>.$el = <span class="keyword">typeof</span> options.el === <span class="string">'string'</span> ? <span class="built_in">document</span>.querySelector(options.el) : options.el</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>._proxyData(<span class="keyword">this</span>.$data)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 调用 observer 对象，监听数据的变化。</span></span><br><span class="line">        <span class="keyword">new</span> Observer(<span class="keyword">this</span>.$data)</span><br><span class="line">        <span class="comment">// 4. 调用 compiler 对象，解析指令和差值表达式。</span></span><br><span class="line">        <span class="keyword">debugger</span></span><br><span class="line">        <span class="keyword">new</span> Compiler(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _proxyData (data) &#123;</span><br><span class="line">        <span class="comment">// 遍历 data 对象，调用 Object.defineProperty 将data中的属性其注入到实例 this 中（方便调用）</span></span><br><span class="line">        <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 箭头函数未改变 this 指向实例，如果是 function 指向 window</span></span><br><span class="line">            <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, key, &#123;</span><br><span class="line">                enumerable: <span class="literal">true</span>,</span><br><span class="line">                configurable: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">                <span class="keyword">get</span> () &#123;</span><br><span class="line">                    <span class="keyword">return</span> data[key]</span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">                <span class="keyword">set</span> (newValue) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(newValue === data[key])&#123;</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    data[key] = newValue</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="模拟-Observer"><a href="#模拟-Observer" class="headerlink" title="模拟 Observer"></a>模拟 Observer</h2><p>实现功能：</p><ol><li>负责把 data 选项中的属性转换成响应式数据。</li><li>data 中的某个属性也是对象，把该属性转换成响应式数据。</li><li>数据变化发生通知。</li></ol><p>结构：<br>Observer：<code>walk(data)</code>（遍历 data 属性）、<code>defineReactive(data, key, value)</code>（转换为 getter/setter 定义响应式数据）。</p><p>代码：</p><p><code>Observer.js</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(data)&#123;</span><br><span class="line">        <span class="keyword">this</span>.walk(data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    walk (data) &#123;</span><br><span class="line">        <span class="comment">// 1. 判断 data 是否为对象，增强代码健壮性</span></span><br><span class="line">        <span class="keyword">if</span>( !data || <span class="keyword">typeof</span> data !== <span class="string">'object'</span> ) &#123;  <span class="comment">// null 非对象直接返回</span></span><br><span class="line">            <span class="keyword">return</span> </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 遍历 data 对象的所有属性，将其转换为 getter、setter</span></span><br><span class="line">        <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.defineReactive(data, key, data[key])   </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义响应式数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; obj  data 对象</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; key  属性</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; val  属性对应的值</span></span><br><span class="line"><span class="comment">     * @memberof Observer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    defineReactive (obj, key, val) &#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="keyword">this</span>  <span class="comment">// set 内部调用 walk 使用</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> dep = <span class="keyword">new</span> Dep()   <span class="comment">// 负责收集依赖，将来</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果 val 是对象，递归调用，将 val 内部的属性也准换为响应式数据。</span></span><br><span class="line">        <span class="keyword">this</span>.walk(val)  <span class="comment">// 调用 this.walk，walk内部有判断，只有在 val 是对象时生效。</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">            enumerable: <span class="literal">true</span>,</span><br><span class="line">            configurable: <span class="literal">true</span>,</span><br><span class="line">            <span class="keyword">get</span> () &#123;</span><br><span class="line">                Dep.target &amp;&amp; dep.addSub(Dep.target) <span class="comment">// 收集依赖，将来数据变化时发送通知</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 这里不能使用 obj[key]，当 vm.val 调用时会发生死递归</span></span><br><span class="line">                <span class="keyword">return</span> val    </span><br><span class="line">                <span class="comment">// val 可以 是因为外部data对get有引用，在此处产生了 Closure 闭包，</span></span><br><span class="line">                <span class="comment">// 使val可以延续作用域 </span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">set</span> (newVal) &#123;</span><br><span class="line">                <span class="keyword">if</span> (newVal === val) &#123;</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">                val = newVal</span><br><span class="line">                that.walk(newVal)  <span class="comment">// 确保修改后为对象的内部属性数据也是响应式的。</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 发送通知</span></span><br><span class="line">                dep.notify()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>要确保数据中的对象的属性也是响应式的。</li><li>在将普通数据改变为对象时也确保内部属性是响应式数据。</li></ol><blockquote><p>都是利用递归调用解决的。</p></blockquote><h2 id="模拟-Compiler"><a href="#模拟-Compiler" class="headerlink" title="模拟 Compiler"></a>模拟 Compiler</h2><p>实现功能：（操作DOM）</p><ol><li>编译模板，解析指令、差值表达式。</li><li>负责页面的首次渲染。</li><li>当数据变化后重新渲染视图。</li></ol><p>结构：<br>Compiler: <code>el</code>（DOM） / <code>vm</code>（实例）、<code>compile(el)</code> / <code>compilerElement(node)</code> / <code>compileText(node)</code>（dom操作）</p><p>代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(vm)&#123;</span><br><span class="line">        <span class="keyword">this</span>.el = vm.$el</span><br><span class="line">        <span class="keyword">this</span>.vm = vm</span><br><span class="line">        <span class="keyword">debugger</span></span><br><span class="line">        <span class="keyword">this</span>.compile(<span class="keyword">this</span>.el) <span class="comment">// 创建 Compile 立即调用 compile 函数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *编译模板处理文本节点 和 元素节点</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; el</span></span><br><span class="line"><span class="comment">     * @memberof Compiler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    compile (el) &#123;</span><br><span class="line">        <span class="keyword">debugger</span></span><br><span class="line">        <span class="comment">// el就是 id="app" 的这个div，我们要遍历其中所有的节点（不是元素） </span></span><br><span class="line">        <span class="comment">// childNodes（不是 children 子元素）</span></span><br><span class="line">        <span class="keyword">let</span> childNodes = el.childNodes <span class="comment">// 伪数组 拿到的只是第一层子结点</span></span><br><span class="line">        <span class="built_in">Array</span>.from(childNodes).forEach(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.isTextNode(node)) &#123; </span><br><span class="line">                <span class="keyword">debugger</span></span><br><span class="line">                <span class="comment">// 如果是文本节点</span></span><br><span class="line">                <span class="keyword">this</span>.compileText(node)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.isElementNode(node)) &#123; </span><br><span class="line">                <span class="comment">// 处理元素节点</span></span><br><span class="line">                <span class="keyword">this</span>.compileElement(node)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断 node节点 是否有子节点，如果有递归调用 compile</span></span><br><span class="line">            <span class="keyword">if</span> (node.childNodes &amp;&amp; node.childNodes.length) &#123;</span><br><span class="line">                <span class="keyword">this</span>.compile(node)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *编译元素节点，处理指令</span></span><br><span class="line"><span class="comment">     * 1.遍历所有的属性节点</span></span><br><span class="line"><span class="comment">     * 2.判断是否有指令</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; node 要处理的元素</span></span><br><span class="line"><span class="comment">     * @memberof Compiler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    compileElement (node) &#123;</span><br><span class="line">        <span class="comment">// 1.遍历所有的属性节点</span></span><br><span class="line">        <span class="built_in">Array</span>.from(node.attributes).forEach(<span class="function">(<span class="params">attr</span>) =&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> attrName = attr.name</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.isDirective(attrName)) &#123;</span><br><span class="line">                attrName = attrName.substring(<span class="number">2</span>)  </span><br><span class="line">                <span class="comment">// 去掉 v- 方便之后封装指令方法调用 update()</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">let</span> key = attr.value</span><br><span class="line">                <span class="keyword">this</span>.update(node, key, attrName)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.dir(node.attributes)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *封装调用指令方法的名字</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; node</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; key</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; attrName</span></span><br><span class="line"><span class="comment">     * @memberof Compiler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    update (node, key, attrName) &#123;</span><br><span class="line">        <span class="keyword">let</span> updateFn = <span class="keyword">this</span>[attrName + <span class="string">'Updater'</span>]  <span class="comment">// this.~Updater</span></span><br><span class="line">        <span class="comment">// updateFn &amp;&amp; updateFn(node, this.vm[key], key)</span></span><br><span class="line">        updateFn &amp;&amp; updateFn.call(<span class="keyword">this</span>, node, <span class="keyword">this</span>.vm[key], key)   </span><br><span class="line">        <span class="comment">// 改变 this 指向 Compiler，使watcher可以调用 this.vm</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *处理 v-text 指令</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; node 元素</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; value 值</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; key 属性名key</span></span><br><span class="line"><span class="comment">     * @memberof Compiler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    textUpdater (node, value, key) &#123;</span><br><span class="line">        node.textContent = value</span><br><span class="line">        <span class="keyword">new</span> Watcher(<span class="keyword">this</span>.vm, key, (newValue) =&gt; &#123;</span><br><span class="line">            node.textContent = newValue</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *处理 v-model 指令</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; node 元素</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; value 值</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; key 属性名key</span></span><br><span class="line"><span class="comment">     * @memberof Compiler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    modelUpdater (node, value, key) &#123;</span><br><span class="line">        node.value = value    <span class="comment">// 表单属性获取值用 node.value</span></span><br><span class="line">        <span class="keyword">new</span> Watcher(<span class="keyword">this</span>.vm, key, (newValue) =&gt; &#123;</span><br><span class="line">            node.value = newValue</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 给表单元素绑定 input 事件，解决双向绑定问题。</span></span><br><span class="line">        node.addEventListener(<span class="string">'input'</span>, () =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.vm[key] = node.value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *编译文本，处理差值表达式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; node</span></span><br><span class="line"><span class="comment">     * @memberof Compiler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    compileText (node) &#123;</span><br><span class="line">        <span class="comment">// 使用正则 &#123;&#123; msg &#125;&#125;</span></span><br><span class="line">        <span class="keyword">let</span> reg = <span class="regexp">/\&#123;\&#123;(.+?)\&#125;\&#125;/</span>  </span><br><span class="line">        <span class="comment">// .+ 匹配任意多的字符，? 表示非贪婪模式，尽可能早的结束匹配</span></span><br><span class="line">        <span class="keyword">let</span> value = node.textContent</span><br><span class="line">        <span class="keyword">if</span> (reg.test(value)) &#123;</span><br><span class="line">            <span class="keyword">let</span> key = <span class="built_in">RegExp</span>.$<span class="number">1.</span>trim()   </span><br><span class="line">             <span class="comment">// 获取到第一个分组的内容（空格内部内容） 并去除空格</span></span><br><span class="line">            node.textContent = value.replace(reg, <span class="keyword">this</span>.vm[key])</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建 Watcher 对象，当数据改变更新视图</span></span><br><span class="line">            <span class="keyword">new</span> Watcher(<span class="keyword">this</span>.vm, key, (newValue) =&gt; &#123;</span><br><span class="line">                node.textContent = newValue</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *判断元素属性是否是指令</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; attrName 属性名字</span></span><br><span class="line"><span class="comment">     * @memberof Compiler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    isDirective (attrName) &#123;</span><br><span class="line">        <span class="keyword">return</span> attrName.startsWith(<span class="string">'v-'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *判断节点是否是文本节点</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; node</span></span><br><span class="line"><span class="comment">     * @memberof Compiler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    isTextNode (node) &#123;</span><br><span class="line">        <span class="keyword">debugger</span></span><br><span class="line">        <span class="comment">// 节点有个属性为 nodeType , 3为文本节点，1为元素节点，nodeValue 为节点的值</span></span><br><span class="line">        <span class="keyword">return</span> node.nodeType === <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *判断节点是否是元素节点</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; node 元素</span></span><br><span class="line"><span class="comment">     * @memberof Compiler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    isElementNode (node) &#123;</span><br><span class="line">        <span class="comment">// 节点有个属性为 nodeType , 3为文本节点，1为元素节点，nodeValue 为节点的值</span></span><br><span class="line">        <span class="keyword">return</span> node.nodeType === <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="模拟发布者-Dep"><a href="#模拟发布者-Dep" class="headerlink" title="模拟发布者 Dep"></a>模拟发布者 Dep</h2><p>实现功能：</p><ol><li>收集依赖，添加观察者（watcher）。</li><li>通知所有观察者。</li></ol><p>结构：<br>Dep：subs、addSub()/notify()</p><p>代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> () &#123;</span><br><span class="line">        <span class="comment">// 存储所有的观察者</span></span><br><span class="line">        <span class="keyword">this</span>.subs = []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *添加观察者</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; sub</span></span><br><span class="line"><span class="comment">     * @memberof Dep</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    addSub (sub) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sub &amp;&amp; sub.update) &#123; <span class="comment">// 默认观察者都有一个 update 方法，判断是否是观察者</span></span><br><span class="line">            <span class="keyword">this</span>.subs.push(sub)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *发送通知</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @memberof Dep</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    notify () &#123;</span><br><span class="line">        <span class="keyword">this</span>.subs.forEach(<span class="function"><span class="params">sub</span> =&gt;</span> &#123;</span><br><span class="line">            sub.update()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="模拟-Watcher-类"><a href="#模拟-Watcher-类" class="headerlink" title="模拟 Watcher 类"></a>模拟 Watcher 类</h2><p>实现功能：</p><ol><li>当数据变化触发依赖 dep，dep 通知所有的 Watcher 实例更新视图。</li><li>自身实例化的时候往 dep 对象中添加自己。</li></ol><p>结构：<br>Dep：vm / key / cb / oldValue、update()</p><p>代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (vm, key, cb) &#123;</span><br><span class="line">        <span class="keyword">this</span>.vm = vm</span><br><span class="line">        <span class="keyword">this</span>.key = key   <span class="comment">// data 中的属性名称</span></span><br><span class="line">        <span class="keyword">this</span>.cb = cb     <span class="comment">// 回调函数负责更新视图</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把watcher对象记录到 Dep 类的静态属性 target 中</span></span><br><span class="line">        Dep.target = <span class="keyword">this</span></span><br><span class="line">        <span class="comment">// 触发 get 方法，在 get 方法中会调用 addSub</span></span><br><span class="line">        <span class="keyword">this</span>.oldValue = vm[key]     <span class="comment">// 访问就会触发 get</span></span><br><span class="line">        Dep.target = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *当数据发生变化时更新视图</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @memberof Watcher</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    update () &#123;</span><br><span class="line">        <span class="comment">// 在调用 update 时，数据已经发生了变化，先获取新值</span></span><br><span class="line">        <span class="keyword">let</span> newValue = <span class="keyword">this</span>.vm[<span class="keyword">this</span>.key]</span><br><span class="line">        <span class="keyword">if</span> (newValue === <span class="keyword">this</span>.oldValue) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.cb(newValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="解决双向绑定问题"><a href="#解决双向绑定问题" class="headerlink" title="解决双向绑定问题"></a>解决双向绑定问题</h2><p>解决视图变化，数据跟着变化：给表单元素绑定 input 事件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *处理 v-model 指令</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; node 元素</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; value 值</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; key 属性名key</span></span><br><span class="line"><span class="comment"> * @memberof Compiler</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">modelUpdater (node, value, key) &#123;</span><br><span class="line">    node.value = value    <span class="comment">// 表单属性获取值用 node.value</span></span><br><span class="line">    <span class="keyword">new</span> Watcher(<span class="keyword">this</span>.vm, key, (newValue) =&gt; &#123;</span><br><span class="line">        node.value = newValue</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给表单元素绑定 input 事件，解决双向绑定问题。</span></span><br><span class="line">    node.addEventListener(<span class="string">'input'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.vm[key] = node.value</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><blockquote><p>将 data 中的属性重新赋值成对象，是响应式的。</p></blockquote><blockquote><p>通过 <code>vm.b = &#39;b&#39;</code> 新添加一个属性是非响应式的，未遍历转换为 getter/setter。<br>可以通过 <code>Vue.set(object, propertyName, value)</code> 实现，实际上是单独调用了转换为 getter/setter 的方法。</p></blockquote><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://cn.vuejs.org/v2/guide/reactivity.html%5D" target="_blank" rel="noopener">[https://cn.vuejs.org/v2/guide/reactivity.html]</a></p></blockquote><blockquote><p><a href="https://github.com/answershuto/learnVue/blob/master/docs/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.MarkDown" target="_blank" rel="noopener">https://github.com/answershuto/learnVue/blob/master/docs/响应式原理.MarkDown</a></p></blockquote><blockquote><p><a href="https://blog.fundebug.com/2019/07/10/responsive-vue/" target="_blank" rel="noopener">https://blog.fundebug.com/2019/07/10/responsive-vue/</a></p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</a></p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;vue 响应式原理…
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="vue" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/vue/"/>
    
      <category term="vue响应式原理" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="vue" scheme="http://yoursite.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue 原理深度剖析（一）</title>
    <link href="http://yoursite.com/2020/09/01/Vue_1_vueRouter/"/>
    <id>http://yoursite.com/2020/09/01/Vue_1_vueRouter/</id>
    <published>2020-09-01T13:38:00.000Z</published>
    <updated>2020-09-01T13:46:50.973Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>从vue-Router开始… <a id="more"></a></p></blockquote><h1 id="vue-基础语法"><a href="#vue-基础语法" class="headerlink" title="vue 基础语法"></a>vue 基础语法</h1><h2 id="vue-js-的基础结构"><a href="#vue-js-的基础结构" class="headerlink" title="vue.js 的基础结构"></a>vue.js 的基础结构</h2><ol><li><p>一般结构，利用template模板双向绑定数据。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;p&gt;公司名称：&#123;&#123;company.name&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn....&quot;&gt;&lt;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    new Vue(&#123;</span><br><span class="line">        el: &apos;#app&apos;,</span><br><span class="line">        data: &#123;</span><br><span class="line">            company: &#123;</span><br><span class="line">                name: &apos;la&apos;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p>利用 render 方法，它的参数 h函数 是为了创建虚拟DOM。$mount是将虚拟 DOM 转换为真实 DOM。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn....&quot;&gt;&lt;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    new Vue(&#123;</span><br><span class="line">        data: &#123;</span><br><span class="line">            company: &#123;</span><br><span class="line">                name: &apos;la&apos;,</span><br><span class="line">            &#125;,</span><br><span class="line">            render(h)&#123;</span><br><span class="line">                return h(&apos;div&apos;, [</span><br><span class="line">                    h(&apos;p&apos;, &apos;公司名称：&apos; + this.company.name)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).$mount(&apos;#app&apos;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>这两种的方式不同，结果相同</p></blockquote><h2 id="vue-js-的生命周期"><a href="#vue-js-的生命周期" class="headerlink" title="vue.js 的生命周期"></a>vue.js 的生命周期</h2><p><a href="https://cn.vuejs.org/images/lifecycle.png" target="_blank" rel="noopener">略</a></p><blockquote><p>如果使用构造生成文件（例如构造单文件组件），模板编译将提前执行。（推荐）</p></blockquote><h2 id="常用语法和概念"><a href="#常用语法和概念" class="headerlink" title="常用语法和概念"></a>常用语法和概念</h2><p>差值表达式、指令（自定义指令）、计算属性和侦听器、Class/Style 绑定、条件/列表渲染、表单输入绑定……(略)</p><p>组件（可复用vue实例）、插槽、插件（VueRouter/VueX…）、混入 mixin（多个组件有相同的选项，将相同的选项进行合并，使代码可重用）、响应式原理（利用监听代理机制）、不同构建版本的Vue</p><h1 id="vue-Router-原理分析与实现"><a href="#vue-Router-原理分析与实现" class="headerlink" title="vue Router 原理分析与实现"></a>vue Router 原理分析与实现</h1><blockquote><p><a href="https://router.vuejs.org/zh/%5D" target="_blank" rel="noopener">[https://router.vuejs.org/zh/]</a></p></blockquote><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>略：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span>  <span class="comment">// 引入</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)   <span class="comment">// 注册路由插件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [     <span class="comment">// 路由规则</span></span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/'</span>,</span><br><span class="line">        name: <span class="string">'Index'</span>,</span><br><span class="line">        component: Index</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;  <span class="comment">// 创建路由对象</span></span><br><span class="line">    routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在实例上注册 router 对象</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router,   </span><br><span class="line">    <span class="comment">// 将$route（存储了路径及参数） </span></span><br><span class="line">    <span class="comment">// $router（一个路由对象实例，提供一些与路由相关的方法） 注册到实例上</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件上</span></span><br><span class="line"><span class="comment">// &lt;router-link to="/"&gt;&lt;/router-link&gt;  类似 a 连接</span></span><br><span class="line"><span class="comment">// &lt;router-view&gt;&lt;/router-view&gt;   占位符，用来替换路由组件</span></span><br></pre></td></tr></table></figure><h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><p>两种方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [     <span class="comment">// 路由规则</span></span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/'</span>,</span><br><span class="line">        name: <span class="string">'Index'</span>,</span><br><span class="line">        component: Index</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/detail/:id'</span>,</span><br><span class="line">        name: <span class="string">'Detail'</span>,</span><br><span class="line">        <span class="comment">// 开启 props,会把 URL 中的参数传递给组价，在组件中通过 props 来接收</span></span><br><span class="line">        props: <span class="literal">true</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/*webpackChunkName: "detail"*/</span> <span class="string">'../views/Detail.vue'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件获取</span></span><br><span class="line"><span class="comment">// &#123;&#123; $route.param.id&#125;&#125;  // 通过 $route 获取</span></span><br><span class="line"><span class="comment">// &#123;&#123;id&#125;&#125; 通过 props 传参，类似父子组件传值   推荐第二种</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'Detail'</span>,</span><br><span class="line">    props: [<span class="string">'id'</span>]   <span class="comment">// 接收id</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h3><blockquote><p>略，提取了组件相同的“父”部分作为父组件，不同的部分作为子组件。</p></blockquote><h3 id="编程式导航"><a href="#编程式导航" class="headerlink" title="编程式导航"></a>编程式导航</h3><p>就是通过按钮进行页面跳转：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$router.push(<span class="string">'/'</span>)    <span class="comment">// 传入对象 或者 地址字符串</span></span><br><span class="line"><span class="comment">// this.$router.push(&#123;name: 'Home', params: &#123; id: 1&#125;&#125;)   // 传入对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.$router.replace(<span class="string">'/login'</span>)  <span class="comment">// 和 push 效果相同，但是不会记入历史记录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.$router.go(<span class="number">-2</span>)  <span class="comment">// 负数即后退，如果是 -1 的话，就相当于 this.$router.back()</span></span><br></pre></td></tr></table></figure><blockquote><p>Chrome 长按后退按钮可以展示出所有的后退历史</p></blockquote><h2 id="hash模式-和-history模式"><a href="#hash模式-和-history模式" class="headerlink" title="hash模式 和 history模式"></a>hash模式 和 history模式</h2><blockquote><p>这两种模式都是客户端实现路由的模式：当页面发生变化的时候，不会向服务端发起请求，只是用JS监听路由的变化，根据不同的地址渲染不同的内容，如果需要服务端的内容会向服务端发送 AJAX 请求。</p></blockquote><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>hash模式：</p><ol><li><blockquote><p><code>https://....../#/pla?id=1</code> ，路径中会带有与数据无关的符号，“#”，“?”…</p></blockquote></li><li><p>原理：基于锚点，以及 <code>onhashchange</code> 事件。</p></li></ol><p>history模式:</p><ol><li><blockquote><p><code>https://....../pla/1</code> ，但需要服务端配置支持。</p></blockquote></li><li><p>原理：基于 HTML5 中的 History API。 <code>history.pushState() （IE10之后支持） / history.replaceState()</code> 将路径放到历史记录里。</p></li></ol><h3 id="history模式"><a href="#history模式" class="headerlink" title="history模式"></a>history模式</h3><blockquote><p>单页面应用中，服务端不存在 <code>https://....../pla/1</code> 这样的地址，会报错，404找不到地址。<br>服务端应配置，除了静态资源都返回单页面应用的 index.html。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认是 hash 模式，需要将 mode 改为 history 模式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    mode: <span class="string">'history'</span>,</span><br><span class="line">    routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [     <span class="comment">// 路由规则</span></span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'*'</span>,</span><br><span class="line">        name: <span class="string">'404'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/*webpackChunkName: '404'*/</span> <span class="string">'../views/404.vue'</span>) </span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p><code>localhost:8080/video</code> 刷新会向服务端发送请求，然后返回 404。为了解决这个问题，需要额外配置。</p></blockquote><p>node 服务器配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入处理 history 模式模块</span></span><br><span class="line"><span class="keyword">const</span> history = <span class="built_in">require</span>(<span class="string">'connect-history-api-fallback'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册 处理 history 模式的中间件</span></span><br><span class="line">app.use(history())       <span class="comment">// 解决方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理静态资源的中间件，网站根目录 ../web</span></span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'../web'</span>)))</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务器开启，端口：3000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>服务器会默认将 index.html 返回，返回后 浏览器再去判断地址后面的参数</p></blockquote><p>nginx 服务器配置：</p><ol><li>从官网下载 nginx 的压缩包。</li><li>把压缩包解压到 c 盘根目录，<code>c:\nginx-1.18.0</code> 文件夹。</li><li>打开命令行，切换到目录 <code>c:\nginx-1.18.0</code>。(目录不能有中文)</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 启动</span><br><span class="line">start nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 重启</span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>停止</span><br><span class="line">nginx -s stop</span><br><span class="line">nginx-1.18.0</span><br><span class="line">    |———— conf       # 配置文件</span><br><span class="line">    |      |———— nginx.conf</span><br><span class="line">    |———— contrib</span><br><span class="line">    |———— docs</span><br><span class="line">    |———— html       # 存储我们的网站,打包好的内容放到该目录</span><br><span class="line">    |———— logs</span><br><span class="line">    |———— temp</span><br><span class="line">nginx.exe</span><br></pre></td></tr></table></figure><p><code>nginx.conf</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    listen    80; # 配置端口号</span><br><span class="line">    server_name  localhost;       # 域名，未绑到线上，默认为 localhost</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root  html;    # 指定根目录 html 文件夹</span><br><span class="line">        index index.html index.htm;  # 默认的首页</span><br><span class="line">        try_files $uri $uri/ /index.html;  # 配置 history 模式   </span><br><span class="line"></span><br><span class="line">        # 就是尝试请求文件或文件下的 index.html，如果都没有则返回 默认首页 index.html</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span> 配置完之后重启 nginx</span><br></pre></td></tr></table></figure><h2 id="模拟实现VueRouter"><a href="#模拟实现VueRouter" class="headerlink" title="模拟实现VueRouter"></a>模拟实现VueRouter</h2><blockquote><p>前置知识：插件、混入、<code>Vue.observable()</code>、插槽、render 函数、运行时和完整版的vue</p></blockquote><h3 id="vueRouter-实现原理"><a href="#vueRouter-实现原理" class="headerlink" title="vueRouter 实现原理"></a>vueRouter 实现原理</h3><p>前端路由，判断前端路径加载不同的组件：</p><p><code>hash</code> 模式：</p><ol><li>URL 中 # 后面的内容作为 路径地址。</li><li>监听 <code>hashchange</code> 事件。</li><li>根据当前路由地址找到对应的组件重新渲染。</li></ol><p><code>history</code> 模式：</p><ol><li>路径是普通的URL，通过 <code>history.pushState()</code> 方法改变地址栏，并把当前路径记录到历史记录里，并不会真正的跳转到指定路径，就不会向服务器发送请求。</li><li>监听 <code>popstate</code> 事件，监听浏览器历史记录的变化。</li><li>根据当前路由地址找到对应组件重新渲染。</li></ol><blockquote><p><code>pushState()</code> / <code>replaceState()</code> 并不会触发该事件。back/forward事件才会被触发。</p></blockquote><h3 id="核心代码分析"><a href="#核心代码分析" class="headerlink" title="核心代码分析"></a>核心代码分析</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册插件  Vue 功能的强大主要就是插件机制，比如VueX，VueRouter 等。</span></span><br><span class="line">Vue.use(VueRouter)    </span><br><span class="line"><span class="comment">// Vue.use() 传入函数或者对象，传入函数直接调用，传入对象，调用其中的 install 方法。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    routes: [</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">'home'</span>, <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">component</span>: homeComponent &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 Vue 实例，注册 router 对象</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(app)</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure><blockquote><p>VueRouter（对象）：</p><ol><li>属性<ul><li>options 传入的对象 路由规则</li><li>data 对象，其中的 current 属性记录当前路由，利用 <code>Vue.observable()</code>方法将其设置为响应式的。</li></ul></li><li>方法<ul><li>Constructor(options):VueRouter 初始化实例属性和方法。</li><li>_install(Vue):void 静态方法，用来实现vue的插件机制。</li><li>init():void 为了调用下面三个方法。</li><li>initEvent():void <code>popstate</code> 事件，监听浏览器历史记录的变化。</li><li>createRouteMap():void 初始化 routeMap 属性。将传入的路由规则转换为键值对的存储到 routeMap 对象中。路由地址对应组件</li><li>initComponents(Vue):void 用来创建 <code>router-link</code> 和 <code>router-view</code> 组价的。</li></ul></li></ol></blockquote><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span>;     <span class="comment">// 用来记录 vue，将其作为全局变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  静态方法，用来实现vue的插件机制</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @static</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; Vue  vue的构造函数</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; options 可选的选项对象</span></span><br><span class="line"><span class="comment">     * @memberof VueRouter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> install (Vue, options) &#123;</span><br><span class="line">        <span class="comment">// 1. 判断当前插件是否已经安装</span></span><br><span class="line">        <span class="comment">// 2. 把 vue 的构造函数记录到全局变量中来，方便后面使用 vue 的构造函数，比如后面创建 vue-link vue-view 需要用到 vue.component</span></span><br><span class="line">        <span class="comment">// 3. 把创建 vue 实例时传入的 router 对象，给它注入到所有 vue 实例上。vue.$router 就是在这个时候注入到实例上的。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1....  它检查它自己</span></span><br><span class="line">        <span class="keyword">if</span> (VueRouter.install.installed) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        VueRouter.install.installed = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2....</span></span><br><span class="line">        _Vue = Vue;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3....</span></span><br><span class="line">        <span class="comment">// _Vue.prototype.$router = this.$options.router</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用混入</span></span><br><span class="line">        _Vue.mixin(&#123; <span class="comment">// 会给所有组件设置该选项</span></span><br><span class="line">            beforeCreate () &#123;    <span class="comment">// this 指向实例</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.$options.router) &#123;   </span><br><span class="line">                    <span class="comment">// 仅在实例上挂载 $router 属性，</span></span><br><span class="line">                    <span class="comment">// 在组件的该 $options 选项中不存在 router,因此不会挂载</span></span><br><span class="line">                    _Vue.prototype.$router = <span class="keyword">this</span>.$options.router</span><br><span class="line">                    <span class="keyword">this</span>.$options.router.init()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates an instance of VueRouter.</span></span><br><span class="line"><span class="comment">     * 初始化实例属性和方法。</span></span><br><span class="line"><span class="comment">     * - options 传入的对象 路由规则</span></span><br><span class="line"><span class="comment">     * - data  对象，其中的 current 属性记录当前路由，利用 `Vue.observable()`方法将其设置为响应式的。</span></span><br><span class="line"><span class="comment">     * - routeMap 对象，记录路由和地址的对应关系</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; options</span></span><br><span class="line"><span class="comment">     * @memberof VueRouter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">constructor</span> (options) &#123;</span><br><span class="line">        <span class="keyword">this</span>.options = options;</span><br><span class="line">        <span class="keyword">this</span>.routeMap = &#123;&#125;;</span><br><span class="line">        <span class="keyword">this</span>.data = _Vue.observable(&#123;    <span class="comment">// 响应式的对象，这点很重要</span></span><br><span class="line">            current: <span class="string">'/'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 包装下面的方法，方便调用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @memberof VueRouter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    init () &#123;</span><br><span class="line">        <span class="keyword">this</span>.createRouteMap();</span><br><span class="line">        <span class="keyword">this</span>.initComponents(_Vue);</span><br><span class="line">        <span class="keyword">this</span>.initEvent()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *遍历所有的路由规则，把路由规则解析成键值对的形式，存储到 routeMap 中</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @memberof VueRouter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    createRouteMap () &#123;</span><br><span class="line">        <span class="keyword">this</span>.options.routes.forEach(<span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.routeMap[route.path] = route.component</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建组件 router-link / router-view</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; Vue vue构造函数，也可以使用全局变量 _vue</span></span><br><span class="line"><span class="comment">     * @memberof VueRouter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    initComponents (Vue) &#123;</span><br><span class="line"></span><br><span class="line">        Vue.component(<span class="string">'router-link'</span>, &#123;</span><br><span class="line">            props: &#123;</span><br><span class="line">                to: <span class="built_in">String</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// template: '&lt;slot&gt;&lt;/slot&gt;'</span></span><br><span class="line"></span><br><span class="line">            render (h) &#123;</span><br><span class="line">                <span class="comment">// h 是用来创建虚拟 dom 的</span></span><br><span class="line">                <span class="comment">// 第一个参数是选择器，第二个参数是要创建的 dom 的属性对象，第三个参数是子元素数组</span></span><br><span class="line">                <span class="keyword">return</span> h(<span class="string">'a'</span>, &#123;</span><br><span class="line">                    attrs: &#123;</span><br><span class="line">                        href: <span class="keyword">this</span>.to</span><br><span class="line">                    &#125;,</span><br><span class="line">                    on: &#123;    <span class="comment">// 注册事件</span></span><br><span class="line">                        click: <span class="keyword">this</span>.clickHandler <span class="comment">// 不要写成事件调用</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, [<span class="keyword">this</span>.$slots.default])</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line">                clickHandler (e) &#123;</span><br><span class="line">                    history.pushState(&#123;&#125;, <span class="string">''</span>, <span class="keyword">this</span>.to);   </span><br><span class="line">                    <span class="comment">// 事件对象参数，网页标题，跳转地址</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">this</span>.$router.data.current = <span class="keyword">this</span>.to   </span><br><span class="line">                    <span class="comment">// this 当前 router-link 组件，使用是挂载到了vue 实例上，</span></span><br><span class="line">                    <span class="comment">// 因此所有组件都可以拿到 $router</span></span><br><span class="line">                    </span><br><span class="line">                    e.preventDefault();      <span class="comment">// 阻止 a 链接的事件调用</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> self = <span class="keyword">this</span>;    <span class="comment">// 存储 vueRouter 实例</span></span><br><span class="line">        Vue.component(<span class="string">'router-view'</span>, &#123;</span><br><span class="line">            render(h)&#123;</span><br><span class="line">                <span class="comment">// 调用 h 函数，返回虚拟 DOM </span></span><br><span class="line">                <span class="comment">// 找到路由地址，根据 routeMap 找到对应的组件，</span></span><br><span class="line">                <span class="comment">// 再利用 h 函数转换为虚拟 DOM，直接返回</span></span><br><span class="line">                <span class="comment">// 要改变地址栏的地址，而不让它去请求服务器，调用方法 history.pushState()</span></span><br><span class="line">                <span class="comment">// 然后把当前地址记录到 当前路由地址 self.data.current</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">const</span> component = self.routeMap[ self.data.current ]    </span><br><span class="line">                <span class="comment">// 根据当前路由地址找到组件</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> h(component) </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *点击前进后退改变组件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @memberof VueRouter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    initEvent () &#123;</span><br><span class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, () =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.data.current = <span class="built_in">window</span>.location.pathname</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>将其引入替代原来的 vueRouter</p></blockquote><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>报错：</p><ol><li>运行时版：不支持 template 模板，需要打包的时候提前编译。vue-cli 默认为运行时版本，效率更高。</li><li>完整版：包含运行时和编译器，体积比运行时版本大 10k 左右，程序运行时把模板转换为 render 函数。</li></ol><p>解决：</p><ol><li><p>通过配置将运行时版本转为完整版</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 vue.config.js 并将其中的 runtimeCompiler 默认值 false 设置为 true</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 选项...</span></span><br><span class="line">    runtimeCompiler: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>通过渲染函数（render()），在运行时版本解决</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题原因所在就是 运行时版本不带编译器，无法将 template 预编译成 render 函数。</span></span><br><span class="line">initComponents (Vue) &#123;</span><br><span class="line">    Vue.component(<span class="string">'router-link'</span>, &#123;</span><br><span class="line">        props: &#123;</span><br><span class="line">            to: <span class="built_in">String</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// template: '&lt;slot&gt;&lt;/slot&gt;'</span></span><br><span class="line">        render (h) &#123; <span class="comment">// h 是用来创建虚拟 dom 的</span></span><br><span class="line">            <span class="comment">// 第一个参数是选择器，第二个参数是要创建的 dom 的属性对象，</span></span><br><span class="line">            <span class="comment">// 第三个参数是子元素数组</span></span><br><span class="line">            <span class="keyword">return</span> h(<span class="string">'a'</span>, &#123;</span><br><span class="line">                attrs: &#123;</span><br><span class="line">                    href: <span class="keyword">this</span>.to</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, [<span class="keyword">this</span>.$slots.default])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="浏览器前进后退问题"><a href="#浏览器前进后退问题" class="headerlink" title="浏览器前进后退问题"></a>浏览器前进后退问题</h4><p>问题：浏览器，前进后退按钮改变地址栏地址，但组件没有响应。</p><p>解决：地址栏发生改变，加载响应的组件。利用 popState()会在历史发生变化时触发，<code>pushState()</code> / <code>replaceState()</code> 并不会触发该事件。back/forward事件才会被触发。</p><p>详见：<code>initEvent()</code>函数。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://cn.vuejs.org/v2/guide/mixins.html" target="_blank" rel="noopener">mixin</a></p></blockquote><blockquote><p><a href="https://cn.vuejs.org/v2/guide/render-function.html" target="_blank" rel="noopener">render</a></p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event%5D" target="_blank" rel="noopener">[https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event]</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;从vue-Router开始…
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="vue" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/vue/"/>
    
      <category term="vueRouter" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/vue/vueRouter/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="vue" scheme="http://yoursite.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>一个 node 环境 npm 打包 errno 134</title>
    <link href="http://yoursite.com/2020/08/25/B%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>http://yoursite.com/2020/08/25/B问题记录/</id>
    <published>2020-08-24T16:28:00.000Z</published>
    <updated>2020-08-24T16:36:14.203Z</updated>
    
    <content type="html"><![CDATA[<p>#errno 134 问题</p><p>报错信息 JS 堆栈溢出 errno 134 <a id="more"></a><br><a href="https://stackoverflow.com/questions/38558989/node-js-heap-out-of-memory" target="_blank" rel="noopener">https://stackoverflow.com/questions/38558989/node-js-heap-out-of-memory</a></p><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><ol><li><p>setx NODE_OPTIONS –max_old_space_size=8192</p><blockquote><p><a href="https://stackoverflow.com/questions/38558989/node-js-heap-out-of-memory" target="_blank" rel="noopener">https://stackoverflow.com/questions/38558989/node-js-heap-out-of-memory</a></p></blockquote></li><li><p>重启 vscode</p></li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>有多种问题都会出现 <strong>errno 134</strong>：</p><ol><li>一种解决方法如上，node JS溢出，解决方法如上。</li><li>还有一种是清除 npm 缓存，及 <code>package-lock.json</code> <code>node_modules</code> 重新 install。</li></ol><blockquote><p><a href="https://stackoverflow.com/questions/57605441/error-this-is-probably-not-a-problem-with-npm-there-is-likely-additional-loggi" target="_blank" rel="noopener">https://stackoverflow.com/questions/57605441/error-this-is-probably-not-a-problem-with-npm-there-is-likely-additional-loggi</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#errno 134 问题&lt;/p&gt;
&lt;p&gt;报错信息 JS 堆栈溢出 errno 134
    
    </summary>
    
      <category term="前端 问题" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF-%E9%97%AE%E9%A2%98/"/>
    
      <category term="node npm 打包问题" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF-%E9%97%AE%E9%A2%98/node-npm-%E6%89%93%E5%8C%85%E9%97%AE%E9%A2%98/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="node npm 打包问题" scheme="http://yoursite.com/tags/node-npm-%E6%89%93%E5%8C%85%E9%97%AE%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>模块化——了解Rollup/parcsell</title>
    <link href="http://yoursite.com/2020/08/19/AWebTool_%E6%A8%A1%E5%9D%97%E5%8C%96_Rollup_parcell/"/>
    <id>http://yoursite.com/2020/08/19/AWebTool_模块化_Rollup_parcell/</id>
    <published>2020-08-19T11:30:00.000Z</published>
    <updated>2020-08-24T15:55:07.861Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Rollup"><a href="#Rollup" class="headerlink" title="Rollup"></a>Rollup</h1><p>ESModule打包器，作用与webpack类似，但是比webpack更加轻量级。它没有像webpack一样的插件机制，仅仅作为一个打包器存在着。<a id="more"></a></p><p>它主要是充分利用了ECM的特性，用来构建扁平化高性能的类库。</p><h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install rollup --save-dev</span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rollup ./src/index.js --format iife --file dist/bundle.js</span><br><span class="line"><span class="meta">#</span> 指定打包入口文件 --format指定输出格式  使用自调用格式</span><br><span class="line"><span class="meta">#</span> --file 指定打包的输出路径</span><br></pre></td></tr></table></figure><p>rollup 会自动默认打开 treeShaking ，只打包使用到的模块，来优化我们打包结果。</p><p>打包的结果及其精简。</p><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p><code>rollup.config.js</code> 配置文件，同样运行在 node 环境中，但它会对该文件另行处理，所以可以继续沿用 ESM 的模块化方式。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    input: <span class="string">'src/index.js'</span>,  <span class="comment">// 入口路径</span></span><br><span class="line">    output: &#123;             <span class="comment">// 出口配置</span></span><br><span class="line">        file: <span class="string">'dist/bundle.js'</span> , <span class="comment">// 出口路径</span></span><br><span class="line">        format: <span class="string">'iife'</span>       <span class="comment">// format 打包格式</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>告诉命令行使用配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rollup --config</span><br><span class="line"><span class="meta">#</span> 也可以指定名称 `rollup --config rollup.config.js`</span><br></pre></td></tr></table></figure><h3 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h3><blockquote><p>当我们需要加载其它类型的资源文件，或导入CommonJS模块，或编译ES的新特性，这些额外的需求也可以使用插件的方式扩展。而且这是它唯一的扩展途径。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">npm install rollup-plugin-json --save-dev # 导入json文件的插件</span><br><span class="line">rollup.config.js</span><br><span class="line">import json from 'rollup-plugin-json'</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    input: 'src/index.js',  // 入口路径</span><br><span class="line">    output: &#123;             // 出口配置</span><br><span class="line">        file: 'dist/bundle.js' , // 出口路径</span><br><span class="line">        format: 'iife'       // format 打包格式</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        json(),     // 将调用结果配置进来</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="加载-npm-模块"><a href="#加载-npm-模块" class="headerlink" title="加载 npm 模块"></a>加载 npm 模块</h3><p>node_modules 下面的第三方的模块，它不能直接通过模块名称引用，需要借助插件来磨平该差异。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev rollup-plugin-node-resolve </span><br><span class="line">npm install lodash-es # 测试 rollup 默认只能加载 ES模式模块</span><br><span class="line">rollup.config.js</span><br><span class="line">import json from 'rollup-plugin-json'</span><br><span class="line">import resolve from 'rollup-plugin-node-resolve';</span><br><span class="line">import commonjs from 'rollup-plugin-commonjs';</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    input: 'src/index.js',  // 入口路径</span><br><span class="line">    output: &#123;             // 出口配置</span><br><span class="line">        file: 'dist/bundle.js' , // 出口路径</span><br><span class="line">        format: 'iife'       // format 打包格式</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        json(),     // 将调用结果配置进来</span><br><span class="line">        resolve(),</span><br><span class="line">        commonjs()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="加载-CommonJS-模块"><a href="#加载-CommonJS-模块" class="headerlink" title="加载 CommonJS 模块"></a>加载 CommonJS 模块</h3><blockquote><p>由于许多 npm 模块还是使用 CommonJS 来导出成员，因此需要对此做出兼容</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev rollup-plugin-commonjs</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/rollup/rollup-plugin-commonjs" target="_blank" rel="noopener">https://github.com/rollup/rollup-plugin-commonjs</a></p></blockquote><h3 id="代码拆分"><a href="#代码拆分" class="headerlink" title="代码拆分"></a>代码拆分</h3><blockquote><p>新版本已经支持代码拆分Code Splitting了，并使用 Dynamic Imports 动态导入的方式实现了按需加载</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">'./logger'</span>).then(<span class="function">(<span class="params">&#123; log &#125;</span>) =&gt;</span> &#123;    <span class="comment">// 使用动态导入</span></span><br><span class="line">    log(<span class="string">'code splitting~'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>修改，<code>rollup.config.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;             <span class="comment">// 出口配置</span></span><br><span class="line">    <span class="comment">// file: 'dist/bundle.js' , // 出口路径</span></span><br><span class="line">    <span class="comment">// format: 'iife'           // format 打包格式</span></span><br><span class="line">    dir: <span class="string">'dist'</span>,       <span class="comment">// 指定多个输出文件使用该参数代替 file 参数</span></span><br><span class="line">    format: <span class="string">'amd'</span>      <span class="comment">// 使用代码拆分不能使用 iife 这种代码格式</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="多入口打包"><a href="#多入口打包" class="headerlink" title="多入口打包"></a>多入口打包</h3><blockquote><p>多入口打包，会内部会提取代码拆分，公共模块，因此不能再使用 iife 输出格式</p></blockquote><p>修改，<code>rollup.config.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// input: 'src/index.js',  // 入口路径</span></span><br><span class="line">    input: [<span class="string">'src/index.js'</span>, <span class="string">'src/main.js'</span>]    <span class="comment">// 1.使用数组或对象</span></span><br><span class="line">    output: &#123;             <span class="comment">// 出口配置</span></span><br><span class="line">        <span class="comment">// file: 'dist/bundle.js' , // 出口路径</span></span><br><span class="line">        <span class="comment">// format: 'iife'       // format 打包格式</span></span><br><span class="line">        dir: <span class="string">'dist'</span>,</span><br><span class="line">        format: <span class="string">'amd'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        json(),     <span class="comment">// 将调用结果配置进来</span></span><br><span class="line">        resolve(),</span><br><span class="line">        commonjs()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>amd 格式不能直接引用到页面上，需要使用实现了amd标准的库加载，比如require.js</p><p><code>&lt;script src=&quot;......./require.js&quot; data-main=&quot;foo.js&quot;&gt; &lt;/script&gt;</code> 指定入口模块路径。</p></blockquote><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>优点：</p><ol><li>输出结果干净扁平</li><li>自动移除引用的代码 treeshking</li><li>打包结果依然完全可读</li></ol><p>缺点:</p><ol><li>加载非 ESM 的第三方模块比较复杂。</li><li>模块最终都被打包到一个函数中，无法实现 HRM 模块热替换。</li><li>浏览器环境中，代码拆分功能依赖 AMD 库。</li></ol><blockquote><p>如果开发应用程序，需要大量三方库，并需要HRM这种模块热替换等，就使用webpack。</p><p>如果开发一个框架或类库，建议使用 Rollup。</p></blockquote><h1 id="Parcel"><a href="#Parcel" class="headerlink" title="Parcel"></a>Parcel</h1><blockquote><p>极速零配置Web应用打包器。</p></blockquote><h2 id="简单实用"><a href="#简单实用" class="headerlink" title="简单实用"></a>简单实用</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install parcel-bundler --save-dev</span><br></pre></td></tr></table></figure><h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><blockquote><p>官方建议我们使用 HTML 文件作为文件打包的入口</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parcel src/index.html</span><br></pre></td></tr></table></figure><blockquote><p>parcel 会根据 html 文件引入的标签找到打包入口并顺着import语句进行打包。</p><p>并且自动开启了一个类似 dev-serve 的开发服务器，并且在修改时会自动刷新服务器。</p></blockquote><h3 id="HMR"><a href="#HMR" class="headerlink" title="HMR"></a>HMR</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="comment">// 只接受一个参数 回调函数，即只有当前模块或者当前模块依赖的模块更新才会触发</span></span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="function"><span class="params">()</span>=&gt;</span>&#123;   </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'hrm'</span>) </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自动安装依赖"><a href="#自动安装依赖" class="headerlink" title="自动安装依赖"></a>自动安装依赖</h3><blockquote><p>parsel 有自动安装依赖的功能</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>    <span class="comment">// 直接使用，parsel会自动安装</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.css'</span>      <span class="comment">// 引入其他文件，比如 css</span></span><br></pre></td></tr></table></figure><blockquote><p>对于其它文件的引入也是零配置的，也可以自动更新。</p></blockquote><h3 id="支持动态导入"><a href="#支持动态导入" class="headerlink" title="支持动态导入"></a>支持动态导入</h3><blockquote><p>内部使用动态导入，它也会自动拆分代码</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">'jquery'</span>).then(<span class="function"><span class="params">$</span> =&gt;</span> &#123;</span><br><span class="line">    $(<span class="string">'div'</span>).append(<span class="string">'&lt;p&gt;你好啦&lt;/p&gt;'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="生产模式打包"><a href="#生产模式打包" class="headerlink" title="生产模式打包"></a>生产模式打包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parcel build src/index.html  # 生产模式打包</span><br></pre></td></tr></table></figure><blockquote><p>parcel 使用的是多进程，相对来说要比 webpack 要快，webpack 需要使用 happypack 插件实现这一点。</p></blockquote><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>优点：</p><ol><li>零配置，使用简单。</li><li>构建速度快。</li></ol><p>缺点：2017发出，生态可能不完善</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://www.rollupjs.com/" target="_blank" rel="noopener">https://www.rollupjs.com/</a></p></blockquote><blockquote><p><a href="https://zh.parceljs.org/" target="_blank" rel="noopener">https://zh.parceljs.org/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Rollup&quot;&gt;&lt;a href=&quot;#Rollup&quot; class=&quot;headerlink&quot; title=&quot;Rollup&quot;&gt;&lt;/a&gt;Rollup&lt;/h1&gt;&lt;p&gt;ESModule打包器，作用与webpack类似，但是比webpack更加轻量级。它没有像webpack一样的插件机制，仅仅作为一个打包器存在着。
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="模块化 Rollup/parcsell" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/%E6%A8%A1%E5%9D%97%E5%8C%96-Rollup-parcsell/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="模块化 Rollup/parcsell" scheme="http://yoursite.com/tags/%E6%A8%A1%E5%9D%97%E5%8C%96-Rollup-parcsell/"/>
    
  </entry>
  
  <entry>
    <title>模块化——深入Webpack对比</title>
    <link href="http://yoursite.com/2020/08/19/AWebTool_%E6%A8%A1%E5%9D%97%E5%8C%96_webpack/"/>
    <id>http://yoursite.com/2020/08/19/AWebTool_模块化_webpack/</id>
    <published>2020-08-19T11:30:00.000Z</published>
    <updated>2020-08-24T15:55:02.404Z</updated>
    
    <content type="html"><![CDATA[<h1 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h1><p>前端范式之一，主流的代码组织方式。<a id="more"></a></p><h2 id="演变过程"><a href="#演变过程" class="headerlink" title="演变过程"></a>演变过程</h2><blockquote><p><em>文件划分</em> (script标签) —— 命名空间的方式 —— IIFE —— 引入模块化规范</p></blockquote><p><em>文件划分</em>，引入全局导致了全局污染，依靠约定。</p><p>命名空间，<em>文件划分</em> 的基础上用对象包裹，解决全局污染，没有私有空间，仍可以被外部访问，没有依赖关系。</p><p>利用 IIFE 立即执行函数的方式，</p><ol><li>封装私有空间，作用域。</li><li>向外暴露成员挂载到全局对象 <code>window</code> 上。</li><li>利用闭包具有私有变量。</li><li>利用自执行函数的参数作为依赖执行。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;$(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)(jQuery) <span class="comment">// 依赖了 jQuery</span></span><br></pre></td></tr></table></figure><h2 id="模块化-规范"><a href="#模块化-规范" class="headerlink" title="模块化 规范"></a>模块化 <em>规范</em></h2><blockquote><p>模块化标准 + 模块加载器（实现自动加载）</p></blockquote><h3 id="Common-js"><a href="#Common-js" class="headerlink" title="Common.js"></a><code>Common.js</code></h3><p>Node提出的一个标准，它约定了以下规范：</p><ol><li>一个文件一个模块。</li><li>每个模块都有一个单独的作用域。</li><li>通过 <code>module.exports</code> 导出成员。</li><li>通过 <code>require</code> 函数载入模块。</li></ol><blockquote><p>Common JS 是以同步模式加载模块，node 的执行机制是启动时加载模块，使用再引入，而浏览器端不能使用，同步模式请求过大会引起性能问题。</p></blockquote><h3 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h3><blockquote><p>Asynchronous Module Definition 异步模块化规范，同期 <code>Require.js</code> 库就实现了该规范，并实现了模块加载器的功能。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="built_in">require</span>(<span class="string">'b'</span>)  <span class="comment">// 加载模块</span></span><br><span class="line">define( ... () =&gt; &#123; <span class="keyword">return</span> c &#125;) <span class="comment">// 定义模块</span></span><br></pre></td></tr></table></figure><p>缺点：使用复杂，模块 JS 文件请求频繁</p><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><blockquote><p>CMD，通用模块定义规范，sea.js 实现了该规范。它的出现时为了降低学习成本。</p></blockquote><h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><blockquote><p>Node环境中遵循 CommonJS 规范，浏览器环境遵循 ES Modules 规范。</p></blockquote><p><code>CommonJS</code>，是内置模块没有兼容等问题。</p><p><code>ES Modules</code>，在新语法中实现，偶尔会有新语法 <strong>兼容问题</strong>。</p><h4 id="ES-Modules"><a href="#ES-Modules" class="headerlink" title="ES Modules"></a><code>ES Modules</code></h4><p>准备工具：</p><ol><li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// script 标签设置 type="module" 的属性就可以以 ES Module 的标准执行其中的JS了</span></span><br></pre></td></tr></table></figure></li><li><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm install serve --save-dev</span><br><span class="line"></span><br><span class="line">npm install browser-sync --save-dev # 具有热更新功能模块</span><br><span class="line">npm link browser-sync</span><br><span class="line">browser-sync . --files **/*.js # 监听所有的 js 文件</span><br></pre></td></tr></table></figure></li></ol><h4 id="基本特性"><a href="#基本特性" class="headerlink" title="基本特性"></a>基本特性</h4><ol><li><p><code>script</code> 标签设置 <code>type=&quot;module&quot;</code>相对于普通的 <code>script</code> 标签会有不同的特性</p><ul><li>自动采用严格模式，忽略 <code>use strict</code>。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">// 严格模式 undefined 非严格模式 window</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>每个 <code>module</code> 都是运行在单独的私有作用域当中。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 私有作用域 划地为营 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> foo = <span class="number">100</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(brr); <span class="comment">// 200</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> brr = <span class="number">200</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(foo); <span class="comment">// undefined</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>外部JS文件是通过 CORS 方式请求的，不在同源地址下，响应需要提供有效 CORS 标头，CORS 标头不支持文件请求。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/jquery@3.4.1/dist/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"https://libs.baidu.com/jquery/2.0.0/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ESM 的 <code>script</code> 会自动的延迟执行脚本，等同于 <code>script</code> 中的 <code>defer</code> 属性。<code>script</code> 会阻塞代码的执行，延迟执行，使得渲染完成之后再执行脚本 。</p></li></ol><h4 id="导出导入"><a href="#导出导入" class="headerlink" title="导出导入"></a>导出导入</h4><ol><li><code>export</code> 关键字导出。</li><li><code>import</code> 关键字导入。</li></ol><blockquote><p><a href="https://es6.ruanyifeng.com/#docs/module" target="_blank" rel="noopener">https://es6.ruanyifeng.com/#docs/module</a></p></blockquote><blockquote><p><a href="https://javascript.ruanyifeng.com/nodejs/module.html" target="_blank" rel="noopener">https://javascript.ruanyifeng.com/nodejs/module.html</a></p></blockquote><h4 id="ESM-兼容性问题"><a href="#ESM-兼容性问题" class="headerlink" title="ESM 兼容性问题"></a>ESM 兼容性问题</h4><h5 id="ESM-in-Browser"><a href="#ESM-in-Browser" class="headerlink" title="ESM in Browser"></a>ESM in Browser</h5><p>IE 不支持 ESM：</p><ol><li>babel 转义为 ES5。</li><li>polyfill 兼容方案<ul><li><code>npm install browser-es-module-loader</code> 。</li><li><code>npm install promise-ployfill --save-exact</code>。</li><li>给 <code>script</code> 标签 <code>nomodule</code> 属性，使其仅在不支持module的浏览器执行</li></ul></li></ol><h5 id="ESM-in-Node-js"><a href="#ESM-in-Node-js" class="headerlink" title="ESM in Node.js"></a>ESM in Node.js</h5><p><code>node &gt; 8.5</code> 可以直接使用 ESM。</p><ol><li><code>index.js</code> 改为 <code>index.mjs</code></li><li><code>node --experimental modules index.mjs</code> 运行试验特性</li></ol><h4 id="与-CommonJS-模块交互"><a href="#与-CommonJS-模块交互" class="headerlink" title="与 CommonJS 模块交互"></a>与 <code>CommonJS</code> 模块交互</h4><ol><li>ESM 中可以导入 CommonJS 模块。</li><li>CommonJS 中不能导入 ESM模块。</li><li>CommonJS 始终只会导出一个默认成员。</li><li>注意 import 不是解构导出对象。</li></ol><h4 id="在-node-中使用-ESM-和-CommonJS-差异"><a href="#在-node-中使用-ESM-和-CommonJS-差异" class="headerlink" title="在 node 中使用 ESM 和 CommonJS 差异"></a>在 node 中使用 ESM 和 CommonJS 差异</h4><p>注意：导入导出可以被 <code>import</code>和<code>exports</code> 代替，<code>__filename</code> 和 <code>__dirname</code> 需要别的方式代替</p><h4 id="新版本支持情况"><a href="#新版本支持情况" class="headerlink" title="新版本支持情况"></a>新版本支持情况</h4><p><code>node 12.~</code>：</p><ol><li>不需要改文件后缀名，需要将<code>package.json</code>中添加字段 <code>&quot;type&quot;: &quot;module&quot;</code>。</li><li>而再想使用 <code>CommonJS</code> 规范，需要将 <code>common.js</code> 改为 <code>common.cjs</code>。</li></ol><h4 id="早期-node-兼容方案"><a href="#早期-node-兼容方案" class="headerlink" title="早期 node 兼容方案"></a>早期 node 兼容方案</h4><p>利用 babel：</p><ol><li><p><code>npm install @babel/node @babel/core @babel/preset-env --save-dev</code>。</p></li><li><p>运行 <code>babel-node</code> 命令。</p></li><li><p><code>preset-env</code> 插件集合。<code>babel-node index.js --preset=@babel/preset-env</code></p></li><li><p>配置<code>.babelrc</code> 文件，<code>&quot;presets&quot;: [&quot;@babel/preset-env&quot;]</code>，presets 是一组插件。</p></li><li><p>使用单独的插件</p></li></ol>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/plugin-transform-modules-commonjs --save-dev</span><br></pre></td></tr></table></figure><ul><li>配置<code>.babelrc</code> 文件，<code>&quot;plugins&quot;: [&quot;@babel/plugin-transform-modules-commonjs&quot;]</code></li></ul><h1 id="模块化打包工具"><a href="#模块化打包工具" class="headerlink" title="模块化打包工具"></a>模块化打包工具</h1><p>主要解决问题：</p><ol><li>环境兼容问题。比如编译转化各种各样的代码。</li><li>将模块化零散的文件打包，减少请求。</li><li>支持其他前端资源模块化。</li></ol><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>webpack：</p><ol><li>模块打包器打包。</li><li>模块加载器。</li><li>代码拆分。（避免打包文件过大）</li><li>将资源模块化引入。</li></ol><blockquote><p>模块化工具是解决的是前端整体的模块化。</p></blockquote><h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init </span><br><span class="line">npm install webpack webpack-cli --save-dev</span><br></pre></td></tr></table></figure><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>webpack4.0 版本：</p><ol><li>支持零配置打包。</li><li>约定 <code>src/index.js</code> 作为入口，<code>dist/main.js</code> 作为出口。</li></ol><p>一般配置，会配置在 <code>webpack.config.js</code> 文件里，因为是运行在node环境中，需要按照 CommonJS 规范。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'development'</span>,</span><br><span class="line">    entry: <span class="string">'./src/main.js'</span>,  <span class="comment">// 入口</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'bundle.js'</span>, <span class="comment">// 出口</span></span><br><span class="line">        path: path.join(__dirname, <span class="string">'output'</span>)    <span class="comment">// 绝对路径</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h3><p>webpack4.0 新增了 <a href="https://webpack.js.org/configuration/mode/" target="_blank" rel="noopener">工作模式</a>，指代针对不同环境预设的配置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WARNING in configuration</span><br><span class="line">The 'mode' option has not been set, webpack will fallback to 'production' for this value. Set 'mode' option to 'development' or 'production' to enable defaults for each environment.</span><br><span class="line">You can also set it to 'none' to disable any default behavior. Learn more: https://webpack.js.org/configuration/mode/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 设置模式</span><br><span class="line">webpack --mode development # 启动开发模式打包</span><br></pre></td></tr></table></figure><ol><li>默认 production 模式，自动启动优化，优化打包结果。</li><li>development 模式，自动添加打包速度，添加一些调试辅助。</li><li>none 模式，不会有任何多余的操作。</li><li>也可以直接在配置文件中添加 mode 属性</li></ol><h3 id="打包结果运行原理"><a href="#打包结果运行原理" class="headerlink" title="打包结果运行原理"></a>打包结果运行原理</h3><blockquote><p>ctrl + K + 0 折叠所有代码</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 源码拆解</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123;  <span class="comment">// 模块 modules = [fn,fn,fn...]</span></span><br><span class="line">    <span class="comment">// The module cache 缓存加载过的模块</span></span><br><span class="line">    <span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The require function 加载模块  </span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 先从缓存中读取，没有则创建新的模块放到缓存中</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ==========</span></span><br><span class="line">        <span class="comment">// 这里是一些数据和工具函数</span></span><br><span class="line">    <span class="comment">// ==========</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load entry module and return exports</span></span><br><span class="line">    <span class="comment">// 加载入口模块并输出</span></span><br><span class="line">    <span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="number">0</span>);</span><br><span class="line">&#125;)([</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;),  <span class="comment">// 这里的参数对应的就是源代码里的一个个模块</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;),  <span class="comment">// 包裹在函数中实现模块私有作用域</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        __webpack_require__.r(__webpack_exports__); <span class="comment">// 调用r函数，向外表明为 ESModule 模块</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure><blockquote><p>将各个模块写入到同一个文件当中，并还保持原来的状态关系</p></blockquote><h3 id="资源模块加载"><a href="#资源模块加载" class="headerlink" title="资源模块加载"></a>资源模块加载</h3><blockquote><p>默认的资源加载器Loader，加载 JS 文件，想要加载不同的文件，就要配置不同的 Loader。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install css-loader --save-dev # css 编译为 js</span><br><span class="line">npm install style-loader --save-dev # 将编译好的追加到 style标签页面上</span><br></pre></td></tr></table></figure><p>其它资源的加载配置，配置在配置文件的 modules 字段里</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/.css$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">                <span class="string">'style-loader'</span>,</span><br><span class="line">                <span class="string">'css-loader'</span>,    <span class="comment">// 多个 loader 从数组后面开始</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="动态导入资源"><a href="#动态导入资源" class="headerlink" title="动态导入资源"></a>动态导入资源</h4><p>利用 <code>import</code> 在需要的地方导入文件，webpack会自动沿着 <code>import</code> 打包。</p><h4 id="代表性-loader"><a href="#代表性-loader" class="headerlink" title="代表性 loader"></a>代表性 <em>loader</em></h4><h5 id="文件资源加载器"><a href="#文件资源加载器" class="headerlink" title="文件资源加载器"></a>文件资源加载器</h5><blockquote><p>根据文件匹配到文件，加载器将文件复制到输出目录，然后将文件所在的输出目录的路径作为返回值返回。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install file-loader --save-dev</span><br></pre></td></tr></table></figure><p><code>webpack.config.js</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span>,</span><br><span class="line">    entry: <span class="string">'./src/main.js'</span>,  <span class="comment">// 入口</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'bundle.js'</span>, <span class="comment">// 出口</span></span><br><span class="line">        publicPath:<span class="string">'dist/'</span>,    <span class="comment">// 需要指定文件打包后的路径</span></span><br><span class="line">        path: path.join(__dirname, <span class="string">'dist'</span>)    <span class="comment">// 绝对路径</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span>,    <span class="comment">// 从数组后面开始</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/.png$/</span>,</span><br><span class="line">                use: <span class="string">'file-loader'</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Data-URLs-url-loader"><a href="#Data-URLs-url-loader" class="headerlink" title="Data URLs/url-loader"></a><code>Data URLs/url-loader</code></h5><blockquote><p>Data URLs 是特殊的URL协议。</p><p><code>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</code>，分别为：协议、媒体类型和编码、文件内容。它本身就包含了内容本身，就不会去发送http请求了。</p></blockquote><p>比如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:text/html;charset=UTF-8,<span class="tag">&lt;<span class="name">h1</span>&gt;</span>html content<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果是图片字体等二进制文件类型，可以先将文件内容经过 base64 编码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:image/png;base64,isadhadsofdsjifadisjfa...</span><br></pre></td></tr></table></figure><blockquote><p>在 webpack 打包静态资源时，我们也可以通过这种方式来实现。</p></blockquote><p>需要使用到 <code>url-loader</code> 加载器，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install url-loader --save-dev</span><br></pre></td></tr></table></figure><p>之后将 <code>file-loader</code> 改为 <code>url-loader</code>。</p><p>最佳的实践方式是：</p><ol><li><p>小文件使用 Data URLs，减少请求次数。</p></li><li><p>大文件单独提取存放，提高加载速度。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/.png$/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 单位是字节，需要乘以 1024 = 10kb</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 小于 10kb 使用url-loader,大于10kb自动使用 file-loader,记得安装 file-loader</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="常用加载器分类"><a href="#常用加载器分类" class="headerlink" title="常用加载器分类"></a>常用加载器分类</h3><p>编译转换类：这种类型的 loader 会将加载到的资源模块，转换为 JS 代码。比如：CSS-loader。</p><p>文件操作类型：将加载到的资源模块，拷贝到输出目录，同时会将访问路径向外导出。比如：file-loader。</p><p>代码检查类：将加载到的代码资源进行校验，统一风格，提高代码质量。</p><h4 id="处理-ES2015"><a href="#处理-ES2015" class="headerlink" title="处理 ES2015"></a>处理 ES2015</h4><blockquote><p>webpack是一个打包工具，如果需要在打包过程中顺便编译，需要安装一个编译型的loader。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader @babel/core @babel/preset-env --save-dev</span><br><span class="line">module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /.js$/,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: 'babel-loader',</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: ['@babel/preset-env']</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="模块加载方式"><a href="#模块加载方式" class="headerlink" title="模块加载方式"></a>模块加载方式</h3><ol><li>基于 ESM标准的 import 声明。</li><li>遵循 CommonJS 标准的 require 函数。</li><li>遵循 AMD 标准的 defined 函数和 require 函数。</li></ol><blockquote><p>模块加载模式不要混用，不利于维护。</p></blockquote><p>loader 加载的非 js 也会触发资源的加载。比如：</p><ol><li>样式代码中的 <code>@import</code> 指令和 <code>url</code> 函数。</li><li>HTML 代码中图片标签的 src 属性。</li></ol><blockquote><p>webpack 根据不同的文件，找到相应的loader进行加载。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-loader --save-dev</span><br></pre></td></tr></table></figure><p>配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/.html$/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">'html-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        attributes: &#123;</span><br><span class="line">                            list: [</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="comment">// Tag name</span></span><br><span class="line">                                    tag: <span class="string">'a'</span>,</span><br><span class="line">                                    <span class="comment">// Attribute name</span></span><br><span class="line">                                    attribute: <span class="string">'href'</span>,</span><br><span class="line">                                    <span class="comment">// Type of processing, can be `src` or `scrset`</span></span><br><span class="line">                                    type: <span class="string">'src'</span>,</span><br><span class="line">                                    <span class="comment">// Allow to filter some attributes</span></span><br><span class="line">                                    filter: <span class="function">(<span class="params">tag, attribute, attributes, resourcePath</span>) =&gt;</span> &#123;</span><br><span class="line">                                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                                    &#125;,</span><br><span class="line">                                &#125;</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="核心工作原理"><a href="#核心工作原理" class="headerlink" title="核心工作原理"></a>核心工作原理</h3><ol><li>从打包入口开始，根据代码中出现的 <code>import</code> <code>require</code>等模块语句，解析推断出模块之间的依赖关系。</li><li>形成依赖关系的依赖树。</li><li>遍历，递归这个依赖树，找到对应的资源文件。</li><li>根据配置文件的 <code>rules</code> 属性，找到对应的模块的加载器加载该模块。</li><li>将加载结果放到输出文件中，实现整个项目的打包。</li></ol><blockquote><p>loader机制 是 webpack 的核心</p></blockquote><h2 id="开发my-loader"><a href="#开发my-loader" class="headerlink" title="开发my loader"></a>开发my loader</h2><blockquote><p>实现 markdown-loader 文件加载器，实现可以在代码中直接导入md文件的功能。</p></blockquote><ol><li>md文件是转换为html后呈现到页面上的，实现导入的md文件就是html字符串</li><li>loader 函数类似管道，可以链式调用。（loader 要返回 JS 代码或者新的加载器）</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">webpack.config.js</span><br><span class="line">module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /.md$/,</span><br><span class="line">                use: [</span><br><span class="line">                    &apos;./markdown-loader&apos;,</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">markdown-loader.js</span><br><span class="line">module.exports =  source =&gt; &#123;     // source接收输入</span><br><span class="line">    console.log(source);</span><br><span class="line">    return &apos;console.log(&quot;i am md&quot;)&apos;;  // return js 代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="marked"><a href="#marked" class="headerlink" title="marked"></a>marked</h3><blockquote><p>md 解析模块</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">npm install marked --save-dev # 用来解析md模块</span><br><span class="line">npm install html-loader --save-dev # 用来解析解析完成后的 html </span><br><span class="line">webpack.config.js</span><br><span class="line">module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /.md$/,</span><br><span class="line">                use: [</span><br><span class="line">                    'html-loader',</span><br><span class="line">                    './markdown-loader',</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">loader</span><br><span class="line">const marked = require('marked')</span><br><span class="line"></span><br><span class="line">module.exports =  source =&gt; &#123;     // source接收输入</span><br><span class="line">    const html = marked(source)</span><br><span class="line"></span><br><span class="line">    // 返回一个 JS 代码</span><br><span class="line">    // return `module.exports = "$&#123;html&#125;"`  换行符等拼接可能会存在语法错误</span><br><span class="line">    // return `module.exports =$&#123;JSON.stringify(html)&#125;`</span><br><span class="line">    // return `export default $&#123;JSON.stringify(html)&#125;`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 返回的 html 字符串交给下一个 loader 处理</span><br><span class="line">    return html</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="插件机制"><a href="#插件机制" class="headerlink" title="插件机制"></a>插件机制</h2><blockquote><p>Loader 专注实现资源模块加载，插件（plugin）解决其它自动化的工作，比如：清除dist目录，拷贝静态文件，压缩代码……。</p></blockquote><h3 id="常用的插件"><a href="#常用的插件" class="headerlink" title="常用的插件"></a>常用的插件</h3><h4 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="headerlink" title="clean-webpack-plugin"></a><code>clean-webpack-plugin</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install clean-webpack-plugin --save-dev</span><br><span class="line">webpack.config.js</span><br><span class="line">const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin')</span><br><span class="line">// ...</span><br><span class="line">plugins: [</span><br><span class="line">    new CleanWebpackPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="headerlink" title="html-webpack-plugin"></a><code>html-webpack-plugin</code></h4><p>HTML参与webpack构建，自动生成html文件解决：</p><ol><li>html 和 dist不同包，要同时发布两个的问题</li><li>配置变化，路径变化，html 中的路径要跟着变化问题</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin --save-dev</span><br><span class="line">webpack.config.js</span><br><span class="line">const HtmlWebpackPlugin = require('html-webpack-plugin')</span><br><span class="line">const copyWebpackPlugin= require('copy-webpack-plugin')</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">    new CleanWebpackPlugin(),</span><br><span class="line">    // 用于生成index.html</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: 'my webpack sample',</span><br><span class="line">        meta: &#123;</span><br><span class="line">            viewport: 'width=device-width'</span><br><span class="line">        &#125;,</span><br><span class="line">        template: './src/index.html'  // 使用模板</span><br><span class="line">    &#125;),</span><br><span class="line">    // 用于生成 多个html页面就多次调用该实例</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: 'about.html'</span><br><span class="line">    &#125;),</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">        template: 'entry/index.html',</span><br><span class="line">        title: 'CSStoryEditor',</span><br><span class="line">        filename: 'edit.html',</span><br><span class="line">        chunks: ['app'],</span><br><span class="line">        favicon: 'entry/favicon.ico'</span><br><span class="line">    &#125;),</span><br><span class="line">    new CopyWebpackPlugin(&#123;</span><br><span class="line">        patterns: [</span><br><span class="line">            'public'</span><br><span class="line">        ]</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="copy-webpack-plugin"><a href="#copy-webpack-plugin" class="headerlink" title="copy-webpack-plugin"></a><code>copy-webpack-plugin</code></h4><blockquote><p>对于不需要构建的静态文件，在打包时可以一并输出到输出目录。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install copy-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/webpack-contrib/copy-webpack-plugin" target="_blank" rel="noopener">https://github.com/webpack-contrib/copy-webpack-plugin</a></p></blockquote><h3 id="开发一个插件"><a href="#开发一个插件" class="headerlink" title="开发一个插件"></a>开发一个插件</h3><h4 id="插件机制工作原理"><a href="#插件机制工作原理" class="headerlink" title="插件机制工作原理"></a>插件机制工作原理</h4><blockquote><p>插件机制基于钩子机制。</p></blockquote><blockquote><p>Hooks：<a href="https://webpack.docschina.org/api/compiler-hooks/" target="_blank" rel="noopener">https://webpack.docschina.org/api/compiler-hooks/</a></p></blockquote><p>webpack 要求我们的插件必须是个函数或者是一个包含apply方法的对象。</p><p>需求：删除打包后的js中多余的注释：<code>/*****/</code>。</p><p>利用到的钩子函数：</p><ol><li><code>emit</code> 输出 asset 到目录之前执行。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPlugin</span> </span>&#123;</span><br><span class="line">    apply(complier)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'myPlugin'</span>)</span><br><span class="line">        <span class="comment">// 通过complier的hooks属性访问emit钩子函数，通过tap方法注册一个钩子函数。</span></span><br><span class="line">        <span class="comment">// 第一个参数插件的名称，第二个参数需要挂载的函数</span></span><br><span class="line">        complier.hooks.emit.tap(<span class="string">'MyPlugin'</span>, compilation =&gt; &#123;    </span><br><span class="line">            <span class="comment">// compilation 是个对象，是此次打包的上下文</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"compilation =======&gt; "</span>+ compilation.assets)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">const</span> name <span class="keyword">in</span> compilation.assets)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(name)     <span class="comment">// 文件名</span></span><br><span class="line">                <span class="comment">// console.log(compilation.assets[name].source())  // 文件内容</span></span><br><span class="line">                <span class="keyword">if</span> (name.endsWith(<span class="string">'.js'</span>))&#123;</span><br><span class="line">                    <span class="keyword">const</span> contents = compilation.assets[name].source()</span><br><span class="line">                    <span class="keyword">const</span> withoutComments =contents.replace(<span class="regexp">/\/\*\*+\*\//g</span>, <span class="string">''</span>) </span><br><span class="line">                    compilation.assets[name] = &#123;</span><br><span class="line">                        source: <span class="function"><span class="params">()</span> =&gt;</span> withoutComments,     <span class="comment">// 同样将source的返回值该为替换后的内容</span></span><br><span class="line">                        size: <span class="function"><span class="params">()</span> =&gt;</span> withoutComments.length    <span class="comment">// webpack 要求的必须的方法</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> MyPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p>插件的工作原理，是通过往 webpack 的生命周期的钩子中挂载函数实现扩展的。</p></blockquote><h2 id="开发体验"><a href="#开发体验" class="headerlink" title="开发体验"></a>开发体验</h2><blockquote><p>传统：编写源代码，webpack打包，运行，刷新浏览器</p></blockquote><p>设想理想的开发环境需要：</p><ol><li>以 HTTP Server 运行。<ul><li>可以更加接近生产环境的状态。</li><li>支持ajax等API。</li></ul></li><li>自动编译可自动刷新。<ul><li>简化开发。</li></ul></li><li>提供 sourceMap 支持。<ul><li>利于调试。</li></ul></li></ol><h3 id="实现自动编译"><a href="#实现自动编译" class="headerlink" title="实现自动编译"></a>实现自动编译</h3><p>利用 watch 的工作模式，监视源文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack --watch</span><br></pre></td></tr></table></figure><blockquote><p>webpack 会以监视模式去运行，在打包完成之后，不会马上退出，它会等待文件变化，直到手动退出。</p></blockquote><p>在另一个控制台打开服务，但仍需要手动刷新浏览器实现刷新。</p><h3 id="自动刷新浏览器"><a href="#自动刷新浏览器" class="headerlink" title="自动刷新浏览器"></a>自动刷新浏览器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g browser-sync</span><br><span class="line"></span><br><span class="line">browser-sync dist --files &quot;**/*&quot;</span><br></pre></td></tr></table></figure><blockquote><p>利用 watch 模式，自动编译，利用 browser-sync 自动刷新浏览器</p></blockquote><p>但需要同时使用两个工具，并且进行了两次磁盘读写操作。</p><h3 id="webpack-Dev-Server"><a href="#webpack-Dev-Server" class="headerlink" title="webpack Dev Server"></a><code>webpack Dev Server</code></h3><p>webpack 官方工具，提供用于开发的 HTTP Server，并且集成了 自动编译和自动刷新浏览器等功能。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure><p>集成了以上的所有功能，但是它并没有将打包结果放到磁盘中，而是放到了内存中，提高运行效率</p><h4 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h4><p>如果有静态资源需要作为开发服务器的资源被访问，可以配置 <code>webpack.config.js</code> 中的 <code>devServer</code> 字段。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    contentBase: [<span class="string">'./public'</span>]      <span class="comment">// 指定 额外的静态资源路径</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><blockquote><p><code>new CopyWebpackPlugin()</code> 在上线前才会使用。</p></blockquote><h4 id="代理-API-服务"><a href="#代理-API-服务" class="headerlink" title="代理 API 服务"></a>代理 API 服务</h4><p>开发环境和生产环境的API不一致会有跨域问题：</p><ol><li>如果该API支持CORS，则可以使用跨域资源共享（CORS）解决。</li><li>如果同源部署，可以是用dev-Server提供的代理配置来解决。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    contentBase: [<span class="string">'./public'</span>],     <span class="comment">// 指定 额外的静态资源路径</span></span><br><span class="line">    proxy: &#123;</span><br><span class="line">        <span class="string">'/api'</span>: &#123;         <span class="comment">// key 代理de 请求路径前缀，值为代理规则配置</span></span><br><span class="line">            <span class="comment">// https://localhost:8080/api/users  ——&gt; https://api.github.com/api/users</span></span><br><span class="line">            target: <span class="string">'https://api.github.com'</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// https://localhost:8080/api/users  ——&gt; https://api.github.com/users</span></span><br><span class="line">            pathRewrite: &#123;</span><br><span class="line">                <span class="string">'^api'</span>: <span class="string">''</span></span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 不能使用 localhost:8080 作为请求 GitHub 的主机名</span></span><br><span class="line">            <span class="comment">// 请求会将 localhost:8080 这个主机名带向服务器，服务器不认识，</span></span><br><span class="line">            <span class="comment">// 需要修改为代理的地址</span></span><br><span class="line">            changeOrigin: <span class="literal">true</span>      </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>test.js：顺便复习一下原生js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'https://api.github.com/users'</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SourceMap"><a href="#SourceMap" class="headerlink" title="SourceMap"></a>SourceMap</h3><blockquote><p>问：运行代码和源码不同，将难于调试，因此引入 Source Map。用来映射运行代码和源代码之间的关系。</p></blockquote><blockquote><p>映射一般在 <code>min.map</code> 格式文件夹下。</p><p>添加注释：<code>//# sourceMappingURL-jquery-3.4.1.min.map</code> 就会自动请求该map文件。根据该内容逆向解析出源文件。</p></blockquote><p><code>webpack.config.js</code> 配置方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devtool: sourceMap</span><br></pre></td></tr></table></figure><blockquote><p>devtool 可以配置很多模式，生成sourceMap文件的方式有很多种，每种方式的效率和效果不同。</p></blockquote><p>大致规律如下：</p><ol><li>eval - 是否使用 eval 执行模块代码。</li><li>cheap - Source Map 是否包含行信息。</li><li>module - 是否能够得到 Loader 处理之前的源代码。</li><li>inline - sourcemap以 <code>data-url</code> 的方式嵌入到代码当中。</li><li>hidden - 生成但是未引入该文件，比如：jQuery等。</li><li>nosources - 提供位置，但不提供源代码，保护生产环境中的代码。</li></ol><blockquote><p>公司项目中使用的是 eval-source-map 模式，错误可以定位到行和列。</p></blockquote><blockquote><p><a href="https://webpack.js.org/configuration/devtool/" target="_blank" rel="noopener">https://webpack.js.org/configuration/devtool/</a></p></blockquote><h4 id="选择合适的-SourceMap"><a href="#选择合适的-SourceMap" class="headerlink" title="选择合适的 SourceMap"></a>选择合适的 SourceMap</h4><ol><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cheap-module-eval-source-map</span><br></pre></td></tr></table></figure></li></ol><p>   开发阶段。</p><ul><li>需要定位经过 loader。</li><li>首次打包速度慢，重写打包相对快。</li></ul><ol start="2"><li>none / nosources-source-map 生产环境保密性。</li></ol><h3 id="HMR"><a href="#HMR" class="headerlink" title="HMR"></a>HMR</h3><blockquote><p>模块热替换：在页面不更新的情况下更新代码模块。只更新修改的模块。</p></blockquote><ol><li><p>开启：</p><ul><li><code>webpack-dev-server --hot</code> 命令开启。</li><li><code>devServer:{hot: true}</code> 配置文件开启。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">]</span><br><span class="line"><span class="comment">// 样式文件可以直接进行热更新</span></span><br></pre></td></tr></table></figure></li><li><p>手动处理模块热替换逻辑：</p><ul><li>框架下开发有时框架内部会集成提供热更新。</li><li>使用热更新的APIs</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.hot.accept(<span class="string">'./main.js'</span>,()=&gt;&#123;&#125;)  <span class="comment">// hmr 模块</span></span><br></pre></td></tr></table></figure></li><li><p>图片热替换</p></li></ol><h4 id="hmr问题"><a href="#hmr问题" class="headerlink" title="hmr问题"></a>hmr问题</h4><ol><li>使用 hot-only 解决报错会自动更新问题。</li><li><code>module.hot</code> 模块来自hmr，可以先判断是否引入 hmr。</li></ol><h2 id="生产环境优化"><a href="#生产环境优化" class="headerlink" title="生产环境优化"></a>生产环境优化</h2><blockquote><p>webpack 添加额外的代码实现其功能，在生产模式很多是不必要的。</p></blockquote><p>生产环境更注重运行效率。比如：使用 webpack 的预设配置 <code>mode</code>。</p><ol><li>可以配置文件根据环境不同导出不同的配置。(适用于中小型项目)</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; env   通过 CLI 传递的环境名参数</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; args   运行 cli 过程中所有参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env, args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> config = &#123;</span><br><span class="line">        <span class="comment">// 开发模式下的配置</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (env === <span class="string">'production'</span>) &#123;</span><br><span class="line">        config.mode = <span class="string">'prodution'</span></span><br><span class="line">        config.devtool = <span class="literal">false</span></span><br><span class="line">        config.plugin = [</span><br><span class="line">            ...config.plugin,</span><br><span class="line">            <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">            <span class="keyword">new</span> CopyWebpackPlugin([<span class="string">`public`</span>])</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line">webpack --env production # 给 env 传递了一个参数，参数值为 production</span><br></pre></td></tr></table></figure><blockquote><p>也可以在全局直接判断环境变量来导出不同的配置。</p></blockquote><ol><li>一个环境对应一个配置文件。<ul><li>公共配置文件，抽象开发生产配置。<code>webpack.common.js</code></li><li>再者是两个配置文件。<code>webpack.dev.js/webpack.prod.js</code></li></ul></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">npm install  webpack-merge --save-dev # 用来深拷贝并合并对象，使用common时使用</span><br><span class="line"><span class="meta">#</span> 也可以使用其它库的merge方法</span><br><span class="line"></span><br><span class="line">webpack --config webpack.prod.js  # 运行时命令，可以写进 script 里</span><br><span class="line">webpack.prod.js</span><br><span class="line">const common = require('./webpack.common');</span><br><span class="line">const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');</span><br><span class="line">const copyWebpackPlugin = require('copy-webpack-plugin');</span><br><span class="line">const merge = require('webpack-merge')</span><br><span class="line"></span><br><span class="line">module.exports = merge(common, &#123;    // merge 专门用来合并webpack配置文件的</span><br><span class="line">    mode: 'production',</span><br><span class="line">    plugins: [</span><br><span class="line">        new CleanWebpackPlugin(),</span><br><span class="line">        new copyWebpackPlugin(['public'])</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="DefinePlugin"><a href="#DefinePlugin" class="headerlink" title="DefinePlugin"></a><code>DefinePlugin</code></h3><blockquote><p>一个为代码注入全局成员的插件。production 模式下默认启用，并注入了一个常量 <code>process.env.NODE_ENV</code> ，许多模块就是依据这个成员来判断运行环境的。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.DefinePlugin(&#123;  <span class="comment">// 接收一个对象，对象中的每个键值都会注入到我们的代码中</span></span><br><span class="line">            API_BASE_URL: <span class="string">`"string"`</span>  <span class="comment">// 会将所有代码中 API_BASE_URL 转换为 "string"</span></span><br><span class="line">            <span class="comment">// 该 差价 所传的值是JS代码片段</span></span><br><span class="line">            <span class="comment">// 如果想要值，可以将其表示为代码片段，比如：JSON.stringify('string'),结果为string值</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TreeShaking"><a href="#TreeShaking" class="headerlink" title="TreeShaking"></a><code>TreeShaking</code></h3><blockquote><p>检测未引用代码，并移除，它会在生产模式下自动开启。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;      <span class="comment">// 这里集中配置webpack内部的优化功能。</span></span><br><span class="line">    usedExports: <span class="literal">true</span>,    <span class="comment">// 表示在输出结果中只导出外部使用了模块</span></span><br><span class="line">    minmize: <span class="literal">true</span>,  <span class="comment">// 压缩代码</span></span><br><span class="line"></span><br><span class="line">    concatenateModules: <span class="literal">true</span>, <span class="comment">// 把所有模块合并到一起放到同一个函数里    Scope Hoisting</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="concatenateModules"><a href="#concatenateModules" class="headerlink" title="concatenateModules"></a><code>concatenateModules</code></h4><blockquote><p>合并模块函数，模块会被放到函数当中作为参数，模块过多会增加代码体积，降低运行效率。</p></blockquote><h4 id="Tree-shaking-amp-Babel"><a href="#Tree-shaking-amp-Babel" class="headerlink" title="Tree-shaking&amp;Babel"></a><code>Tree-shaking&amp;Babel</code></h4><p>疑问：使用 Babel 无法使用 TreeShinking 问题？</p><blockquote><p><code>TreeShaking</code> 使用的前提，就是要使用 ESM 来组织我们的代码，实现我们的模块化。</p></blockquote><p>babel 在转换时会将ESM转换为 CommonJS，在最新版本中默认关闭了该转换。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">options: [</span><br><span class="line">    <span class="comment">// 强制将 ESM 转换为 commonjs,TreeShinking将失效</span></span><br><span class="line">    [<span class="string">'@babel/preset-env'</span>, &#123; <span class="attr">modules</span>: <span class="string">'commonjs'</span> &#125;] </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 确保不会转换</span></span><br><span class="line">    [<span class="string">'@babel/preset-env'</span>, &#123; <span class="attr">modules</span>: <span class="literal">false</span> &#125;]  </span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="sideEffects"><a href="#sideEffects" class="headerlink" title="sideEffects"></a><code>sideEffects</code></h3><blockquote><p>副作用，允许我们通过配置，来表示我们的代码是否有副作用</p></blockquote><p>副作用：指，模块执行时除了导出成员之外所做的事情。</p><p>sideEffects：一般用来在开发 npm 包时标记是否有副作用。它会在生产模式下自动开启。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;      <span class="comment">// 这里集中配置webpack内部的优化功能。</span></span><br><span class="line">    sideEffects: <span class="literal">true</span>, <span class="comment">// 开启功能</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">"sideEffects"</span>: <span class="literal">false</span>   <span class="comment">// 标示当前代码package.json所影响的项目，没有副作用</span></span><br></pre></td></tr></table></figure><p>没有副作用的模块也没有引入的情况下，就会被移除。</p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>sideEffects 使用的关键在于确定模块没有副作用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json  标示哪些有副作用</span></span><br><span class="line"><span class="string">"sideEffects"</span>: [</span><br><span class="line">    <span class="string">'./src/*'</span>,</span><br><span class="line">    <span class="string">'*.css'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="Code-Splitting"><a href="#Code-Splitting" class="headerlink" title="Code Splitting"></a><code>Code Splitting</code></h3><blockquote><p>代码分包/代码分割，在应用工作时，并不是所有模块都是必须要加载进来的，此时代码分割就显的尤为重要。</p></blockquote><p>加之http1.1版本的许多缺陷：</p><ol><li>它在同域的并行请求受到了限制。</li><li>每次请求都会有一定的延迟。</li><li>请求的 Header 浪费带宽流量。</li></ol><p>在这之上，我们需要打包并分包，按需加载。方式：多入口打包、动态导入。</p><h4 id="多入口打包"><a href="#多入口打包" class="headerlink" title="多入口打包"></a>多入口打包</h4><blockquote><p>适用传统的多页应用程序。一个页面对应一个打包入口，公共部分单独提取。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">entry: &#123;   <span class="comment">// 注意 entry 这里是一个对象而不是一个数组，数组是将多个文件打包到一起</span></span><br><span class="line">    index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    main: <span class="string">'./src/main.js'</span></span><br><span class="line">&#125;</span><br><span class="line">output: &#123;</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span>    <span class="comment">// name 会替换为 入口名</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">plugins: &#123;</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'index'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">            viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        filename: <span class="string">'index.html'</span>,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">        chunks: [<span class="string">'index'</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'main'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">            viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        filename: <span class="string">'main.html'</span>,</span><br><span class="line">        template: <span class="string">'./src/main.html'</span>,</span><br><span class="line">        <span class="comment">// chunks 将各自引入的js引入各自的html, 避免引入同一个HTML文件。指定需要注入的bundle</span></span><br><span class="line">        chunks: [<span class="string">'main'</span>]    </span><br><span class="line">    &#125;),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="提取公共模块"><a href="#提取公共模块" class="headerlink" title="提取公共模块"></a>提取公共模块</h5><blockquote><p>我们需要将公共模块打包到同一个文件</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">        chunks: <span class="string">'all'</span>   <span class="comment">// 会将所有的公共模块打包到一起</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="动态导入"><a href="#动态导入" class="headerlink" title="动态导入"></a>动态导入</h4><blockquote><p>按需加载，在我们需要某个模块时，我们再加载这个模块。webpack利用动态导入来实现按需加载，动态导入的模块会被自动分包。</p></blockquote><h5 id="静态导入"><a href="#静态导入" class="headerlink" title="静态导入"></a>静态导入</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态导入</span></span><br><span class="line"><span class="keyword">import</span> index <span class="keyword">from</span> <span class="string">'./index/index'</span></span><br><span class="line"><span class="keyword">import</span> main <span class="keyword">from</span> <span class="string">'./main/main'</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> (hash === <span class="string">'#index'</span>)&#123;</span><br><span class="line">    dom.appendChild(index())</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash === <span class="string">'#main'</span>) &#123;</span><br><span class="line">    dom.appendChild(main())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="动态导入-1"><a href="#动态导入-1" class="headerlink" title="动态导入"></a>动态导入</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态导入</span></span><br><span class="line"><span class="comment">// import index from './index/index'</span></span><br><span class="line"><span class="comment">// import main from './main/main'</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> (hash === <span class="string">'#index'</span>)&#123;</span><br><span class="line">   <span class="comment">// dom.appendChild(index())</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="string">'./index/index'</span>).then(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: index&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        dom.appendChild(index())</span><br><span class="line">    &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash === <span class="string">'#main'</span>) &#123;</span><br><span class="line">    <span class="comment">// dom.appendChild(main())</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="string">'./main/main'</span>).then(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: main&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        dom.appendChild(main())</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>按照ESM动态导入成员的方式导入模块，webpack 会自动进行分包、提取公共模块、按需加载。</p><p>使用框架进行单页面开发，路由模块可以使用动态导入按需加载。</p></blockquote><h5 id="魔法注释"><a href="#魔法注释" class="headerlink" title="魔法注释"></a>魔法注释</h5><blockquote><p>webpack分包默认为 bundel1.js … ，给 webpack 分包命名使用特定的注释。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'main'*/</span><span class="string">'./main/main'</span>).then(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: main&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    dom.appendChild(main())</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// /* webpackChunkName: 'main'*/ 设置的名字相同就会被打包到同一个文件。</span></span><br></pre></td></tr></table></figure><h3 id="MiniCssExtractPlugin"><a href="#MiniCssExtractPlugin" class="headerlink" title="MiniCssExtractPlugin"></a><code>MiniCssExtractPlugin</code></h3><blockquote><p>将 CSS 代码打包到单独的文件的插件，它可以实现 CSS 的按需加载。</p><p>css代码不大没有必要进行该操作，到大小超过150kb时再使用该插件。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">npm install mini-css-extract-plugin --save-dev</span><br><span class="line">webpack.config.js</span><br><span class="line">const MiniCssExtractPlugin = require('mini-css-extract-plugin')</span><br><span class="line">/*</span><br><span class="line">...</span><br><span class="line">*/</span><br><span class="line">rule: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: /\.css$/,</span><br><span class="line">        use: [</span><br><span class="line">            // 'style-loader'</span><br><span class="line">            MiniCssExtractPlugin.loader,</span><br><span class="line">            'css-loader'</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">/*</span><br><span class="line">...</span><br><span class="line">*/</span><br><span class="line">plugins: &#123;</span><br><span class="line">    new MiniCssExtractPlugin()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OptimizeCssAssetsWebpackPlugin"><a href="#OptimizeCssAssetsWebpackPlugin" class="headerlink" title="OptimizeCssAssetsWebpackPlugin"></a><code>OptimizeCssAssetsWebpackPlugin</code></h4><blockquote><p>压缩输出的 CSS 文件。webpack内部的压缩仅仅针对引入js文件的压缩，其它压缩均需要额外插件。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm install optimize-css-assets-webpack-plugin --save-dev</span><br><span class="line">webpack.config.js</span><br><span class="line">const OptimizeCssAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin')</span><br><span class="line">/*</span><br><span class="line">...</span><br><span class="line">*/</span><br><span class="line">plugins: &#123;</span><br><span class="line">    new OptimizeCssAssetsWebpackPlugin() // 在任何模式都会压缩</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>webpack 推荐将所有压缩类插件配置到 optimization 下的 minimizer 下便于控制：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">'terser-webpack-plugin'</span>)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">optimization: &#123;</span><br><span class="line">    minimizer: [    </span><br><span class="line">        <span class="comment">// 生产模式下自动启用该特性，webpack默认启用自定义压缩文件，原本的js压缩将失效，将重新配置压缩</span></span><br><span class="line">        <span class="keyword">new</span> OptimizeCssAssetsWebpackPlugin()，</span><br><span class="line">        <span class="keyword">new</span> TerserWebpackPlugin()    <span class="comment">// 压缩js文件</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="输出文件名-Hash"><a href="#输出文件名-Hash" class="headerlink" title="输出文件名 Hash"></a>输出文件名 Hash</h3><blockquote><p>前端部署前端资源时，会启用服务器的静态资源缓存，对于用户的浏览器而言就会缓存住静态资源，从而减少请求。</p></blockquote><p>问题：设置缓存的时间不能过短，过短就会失去了缓存的意义，时间过长服务器更新资源不能得到及时更新。</p><p>在生产环境下，给文件名使用 Hash 值，当资源更新时，文件名也会随之变化，对于客户端就会对新的文件进行请求，从而解决缓存的问题，将时间设置的长一点也无所谓了。</p><p>设置哈希的三种方式：</p><ol><li><code>filename: &#39;[name]-[hash].bundle.js&#39;</code> 给 <code>filename</code> 设置项目级别的hash，任意代码更新，全部hash都会发生变化。</li><li><code>filename: &#39;[name]-[chunkhash].bundle.js&#39;</code> chunk块级别的打包，根据打包的模块进行块更新。</li><li><code>filename: &#39;[name]-[contenthash].bundle.js&#39;</code> 设置文件级别的hash，文件改变就会改变hash值。</li></ol><blockquote><p>[contenthash:8] 指定hash的长度，控制缓存推荐该 hash 模式。</p></blockquote><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://imweb.io/topic/55994b358555272639cb031b" target="_blank" rel="noopener">https://imweb.io/topic/55994b358555272639cb031b</a></p></blockquote><blockquote><p><a href="https://fe.rualc.com/note/js-modular.html" target="_blank" rel="noopener">https://fe.rualc.com/note/js-modular.html</a></p></blockquote><blockquote><p><a href="https://www.webpackjs.com/loaders/html-loader/" target="_blank" rel="noopener">https://www.webpackjs.com/loaders/html-loader/</a></p></blockquote><blockquote><p><a href="https://imweb.io/topic/5d4a94a08db073cf44ca8cd0" target="_blank" rel="noopener">https://imweb.io/topic/5d4a94a08db073cf44ca8cd0</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;模块化&quot;&gt;&lt;a href=&quot;#模块化&quot; class=&quot;headerlink&quot; title=&quot;模块化&quot;&gt;&lt;/a&gt;模块化&lt;/h1&gt;&lt;p&gt;前端范式之一，主流的代码组织方式。
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="模块化 Webpack" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/%E6%A8%A1%E5%9D%97%E5%8C%96-Webpack/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="模块化 Webpack" scheme="http://yoursite.com/tags/%E6%A8%A1%E5%9D%97%E5%8C%96-Webpack/"/>
    
  </entry>
  
  <entry>
    <title>规范化——ESLint</title>
    <link href="http://yoursite.com/2020/08/19/AWebTool_%E8%A7%84%E8%8C%83%E5%8C%96_ESLint/"/>
    <id>http://yoursite.com/2020/08/19/AWebTool_规范化_ESLint/</id>
    <published>2020-08-19T11:30:00.000Z</published>
    <updated>2020-08-24T15:54:50.906Z</updated>
    
    <content type="html"><![CDATA[<h1 id="规范化标准"><a href="#规范化标准" class="headerlink" title="规范化标准"></a>规范化标准</h1><p>团队项目需要明确的统一编码标准，降低项目的沟通及维护成本。</p><p>代码、文档、提交日志均需要统一标准，其中代码规范最为重要。</p><p>代码方面比如：空格场景，缩进方式，函数变量命名规范。</p><p>如今已经以从认为规定到使用工具来实现，Lint。<a id="more"></a></p><h1 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h1><blockquote><p>一个主流的 JavaScript Lint 工具 监测 JS 代码质量。</p></blockquote><p>带来什么？统一开发者编码风格。提高开发者编码能力。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm install eslint --save-dev</span><br><span class="line">npx eslint -v</span><br></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx exlint --init</span><br></pre></td></tr></table></figure><blockquote><p>市面上三种主流风格：</p><p>Airbnb: <a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">https://github.com/airbnb/javascript</a><br>Standard: <a href="https://github.com/standard/standard" target="_blank" rel="noopener">https://github.com/standard/standard</a><br>Google: <a href="https://github.com/google/eslint-config-google" target="_blank" rel="noopener">https://github.com/google/eslint-config-google</a></p></blockquote><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npx exlint xx.js</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 6 errors and 0 warnings potentially fixable with the `--fix` option.</span><br><span class="line">npx exlint xx.js --fix # 修正大多数格式问题</span><br></pre></td></tr></table></figure><blockquote><p>常见错误：</p><p>1:7 error ‘foo’ is assigned a value but never used no-unused-vars // 没用到<br>10:1 error ‘syy’ is not defined no-unde // undefinedf</p></blockquote><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.eslintrc.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  env: &#123;                  // 运行环境 Environment  可以同时配置多个环境</span><br><span class="line">    browser: true,        // 浏览器  这里并不影响使用浏览器API，因为它被继承的 standard 规格覆盖了</span><br><span class="line">    es2020: true           </span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [              // 继承 继承了 standard 的风格 也同时可以继承多个共享配置</span><br><span class="line">    &apos;standard&apos;</span><br><span class="line">  ],</span><br><span class="line">  parserOptions: &#123;        // parser Options 解析器选项  （语法解析器）</span><br><span class="line">    ecmaVersion: 11</span><br><span class="line">  &#125;,</span><br><span class="line">  rules: &#123;     // 校验规则的开启和关闭   在 standard 里也开启了许多规则 </span><br><span class="line">    &apos;no-alert&apos;: &quot;error&quot;     // warn error off 警告 报错 关闭</span><br><span class="line">  &#125;,</span><br><span class="line">  globals: &#123;    // 最新版本默认配置中已没有再体现该选项了</span><br><span class="line">     &apos;jQuery&apos;: &quot;readonly&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>官网上有可以配置的所有的规则</p></blockquote><h3 id="配置注释"><a href="#配置注释" class="headerlink" title="配置注释"></a>配置注释</h3><blockquote><p>为个别违反规范的编码配置格式</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">'$&#123;name&#125; is a coder'</span>  <span class="comment">// eslint-disable-line no-template-curly-in-string</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(str)</span><br></pre></td></tr></table></figure><blockquote><p>eslint-disable-line 标示不检测该行，no-template-curly-in-string 不检测的规则名称（会在报错时给出）</p></blockquote><blockquote><p><a href="http://eslint.cn/docs/user-guide/configuring#configuring-rules" target="_blank" rel="noopener">http://eslint.cn/docs/user-guide/configuring#configuring-rules</a></p></blockquote><h3 id="ESLint-结合自动化工具"><a href="#ESLint-结合自动化工具" class="headerlink" title="ESLint 结合自动化工具"></a>ESLint 结合自动化工具</h3><blockquote><p>与项目统一，方便管理</p></blockquote><h4 id="gulp"><a href="#gulp" class="headerlink" title="gulp"></a>gulp</h4><ol><li>完成相应的依赖安装</li><li>准备 <a href="https://github/zce/zce-gulp-demo.git" target="_blank" rel="noopener">gulp项目</a></li><li>完成 eslint 模块安装</li><li>创建 eslint 配置文件配置</li><li>完成 gulp-eslint 模块安装</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gulpfile.js</span><br><span class="line">const script = () =&gt; &#123;</span><br><span class="line">    return src(&apos;src/assets/script/*.js&apos;, &#123; base: &quot;src&quot; &#125;)</span><br><span class="line">        .pipe(plugins.eslint())     // 它只能检查代码中的问题，并不能做出任何反馈</span><br><span class="line">        .pipe(plugins.eslint.format())       // 打印错误</span><br><span class="line">        .pipe(plugins.eslint.failAfterError())       // 终止管道</span><br><span class="line">        .pipe(plugins.babel(&#123; presets: [&apos;@babel/preset-env&apos;] &#125;))</span><br><span class="line">        .pipe(dest(&apos;temp&apos;))</span><br><span class="line">        .pipe(bs.reload(&#123; stream: true &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h4><ol><li>完成相应的依赖安装</li><li>准备 <a href="https://github.com/zce/zce-react-app.git" target="_blank" rel="noopener">webpack项目</a></li><li>完成 eslint 模块安装</li><li>安装 eslint-loader 模块</li><li>创建 eslint 配置文件配置</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: <span class="string">'eslint-loader'</span>,</span><br><span class="line">        enforce: <span class="string">'pre'</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h5 id="后续配置"><a href="#后续配置" class="headerlink" title="后续配置"></a>后续配置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint-plugin-react --save-dev</span><br><span class="line">.eslintrc.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  env: &#123;                  // 运行环境 Environment  可以同时配置多个环境</span><br><span class="line">    browser: true,        // 浏览器  这里并不影响使用浏览器API，因为它被继承的 standard 规格覆盖了</span><br><span class="line">    es2020: true           </span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [              // 继承 继承了 standard 的风格 也同时可以继承多个共享配置</span><br><span class="line">    'standard'</span><br><span class="line">  ],</span><br><span class="line">  parserOptions: &#123;        // parser Options 解析器选项  （语法解析器）</span><br><span class="line">    ecmaVersion: 11</span><br><span class="line">  &#125;,</span><br><span class="line">  rules: &#123;     // 校验规则的开启和关闭   在 standard 里也开启了许多规则 </span><br><span class="line">    'no-alert': "error",     // warn error off 警告 报错 关闭</span><br><span class="line">    'react/jsx-uses-react': 2,   // 2 error 开启检测，可以避免定义未使用的报错</span><br><span class="line">    'react/jsx-uses-vars': 2,         </span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: &#123;</span><br><span class="line">     'react'   </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 以继承的方式配置</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  env: &#123;                  // 运行环境 Environment  可以同时配置多个环境</span><br><span class="line">    browser: true,        // 浏览器  这里并不影响使用浏览器API，因为它被继承的 standard 规格覆盖了</span><br><span class="line">    es2020: true           </span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [              // 继承 继承了 standard 的风格 也同时可以继承多个共享配置</span><br><span class="line">    'standard',</span><br><span class="line">    'plugin:react/recommended'     // 继承实现后续配置</span><br><span class="line">  ],</span><br><span class="line">  parserOptions: &#123;        // parser Options 解析器选项  （语法解析器）</span><br><span class="line">    ecmaVersion: 11</span><br><span class="line">  &#125;,</span><br><span class="line">  rules: &#123;     // 校验规则的开启和关闭   在 standard 里也开启了许多规则 </span><br><span class="line">    'no-alert': "error",     // warn error off 警告 报错 关闭</span><br><span class="line">    // 'react/jsx-uses-react': 2,   // 2 error 开启检测，可以避免定义未使用的报错</span><br><span class="line">    // 'react/jsx-uses-vars': 2,         </span><br><span class="line">  &#125;,</span><br><span class="line">  // plugins: &#123;</span><br><span class="line">  //    'react'   </span><br><span class="line">  // &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="现代项目集成-ESLint"><a href="#现代项目集成-ESLint" class="headerlink" title="现代项目集成 ESLint"></a>现代项目集成 ESLint</h3><blockquote><p>vue 和 React 框架生态集成了这些规范化标准的工具。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install @vue/cli -g</span><br><span class="line"></span><br><span class="line">vue create my-vue  # 禁止大写字母</span><br></pre></td></tr></table></figure><blockquote><p>注意：选择配置，<code>lint on save</code> 表示webpack打包是调用。<code>lint and fix on commit</code> 表示 利用git钩子，提交时调用。（建议都进行选择 a）。</p></blockquote><h3 id="结合-typeScript"><a href="#结合-typeScript" class="headerlink" title="结合 typeScript"></a>结合 typeScript</h3><blockquote><p>使用ESLint 配合 typescript 插件进行检查</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm install -g typescript</span><br><span class="line">npm install eslint --save-dev</span><br><span class="line">npx eslint --init</span><br></pre></td></tr></table></figure><p>生成配置文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    es2020: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="string">'standard'</span></span><br><span class="line">  ],</span><br><span class="line">  parser: <span class="string">'@typescript-eslint/parser'</span>,   <span class="comment">// 多了一个解析器</span></span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    ecmaVersion: <span class="number">11</span>,</span><br><span class="line">    sourceType: <span class="string">'module'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="string">'@typescript-eslint'</span></span><br><span class="line">  ],</span><br><span class="line">  rules: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Stylelint"><a href="#Stylelint" class="headerlink" title="Stylelint"></a>Stylelint</h1><blockquote><p>提供默认的代码检查规则，提供了 CLI 工具以供使用，通过插件实现 SASS Less PostCSS 的代码检查，支持Gulp/webpack 的集成</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install stylelint -D</span><br><span class="line"></span><br><span class="line">npm install stylelint-config-standard # 手动安装共享配置模块</span><br><span class="line"></span><br><span class="line">npx stylelint style.css --fix # 执行并修复部分问题</span><br><span class="line"></span><br><span class="line">npm install style-config-sass-guidelines # sass 检测模块安装</span><br></pre></td></tr></table></figure><p>手动新建文件<code>.stylelintrc.js</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 它没有可继承的共享配置配置，需要自己安装 npm install stylelint-config-standard</span></span><br><span class="line">    extends: [</span><br><span class="line">        <span class="string">"stylelint-config-standard"</span>,</span><br><span class="line">        <span class="string">"stylelint-config-sass-guidelines"</span></span><br><span class="line">    ]      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>less 等类似</p></blockquote><h1 id="prettier-的使用"><a href="#prettier-的使用" class="headerlink" title="prettier 的使用"></a>prettier 的使用</h1><blockquote><p>一款通用的前端代码格式化工具。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install prettier -D</span><br><span class="line">npx prettier style.css --write    # 默认将格式化代码打印到控制台，添加 --write 覆盖源文件</span><br><span class="line">npx prettier . --write  # 统配所有文件</span><br></pre></td></tr></table></figure><h1 id="Git-Hooks-介绍"><a href="#Git-Hooks-介绍" class="headerlink" title="Git Hooks 介绍"></a>Git Hooks 介绍</h1><blockquote><p>问题：代码提交至仓库前未执行 lint 工作？</p></blockquote><p>利用 GIT Hooks，在提交代码之前强制执行 lint 操作。</p><ol><li>git Hooks ，就是git的钩子，每个钩子对应一个任务。比如：<code>commit</code> 、<code>push</code> 等等。</li><li>我们可以通过 shell 脚本编写钩子任务，使其在触发时执行具体要求的执行操作。</li><li>找到文件 <code>.git ——&gt; hooks ——&gt; pre-commit.sample</code> 在提交代码之前会触发该钩子。</li><li>Copy 去掉 <code>.sample</code> 文件后缀名即可修改该文件。</li><li>编写 shell 脚本，（<code>#!/bin/sh</code> 指明了运行环境）。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/sh</span><br><span class="line">echo "before commit"    # 这样 就将命令挂载到了 提交代码之前</span><br></pre></td></tr></table></figure><blockquote><p>git init 后看不到.git文件夹，在任务管理器勾选查看 ==&gt; 隐藏文件</p></blockquote><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://cn.eslint.org/" target="_blank" rel="noopener">https://cn.eslint.org/</a></p></blockquote><blockquote><p><a href="http://stylelint.cn/" target="_blank" rel="noopener">http://stylelint.cn/</a></p></blockquote><blockquote><p><a href="https://www.npmjs.com/package/prettier" target="_blank" rel="noopener">https://www.npmjs.com/package/prettier</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;规范化标准&quot;&gt;&lt;a href=&quot;#规范化标准&quot; class=&quot;headerlink&quot; title=&quot;规范化标准&quot;&gt;&lt;/a&gt;规范化标准&lt;/h1&gt;&lt;p&gt;团队项目需要明确的统一编码标准，降低项目的沟通及维护成本。&lt;/p&gt;
&lt;p&gt;代码、文档、提交日志均需要统一标准，其中代码规范最为重要。&lt;/p&gt;
&lt;p&gt;代码方面比如：空格场景，缩进方式，函数变量命名规范。&lt;/p&gt;
&lt;p&gt;如今已经以从认为规定到使用工具来实现，Lint。
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="规范化 ESLint" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/%E8%A7%84%E8%8C%83%E5%8C%96-ESLint/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="规范化 ESLint" scheme="http://yoursite.com/tags/%E8%A7%84%E8%8C%83%E5%8C%96-ESLint/"/>
    
  </entry>
  
  <entry>
    <title>自动化——有关于gulp对比</title>
    <link href="http://yoursite.com/2020/08/12/AWebTool_%E8%87%AA%E5%8A%A8%E5%8C%96_gulp_grunt_FIS/"/>
    <id>http://yoursite.com/2020/08/12/AWebTool_自动化_gulp_grunt_FIS/</id>
    <published>2020-08-12T13:30:00.000Z</published>
    <updated>2020-08-24T15:54:57.874Z</updated>
    
    <content type="html"><![CDATA[<h1 id="自动化构建"><a href="#自动化构建" class="headerlink" title="自动化构建"></a>自动化构建</h1><p>自动化构建：就是将 <strong>开发阶段产生的源代码</strong> 自动化的转换成 <strong>生产环境中可以运行的代码或程序</strong>。</p><p>自动化构建工作流：<a id="more"></a></p><ol><li>尽可能的脱离运行环境的兼容带来的种种问题。</li><li>使用提高效率的语法、规范和标准。比如： es next、sass、模板引擎……。</li></ol><p>自动化构建工具：就是将浏览器不能直接支持的以上的特性，转换为能够执行的代码。</p><blockquote><p>终极目标就是提高我们的编码效率。</p></blockquote><h1 id="NPM-Scripts"><a href="#NPM-Scripts" class="headerlink" title="NPM Scripts"></a>NPM Scripts</h1><p>解决重复调用命令的问题。在 package.json 的 <code>scripts</code> 字段配置。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置命令，当在命令行运行时，它会自动在 ./node_module/bin/[module_name] 中找。</span></span><br><span class="line"><span class="string">"scripts"</span>: &#123; </span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"sass scss/main.scss css/style.css --watch"</span>,  <span class="comment">// --watch 会监听变化自动编译</span></span><br><span class="line">    <span class="string">"preserve"</span>: <span class="string">"npm run build"</span>,   <span class="comment">// preserve 会在运行serve之前运行 build</span></span><br><span class="line">    <span class="comment">// --file 监听文件变化自动更新浏览器文件，省略刷新</span></span><br><span class="line">    <span class="string">"serve"</span>: <span class="string">"browser-sync --files \"css/*.css\""</span>,  <span class="comment">// 自动起一个 web 服务器</span></span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"run-p build serve"</span>  <span class="comment">// build 和 serve同时执行</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p><code>npm run dev</code> / <code>yarn dev</code>。</p><ol><li><code>npm install browser-sync --save-dev</code>。</li><li><code>npm install npm-run-all --save-dev</code>，为了并行执行命令。</li></ol><h1 id="npx"><a href="#npx" class="headerlink" title="npx"></a><em>npx</em></h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>在运行的时候，会到 <code>node_modules/.bin</code> 路径和环境变量 <code>$PATH</code> 里检查命令是否存在。所以系统命令也可以调用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> npx ls</span><br><span class="line"><span class="meta">#</span> 等同于 ls</span><br></pre></td></tr></table></figure><blockquote><p>注意，Bash 内置的命令不在<code>$PATH</code>里面，所以不能用。比如，<code>cd</code>是 Bash 命令，因此就不能用<code>npx cd</code>。</p></blockquote><h2 id="调用项目安装的模块"><a href="#调用项目安装的模块" class="headerlink" title="调用项目安装的模块"></a>调用项目安装的模块</h2><p>举例，项目中安装了Mocha，一般是在 <code>package.json</code> 的 <code>scripts</code> 字段里配置，如果要在命令行下调用就可以使用 <code>npx</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 原本在命令行中调用</span><br><span class="line"><span class="meta">$</span> node-modules/.bin/mocha --version</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 利用 npx</span><br><span class="line"><span class="meta">$</span> npx mocha --version</span><br></pre></td></tr></table></figure><h2 id="避免全局安装模块"><a href="#避免全局安装模块" class="headerlink" title="避免全局安装模块"></a>避免全局安装模块</h2><p><code>npx</code> 会将全局安装的模块下载到一个临时目录，使用后删除，并且允许指定版本，比如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 运行 全局模块 create-react-app</span><br><span class="line"><span class="meta">$</span> npx create-react-app my-react-app</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 指定 uglify-js 版本</span><br><span class="line"><span class="meta">$</span> npx uglify-js@3.1.0 main.js -o ./dist/main.js</span><br></pre></td></tr></table></figure><blockquote><p>只要 npx 后面的模块无法在本地发现，就会下载同名模块。</p></blockquote><h2 id="no-install-参数和-ignore-existing-参数"><a href="#no-install-参数和-ignore-existing-参数" class="headerlink" title="--no-install 参数和 --ignore-existing 参数"></a><code>--no-install</code> 参数和 <code>--ignore-existing</code> 参数</h2><p><code>--no-install</code>：强行使用本地模块，不下载远程。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> npx --no-install http-server</span><br></pre></td></tr></table></figure><p><code>--ignore-existing</code>：忽略本地模块，强制安装远程模块。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> npx --ignore-existing create-react-app my-react-app</span><br></pre></td></tr></table></figure><h2 id="使用不同版本的-node"><a href="#使用不同版本的-node" class="headerlink" title="使用不同版本的 node"></a>使用不同版本的 node</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> npx node@12.18.3 -v</span><br><span class="line"><span class="meta">#</span> 使用 node 12.18.3 版本执行 -v 命令</span><br></pre></td></tr></table></figure><h2 id="p-参数"><a href="#p-参数" class="headerlink" title="-p 参数"></a><code>-p</code> 参数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> npx -p node@12.18.3 node -v</span><br><span class="line"><span class="meta">#</span> 同上</span><br><span class="line"><span class="meta">$</span> npx -p lolcatjs -p cowsay [command]</span><br><span class="line"><span class="meta">#</span> 安装多个模块场景</span><br></pre></td></tr></table></figure><h2 id="c-参数"><a href="#c-参数" class="headerlink" title="-c 参数"></a><code>-c</code> 参数</h2><p>如果 npx 安装多个模块，默认情况下，所执行的命令之中，只有第一个可执行项会使用 npx 安装的模块，后面的可执行项还是会交给 Shell 解释。</p><ol><li>参数可以将所有命令都用 npx 解释。</li><li>可以将环境变量带入所要执行的命令。</li></ol><h2 id="执行-GitHub-源码"><a href="#执行-GitHub-源码" class="headerlink" title="执行 GitHub 源码"></a>执行 GitHub 源码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 执行 Gist 代码</span><br><span class="line"><span class="meta">$</span> npx https://gist.github.com/zkat/4bc19503fe9e9309e2bfaa2c58074d32</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 执行仓库代码</span><br><span class="line"><span class="meta">$</span> npx github:piuccio/cowsay hello</span><br></pre></td></tr></table></figure><blockquote><p>注意，远程代码必须是一个模块，即必须包含<code>package.json</code>和入口脚本。</p></blockquote><h1 id="常用的自动化构建工具"><a href="#常用的自动化构建工具" class="headerlink" title="常用的自动化构建工具"></a>常用的自动化构建工具</h1><p>Grunt、Gulp、FIS（自动化构建工具）</p><blockquote><p>Webpack（严格意义上是模块打包工具）</p></blockquote><p>对比：</p><ol><li>Grunt<ul><li>出现的早，生态完善。</li><li>构建过程基于临时文件，磁盘读写操作频繁，构建速度较慢。</li></ul></li><li>Gulp<ul><li>基于内存实现，速度快。</li><li>默认支持同时执行多个任务。</li><li>使用方式易懂。</li><li>流行，论坛参与度高。</li></ul></li><li>FIS<ul><li>微内核，封装大而全，适合初学者。</li></ul></li></ol><h1 id="Grunt"><a href="#Grunt" class="headerlink" title="Grunt"></a><em>Grunt</em></h1><h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init --yes    </span><br><span class="line">npm install grunt    # ???</span><br><span class="line">code gruntfile.js   # 定义需要 grunt 自动执行的任务</span><br></pre></td></tr></table></figure><h3 id="配置-gruntfile-js"><a href="#配置-gruntfile-js" class="headerlink" title="配置 gruntfile.js"></a>配置 <code>gruntfile.js</code></h3><h4 id="grunt-registerTask-API-注册任务"><a href="#grunt-registerTask-API-注册任务" class="headerlink" title="grunt.registerTask API 注册任务"></a><code>grunt.registerTask</code> API 注册任务</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// g 需要导出一个函数，内部提供创建任务的 API</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    grunt.registerTask(<span class="string">'foo'</span>, ()=&gt;&#123;   <span class="comment">// 任务名字，任务函数</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'hello grunt-'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    grunt.registerTask(<span class="string">'bar'</span>, <span class="string">'任务描述'</span>, ()=&gt;&#123;   <span class="comment">// 任务名字，任务描述, 任务函数</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'hello task-'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// grunt.registerTask('default', '任务描述', ()=&gt;&#123;   // 自动调用</span></span><br><span class="line">    <span class="comment">//     console.log('hello default-')</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">    grunt.registerTask(<span class="string">'default'</span>, [<span class="string">'foo'</span>, <span class="string">'bar'</span>])   <span class="comment">// 自动调用指定任务</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// grunt.registerTask('async-task', () =&gt; &#123;  // 无法运行</span></span><br><span class="line">    <span class="comment">//     setTimeout(() =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//         console.log('async task working-')</span></span><br><span class="line">    <span class="comment">//     &#125;, 1000)</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">    grunt.registerTask(<span class="string">'async-task'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> done = <span class="keyword">this</span>.async()</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'async task working-'</span>)</span><br><span class="line">            done()</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  ========= 标记任务失败，不影响接下来的任务的执行</span></span><br><span class="line"></span><br><span class="line">    grunt.registerTask(<span class="string">'bad'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'i am bad-'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>    <span class="comment">// 标记任务失败</span></span><br><span class="line">    &#125;)</span><br><span class="line">    grunt.registerTask(<span class="string">'afterBad'</span>,[<span class="string">'foo'</span>,<span class="string">'bad'</span>,<span class="string">'bar'</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `grunt default --force` # 强制执行所有任务，错误下面的也会执行</span></span><br><span class="line"></span><br><span class="line">    grunt.registerTask(<span class="string">'async-task1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> done = <span class="keyword">this</span>.async()  <span class="comment">// ?</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'async task1 working-'</span>)</span><br><span class="line">            done(<span class="literal">false</span>)    <span class="comment">// 异步任务标记失败</span></span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="grunt-initConfig-API-配置选项方法"><a href="#grunt-initConfig-API-配置选项方法" class="headerlink" title="grunt.initConfig API 配置选项方法"></a><code>grunt.initConfig</code> API 配置选项方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">grunt.initConfig(&#123;</span><br><span class="line">    foo: <span class="string">'FOO 配置对象？？？'</span>,</span><br><span class="line">    foo1: &#123;</span><br><span class="line">        bar1: <span class="number">123456</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">grunt.registerTask(<span class="string">'initConfigFOO'</span>,() =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> init = grunt.config(<span class="string">'foo'</span>)  <span class="comment">// grunt.config 获取 grunt.initConfig 值</span></span><br><span class="line">    <span class="keyword">const</span> init1 = grunt.config(<span class="string">'foo1'</span>)  </span><br><span class="line">    <span class="built_in">console</span>.log(init,init1.bar1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="grunt-registerMultiTask-API-构建多目标任务"><a href="#grunt-registerMultiTask-API-构建多目标任务" class="headerlink" title="grunt.registerMultiTask API 构建多目标任务"></a><code>grunt.registerMultiTask</code> API 构建多目标任务</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ================== 多目标任务模式，可以让任务根据配置形成多个子任务</span></span><br><span class="line">grunt.initConfig(&#123;</span><br><span class="line">    multiTask: &#123;    <span class="comment">// 多目标任务模式，相当于以多个子任务进行</span></span><br><span class="line">        options:&#123;    <span class="comment">// 其它的 key值 作为子目标，options 选项则作为任务的配置项</span></span><br><span class="line">            foo: <span class="string">'bar'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        css: &#123;</span><br><span class="line">            options: &#123;</span><br><span class="line">                foo: <span class="string">'css bar'</span>    <span class="comment">// 会覆盖掉 上一个options</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        js: <span class="string">'2'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">grunt.registerMultiTask(<span class="string">'multiTask'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Muli Task _'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 相当于执行了两遍，每一遍的 this 都是当前的子任务</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`target:<span class="subst">$&#123;<span class="keyword">this</span>.target&#125;</span>, data:<span class="subst">$&#123;<span class="keyword">this</span>.data&#125;</span>`</span>) </span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.options()) <span class="comment">// 拿到配置项</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Grunt插件"><a href="#Grunt插件" class="headerlink" title="Grunt插件"></a>Grunt插件</h2><h3 id="简单使用-1"><a href="#简单使用-1" class="headerlink" title="简单使用"></a>简单使用</h3><p>大多任务都是通用的（压缩代码等等），因此 Grunt 的插件是 Grunt 的核心。</p><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> grunt-contrib-clean 自动清除开发过程中产生的临时文件</span><br><span class="line">npm install grunt-contrib-clean</span><br></pre></td></tr></table></figure><p><code>gruntfile.js</code> 引入使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span>&#123;</span><br><span class="line">    grunt.loadNpmTasks(<span class="string">'grunt-contrib-clean'</span>)</span><br><span class="line"></span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">        clean: &#123;</span><br><span class="line">            temp: <span class="string">'temp/*.txt'</span>            <span class="comment">// 需要配置清除路径</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run grunt clean  # npm run 是因为我配置到了npmScript里了</span><br></pre></td></tr></table></figure><h3 id="常用插件"><a href="#常用插件" class="headerlink" title="常用插件"></a>常用插件</h3><h4 id="Sass"><a href="#Sass" class="headerlink" title="Sass"></a><em>Sass</em></h4><p>npm <code>grunt-sass</code>，依赖 npm 使用 sass，好处是对环境的依赖少。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install grunt-sass sass --dev</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">'sass'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">        sass: &#123;</span><br><span class="line">            options: &#123;</span><br><span class="line">                sourceMap: <span class="literal">true</span>,     <span class="comment">// 自动生成 sourceMap 文件</span></span><br><span class="line">                implementation: sass  <span class="comment">// 表示使用哪个模块编译</span></span><br><span class="line">            &#125;,</span><br><span class="line">            main: &#123;</span><br><span class="line">                files: &#123;</span><br><span class="line">                    <span class="string">'dist/css/main.css'</span>: <span class="string">'src/scss/main.scss'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    grunt.loadNpmTasks(<span class="string">'grunt-sass'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run grunt sass</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.npmjs.com/package/grunt-sass" target="_blank" rel="noopener">https://www.npmjs.com/package/grunt-sass</a></p></blockquote><h4 id="babel"><a href="#babel" class="headerlink" title="babel"></a><em>babel</em></h4><p>安装：依赖babel核心模块和预设</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install grunt-babel @babel/core @babel/preset-env --save-dev</span><br><span class="line"></span><br><span class="line">npm install load-grunt-tasks --dev # 随着loadNpmTasks 增多，这是一个简化的工具</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">'sass'</span>)</span><br><span class="line"><span class="keyword">const</span> loadGruntTasks = <span class="built_in">require</span>(<span class="string">'load-grunt-tasks'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">        sass: &#123;</span><br><span class="line">            options: &#123;</span><br><span class="line">                sourceMap: <span class="literal">true</span>,     <span class="comment">// 自动生成 sourceMap 文件</span></span><br><span class="line">                implementation: sass  <span class="comment">// 表示使用哪个模块编译</span></span><br><span class="line">            &#125;,</span><br><span class="line">            main: &#123;</span><br><span class="line">                files: &#123;</span><br><span class="line">                    <span class="string">'dist/css/main.css'</span>: <span class="string">'src/scss/main.scss'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        babel: &#123;</span><br><span class="line">            options: &#123;</span><br><span class="line">                sourceMap: <span class="literal">true</span>,</span><br><span class="line">                presets: [<span class="string">'@babel/preset-env'</span>]   <span class="comment">// 根据最新的特性进行转换</span></span><br><span class="line">            &#125;,</span><br><span class="line">            main: &#123;</span><br><span class="line">                files: &#123;    <span class="comment">// 输入输出文件</span></span><br><span class="line">                    <span class="string">'dist/js/main.js'</span>: <span class="string">'src/js/main.js'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;     </span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// grunt.loadNpmTasks('grunt-sass')</span></span><br><span class="line">    loadGruntTasks(grunt) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.npmjs.com/package/grunt-babel" target="_blank" rel="noopener">https://www.npmjs.com/package/grunt-babel</a></p></blockquote><blockquote><p><a href="https://www.npmjs.com/package/load-grunt-tasks" target="_blank" rel="noopener">https://www.npmjs.com/package/load-grunt-tasks</a></p></blockquote><h4 id="热更新（自动编译）"><a href="#热更新（自动编译）" class="headerlink" title="热更新（自动编译）"></a>热更新（自动编译）</h4><p>安装：文件改变，自动编译</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install grunt-contrib-watch --save-dev</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">'sass'</span>)</span><br><span class="line"><span class="keyword">const</span> loadGruntTasks = <span class="built_in">require</span>(<span class="string">'load-grunt-tasks'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">        sass: &#123;</span><br><span class="line">            options: &#123;</span><br><span class="line">                sourceMap: <span class="literal">true</span>,     <span class="comment">// 自动生成 sourceMap 文件</span></span><br><span class="line">                implementation: sass  <span class="comment">// 表示使用哪个模块编译</span></span><br><span class="line">            &#125;,</span><br><span class="line">            main: &#123;</span><br><span class="line">                files: &#123;    <span class="comment">// 输入输出文件</span></span><br><span class="line">                    <span class="string">'dist/css/main.css'</span>: <span class="string">'src/scss/main.scss'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        babel: &#123;</span><br><span class="line">            options: &#123;</span><br><span class="line">                sourceMap: <span class="literal">true</span>,</span><br><span class="line">                presets: [<span class="string">'@babel/preset-env'</span>]   <span class="comment">// 根据最新的特性进行转换</span></span><br><span class="line">            &#125;,</span><br><span class="line">            main: &#123;</span><br><span class="line">                files: &#123;    <span class="comment">// 输出输入文件</span></span><br><span class="line">                    <span class="string">'dist/js/main.js'</span>: <span class="string">'src/js/main.js'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        watch: &#123;</span><br><span class="line">            js: &#123;</span><br><span class="line">                files: [<span class="string">'src/js/*.js'</span>],  <span class="comment">// 所要监视的文件</span></span><br><span class="line">                tasks: [<span class="string">'babel'</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            css: &#123;</span><br><span class="line">                files: [<span class="string">'src/scss/*.scss'</span>],</span><br><span class="line">                tasks: [<span class="string">'sass'</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">loadGruntTasks(grunt) </span><br><span class="line">grunt.registerTask(<span class="string">'default'</span>, [<span class="string">'sass'</span>, <span class="string">'babel'</span>, <span class="string">'watch'</span>]) <span class="comment">// 做映射，确保在启动时先执行一次编译</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm run grunt watch # </span><br><span class="line"></span><br><span class="line">npm run grunt # 做完映射后命令</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.npmjs.com/package/grunt-contrib-watch" target="_blank" rel="noopener">https://www.npmjs.com/package/grunt-contrib-watch</a></p></blockquote><h1 id="Gulp"><a href="#Gulp" class="headerlink" title="Gulp"></a><em>Gulp</em></h1><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><blockquote><p>根据<a href="https://www.gulpjs.com.cn/docs/getting-started/quick-start/" target="_blank" rel="noopener">官网</a>安装</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init --yes</span><br><span class="line">npm install gulp --dev    # 同时安装了 gulpCli</span><br><span class="line">code gulpfile.js   # 定义需要 grunt 自动执行的任务</span><br></pre></td></tr></table></figure><h3 id="Gulpfile"><a href="#Gulpfile" class="headerlink" title="Gulpfile"></a>Gulpfile</h3><h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><p><code>gulpfile.js</code> 文件，在执行 <code>gulp</code> 命令时都会被自动加载，这里面会写着 <code>gulp</code>API，还有纯 js 或 node 模块，以及任何导出（export）的函数都将注册到 gulp 的任务（task）系统中。</p><h4 id="其它语言"><a href="#其它语言" class="headerlink" title="其它语言"></a>其它语言</h4><p>使用其它转译语言，安装模块后使用：</p><ul><li>对于 TypeScript，重命名为 <code>gulpfile.ts</code> 并安装 <a href="https://www.npmjs.com/package/ts-node" target="_blank" rel="noopener">ts-node</a> 模块。</li><li>对于 Babel，重命名为 <code>gulpfile.babel.js</code> 并安装 <a href="https://www.npmjs.com/package/@babel/register" target="_blank" rel="noopener">@babel/register</a> 模块。</li></ul><h4 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h4><p>随着项目增大，使用 <code>import</code> 分割。</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defaultTask</span>(<span class="params">cd</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// please code for your default task here</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'i am gulp'</span>)</span><br><span class="line">    cd()                <span class="comment">// 不写回调会报提示，因为最新版取消了同步模式，需要用回调标记完成</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = defaultTask   <span class="comment">// default 默认任务 gulp 自动运行</span></span><br></pre></td></tr></table></figure><blockquote><p>约定每个任务为异步任务</p></blockquote><p>gulp 4.0之前：(已不推荐)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>)</span><br><span class="line">gulp.task(<span class="string">'bar'</span>, done =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'bar workig~'</span>)</span><br><span class="line">    done()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><h4 id="导出任务"><a href="#导出任务" class="headerlink" title="导出任务"></a>导出任务</h4><blockquote><p>公开私有只是设计上导出和未导出的区别而已</p></blockquote><h5 id="公开任务"><a href="#公开任务" class="headerlink" title="公开任务"></a>公开任务</h5><p>从 gulpfile 中被导出（export），可以通过 <code>gulp</code> 命令直接调用。</p><h5 id="私有任务"><a href="#私有任务" class="headerlink" title="私有任务"></a>私有任务</h5><p>被<strong>设计为</strong>在内部使用，通常作为 <code>series()</code> 或 <code>parallel()</code> 组合的组成部分。</p><h4 id="组合任务"><a href="#组合任务" class="headerlink" title="组合任务"></a>组合任务</h4><p>顺序执行（串行模式）使用 <code>series()</code> ，并发执行使用 <code>parallel()</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;series, parallel&#125; = <span class="built_in">require</span>(<span class="string">'gulp'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">task1</span>(<span class="params">done</span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'task1'</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">    done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">task2</span>(<span class="params">done</span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'task2'</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">    done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">task3</span>(<span class="params">done</span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'task3'</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">    done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.task = series(task1, task2, task3)</span><br><span class="line">exports.taskP = parallel(task1, task2, task3)</span><br></pre></td></tr></table></figure><h3 id="异步执行"><a href="#异步执行" class="headerlink" title="异步执行"></a>异步执行</h3><blockquote><p>新版 gulp 不再支持同步任务 ，不使用以下几种方式，会发出 <em>“Did you forget to signal async completion?”</em> 警告 。</p></blockquote><p>Node 库以多种方式处理异步功能。最常见的模式是 <a href="https://nodejs.org/api/errors.html#errors_error_first_callbacks" target="_blank" rel="noopener">error-first callbacks</a>，但是你还可能会遇到 <a href="https://nodejs.org/api/stream.html#stream_stream" target="_blank" rel="noopener">streams</a>、<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises" target="_blank" rel="noopener">promises</a>、<a href="https://nodejs.org/api/events.html#events_events" target="_blank" rel="noopener">event emitters</a>、<a href="https://nodejs.org/api/child_process.html#child_process_child_process" target="_blank" rel="noopener">child processes</a>, 或 <a href="https://github.com/tc39/proposal-observable/blob/master/README.md" target="_blank" rel="noopener">observables</a>。gulp 任务（task）规范化了所有这些类型的异步功能 （？？？）</p><p>常用的几种任务（task）完成通知：</p><ol><li>callback</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'callback'</span>)</span><br><span class="line">    cb()</span><br><span class="line">&#125;</span><br><span class="line">exports.callback = callback</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误优先 （一种标准）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback_error</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'callback_error'</span>)</span><br><span class="line">    cb(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'i am error'</span>))   <span class="comment">// 同时会阻塞后续任务</span></span><br><span class="line">&#125;</span><br><span class="line">exports.callback_e = callback_error</span><br></pre></td></tr></table></figure><ol><li>promise</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// promise</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback_promise</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'callback_promise'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">'resolve of promise'</span>) <span class="comment">// gulp 会忽略掉这里传的值</span></span><br><span class="line">&#125;</span><br><span class="line">exports.callback_p = callback_promise</span><br><span class="line"></span><br><span class="line"><span class="comment">// reject</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback_promise_r</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'callback_promise'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(failed)) <span class="comment">// gulp 会忽略掉这里传的值</span></span><br><span class="line">&#125;</span><br><span class="line">exports.callback_pr = callback_promise_r</span><br></pre></td></tr></table></figure><ol><li><code>async/await</code> （node 8版本以上可用）</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// async await</span><br><span class="line"></span><br><span class="line">function setTime(time)&#123;</span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">        setTimeout(resolve,time)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function async()&#123;</span><br><span class="line">    await setTime(1000)</span><br><span class="line">    console.log('async await -')</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.callback_a = async</span><br></pre></td></tr></table></figure><ol><li>流操作，结束时机是 <code>return readStream</code> 触发了Stream中的 <code>end()</code> 事件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback_stream</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> readStream = fs.createReadStream(<span class="string">'package.json'</span>)</span><br><span class="line">    <span class="keyword">const</span> writeStream = fs.createWriteStream(<span class="string">'json.txt'</span>)</span><br><span class="line">    readStream.pipe(writeStream)  <span class="comment">// 相当于从一个池子往另一个池子倒水, 起到文件复制的作用</span></span><br><span class="line">    <span class="keyword">return</span> readStream</span><br><span class="line">&#125;</span><br><span class="line">exports.callback_s = callback_stream</span><br></pre></td></tr></table></figure><p>模拟：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback_stream</span> (<span class="params">done</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> readStream = fs.createReadStream(<span class="string">'package.json'</span>)</span><br><span class="line">    <span class="keyword">const</span> writeStream = fs.createWriteStream(<span class="string">'json.txt'</span>)</span><br><span class="line">    readStream.pipe(writeStream)  <span class="comment">// 相当于从一个池子往另一个池子倒水, 起到文件复制的作用</span></span><br><span class="line">    readStream.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">        done()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="构建过程及原理"><a href="#构建过程及原理" class="headerlink" title="构建过程及原理"></a>构建过程及原理</h2><blockquote><p>The streaming build system 基于流的构建系统</p></blockquote><p>总体步骤：输入——加工——输出。比如：读取文件——压缩文件——写入文件。</p><p>例，简单的压缩实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取流 转换流 写入流</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myCompress</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 文件读取流</span></span><br><span class="line">    <span class="keyword">const</span> read = fs.createReadStream(<span class="string">'normalize.css'</span>)</span><br><span class="line">    <span class="comment">// 文件写入流</span></span><br><span class="line">    <span class="keyword">const</span> write = fs.createWriteStream(<span class="string">'normalize.min.css'</span>)</span><br><span class="line">    <span class="comment">// 文件转化流</span></span><br><span class="line">    <span class="keyword">const</span> transform = <span class="keyword">new</span> Transform(&#123;</span><br><span class="line">        transform: <span class="function">(<span class="params">chunk, encoding, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 转换过程实现</span></span><br><span class="line">            <span class="comment">// chunk 可以拿到读取流中读取到的内容（Buffer）</span></span><br><span class="line">            <span class="keyword">const</span> input = chunk.toString()  <span class="comment">// 读出来是一个字节数组，因此要转换成字符串</span></span><br><span class="line">            <span class="keyword">const</span> output = input.replace(<span class="regexp">/\s+/g</span>,<span class="string">''</span>).replace(<span class="regexp">/\/\*.+?\*\//g</span>,<span class="string">''</span>) <span class="comment">// 替换掉空白格和注释</span></span><br><span class="line">            callback(<span class="literal">null</span>, output)   <span class="comment">// 这是个错误优先的回调函数，没有错误对象传空null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把读取的文件流导出写入文件流</span></span><br><span class="line">    read</span><br><span class="line">    .pipe(transform) <span class="comment">// 转换</span></span><br><span class="line">    .pipe(write)  <span class="comment">// 写入</span></span><br><span class="line">    <span class="keyword">return</span> read</span><br><span class="line">&#125;</span><br><span class="line">exports.callback_m = myCompress</span><br></pre></td></tr></table></figure><h2 id="文件操作的API"><a href="#文件操作的API" class="headerlink" title="文件操作的API"></a>文件操作的API</h2><blockquote><p>文件操作的API及插件的使用，相对于node封装的更加强大</p></blockquote><ol><li><code>src()</code>：创建一个流，用于从文件系统读取 <a href="https://www.gulpjs.com.cn/docs/api/concepts#vinyl" target="_blank" rel="noopener">Vinyl</a> 对象。</li><li>利用插件转换。</li><li><code>dest()</code>：创建一个用于将 <a href="https://www.gulpjs.com.cn/docs/api/concepts#vinyl" target="_blank" rel="noopener">Vinyl</a> 对象写入到文件系统的流。destination缩写，目标位置。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 装 css 转换流插件</span><br><span class="line">npm install gulp-clean-css --save-dev</span><br><span class="line">npm install gulp-rename --save-dev</span><br></pre></td></tr></table></figure><p><code>gulpfile.js</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;src, dest&#125; = <span class="built_in">require</span>(<span class="string">'gulp'</span>)    <span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">const</span> cssClean = <span class="built_in">require</span>(<span class="string">'gulp-clean-css'</span>)</span><br><span class="line"><span class="keyword">const</span> rename = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">srcAndDist</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> src(<span class="string">'src/*.scss'</span>)</span><br><span class="line">        .pipe(cssClean())</span><br><span class="line">        .pipe(rename(&#123;<span class="attr">extname</span>: <span class="string">'.min.css'</span>&#125;))</span><br><span class="line">        .pipe(dest(<span class="string">'dist'</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.sad = srcAndDist</span><br></pre></td></tr></table></figure><h2 id="自动化构建工作流（案例）"><a href="#自动化构建工作流（案例）" class="headerlink" title="自动化构建工作流（案例）"></a>自动化构建工作流（案例）</h2><h3 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 装 css 转换流插件</span><br><span class="line">npm install gulp-clean-css --save-dev</span><br><span class="line">npm install gulp-rename --save-dev</span><br><span class="line">npm install gulp-sass --save-dev       # node-sass 部分依赖于国外，需要配置镜像源</span><br></pre></td></tr></table></figure><p>引入 sass 编译</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;src, dest&#125; = <span class="built_in">require</span>(<span class="string">'gulp'</span>)    <span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">const</span> cssClean = <span class="built_in">require</span>(<span class="string">'gulp-clean-css'</span>)</span><br><span class="line"><span class="keyword">const</span> rename = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>)</span><br><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">'gulp-sass'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">srcCSS</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> src(<span class="string">'src/*.scss'</span>)</span><br><span class="line">        <span class="comment">// sass会忽略掉 ‘_’ 开头的文件，参数可以指定输出样式</span></span><br><span class="line">        .pipe(sass(&#123; <span class="attr">outputStyle</span>: <span class="string">'expanded'</span> &#125;))      </span><br><span class="line">        .pipe(cssClean())</span><br><span class="line">        .pipe(rename(&#123;<span class="attr">extname</span>: <span class="string">'.min.css'</span>&#125;))</span><br><span class="line">        .pipe(dest(<span class="string">'dist'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-babel --save-dev</span><br><span class="line">npm install gulp-babel @babel/core @babel/preset-env --save-dev</span><br></pre></td></tr></table></figure><p>引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">'gulp-babel'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">script</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> src(<span class="string">'src/js/*.js'</span>, &#123;<span class="attr">base</span>: <span class="string">'src'</span>&#125;)</span><br><span class="line">        <span class="comment">// @babel/preset-env 是转换打包的集合，没有配置会没有效果</span></span><br><span class="line">        .pipe(babel(&#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;)) </span><br><span class="line">        .pipe(dest(<span class="string">'dist'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-swig --save-dev</span><br></pre></td></tr></table></figure><p>引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> swig = <span class="built_in">require</span>(<span class="string">'gulp-swig'</span>)</span><br><span class="line"><span class="keyword">const</span> data = &#123;     <span class="comment">// 模拟数据</span></span><br><span class="line">    hello: <span class="string">'你好'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">page</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ** 表示src任意子目录下的 html 文件</span></span><br><span class="line">    <span class="keyword">return</span> src(<span class="string">'src/**.html'</span>, &#123;<span class="attr">base</span>:<span class="string">'src'</span>&#125;)</span><br><span class="line">        .pipe(swig(&#123;data&#125;))</span><br><span class="line">        .pipe(dest(<span class="string">'dist'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组合</span></span><br><span class="line"><span class="keyword">const</span> &#123;series, parallel&#125; = <span class="built_in">require</span>(<span class="string">'gulp'</span>)</span><br><span class="line"><span class="keyword">const</span> compile = parallel(srcCSS, script, page)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    srcAndDist,</span><br><span class="line">    script,</span><br><span class="line">    page,</span><br><span class="line">    image,</span><br><span class="line">    font,     </span><br><span class="line">    compile</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字体-图片"><a href="#字体-图片" class="headerlink" title="字体/图片"></a>字体/图片</h3><h4 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 依赖模块涉及c++，需要下载二进制程序集，大多在github，无法配置镜像，需要使用其它方式</span><br><span class="line">npm install gulp-imagemin --save-dve</span><br></pre></td></tr></table></figure><p>引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>)</span><br><span class="line"><span class="keyword">const</span> image = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> src(<span class="string">'src/assets/images/**'</span>, &#123;<span class="attr">base</span>: <span class="string">'src'</span>&#125;)</span><br><span class="line">        .pipe(imagemin())</span><br><span class="line">        .pipe(dest(<span class="string">'dist'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> font = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> src(<span class="string">'src/assets/font/**'</span>,&#123;<span class="attr">base</span>: <span class="string">'src'</span>&#125;)</span><br><span class="line">        .pipe(imagemin())</span><br><span class="line">        .pipe(dest(<span class="string">'dist'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="额外文件"><a href="#额外文件" class="headerlink" title="额外文件"></a>额外文件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> extra = <span class="function"><span class="params">()</span> =&gt;</span> &#123;     <span class="comment">// 额外文件打包</span></span><br><span class="line">    <span class="keyword">return</span> src(<span class="string">'public/**'</span>, &#123; <span class="attr">base</span>: <span class="string">'public'</span> &#125;)</span><br><span class="line">    .pipe(dest(<span class="string">'dist'</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compile = parallel(style, script, page, image, font)</span><br><span class="line"><span class="keyword">const</span> build = parallel(compile, extra)</span><br></pre></td></tr></table></figure><h4 id="自动清除目录文件"><a href="#自动清除目录文件" class="headerlink" title="自动清除目录文件"></a>自动清除目录文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install del --save-dev</span><br></pre></td></tr></table></figure><p>引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> del = <span class="built_in">require</span>(<span class="string">'del'</span>)</span><br><span class="line"><span class="keyword">const</span> clean = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> del([<span class="string">'dist'</span>])    <span class="comment">// 返回的是一个 promise 对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> build = series(clean, parallel(compile, extra))  <span class="comment">// 需要串行进行</span></span><br></pre></td></tr></table></figure><blockquote><p><code>del</code> 不是 gulp 的插件，但是可以在 gulp 中使用 </p></blockquote><h3 id="自动加载插件"><a href="#自动加载插件" class="headerlink" title="自动加载插件"></a>自动加载插件</h3><p>汇总 <code>require</code> 操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-load-plugins --save-dev</span><br></pre></td></tr></table></figure><p>引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loadPlugins = <span class="built_in">require</span>(<span class="string">'gulp-load-plugins'</span>)</span><br><span class="line"><span class="keyword">const</span> plugins = loadPlugins()</span><br><span class="line"><span class="comment">// 使用到插件的地方需要全部改为 plugins.sass...不需要 require,可自动加载</span></span><br></pre></td></tr></table></figure><h3 id="热更新开发服务器"><a href="#热更新开发服务器" class="headerlink" title="热更新开发服务器"></a>热更新开发服务器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install browser-sync --save-dev</span><br></pre></td></tr></table></figure><blockquote><p>相对与 express 开发的普通的web服务器，它功能更强大支持热更新等</p></blockquote><p>引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">'browser-sync'</span>)</span><br><span class="line"><span class="keyword">const</span> bs = browserSync.create()  <span class="comment">// 创建</span></span><br><span class="line"><span class="keyword">const</span> serve = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    bs.init(&#123;</span><br><span class="line">        notify: <span class="literal">false</span>,</span><br><span class="line">        port: <span class="number">2080</span>,</span><br><span class="line">        <span class="comment">// opent: false,</span></span><br><span class="line">        files: <span class="string">'dist/**'</span>,</span><br><span class="line">        server: &#123;</span><br><span class="line">            baseDir: <span class="string">'dist'</span>,   <span class="comment">// 指定监听文件</span></span><br><span class="line">            routes: &#123;</span><br><span class="line">                <span class="string">'/node_modules'</span> : <span class="string">'node_modules'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports =&#123;</span><br><span class="line">    serve</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="监听变化构建优化"><a href="#监听变化构建优化" class="headerlink" title="监听变化构建优化"></a>监听变化构建优化</h3><p>调用 gulp <code>watch API</code> 对文件进行监视</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;watch&#125; = <span class="built_in">require</span>(<span class="string">'gulp'</span>)</span><br><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">'browser-sync'</span>)</span><br><span class="line"><span class="keyword">const</span> bs = browserSync.create()  <span class="comment">// 创建</span></span><br><span class="line"><span class="keyword">const</span> serve = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 文件改变触发相应的编译任务，再进行热更新</span></span><br><span class="line">    watch(<span class="string">'src/assets/styles/*.scss'</span>, style) </span><br><span class="line">    watch(<span class="string">'src/assets/scripts/*.js'</span>, script)</span><br><span class="line">    watch(<span class="string">'src/*.html'</span>, page)</span><br><span class="line">    <span class="comment">// watch('src/assets/images/**', image)</span></span><br><span class="line">    <span class="comment">// watch('src/assets/fonts/**', font)</span></span><br><span class="line">    <span class="comment">// watch('public/**', extra)</span></span><br><span class="line">    watch([</span><br><span class="line">        <span class="string">'src/assets/images/**'</span>,</span><br><span class="line">        <span class="string">'src/assets/fonts/**'</span>,</span><br><span class="line">        <span class="string">'public/**'</span>,</span><br><span class="line">    ], bs.reload)</span><br><span class="line">    </span><br><span class="line">    bs.init(&#123;</span><br><span class="line">        notify: <span class="literal">false</span>,</span><br><span class="line">        port: <span class="number">2080</span>,</span><br><span class="line">        <span class="comment">// opent: false,</span></span><br><span class="line">        files: <span class="string">'dist/**'</span>,  </span><br><span class="line">        <span class="comment">// 也可以在每个任务中使用 .pipe(bs.reload(&#123;stream: ture&#125;))</span></span><br><span class="line">        server: &#123;</span><br><span class="line">            <span class="comment">// 指定监听文件 找不到依次向后找</span></span><br><span class="line">            baseDir: [<span class="string">'dist'</span>, <span class="string">'src'</span>, <span class="string">'public'</span>],   </span><br><span class="line">            <span class="comment">// src public 只是拷贝不影响呈现，因此开发阶段直接使用源文件，加快编译效率</span></span><br><span class="line">            routes: &#123;</span><br><span class="line">                <span class="string">'/node_modules'</span> : <span class="string">'node_modules'</span> <span class="comment">// 开发阶段为三方做了路由映射</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子任务</span></span><br><span class="line"><span class="keyword">const</span> compile = parallel(style, script, page)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上线之前执行任务</span></span><br><span class="line"><span class="keyword">const</span> build = series(clean, parallel(compile, image, font, extra))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开发阶段热更新</span></span><br><span class="line"><span class="keyword">const</span> develop = series(compile, serve)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports =&#123;</span><br><span class="line">    compile,</span><br><span class="line">    build,</span><br><span class="line">    develop</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>页面缓存的机制导致swig不发生变化？？？swig 选项 cache 设置为 false </p></blockquote><h3 id="useref-解决文件引用问题"><a href="#useref-解决文件引用问题" class="headerlink" title="useref 解决文件引用问题"></a>useref 解决文件引用问题</h3><p>问题：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开发环境使用的 node_module 文件并不能引入到生产环境问题 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/node_module/bootstrap/dist/css/bootstrap.css"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-useref --save-dev</span><br></pre></td></tr></table></figure><p>引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useref = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> src(<span class="string">'dist/*.html'</span>, <span class="string">'dist'</span>)</span><br><span class="line">        .pipe(plugins.useref(&#123; <span class="attr">searchPath</span>: [<span class="string">'dist'</span>, <span class="string">'.'</span>]&#125;))  <span class="comment">// dist 根目录下面找</span></span><br><span class="line">        <span class="comment">// 生成新的文件可以在此处写入其它操作：压缩等</span></span><br><span class="line">        .pipe(dest(<span class="string">'dist'</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    useref</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解决：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- build:css assets/styles/vendor.css --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/node_module/bootstrap/dist/css/bootstrap.css"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- endbuild --&gt;</span></span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 它会将 build 标记的内容全部合并到指定的路径里并引用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"assets/styles/vendor.css"</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="文件压缩"><a href="#文件压缩" class="headerlink" title="文件压缩"></a>文件压缩</h3><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-htmlmin --save-dev    # html</span><br><span class="line">npm install gulp-uglify --save-dev     # js</span><br><span class="line">npm install gulp-clean-css --save-dev  # css</span><br><span class="line">npm install gulp-if --save-dev</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useref = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> src(<span class="string">'dist/*.html'</span>, <span class="string">'dist'</span>)</span><br><span class="line">        .pipe(plugins.useref(&#123; <span class="attr">searchPath</span>: [<span class="string">'dist'</span>, <span class="string">'.'</span>]&#125;))  <span class="comment">// dist 根目录下面找</span></span><br><span class="line">        .pipe(plugins.if(<span class="regexp">/\.js$/</span>, plugin.uglify()))</span><br><span class="line">        .pipe(plugins.if(<span class="regexp">/\.css$/</span>, plugin.cleanCss()))</span><br><span class="line">        .pipe(plugins.if(<span class="regexp">/\.html$/</span>, plugin.htmlmin(&#123; </span><br><span class="line">            collapseWhitespace: <span class="literal">true</span>,  <span class="comment">// 折叠空白格</span></span><br><span class="line">            minifyCSS: <span class="literal">true</span>,   <span class="comment">// 压缩行内css</span></span><br><span class="line">            minifyJS: <span class="literal">true</span>     <span class="comment">// 压缩行内JS  ...</span></span><br><span class="line">        &#125;))) </span><br><span class="line">        <span class="comment">// .pipe(dest('dist'))    解决读写冲突问题</span></span><br><span class="line">        .pipe(dest(<span class="string">'release'</span>))</span><br><span class="line">&#125;<span class="string">``</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    useref</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 先执行 compile 再执行 useref</span></span><br></pre></td></tr></table></figure><h3 id="解决重建目录问题"><a href="#解决重建目录问题" class="headerlink" title="解决重建目录问题"></a>解决重建目录问题</h3><blockquote><p>问题：为了解决读写冲突，我们将压缩文件放入到了 release 文件，但是与原来静态资源的位置不一致</p></blockquote><p>解决：</p><p>将原本读取到 <code>dist</code> 文件的文件放入到临时文件 <code>temp</code> 文件中，在 <code>useref</code> 中从临时文件 temp 中读取到 dist文件中</p><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><ol><li>暴露必要接口。</li><li>写进 <code>package.json</code> 的 <code>scripts</code> 属性。</li><li><code>.gitignore</code> 忽略掉临时文件，比如：<code>temp/dist</code>。</li></ol><h2 id="封装自动化构建工作流"><a href="#封装自动化构建工作流" class="headerlink" title="封装自动化构建工作流"></a>封装自动化构建工作流</h2><p>问题：<code>gulpfile.js</code> 公用在多个项目当中，当修改 <code>gulpfile.js</code> 或升级配置时，需要修改多个文件。</p><blockquote><p>提取多个项目共同的自动化构建过程：利用 CLI + gulpfile.js</p></blockquote><h1 id="FIS3"><a href="#FIS3" class="headerlink" title="FIS3"></a>FIS3</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install fis3 --save-dev</span><br><span class="line"></span><br><span class="line">npm run fis3 release #</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://fis.baidu.com/" target="_blank" rel="noopener">https://fis.baidu.com/</a></p></blockquote><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><h2 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h2><blockquote><p><a href="https://segmentfault.com/a/1190000012505272" target="_blank" rel="noopener">https://segmentfault.com/a/1190000012505272</a></p></blockquote><blockquote><p><a href="https://blog.csdn.net/HuangsTing/article/details/89134874" target="_blank" rel="noopener">https://blog.csdn.net/HuangsTing/article/details/89134874</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm get config profix</span><br><span class="line">*******</span><br><span class="line">npm set config profix *******</span><br></pre></td></tr></table></figure><h2 id="npm科学上网"><a href="#npm科学上网" class="headerlink" title="npm科学上网"></a>npm科学上网</h2><p><code>npm</code> 科学上网导致的问题</p><blockquote><p><a href="https://segmentfault.com/a/1190000022881608" target="_blank" rel="noopener">https://segmentfault.com/a/1190000022881608</a></p></blockquote><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://www.gulpjs.com.cn/docs/getting-started/quick-start/" target="_blank" rel="noopener">https://www.gulpjs.com.cn/docs/getting-started/quick-start/</a></p></blockquote><blockquote><p><a href="https://www.ruanyifeng.com/blog/2019/02/npx.html" target="_blank" rel="noopener">https://www.ruanyifeng.com/blog/2019/02/npx.html</a></p></blockquote><blockquote><p><a href="https://www.npmjs.com/package/npx" target="_blank" rel="noopener">https://www.npmjs.com/package/npx</a></p></blockquote><blockquote><p><a href="https://fis.baidu.com/" target="_blank" rel="noopener">https://fis.baidu.com/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;自动化构建&quot;&gt;&lt;a href=&quot;#自动化构建&quot; class=&quot;headerlink&quot; title=&quot;自动化构建&quot;&gt;&lt;/a&gt;自动化构建&lt;/h1&gt;&lt;p&gt;自动化构建：就是将 &lt;strong&gt;开发阶段产生的源代码&lt;/strong&gt; 自动化的转换成 &lt;strong&gt;生产环境中可以运行的代码或程序&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;自动化构建工作流：
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="自动化 gulp" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/%E8%87%AA%E5%8A%A8%E5%8C%96-gulp/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="自动化 gulp" scheme="http://yoursite.com/tags/%E8%87%AA%E5%8A%A8%E5%8C%96-gulp/"/>
    
  </entry>
  
  <entry>
    <title>工程化CLI——Yeoman与plop</title>
    <link href="http://yoursite.com/2020/08/05/AWebTool_%E5%B7%A5%E7%A8%8B%E5%8C%96Cli_yeoman_plop/"/>
    <id>http://yoursite.com/2020/08/05/AWebTool_工程化Cli_yeoman_plop/</id>
    <published>2020-08-05T12:23:00.000Z</published>
    <updated>2020-08-24T15:56:17.518Z</updated>
    
    <content type="html"><![CDATA[<h1 id="工程化"><a href="#工程化" class="headerlink" title="工程化"></a>工程化</h1><h2 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h2><ol><li>转译新特性语言。</li><li>使用CSS预编译。</li><li>使用模块化，组件化。<a id="more"></a></li><li>手动压缩代码及资源，手动部署。</li><li>多人协同开发，无法硬性统一大家的代码风格。</li><li>从仓库pull下来的代码质量无法保证。</li><li>部分前端开发需要等待后端服务接口提前完成。</li></ol><blockquote><p>语言、模块组件化、自动化、风格质量保证、与后端解耦</p></blockquote><h2 id="一般流程"><a href="#一般流程" class="headerlink" title="一般流程"></a>一般流程</h2><blockquote><p>创建项目阶段——编码阶段——预览测试阶段——提交阶段——部署阶段</p></blockquote><p>创建项目阶段：创建项目结构、特定类型文件</p><p>编码阶段：格式化代码、校验代码、编译构建打包</p><p>预览测试阶段：webServer（阿帕奇、Nginx）、MOCK（模拟后端接口）、Live Reloading、HMR、Source Map（定位源代码问题使用）</p><p>提交阶段：Git Hooks、Lint-staged、持续集成（提交检查，风格质量，提交日志等检查）</p><p>部署阶段：CI/CD 自动上传发布</p><h2 id="脚手架"><a href="#脚手架" class="headerlink" title="脚手架"></a>脚手架</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>根据信息创建对应的项目基础结构。（特定文件及配置）</p><p>Yeoman：通用性项目脚手架工具。</p><p>Plop：用于创建特定类型的文件，例如：创建一个组件、模块所需要的文件。</p><h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><h4 id="Yeoman"><a href="#Yeoman" class="headerlink" title="Yeoman"></a>Yeoman</h4><p>基于 node 通用脚手架工具，可利用其 <code>generator</code> 创造自己的脚手架工具。</p><h5 id="安装入门"><a href="#安装入门" class="headerlink" title="安装入门"></a>安装入门</h5><blockquote><p><a href="https://yeoman.io/learning/" target="_blank" rel="noopener">https://yeoman.io/learning/</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 全局安装 yo</span><br><span class="line">npm install -g yo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 全局安装 generator-node 模块，用例使用</span><br><span class="line">npm install -g generator-node   # 不同的 generator 生成不同的项目 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 创建 my-module 文件作为根目录</span><br><span class="line">mkdir my-module</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 运行 generator-node 模块</span><br><span class="line">yo node</span><br></pre></td></tr></table></figure><p>输入选择</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 创建选择</span><br><span class="line">? Module Name azhong</span><br><span class="line">? Description learn yo</span><br><span class="line">? Project homepage url https://f-lancer.github.io</span><br><span class="line">? Author's Name azhong</span><br><span class="line">? Author's Email </span><br><span class="line">? Author's Homepage https://f-lancer.github.io</span><br><span class="line">? Package keywords (comma to split) module,node</span><br><span class="line">? Send coverage reports to coveralls Yes</span><br><span class="line">? Enter Node versions (comma separated)  </span><br><span class="line">? Enter Node versions (comma separated) </span><br><span class="line">? GitHub username or organization </span><br><span class="line">? Which license do you want to use? MIT</span><br></pre></td></tr></table></figure><h5 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h5><h6 id="Sub-Generator-（模块子集）"><a href="#Sub-Generator-（模块子集）" class="headerlink" title="Sub Generator （模块子集）"></a>Sub Generator （模块子集）</h6><blockquote><p>在已有项目上添加特定的配置文件，比如 <code>.babelrc</code>、<code>.eslintrc</code> 等文件。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 利用 node 子集的 cli，将项目变成 cli 应用</span><br><span class="line">yo node:cli</span><br><span class="line"></span><br><span class="line">? Overwrite package.json? overwrite # 是否重写该文件</span><br></pre></td></tr></table></figure><blockquote><p>generator-node 子集：<a href="https://github.com/yeoman/generator-node" target="_blank" rel="noopener">https://github.com/yeoman/generator-node</a></p></blockquote><h6 id="通用步骤"><a href="#通用步骤" class="headerlink" title="通用步骤"></a>通用步骤</h6><ol><li>明确需求。</li><li>合适的 generator。</li><li>全局安装。</li><li><code>yo</code> 命令运行。</li><li>命令交互行填写。</li><li>生成项目结构。</li></ol><blockquote><p>webapp：<a href="https://yeoman.io/learning/" target="_blank" rel="noopener">https://yeoman.io/learning/</a></p></blockquote><h5 id="自定义-Generator"><a href="#自定义-Generator" class="headerlink" title="自定义 Generator"></a>自定义 <code>Generator</code></h5><blockquote><p>创建 Generator 本质上是创建一个 npm 模块</p></blockquote><h6 id="Generator-基本结构"><a href="#Generator-基本结构" class="headerlink" title="Generator 基本结构"></a>Generator 基本结构</h6><p>普通结构：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|————generators/              ......生成器目录</span><br><span class="line">|       |————app/             ......默认生成目录</span><br><span class="line">|             |————index.js   ......默认生成器实现</span><br><span class="line">|————package.json             ......模块包配置文件</span><br></pre></td></tr></table></figure><p>带子生成器的结构：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|————generators/              ......生成器目录</span><br><span class="line">|       |————app/             ......默认生成目录</span><br><span class="line">|       |     |————index.js   ......默认生成器实现</span><br><span class="line">|       |————component/       ......其它生成器目录</span><br><span class="line">|             |————index.js   ......其它生成器实现</span><br><span class="line">|————package.json             ......模块包配置文件</span><br></pre></td></tr></table></figure><p>名称格式：<code>generator-&lt;name&gt;</code></p><h6 id="实施"><a href="#实施" class="headerlink" title="实施"></a>实施</h6><ol><li>创建文件 <code>generator-sample</code> ，安装 <code>yeoman-generator</code>。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir generator-sample  </span><br><span class="line">npm init</span><br><span class="line">npm install yeoman-generator    # 提供了生成器基类，基类中提供了工具函数</span><br></pre></td></tr></table></figure><ol start="2"><li>文件 <code>generator-sample</code> 内 构建基本结构</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|————generators/              ......生成器目录</span><br><span class="line">|       |————app/             ......默认生成目录</span><br><span class="line">|             |————index.js   ......默认生成器实现</span><br><span class="line">|————package.json             ......模块包配置文件</span><br></pre></td></tr></table></figure><ol start="3"><li><code>index.js</code> 中写入简单功能</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此文件 是 Generator 的核心入口，需要导出一个继承自 Yeoman Generator 的类型</span></span><br><span class="line"><span class="comment">// Yeoman Generator 其中的一些生命周期函数会被自动调用，我们可以在这些生命周期中调用</span></span><br><span class="line"><span class="comment">// 父类提供的一些工具方法实现一些功能，例如文件写入</span></span><br><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">'yeoman-generator'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">    writing () &#123;</span><br><span class="line">        <span class="comment">// Yeoman 自动生成文件阶段调用此方法</span></span><br><span class="line">        <span class="comment">// 这里尝试往项目目录中写入文件</span></span><br><span class="line">        <span class="keyword">this</span>.fs.write(</span><br><span class="line">            <span class="keyword">this</span>.destinationPath(<span class="string">'temp.txt'</span>),</span><br><span class="line">            <span class="built_in">Math</span>.random().toString()</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><code>link</code> 到全局</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm link # link到全局，使之成为一个全局模块包，可以在全局使用</span><br><span class="line"></span><br><span class="line">cd ..</span><br><span class="line">mkdir my-proj # 构建新的项目</span><br><span class="line">cd my-proj</span><br><span class="line"></span><br><span class="line">yo sample # 使用 结果会在 my-proj 文件中生成一个新的temp.txt文件</span><br></pre></td></tr></table></figure><h6 id="根据模板创建文件"><a href="#根据模板创建文件" class="headerlink" title="根据模板创建文件"></a>根据模板创建文件</h6><p>因为我们创建文件一般比较多且复杂，因此我们可以根据模板模板创建文件</p><ol><li>结构改变：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|————generators/              ......生成器目录</span><br><span class="line">|       |————app/             ......默认生成目录</span><br><span class="line">|             |————templates</span><br><span class="line">|                      |————foo.txt    ....模板文件</span><br><span class="line">|             |————index.js   ......默认生成器实现</span><br><span class="line">|————package.json             ......模块包配置文件</span><br></pre></td></tr></table></figure><blockquote><p>这是个模板文件，所有的模板文件都可以放到这个 templates 文件夹下，内部可以使用 EJS 模板标记语法输出数据</p></blockquote><ol start="2"><li>写模板文件<code>foo.txt</code>：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 这是个模板文件，所有的模板文件都可以放到这个 templates 文件夹下</span><br><span class="line">2. 内部可以使用 EJS 模板标记语法输出数据</span><br><span class="line">&lt;%= title %&gt;</span><br><span class="line">&lt;% if(!success) &#123;%&gt;</span><br><span class="line">success 成功了</span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>入口文件<code>index.js</code>改变：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">'yeoman-generator'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">    writing () &#123;</span><br><span class="line">        <span class="comment">// 模板文件路径</span></span><br><span class="line">        <span class="keyword">const</span> temp = <span class="keyword">this</span>.templatePath(<span class="string">'foo.txt'</span>)</span><br><span class="line">        <span class="comment">// 输出目标路径</span></span><br><span class="line">        <span class="keyword">const</span> output = <span class="keyword">this</span>.destinationPath(<span class="string">'foo.txt'</span>)</span><br><span class="line">        <span class="comment">// 模板数据上下文</span></span><br><span class="line">        <span class="keyword">const</span> context = &#123;<span class="attr">title</span>: <span class="string">'hello'</span>, <span class="attr">success</span>: <span class="literal">false</span>&#125;</span><br><span class="line">        <span class="comment">// 会自动将模板文件映射到输出文件</span></span><br><span class="line">        <span class="keyword">this</span>.fs.copyTpl(temp, output , context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>运行</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo sample</span><br></pre></td></tr></table></figure><h6 id="接收用户输入"><a href="#接收用户输入" class="headerlink" title="接收用户输入"></a>接收用户输入</h6><p>使用 <code>prompting</code> 在命令行中和用户交互：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">'yeoman-generator'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">    prompting() &#123;</span><br><span class="line">        <span class="comment">// Yo 在询问用户输入时会调用该方法</span></span><br><span class="line">        <span class="comment">// 此方法会调用父类里的 prompt 方法发出对用户的命令行询问</span></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.prompt([  <span class="comment">// return 是为了后面更好的异步流程控制</span></span><br><span class="line">           &#123;</span><br><span class="line">               type: <span class="string">'input'</span>,   <span class="comment">// 类型</span></span><br><span class="line">               name: <span class="string">'name'</span>,    <span class="comment">// 最终得到的键</span></span><br><span class="line">               message: <span class="string">'Your project name'</span>,  <span class="comment">// 用户提示信息</span></span><br><span class="line">               <span class="keyword">default</span>: <span class="keyword">this</span>.appname   <span class="comment">// 默认为当前文件夹名字</span></span><br><span class="line">           &#125;</span><br><span class="line">       ])</span><br><span class="line">       .then(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// answers =&gt; &#123; name: 'user input value' &#125;</span></span><br><span class="line">            <span class="keyword">this</span>.answers = answers</span><br><span class="line">       &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    writing () &#123;</span><br><span class="line">        <span class="comment">// 模板文件路径</span></span><br><span class="line">        <span class="keyword">const</span> temp = <span class="keyword">this</span>.templatePath(<span class="string">'foo.txt'</span>)</span><br><span class="line">        <span class="comment">// 输出目标路径</span></span><br><span class="line">        <span class="keyword">const</span> output = <span class="keyword">this</span>.destinationPath(<span class="string">'foo.txt'</span>)</span><br><span class="line">        <span class="comment">// 模板数据上下文</span></span><br><span class="line">        <span class="comment">// const context = &#123;title: 'hello', success: false&#125;</span></span><br><span class="line">        <span class="comment">// 会自动将模板文件映射到输出文件</span></span><br><span class="line">        <span class="keyword">this</span>.fs.copyTpl(temp, output , <span class="keyword">this</span>.answers)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Vue-Generator-案例"><a href="#Vue-Generator-案例" class="headerlink" title="Vue Generator 案例"></a><code>Vue Generator</code> 案例</h5><ol><li>结构：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|————generators/              ......生成器目录</span><br><span class="line">|       |————app/             ......默认生成目录</span><br><span class="line">|             |————templates</span><br><span class="line">|                      |————.vue    ....vue项目结构</span><br><span class="line">|                      |————....    ....其它模板文件</span><br><span class="line">|             |————index.js   ......默认生成器实现</span><br><span class="line">|————package.json             ......模块包配置文件</span><br></pre></td></tr></table></figure><ol start="2"><li><code>index.js</code> 生成器入口：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">'yeoman-generator'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">    prompting() &#123;</span><br><span class="line">        <span class="comment">// Yo 在询问用户输入时会调用该方法</span></span><br><span class="line">        <span class="comment">// 此方法会调用父类里的 prompt 方法发出对用户的命令行询问</span></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.prompt([  <span class="comment">// return 是为了后面更好的异步流程控制</span></span><br><span class="line">           &#123;</span><br><span class="line">               type: <span class="string">'input'</span>,   <span class="comment">// 类型</span></span><br><span class="line">               name: <span class="string">'name'</span>,    <span class="comment">// 最终得到的键</span></span><br><span class="line">               message: <span class="string">'Your project name'</span>,  <span class="comment">// 用户提示信息</span></span><br><span class="line">               <span class="keyword">default</span>: <span class="keyword">this</span>.appname   <span class="comment">// 默认为当前文件夹名字</span></span><br><span class="line">           &#125;</span><br><span class="line">       ])</span><br><span class="line">       .then(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// answers =&gt; &#123; name: 'user input value' &#125;</span></span><br><span class="line">            <span class="keyword">this</span>.answers = answers</span><br><span class="line">       &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    writing () &#123;</span><br><span class="line">        <span class="comment">// 把每个文件都通过模板转换到目标路径</span></span><br><span class="line">        <span class="keyword">const</span> templates = [  <span class="comment">// template 绝对路径</span></span><br><span class="line">            <span class="string">'x.vue'</span>,</span><br><span class="line">            <span class="string">'y.js'</span>,</span><br><span class="line">            <span class="string">'README'</span></span><br><span class="line">          <span class="comment">//'...'</span></span><br><span class="line">        ]</span><br><span class="line">        templates.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;   <span class="comment">// 将 用户输入的answers循环至每个用到的模板文件</span></span><br><span class="line">            <span class="keyword">this</span>.fs.copyTpl(</span><br><span class="line">                <span class="keyword">this</span>.templatePath(item),</span><br><span class="line">                <span class="keyword">this</span>.destinationPath(item),</span><br><span class="line">                <span class="keyword">this</span>.answers</span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>实际上就是一个利用一些 <code>Generator API</code> 将用户输入的，利用 <code>EJS</code> 模板替换到项目需要自定义的地方，从而使其可以复用。</p></blockquote><h5 id="发布-Generator"><a href="#发布-Generator" class="headerlink" title="发布 Generator"></a>发布 Generator</h5><blockquote><p>实际上就是发布一个 <code>npm</code> 模块。</p></blockquote><ol><li>源代码托管到仓库：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">echo node_modules &gt; .gitignore   # 创建忽略文件</span><br><span class="line"></span><br><span class="line">git init # 初始化本地空仓库</span><br><span class="line"></span><br><span class="line">git status # 查看状态</span><br><span class="line"></span><br><span class="line">git add . # 当前目录所有下文件</span><br><span class="line"></span><br><span class="line">git commit -m 'feat:initial commit'  # 创建一次提交</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 到远端仓库创建一个新的仓库 获取远端仓库地址</span><br><span class="line"></span><br><span class="line">git remote add origin https://github... # 添加远端 origin 别名</span><br><span class="line"></span><br><span class="line">git push -u origin master    # 推送到远端</span><br><span class="line"></span><br><span class="line">npm push # 发布</span><br><span class="line"></span><br><span class="line">npm publish --registry=https://...   # 淘宝镜像报错默认使用官方镜像</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 添加关键词使得 yeoman 可见</span><br></pre></td></tr></table></figure><h4 id="plop"><a href="#plop" class="headerlink" title="plop"></a>plop</h4><p>精小的脚手架工具，一般会集成到项目中，用来创建相同类型的项目文件。</p><h5 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h5><p>在创建新组建时会需要新建同类型的文件、文件结构及基础代码，我们可以使用 plop 来帮我们做这件事。</p><h5 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a>基本使用</h5><ol><li>安装</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install plop --dev # 开发依赖</span><br></pre></td></tr></table></figure><ol start="2"><li>新建并配置 <code>plopfile.js</code>。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">plop</span> =&gt;</span> &#123;</span><br><span class="line">    plop.setGenerator(<span class="string">'component'</span>, &#123;</span><br><span class="line">        description: <span class="string">'create a component'</span>,</span><br><span class="line">        prompts: [</span><br><span class="line">            &#123;</span><br><span class="line">                type: <span class="string">'input'</span>,</span><br><span class="line">                name: <span class="string">'name'</span>,</span><br><span class="line">                message: <span class="string">'component name'</span></span><br><span class="line">                <span class="keyword">default</span>: <span class="string">'MyComponent'</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        actions: [</span><br><span class="line">            &#123;</span><br><span class="line">                type: <span class="string">'add'</span>,</span><br><span class="line">                path: <span class="string">'src/components/&#123;&#123;name&#125;&#125;/&#123;&#123;name&#125;&#125;.js'</span>,</span><br><span class="line">                templateFile: <span class="string">'plop-templates/component.hbs'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                type: <span class="string">'add'</span>,</span><br><span class="line">                path: <span class="string">'src/components/&#123;&#123;name&#125;&#125;/&#123;&#123;name&#125;&#125;.css'</span>,</span><br><span class="line">                templateFile: <span class="string">'plop-templates/component.css.hbs'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                type: <span class="string">'add'</span>,</span><br><span class="line">                path: <span class="string">'src/components/&#123;&#123;name&#125;&#125;/&#123;&#123;name&#125;&#125;.test.js'</span>,</span><br><span class="line">                templateFile: <span class="string">'plop-templates/component.test.hbs'</span></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>运行</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm plop component</span><br></pre></td></tr></table></figure><ol start="3"><li>总结</li></ol><blockquote><p>安装   ——  创建配置 <code>plopfile.js</code>文件  ——  编写配置模板  ——  运行plop提供的脚手架工具</p></blockquote><h3 id="脚手架工作原理"><a href="#脚手架工作原理" class="headerlink" title="脚手架工作原理"></a>脚手架工作原理</h3><blockquote><p>本质上是创建一个 <code>CLI</code> 应用</p></blockquote><p>建立简单的 <code>CLI</code> 应用：<code>azhongCli</code></p><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir azhongCli</span><br><span class="line">cd azhongCli</span><br><span class="line">npm init</span><br></pre></td></tr></table></figure><p>指定入口文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"azhongcli"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="string">"bin"</span>:<span class="string">"cli.js"</span>,   <span class="comment">// 添加bin字段，指定入口文件为 cli.jss</span></span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="string">"azhongcli"</span>: <span class="string">"azhongcli"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"ISC"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意入口文件 <code>cli.js</code> 文件头</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br></pre></td></tr></table></figure><p>link到全局失败..</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm link ./</span><br><span class="line">npm run azhongcli  # link 到本地配置 scripts字段</span><br></pre></td></tr></table></figure><h4 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h4><ol><li>通过命令行交互询问用户问题。</li><li>根据用户回答结果生成文件。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install inquirer # 命令行</span><br><span class="line">npm install ejs # 模板引擎</span><br></pre></td></tr></table></figure><h4 id="写入"><a href="#写入" class="headerlink" title="写入"></a>写入</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Node CLI 应用入口文件必须要有这样特定的文件头，</span></span><br><span class="line"><span class="comment">// 如果是 LINUX 或者 macOS还需要修改此文件的读写权限为 755，通过 chmod 755 cli.js实现修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 脚手架工作过程：</span></span><br><span class="line"><span class="comment">// 1. 通过命令行交互询问用户问题</span></span><br><span class="line"><span class="comment">// 2. 根据用户回答生成文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">'inquirer'</span>)  <span class="comment">// 用来进行命令行交互</span></span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">'ejs'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">inquirer.prompt([</span><br><span class="line">    &#123;</span><br><span class="line">        type: <span class="string">'input'</span>,</span><br><span class="line">        name: <span class="string">'name'</span>,</span><br><span class="line">        massage: <span class="string">'Project name?'</span></span><br><span class="line">    &#125;</span><br><span class="line">]).then(<span class="function"><span class="params">answers</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 拿到模板目录</span></span><br><span class="line">    <span class="keyword">const</span> tmplDir = path.join(__dirname, <span class="string">'templates'</span>)</span><br><span class="line">    <span class="comment">// 目标目录</span></span><br><span class="line">    <span class="keyword">const</span> destDir = process.cwd() <span class="comment">// 命令行执行的目录</span></span><br><span class="line">    <span class="comment">// 读取输出到目标目录</span></span><br><span class="line">    fs.readdir(tmplDir, (err, files) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err</span><br><span class="line">        files.forEach(<span class="function"><span class="params">file</span>=&gt;</span>&#123;</span><br><span class="line">            ejs.renderFile(path.join(tmplDir, file), answers, (err, result) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">                fs.writeFileSync(path.join(destDir, file), result)</span><br><span class="line">                <span class="built_in">console</span>.log(destDir)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://yeoman.io/authoring/user-interactions.html" target="_blank" rel="noopener">https://yeoman.io/authoring/user-interactions.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;工程化&quot;&gt;&lt;a href=&quot;#工程化&quot; class=&quot;headerlink&quot; title=&quot;工程化&quot;&gt;&lt;/a&gt;工程化&lt;/h1&gt;&lt;h2 id=&quot;解决的问题&quot;&gt;&lt;a href=&quot;#解决的问题&quot; class=&quot;headerlink&quot; title=&quot;解决的问题&quot;&gt;&lt;/a&gt;解决的问题&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;转译新特性语言。&lt;/li&gt;
&lt;li&gt;使用CSS预编译。&lt;/li&gt;
&lt;li&gt;使用模块化，组件化。
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="工程化CLI" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF-Tool/%E5%B7%A5%E7%A8%8B%E5%8C%96CLI/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端 Tool" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF-Tool/"/>
    
      <category term="工程化CLI" scheme="http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96CLI/"/>
    
  </entry>
  
  <entry>
    <title>浅析安全问题</title>
    <link href="http://yoursite.com/2020/07/28/Web_Security/"/>
    <id>http://yoursite.com/2020/07/28/Web_Security/</id>
    <published>2020-07-28T15:25:00.000Z</published>
    <updated>2020-07-28T15:28:18.266Z</updated>
    
    <content type="html"><![CDATA[<h1 id="XSS攻击"><a href="#XSS攻击" class="headerlink" title="XSS攻击"></a>XSS攻击</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Cross-site script，跨站脚本攻击。<a id="more"></a></p><blockquote><p>XSS攻击就是允许攻击者上传任意HTML文件到你的网站，恶意加载执行文件，造成网站丑化或导致用户账号被盗用等。</p></blockquote><h2 id="来自"><a href="#来自" class="headerlink" title="来自"></a>来自</h2><ol><li>用户的UGC信息（User Generated Content 用户生成信息）。</li><li>来自第三方的链接</li><li>URL参数</li><li>POST参数</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referer" target="_blank" rel="noopener">Referer</a>（Referer 请求头包含了请求页面的来源地址，可能来自不信任来源）</li><li>Cookie（可能来自其它子域注入）</li></ol><h2 id="Types-Of-XSS"><a href="#Types-Of-XSS" class="headerlink" title="Types Of XSS"></a>Types Of XSS</h2><p>存储式 XSS 漏洞（stored XSS）、反射式漏洞（reflected XSS）、基于DOM的（DOM-based XSS）。</p><table><thead><tr><th>类型</th><th>存储区</th><th>插入点</th></tr></thead><tbody><tr><td>存储型 XSS</td><td>后端数据库</td><td>HTML</td></tr><tr><td>反射型 XSS</td><td>URL</td><td>HTML</td></tr><tr><td>DOM 型 XSS</td><td>后端数据库/前端存储/URL</td><td>前端 JavaScript</td></tr></tbody></table><h3 id="stored-XSS"><a href="#stored-XSS" class="headerlink" title="stored XSS"></a>stored XSS</h3><p>允许用户存储数据的web应用容易遭受的存储式攻击。</p><p>用户在输入的地方输入js等非法代码，服务器未经验证就存储，再次返回给客户时就可以被利用了。浏览器无法辨别，响应执行，恶意代码窃取用户的数据并发送到攻击者网站，或冒充用户行为，调用目标网站接口执行攻击者指定操作。</p><blockquote><ol><li>输入用户名等时。</li><li>在论坛的新帖子输入html,然后论坛将其提供给他人。</li><li>商品评论，用户私信。</li></ol></blockquote><h3 id="reflected-XSS"><a href="#reflected-XSS" class="headerlink" title="reflected XSS"></a>reflected XSS</h3><p>诱骗用户点击恶意链接或诱导客户提交一个伪造表单，将代码注入web服务器，服务端将恶意代码从URL中取出，拼接在 HTML 中返回给浏览器。</p><blockquote><ol><li>email 社交软件，服务器包含注入代码回复返回，浏览器会执行注入的代码</li></ol></blockquote><h3 id="DOM-based-XSS"><a href="#DOM-based-XSS" class="headerlink" title="DOM-based XSS"></a>DOM-based XSS</h3><p>这种攻击针对有漏洞的客户端侧 <code>JS</code> ，web服务器一开始就没见到恶意注入的代码，取出和执行恶意代码都是由浏览器端完成的，但是具有同样的攻击效果。</p><blockquote><p>但是它仍然可以窃取登陆凭证，或诱骗受害者下载恶意软件，攻击的后果相当于有人黑进了FTP服务器，上传自己的HTML。</p></blockquote><h2 id="预防"><a href="#预防" class="headerlink" title="预防"></a>预防</h2><p>XSS难以防范的主要原因是页面中会出现以下上下文：html元素、属性 js 、css、 url。</p><h3 id="控制输入"><a href="#控制输入" class="headerlink" title="控制输入"></a>控制输入</h3><p>控制输入，对规则数据进行输入校验，比如电话号码中只能是数字及邮件地址等格式是固定的。</p><blockquote><p>但是输入并不是只有那些可见的输入框和url，还可能融入比如cookie，上传文件的文件名，HTTP头，参数名等。一旦攻击者绕过前端过滤，直接构造请求，就可以提交恶意代码了。</p></blockquote><h3 id="输入存储转义"><a href="#输入存储转义" class="headerlink" title="输入存储转义"></a>输入存储转义</h3><p>在存储到数据库前进行转义。</p><blockquote><p>但是无法确定输出这些数据会被用在哪里，如果作为页面在html文件里拼接可以正常显示，但是当通过js赋值给字符串等无法转义回来的地方时，就会产生乱码问题。</p></blockquote><h3 id="纯前端渲染"><a href="#纯前端渲染" class="headerlink" title="纯前端渲染"></a>纯前端渲染</h3><p>先加载一个静态 HTML（无业务数据），执行 JS，通过 AJAX 加载数据，调用 DOM API更新页面。浏览器会自己判断该在哪里插入什么，而不是直接将拼接好的扔给它。</p><blockquote><p>但是：</p><ol><li>纯前端渲染要避免 DOM-based XSS~。</li><li>纯前端适合内部等管理系统，但是对于优化性能及SEO的服务端渲染仍然需要拼接HTML。</li></ol></blockquote><h3 id="转义HTML"><a href="#转义HTML" class="headerlink" title="转义HTML"></a>转义HTML</h3><p>根据目标上下文将所有输出进行实体编码（编码需在服务端侧进行）。转义HTML，主要是对特殊字符进行转义，为了完备的根据不同的上下文进行转义，最好是使用成熟的转义库。</p><h3 id="预防DOM型XSS"><a href="#预防DOM型XSS" class="headerlink" title="预防DOM型XSS"></a>预防DOM型XSS</h3><p>预防DOM型，需要前端的代码规范：</p><ol><li>不将不可信的数据插入到页面上，小心使用 <code>.innerHTML</code>、<code>.outerHTML</code>、<code>document.write()</code> ，应尽量使用 <code>.textContent</code>、<code>.setAttribute()</code> 等。</li><li>使用vue等框架是不使用 <code>v-html</code>，<code>dangerouslySetInnerHTML</code>，避免类似 <code>.innerHTML</code>、<code>.outerHTML</code>的隐患。</li><li>DOM 中的内联事件监听器，如 <code>location</code>、<code>onclick</code>、<code>onerror</code>、<code>onload</code>、<code>onmouseover</code> 等，<code>&lt;a&gt;</code> 标签的 <code>href</code> 属性，JavaScript 的 <code>eval()</code>、<code>setTimeout()</code>、<code>setInterval()</code> 等，都能把字符串作为代码运行。 不要将不可信的数据拼接给这些API。</li></ol><h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><h4 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h4><p>Content Security Policy（内容安全策略）。</p><ul><li>禁止加载外域代码，防止复杂的攻击逻辑。</li><li>禁止外域提交，网站被攻击后，用户的数据不会泄露到外域。</li><li>禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）。</li><li>禁止未授权的脚本执行（新特性，Google Map 移动版在使用）。</li><li>合理使用上报可以及时发现 XSS，利于尽快修复问题</li></ul><h4 id="其他安全"><a href="#其他安全" class="headerlink" title="其他安全"></a>其他安全</h4><ol><li>限制输入内容长度（增加攻击难度）。</li><li>HTTP-only Cookie：HTTP头，禁止 JS 读取该 Cookie 。</li><li>使用验证码，防止脚本操作。</li></ol><h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><p>Cross-site request forgery，跨站请求伪造。</p><blockquote><p>伪造链接页面，诱导客户点击，及将被攻击的网站的注册凭证（比如Cookie），通过发送跨站请求将其发送给第三方网站，攻击者根据该凭证绕过后台的用户验证，冒充用户执行操作。</p><p>即：在不登出A的情况下，访问危险网站 B。</p></blockquote><p>因此防御也主要是检查发起请求的来源。</p><h2 id="来自-1"><a href="#来自-1" class="headerlink" title="来自"></a>来自</h2><p>图片，超链接等嵌入在第三方网站的论坛，文章中等。</p><blockquote><p>跨站请求可以用各种方式，跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等。部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪。</p></blockquote><h2 id="Type-Of-CSRF"><a href="#Type-Of-CSRF" class="headerlink" title="Type Of CSRF"></a>Type Of CSRF</h2><h3 id="请求型"><a href="#请求型" class="headerlink" title="请求型"></a>请求型</h3><p>GET 类型和POST 类型在访问该黑客的页面的时候就会触发请求，携带着还未退出的要攻击的网站的cookie，进行了攻击。</p><p>Post 类型，在个人网站、博客、上传的页面都可能是攻击来源，不可轻视。</p><h3 id="链接型"><a href="#链接型" class="headerlink" title="链接型"></a>链接型</h3><p>常常在论坛中发布的图片中嵌入恶意链接，以广告等形式诱导用户点击。</p><h2 id="预防-1"><a href="#预防-1" class="headerlink" title="预防"></a>预防</h2><p>主要是从检查攻击来源的方式进行防御。</p><ol><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie/SameSite" target="_blank" rel="noopener">Samesite Cookie</a> Samesite属性作为cookie的属性之一，允许声明是否将 Cookie 限制为第一方或同一站点。（部分浏览器暂不兼容，未来的趋势）</p><ul><li>Samesite = Strict，表明这个 Cookie 在任何情况下都不可能作为第三方 Cookie。</li><li>Samesite = Lax，比 Strict 放宽了点限制：假如这个请求是这种请求（改变了当前页面或者打开了新页面）且同时是个GET请求，则这个Cookie可以作为第三方Cookie</li><li></li><li><code>SameSite</code>属性在配置了<code>Secure</code>属性(cookie只能通过https传输)的情况下才会生效, 单独使用不会生效</li></ul></li><li><p>同源检测</p><ul><li>Origin</li></ul></li></ol><pre><code>Header 指明了请求来自哪个站点。- IE11 不会在跨站 CORS 请求中添加Origin标头。- 302 重定向，浏览器不想将Origin泄露到新的服务器上，所以在302，重定向之后，Origin不包含在重定向中的请求中。</code></pre><ul><li>Referer</li></ul><pre><code>Header 记录了请求页面的来源页面的地址。以下两种情况referer不会被发送。- 来源采用的协议是表示本地文件，即“file”或“data” URI不会。- 当前请求页面显示的是非安全协议，而来源页面采用的是安全协议（HTTPS）。</code></pre><blockquote><p>这两个header会被自动带上，且不能由前端自定义内容。</p></blockquote><blockquote><p>同源验证是一个相对简单的防范方法，能够防范，绝大多数的 CRFS 攻击，但是如果也有许多例外情况，比如来源是搜索引擎，或者在本域发起评论等信息，又或者攻击者可以在自己的请求中隐藏Referer。</p></blockquote><ol start="3"><li><p>CSRF Token</p><ul><li>攻击者利用客户的信息进行请求，但是我们可以用攻击者无法获取的信息进行认证，Token。</li><li>主要的表现为在表单或者cookie中加入一个hidden的token值<ul><li>将 CSRF Token 输出到页面。</li><li>请求时携带 Token。</li><li>服务器验证 Token 是否正确。</li></ul></li></ul><blockquote><p>工作量巨大，且容易有遗漏</p></blockquote></li><li><p>双重Cookie验证</p></li><li><p>防止网站被利用</p><ul><li>严格管理所有的上传接口，防止任何预期之外的上传内容（例如HTML）。</li><li>添加Header <code>X-Content-Type-Options: nosniff</code> 防止黑客上传HTML内容的资源（例如图片）被解析为网页。</li><li>对于用户上传的图片，进行转存或者校验。不要直接使用用户填写的图片链接。</li><li>当前用户打开其他用户填写的链接时，需告知风险（这也是很多论坛不允许直接在内容中发布外域链接的原因之一，不仅仅是为了用户留存，也有安全考虑）。</li></ul></li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol><li>CSRF自动防御策略：同源检测（Origin 和 Referer 验证）。</li><li>CSRF主动防御措施：Token验证 或者 双重Cookie验证 以及配合Samesite Cookie。</li></ol><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://juejin.im/entry/58bad941128fe100643fb35b" target="_blank" rel="noopener">https://juejin.im/entry/58bad941128fe100643fb35b</a></p><p><a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener">https://tech.meituan.com/2018/09/27/fe-security.html</a></p><p><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener">https://tech.meituan.com/2018/10/11/fe-security-csrf.html</a></p><p><a href="https://www.anquanke.com/post/id/204052" target="_blank" rel="noopener">https://www.anquanke.com/post/id/204052</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;XSS攻击&quot;&gt;&lt;a href=&quot;#XSS攻击&quot; class=&quot;headerlink&quot; title=&quot;XSS攻击&quot;&gt;&lt;/a&gt;XSS攻击&lt;/h1&gt;&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h2&gt;&lt;p&gt;Cross-site script，跨站脚本攻击。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="web安全" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/web%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="原生JS" scheme="http://yoursite.com/tags/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>lodash 之 函数式编程指北 之 一路向北</title>
    <link href="http://yoursite.com/2020/07/18/JS_FunctionalProgramming/"/>
    <id>http://yoursite.com/2020/07/18/JS_FunctionalProgramming/</id>
    <published>2020-07-18T06:41:00.000Z</published>
    <updated>2020-07-18T06:46:13.087Z</updated>
    
    <content type="html"><![CDATA[<h1 id="lodash函数式编程指北-之-一路向北"><a href="#lodash函数式编程指北-之-一路向北" class="headerlink" title="lodash函数式编程指北 之 一路向北"></a>lodash函数式编程指北 之 一路向北</h1><h1 id="前置基础"><a href="#前置基础" class="headerlink" title="前置基础"></a>前置基础</h1><blockquote><p><code>Object</code> <code>this</code> <code>Function</code> <code>闭包</code> ……. <a id="more"></a></p></blockquote><h2 id="一等公民"><a href="#一等公民" class="headerlink" title="一等公民"></a>一等公民</h2><p>一等公民：是指函数和其它对象及数据类型一样，可以存在数组里，作为参数，赋值给变量等等。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    fnA (a,b) &#123;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;a*b&#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    fnA (a,b) &#123;(a,b)=&gt;&#123;a*b&#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    fnA : <span class="function">(<span class="params">a,b</span>)=&gt;</span>&#123;a*b&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>函数式编成尽量避免使用 this，因此会大量的使用到 bind apply call</p></blockquote><h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><blockquote><p>即，将函数作为参数，返回值的函数</p></blockquote><h2 id="纯函数"><a href="#纯函数" class="headerlink" title="纯函数"></a>纯函数</h2><blockquote><p>纯函数的定义：相同的输入，永远会得到相同的输出，而且没有任何可观察的<strong>副作用</strong>。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如 slice splice 的使用：slice不改变原数组，splice改变了原数组</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">arr.slice(<span class="number">0</span>,<span class="number">2</span>); <span class="comment">// [1,2]</span></span><br><span class="line">arr.slice(<span class="number">0</span>,<span class="number">2</span>); <span class="comment">// [1,2]</span></span><br><span class="line"></span><br><span class="line">arr.splice(<span class="number">0</span>,<span class="number">2</span>); <span class="comment">// [1,2]</span></span><br><span class="line">arr.splice(<span class="number">0</span>,<span class="number">2</span>); <span class="comment">// []</span></span><br></pre></td></tr></table></figure><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li>可缓存性（柯里化可以很好地证明…）</li><li>可测试性（相同的输入，总得到相同的输出）</li><li>可并行执行（不改变原数组，不会访问及影响共享的数据源）</li><li>可移植/自文档化（依赖明显，便于观察理解使用）</li><li>合理性（即，变得更加的可推导，对于代码的理解重构很有好处）</li></ol><h3 id="副作用"><a href="#副作用" class="headerlink" title="副作用"></a>副作用</h3><blockquote><p><em>副作用</em>是在计算结果的过程中，系统状态的一种变化，或者与外部世界进行的<em>可观察的交互</em>。</p></blockquote><p>包括但不限于：更改文件系统、往数据库插入记录、发送一个 http 请求、可变数据、打印/log、获取用户输入、DOM 查询、访问系统状态….</p><blockquote><p>当我们依赖外部输入的参数时都使得程序变得不纯，副作用不可避免，我们只能将其控制在可控的范围内。</p></blockquote><h1 id="柯里化（curry）"><a href="#柯里化（curry）" class="headerlink" title="柯里化（curry）"></a>柯里化（curry）</h1><blockquote><p>柯里化：只传递给函数一部分参数来调用它，让它返回一个函数去处理剩下的参数。</p></blockquote><h2 id="lodash-使用"><a href="#lodash-使用" class="headerlink" title="lodash 使用"></a>lodash 使用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lodash 效果</span></span><br><span class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'lodash'</span>);</span><br><span class="line"><span class="keyword">var</span> sum = <span class="function"><span class="keyword">function</span> (<span class="params">a,b,c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b + c;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> curried = _.curry(sum);</span><br><span class="line"></span><br><span class="line">curried(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>); <span class="comment">// 6</span></span><br><span class="line">curried(<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>);   <span class="comment">// 6</span></span><br><span class="line">curried(<span class="number">1</span>,<span class="number">2</span>)(<span class="number">3</span>);  <span class="comment">// 6</span></span><br></pre></td></tr></table></figure><h2 id="效防-curry"><a href="#效防-curry" class="headerlink" title="效防 curry"></a>效防 curry</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curried</span> (<span class="params">func</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">curriedFn</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; func.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...arguments</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> curriedFn(...args,...arguments)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> func(...args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="简化"><a href="#简化" class="headerlink" title="简化"></a>简化</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curried</span> (<span class="params">func</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">curriedFn</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> args.length &lt; func.length ? </span><br><span class="line">          (...arguments) =&gt; curriedFn(...args,...arguments) </span><br><span class="line">          : func(...args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="代码组合（compose）"><a href="#代码组合（compose）" class="headerlink" title="代码组合（compose）"></a>代码组合（compose）</h1><blockquote><p>将多个函数组合后返回一个新的函数</p></blockquote><h2 id="简单的compose"><a href="#简单的compose" class="headerlink" title="简单的compose"></a>简单的compose</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> compose = <span class="function"><span class="keyword">function</span>(<span class="params">f,g</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> f(g(x));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单例子</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">f, g</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</span><br><span class="line">        f(g(x))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arr.reverse();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arr[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myCompose = compose(f,g);</span><br><span class="line">myCompose([<span class="number">1</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">6</span>]);  <span class="comment">// 6</span></span><br></pre></td></tr></table></figure><blockquote><p>函数的合成还要满足结合律</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">compose(f, compose(g, h))</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">compose(compose(f, g), h)</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">compose(f, g, h)</span><br></pre></td></tr></table></figure><h2 id="lodash中的组合函数"><a href="#lodash中的组合函数" class="headerlink" title="lodash中的组合函数"></a>lodash中的组合函数</h2><p><code>flow()</code> 是从左到右。</p><p><code>flowRight()</code> 是从右到左。</p><blockquote><p>创建一个函数。 返回的结果是调用提供函数的结果，<code>this</code> 会绑定到创建函数。 每一个连续调用，传入的参数都是前一个函数返回的结果。</p></blockquote><h2 id="模拟实现-flowRight"><a href="#模拟实现-flowRight" class="headerlink" title="模拟实现 flowRight()"></a>模拟实现 <code>flowRight()</code></h2><p>主要是 reduce 的使用</p><blockquote><p><a href="https://www.runoob.com/jsref/jsref-reduce.html" target="_blank" rel="noopener">https://www.runoob.com/jsref/jsref-reduce.html</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">composeRight</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> args.reverse().reduce(<span class="function"><span class="keyword">function</span>(<span class="params">startValue,itemFn</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> itemFn(startValue)</span><br><span class="line">        &#125;, value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arr.reverse();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arr[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> myComposeRight = composeRight(f,g);</span><br><span class="line">myComposeRight([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])</span><br></pre></td></tr></table></figure><h3 id="简化-1"><a href="#简化-1" class="headerlink" title="简化"></a>简化</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">composeRight</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">value</span>) =&gt;</span> args.reverse().reduce(<span class="function">(<span class="params">startValue,itemFn</span>) =&gt;</span> itemFn(startValue), value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// reduce(function(初始值，当前项)&#123;&#125;,'初始值传入')  *当前项这里是一个个函数*</span></span><br></pre></td></tr></table></figure><h2 id="trace调试"><a href="#trace调试" class="headerlink" title="trace调试"></a>trace调试</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">'lodash'</span>); <span class="comment">// 利用 lodash curry 函数</span></span><br><span class="line"><span class="keyword">var</span> trace = _.curry(<span class="function">(<span class="params">tag,x</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(tag,x);   <span class="comment">// console 出来以便于查看 tag 标记及之后的值 x</span></span><br><span class="line">    <span class="keyword">return</span> x;       <span class="comment">// 依然返回 x ,不影响组合函数继续向下个函数传值</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="lodash-中的-FP-模块"><a href="#lodash-中的-FP-模块" class="headerlink" title="lodash 中的 FP 模块"></a>lodash 中的 FP 模块</h2><blockquote><p>该模块提供了实用的对函数式编程友好的方法：</p><p>就是将多参数的方法进行了封装，该封装具有 柯里化，函数优先，数据随后的特点。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 与 lodash 模块的区别</span></span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">'lodash'</span>);</span><br><span class="line"></span><br><span class="line">_.map([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>], _.toUpper);</span><br><span class="line">_.split(<span class="string">'hello world'</span>, <span class="string">' '</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// fp 模块</span></span><br><span class="line"><span class="keyword">const</span> fp = <span class="built_in">require</span>(<span class="string">'lodash/fp'</span>);</span><br><span class="line">fp.map(fp.toUpper, [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]);  <span class="comment">// 函数优先</span></span><br><span class="line">fp.map(fp.toUpper)([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]);  <span class="comment">// 柯里化</span></span><br><span class="line">fp.split(<span class="string">' '</span>, <span class="string">'hello World'</span>);</span><br><span class="line">fp.split(<span class="string">' '</span>)(<span class="string">'hello World'</span>);</span><br></pre></td></tr></table></figure><blockquote><p>注意：map方法在 fp 模块有一定的区别。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">'lodash'</span>);</span><br><span class="line"><span class="keyword">const</span> fp = <span class="built_in">require</span>(<span class="string">'lodash/fp'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(_.map([<span class="string">'23'</span>, <span class="string">'8'</span>, <span class="string">'10'</span>], <span class="built_in">parseInt</span>))  <span class="comment">// [ 23, NaN, 2 ]</span></span><br><span class="line"><span class="built_in">console</span>.log(fp.map(<span class="built_in">parseInt</span>, [<span class="string">'23'</span>, <span class="string">'8'</span>, <span class="string">'10'</span>]))  <span class="comment">// [ 23, 8, 10 ]</span></span><br></pre></td></tr></table></figure><h2 id="pointfree"><a href="#pointfree" class="headerlink" title="pointfree"></a>pointfree</h2><blockquote><p>pointFree 不在乎数据，只是将简单的运算步骤进行组合，而组合当中多参数函数又需要进行柯里化，因此：<code>pointfree = Curry（柯里化提取参数） + Compose(组合函数)</code>。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = fp.flowRight(fp.replace(<span class="regexp">/\s+/g</span>, <span class="string">'-'</span>), fp.toLower)</span><br><span class="line"><span class="built_in">console</span>.log(f(<span class="string">'HOLL   woadksf'</span>))</span><br></pre></td></tr></table></figure><h1 id="函子-functor"><a href="#函子-functor" class="headerlink" title="函子 functor"></a>函子 <em>functor</em></h1><blockquote><p>一峰说：</p><ol><li>函子不仅可以用于同一个范畴中的值的转换，还可以将一个范畴转为另一个范畴。即，它是包含了 值与值、范畴与范畴的变形关系。</li><li>一般约定，函子的标志就是容器具有 <code>map</code> 方法。该方法将容器里面的每个值，映射到另个容器。（通透）</li><li>学习函数式编程，实际上就是学习函子的运算。</li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一峰表示：任何具有 map 方法的数据结构，都可以当做函子的实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Functor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(val) &#123;</span><br><span class="line">        <span class="keyword">this</span>.val = val</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    map(f) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(f(<span class="keyword">this</span>.val))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>指北表示：Container 是一个容器：</p><ol><li>Container 是只有一个属性的对象。</li><li><code>_value</code> 不能是一个某个特定的类型，毕竟 Container 是一个 “容器”。</li><li>数据一旦存在那里，就会一直待在那里。</li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指北表示</span></span><br><span class="line"><span class="keyword">var</span> Container = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._value = x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Cantainer.of 作为构造器（constructor）</span></span><br><span class="line">Container.of = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> Container(x) &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要让 别的函数（map）能够操作它</span></span><br><span class="line">Container.prototype.map = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>)</span>&#123;  <span class="comment">// 再放回 Container 就可以连续的调用 map</span></span><br><span class="line">    <span class="keyword">return</span> Container.of(f(<span class="keyword">this</span>.__value))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 就是将改变值的方法放进map，return 出改变值后的 Container，其中也包含 map，即可连续调用了。</span></span><br></pre></td></tr></table></figure><h2 id="of-方法"><a href="#of-方法" class="headerlink" title="of 方法"></a><em>of</em> 方法</h2><blockquote><p>函数式编程约定，用 of 来生成新的容器。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义</span></span><br><span class="line">Functor.of = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Functor(val);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">Functor.of(<span class="number">2</span>).map( <span class="function">(<span class="params">count</span>) =&gt;</span> count+<span class="number">2</span> )</span><br><span class="line"><span class="comment">// return Functor(4)</span></span><br></pre></td></tr></table></figure><h2 id="薛定谔的-Maybe-Maybe函子"><a href="#薛定谔的-Maybe-Maybe函子" class="headerlink" title="薛定谔的 Maybe (Maybe函子)"></a>薛定谔的 <em>Maybe</em> (Maybe函子)</h2><blockquote><p>和 Container 类似，不同的是：Maybe 会先检查自己的值是否为空，然后调用传进来的函数。</p><p>就像平时工作中写的，先检查是否为 null，继而继续执行。避免因为 null 而报错。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Maybe</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (value) &#123;</span><br><span class="line">        <span class="keyword">this</span>._value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">of</span> (value) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Maybe(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    map(fn) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.isNothing() ? Maybe.of(<span class="literal">null</span>) : Maybe.of(fn(<span class="keyword">this</span>._value));</span><br><span class="line">    &#125;</span><br><span class="line">    isNothing() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._value === value || <span class="keyword">this</span>._value === <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Maybe.of(<span class="string">'hello world'</span>).map(<span class="function"><span class="params">x</span> =&gt;</span> x.toUpperCase())</span><br><span class="line">Maybe.of(<span class="literal">null</span>).map(<span class="function"><span class="params">x</span> =&gt;</span> x.toUpperCase())</span><br></pre></td></tr></table></figure><h2 id="纯错误处理-Either（Either函子）"><a href="#纯错误处理-Either（Either函子）" class="headerlink" title="纯错误处理 Either（Either函子）"></a>纯错误处理 <em>Either</em>（Either函子）</h2><blockquote><p>Either 函子表达了条件运算。并利用条件运算，代替了 <code>try ... catch</code>。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Either</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(left, right) &#123;</span><br><span class="line">        <span class="keyword">this</span>._left = left;    <span class="comment">// 正常值 不存在 默认值</span></span><br><span class="line">        <span class="keyword">this</span>._right = right;  <span class="comment">// 正常值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">of</span>(left, right) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Either(left, right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    map(fn) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._right ? </span><br><span class="line">            Either.of(<span class="keyword">this</span>._left, fn(<span class="keyword">this</span>._right)) :</span><br><span class="line">            Either.of(fn(<span class="keyword">this</span>._left), <span class="keyword">this</span>.right)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Either-普通使用"><a href="#Either-普通使用" class="headerlink" title="Either 普通使用"></a><em>Either</em> 普通使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addOne = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Either.of(<span class="number">5</span>, <span class="number">6</span>).map(addOne);</span><br><span class="line"><span class="comment">// Either(5, 7);</span></span><br><span class="line"></span><br><span class="line">Either.of(<span class="number">1</span>, <span class="literal">null</span>).map(addOne);</span><br><span class="line"><span class="comment">// Either(2, null);</span></span><br></pre></td></tr></table></figure><h3 id="Either-try-catch"><a href="#Either-try-catch" class="headerlink" title="Either try ... catch"></a><em>Either</em> <code>try ... catch</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseJSON</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Either.of(<span class="literal">null</span>, <span class="built_in">JSON</span>.parse(json));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e: <span class="built_in">Error</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> Either.of(e, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="IO-函子"><a href="#IO-函子" class="headerlink" title="IO 函子"></a><em>IO</em> 函子</h2><blockquote><p>IO函子的 <code>_value</code> 是一个函数，它可以将不纯的函数存在这里，以使得只有在调用的时候才执行这个不纯的函数，以达到控制副作用的目的。 </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IO</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (fn)&#123;</span><br><span class="line">        <span class="keyword">this</span>._value = fn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">of</span>(x_value)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IO(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 当我们调用的时候返回的是一个函数，当再次调用的时候才返回该值</span></span><br><span class="line">            <span class="keyword">return</span> x_value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    map(fn)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IO(fp.flowRight(fn, <span class="keyword">this</span>._value))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> io = IO.of(process).map(<span class="function"><span class="params">p</span>=&gt;</span>p.execPath)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(io._value())   <span class="comment">// D:\node\Node\node.exe</span></span><br></pre></td></tr></table></figure><h2 id="Folktale-里的-Task-函子"><a href="#Folktale-里的-Task-函子" class="headerlink" title="Folktale 里的 Task 函子"></a>Folktale 里的 <em>Task</em> 函子</h2><blockquote><p>folktale：一个标准的函数式编程库，它没有提供很多功能函数，只提供了一些函数式处理的操作，及一些函子。</p></blockquote><h3 id="Task-函子"><a href="#Task-函子" class="headerlink" title="Task 函子"></a><em>Task</em> 函子</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; task &#125; = <span class="built_in">require</span>(<span class="string">'folktale/concurrency/task'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; split, find &#125; = <span class="built_in">require</span>(<span class="string">'lodash/fp'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span> (<span class="params">filename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> task(<span class="function"><span class="params">resolver</span> =&gt;</span> &#123;</span><br><span class="line">        fs.readFile(filename, <span class="string">'utf-8'</span>, (err, data) =&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) resolver.reject(err)</span><br><span class="line">            resolver.resolve(data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">readFile(<span class="string">'../package-lock.json'</span>)</span><br><span class="line">    .map(split(<span class="string">'\n'</span>))</span><br><span class="line">    .map(find(<span class="function"><span class="params">x</span> =&gt;</span> x.includes(<span class="string">'version'</span>)))</span><br><span class="line">    .run()</span><br><span class="line">    .listen(&#123;</span><br><span class="line">        onRejected: <span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err)</span><br><span class="line">        &#125;,</span><br><span class="line">        onResolved: <span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h2 id="pointed-函子"><a href="#pointed-函子" class="headerlink" title="pointed 函子"></a><em>pointed</em> 函子</h2><blockquote><p>实现 of 静态 方法的函子，使用of方法初始化容器中的值，使用map来处理值。</p></blockquote><h2 id="monad-函子"><a href="#monad-函子" class="headerlink" title="monad 函子"></a><em>monad</em> 函子</h2><blockquote><p>解决函子嵌套问题</p></blockquote><h1 id="参考补充"><a href="#参考补充" class="headerlink" title="参考补充"></a>参考补充</h1><p><a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/?q=" target="_blank" rel="noopener">https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/?q=</a></p><p><a href="http://www.ruanyifeng.com/blog/2017/02/fp-tutorial.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2017/02/fp-tutorial.html</a></p><p><a href="https://www.lodashjs.com/" target="_blank" rel="noopener">https://www.lodashjs.com/</a></p><p><a href="https://juejin.im/post/5d767e1d6fb9a06b032025ea" target="_blank" rel="noopener">https://juejin.im/post/5d767e1d6fb9a06b032025ea</a></p><p><a href="https://f-lancer.github.io/2020/03/26/JS_Function/#more" target="_blank" rel="noopener">https://f-lancer.github.io/2020/03/26/JS_Function/#more</a></p><p><a href="https://f-lancer.github.io/2020/02/14/JS_Object/#more" target="_blank" rel="noopener">https://f-lancer.github.io/2020/02/14/JS_Object/#more</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;lodash函数式编程指北-之-一路向北&quot;&gt;&lt;a href=&quot;#lodash函数式编程指北-之-一路向北&quot; class=&quot;headerlink&quot; title=&quot;lodash函数式编程指北 之 一路向北&quot;&gt;&lt;/a&gt;lodash函数式编程指北 之 一路向北&lt;/h1&gt;&lt;h1 id=&quot;前置基础&quot;&gt;&lt;a href=&quot;#前置基础&quot; class=&quot;headerlink&quot; title=&quot;前置基础&quot;&gt;&lt;/a&gt;前置基础&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;Object&lt;/code&gt; &lt;code&gt;this&lt;/code&gt; &lt;code&gt;Function&lt;/code&gt; &lt;code&gt;闭包&lt;/code&gt; …….
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="原生JS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="FP" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/FP/"/>
    
    
      <category term="原生JS" scheme="http://yoursite.com/tags/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>数据可视化</title>
    <link href="http://yoursite.com/2020/07/12/Three_DataChart/"/>
    <id>http://yoursite.com/2020/07/12/Three_DataChart/</id>
    <published>2020-07-12T04:32:00.000Z</published>
    <updated>2020-07-12T04:35:52.187Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数据可视化初探"><a href="#数据可视化初探" class="headerlink" title="数据可视化初探"></a>数据可视化初探</h1><p>初探……………<a id="more"></a></p><h2 id="2D数据可视化"><a href="#2D数据可视化" class="headerlink" title="2D数据可视化"></a>2D数据可视化</h2><h3 id="SVG-Canvas"><a href="#SVG-Canvas" class="headerlink" title="SVG/Canvas"></a>SVG/Canvas</h3><h4 id="SVG"><a href="#SVG" class="headerlink" title="SVG"></a>SVG</h4><h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><ol><li>一个简单的SVG文档由<code>&lt;svg&gt;</code>根元素和基本的形状元素构成。以及<code>&lt;g&gt;</code>元素来将基本形状编成一个组。</li><li>需要遵从 （标准）XML 语法。<ul><li>XML区分大小写。</li><li>属性值必须用数值引起来。</li></ul></li><li>注意兼容。</li><li><a href="https://developer.mozilla.org/en/SVG/Element" target="_blank" rel="noopener">元素参考</a> ，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model#SVG_%E6%8E%A5%E5%8F%A3" target="_blank" rel="noopener">接口参考</a></li></ol><h5 id="坐标："><a href="#坐标：" class="headerlink" title="坐标："></a>坐标：</h5><p>单位分为 绝对大小和相对大小。（viewBox定义画布上可显示的区域）</p><p><img src="https://developer.mozilla.org/@api/deki/files/78/=Canvas_default_grid.png" alt="img"></p><h5 id="基本元素："><a href="#基本元素：" class="headerlink" title="基本元素："></a>基本元素：</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--rect Rectangular 矩形--&gt;</span>       rx ry 圆角xy方位半径</span><br><span class="line"><span class="comment">&lt;!--circle--&gt;</span>                 r cx cy 半径圆心位置</span><br><span class="line"><span class="comment">&lt;!--ellipse 椭圆--&gt;</span>           rx ry cx cy 椭圆xy半径</span><br><span class="line"><span class="comment">&lt;!--polyline 折线--&gt;</span>          points 点坐标</span><br><span class="line"><span class="comment">&lt;!--polygon 多边形--&gt;</span>         points 点坐标</span><br><span class="line"><span class="comment">&lt;!--path 曲线--&gt;</span>              d </span><br><span class="line"><span class="comment">&lt;!--line 直线--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--text 文字--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--tspan 用来标记文本的子部分--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--tref 元素允许引用已经定义的文本--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--textPath 可以使文字沿着定义好的路径走--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;defs&gt;--&gt;</span>                SVG里的style标签</span><br></pre></td></tr></table></figure><h5 id="line"><a href="#line" class="headerlink" title="line:"></a>line:</h5><p>M：（Move To）<code>M x y</code>/<code>m dx dy</code> 起始坐标。</p><p>L：（Line To）<code>L x y (or l dx dy)</code> 从当前位置到新位置，画一条线。</p><p>H、V：<code>H x (or h dx) V y (or v dy)</code> 绘制水平线、垂直线。</p><p>Z：<code>Z (or z)</code> 闭合路径命令。</p><blockquote><p>使用小写字母时，并不是明确的目标，是表示相对于它前面的点需要移动多少距离。</p></blockquote><p>在path元素里，只存在两种贝塞尔曲线：三次贝塞尔曲线C，和二次贝塞尔曲线Q。</p><p>…等</p><h5 id="Fill"><a href="#Fill" class="headerlink" title="Fill"></a>Fill</h5><p>Fill 上色，<code>fill-opacity</code> 控制填充色的不透明度。</p><h5 id="Stroke"><a href="#Stroke" class="headerlink" title="Stroke"></a>Stroke</h5><p>Stroke 描边，<code>stroke-opacity</code>控制描边的不透明度 。</p><h5 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h5><ol><li><code>&lt;g&gt;</code> 组合</li><li>使用属性<code>transform</code>实现变换等。</li></ol><blockquote><p>了解底层基础是为了开启D3.js的路。</p></blockquote><h3 id="D3-echart"><a href="#D3-echart" class="headerlink" title="D3/echart"></a>D3/echart</h3><h4 id="D3"><a href="#D3" class="headerlink" title="D3"></a>D3</h4><ul><li><a href="https://github.com/junruchen/junruchen.github.io/wiki/SVG%E5%9F%BA%E7%A1%80" target="_blank" rel="noopener">SVG基础</a>，包含svg属性介绍以及svg内部元素基础内容。</li><li><a href="https://github.com/d3/d3/wiki" target="_blank" rel="noopener">D3 API文档</a>，内包含低版本、高版本的多语言文档。</li><li><a href="https://github.com/d3/d3/wiki/Gallery" target="_blank" rel="noopener">D3 图表demo</a>，基本的图表类型实例都能找到。</li></ul><blockquote><p><a href="http://christopheviau.com/d3_tutorial/" target="_blank" rel="noopener">http://christopheviau.com/d3_tutorial/</a></p></blockquote><h4 id="echart"><a href="#echart" class="headerlink" title="echart"></a>echart</h4><ul><li><a href="http://echarts.baidu.com/examples.html" target="_blank" rel="noopener">ECharts Examples</a>，提供大量实例，基本的图表类型都能找到。</li><li><a href="http://echarts.baidu.com/tutorial.html#5%20%E5%88%86%E9%92%9F%E4%B8%8A%E6%89%8B%20ECharts" target="_blank" rel="noopener">ECharts 使用文档 教程</a>，包括使用教程，API，配置项等等。</li><li><a href="http://echarts.baidu.com/theme-builder/" target="_blank" rel="noopener">ECharts 主题构建工具</a>，可构建通用主题，在初始化实例时，注册即可。</li></ul><h4 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h4><h5 id="echart-1"><a href="#echart-1" class="headerlink" title="echart"></a>echart</h5><ol><li>封装完善，直接填写配置项即可使用。使用简单，但不够灵活。</li><li>使用Canvas来绘制图形。canvas不支持事件的处理器，只能展示数据，不能修改。</li><li>兼容IE6以上。</li></ol><h5 id="D3-1"><a href="#D3-1" class="headerlink" title="D3"></a>D3</h5><ol><li>学习成本大，但使用灵活。</li><li>使用SVG绘制图形，可以操作DOM，但当数据改变图表会重新渲染，消耗性能。</li><li>兼容IE9以上。</li></ol><h4 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h4><ol><li>只做展示建议采用 echart。需要和用户交互采用D3。</li><li>项目中大量常规图，采用 echart。特殊图表，流程图等采用D3。</li></ol><h2 id="3D数据可视化"><a href="#3D数据可视化" class="headerlink" title="3D数据可视化"></a>3D数据可视化</h2><h3 id="webGL-Three-js"><a href="#webGL-Three-js" class="headerlink" title="webGL/Three.js"></a>webGL/Three.js</h3><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/SVG</a></p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial</a></p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API</a></p></blockquote><blockquote><p><a href="https://juejin.im/entry/5b90ecf25188255c781c97b5" target="_blank" rel="noopener">https://juejin.im/entry/5b90ecf25188255c781c97b5</a></p></blockquote><blockquote><p><a href="https://juejin.im/post/5cd65a41e51d456e89634ad3" target="_blank" rel="noopener">https://juejin.im/post/5cd65a41e51d456e89634ad3</a></p></blockquote><blockquote><p><a href="https://www.cnblogs.com/zhangdi/p/3690284.html?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="noopener">https://www.cnblogs.com/zhangdi/p/3690284.html?utm_source=tuicool&amp;utm_medium=referral</a></p></blockquote><blockquote><p><a href="https://zhuanlan.zhihu.com/p/21897086" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/21897086</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;数据可视化初探&quot;&gt;&lt;a href=&quot;#数据可视化初探&quot; class=&quot;headerlink&quot; title=&quot;数据可视化初探&quot;&gt;&lt;/a&gt;数据可视化初探&lt;/h1&gt;&lt;p&gt;初探……………
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="原生JS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="数据可视化" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="原生JS" scheme="http://yoursite.com/tags/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>CodeAccumlation</title>
    <link href="http://yoursite.com/2020/07/12/JS_CodeAccumulation/"/>
    <id>http://yoursite.com/2020/07/12/JS_CodeAccumulation/</id>
    <published>2020-07-12T04:26:00.000Z</published>
    <updated>2020-07-12T04:27:44.809Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CodeAccumlation"><a href="#CodeAccumlation" class="headerlink" title="CodeAccumlation"></a>CodeAccumlation</h1><p>手撕一些常见代码，加深理解 JS。<a id="more"></a></p><h1 id="Debounce"><a href="#Debounce" class="headerlink" title="Debounce"></a>Debounce</h1><blockquote><p>在事件被触发 n 秒后再执行回调，如果在 n 内，又被触发，则重新计算</p></blockquote><h2 id="简版"><a href="#简版" class="headerlink" title="简版"></a>简版</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简版防抖函数</span></span><br><span class="line">    <span class="keyword">let</span> timer;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearTimeout(timer)</span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">            testDebounce()</span><br><span class="line">        &#125;,<span class="number">1000</span>)       </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">testDebounce</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 优化防抖函数</span></span><br><span class="line">   <span class="keyword">let</span> debounce = <span class="function"><span class="keyword">function</span> (<span class="params">fn, delay</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> timer;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> that = <span class="keyword">this</span></span><br><span class="line">            <span class="keyword">if</span> (timer) clearTimeout(timer);</span><br><span class="line">            timer = setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;       <span class="comment">// 传入函数才有效</span></span><br><span class="line">                fn.apply(that,args)</span><br><span class="line">            &#125;, delay)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">testDebounce</span>(<span class="params">count</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> arr = [...count]</span><br><span class="line">        arr.shift()</span><br><span class="line">        <span class="built_in">console</span>.log(arr)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> b = debounce(testDebounce,<span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">let</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'myId'</span>)</span><br><span class="line"></span><br><span class="line">    el.addEventListener(<span class="string">"click"</span>,()=&gt;&#123;b([<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])&#125;)  <span class="comment">// 传入参数要写进函数里</span></span><br></pre></td></tr></table></figure><h1 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h1><p>$Ajax POST 请求要data转字符串，传输格式不对会报 400；传输 contentType 格式错误 报错 415</p><ol><li><p>400 请求错误，不能响应该请求，或不存在域名。</p></li><li><p>415 Unsupported Media Type 是一种HTTP协议的错误状态代码，表示服务器由于不支持其有效载荷的格式，从而拒绝接受客户端的请求。</p></li></ol><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote><p><a href="https://www.runoob.com/w3cnote/http-400.html" target="_blank" rel="noopener">https://www.runoob.com/w3cnote/http-400.html</a></p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/415" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/415</a></p></blockquote><h1 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://juejin.im/post/5de7286e6fb9a016107952f7" target="_blank" rel="noopener">https://juejin.im/post/5de7286e6fb9a016107952f7</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;CodeAccumlation&quot;&gt;&lt;a href=&quot;#CodeAccumlation&quot; class=&quot;headerlink&quot; title=&quot;CodeAccumlation&quot;&gt;&lt;/a&gt;CodeAccumlation&lt;/h1&gt;&lt;p&gt;手撕一些常见代码，加深理解 JS。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="原生JS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="CodeAccumlation" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/CodeAccumlation/"/>
    
    
      <category term="原生JS" scheme="http://yoursite.com/tags/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>数据结构与算法</title>
    <link href="http://yoursite.com/2020/06/28/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    <id>http://yoursite.com/2020/06/28/数据结构与算法/</id>
    <published>2020-06-27T16:35:00.000Z</published>
    <updated>2020-07-12T04:07:52.464Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数据结构与算法"><a href="#数据结构与算法" class="headerlink" title="数据结构与算法"></a>数据结构与算法</h1><p>数据结构、算法基础…….<strong>de</strong>复习~。<a id="more"></a></p><h1 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h1><p>f(n) 的代码复杂度是f(n) —&gt;O(f(n))</p><p><code>O(n)</code> 表示，复杂度与计算实例的个数 n 线性相关。</p><p><code>O(logn)</code> 表示，复杂度与计算实例的个数 n 对数相关。</p><h2 id="计算原则"><a href="#计算原则" class="headerlink" title="计算原则"></a>计算原则</h2><ol><li>复杂度与具体的常系数无关。<ul><li><code>O(2n)</code>与<code>O(n)</code>复杂度一致。</li></ul></li><li>多项式级的复杂度相加的时候，选择高者作为结果。<ul><li><code>O(n²)+O(n) = O(n²+n)</code></li></ul></li><li><code>O(1)</code> 表示某任务通过有限可数的资源即可完成。</li></ol><blockquote><p>定义一个新的空间与原空间一致，则空间复杂度为O(n)。未定义则为O(1)</p></blockquote><h2 id="复杂度与代码结构的关系"><a href="#复杂度与代码结构的关系" class="headerlink" title="复杂度与代码结构的关系"></a>复杂度与代码结构的关系</h2><p>时间复杂度与 <strong>代码的结构设计</strong> 有着非常紧密的关系。</p><p>空间复杂度与 <strong>数据结构的设计</strong> 有关。</p><blockquote><p>常用的经验性结论：</p><ol><li>顺序结构的代码，事件复杂度为O(1)。</li><li>二分查找，即，采用二分策略，时间复杂度为O(logn)。</li><li>一个for循环，时间复杂度为O(n)。</li><li>两个顺序执行的for循环也为O(n)。</li><li>两个嵌套的for循环为O(n²) </li></ol></blockquote><h2 id="降低复杂度"><a href="#降低复杂度" class="headerlink" title="降低复杂度"></a>降低复杂度</h2><ol><li><p>梳理减除无效程序。</p><ul><li>常用 <strong>降低时间复杂度 </strong> 的方法有：递归、二分法、排序算法、动态规划等。</li><li><strong>降低空间复杂度</strong> 的核心思路：尽量用低复杂度的数据结构解决问题。 </li></ul></li><li><p>空间复杂度换取时间复杂度。</p></li></ol><blockquote><p>问：如何在一个无序数组中查找出出现次数最多的数字？</p></blockquote><h1 id="增删查"><a href="#增删查" class="headerlink" title="增删查"></a>增删查</h1><p>数据处理的操作，即：</p><ol><li>找到需要处理的数据。查。</li><li>将结果存到新的内存空间。增。</li><li>删除旧结果，将新的结果存入内存空间。删。</li></ol><blockquote><p>遇到优化算法思路：</p><ol><li>分析代码对数据进行了哪些操作。</li><li>根据分析出来的数据操作，找到合理的数据结构。</li></ol></blockquote><h2 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h2><ol><li>根据 <strong>元素的位置或索引</strong> 来进行查找。</li><li>根据 <strong>元素的数值特征</strong> 来查找。</li></ol><p>例1：查找第几个元素？</p><ol><li><p>如果是数组，具有索引，查找第二个元素时间复杂度为 <code>O(1)</code>。</p></li><li><p>如果是链表，需要进行一个一个查找。时间复杂度为O(n)。</p></li></ol><p>例2：查找等于 5 的元素？</p><ol><li><p>数组和链表都为O(n)。</p></li><li><p>能在O(1)的时间复杂度内完成查找动作的数据结构，只有<strong>字典类型</strong>。</p></li></ol><h2 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h2><ol><li>在复杂数据结构的最后，新增一条数据。</li><li>在复杂数据结构的中间某个位置，新增一条数据。</li></ol><p>区别：新增了数据之后，是否会导致原有数据结构中数据的位置顺序改变。</p><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><ol><li>在复杂数据结构的最后，删除一条数据。</li><li>在复杂数据结构的中间某个位置，删除一条数据。</li></ol><p>区别：删除了数据之后，是否会导致原有数据结构中数据的位置顺序改变。</p><h1 id="线性表"><a href="#线性表" class="headerlink" title="线性表"></a>线性表</h1><p>线性表是 n 个数据元素的有限序列，最常用的是链式表达，通常也叫作线性链表或者链表。数据元素也叫作结点，一个结点存储的就是一条数据记录。</p><h2 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h2><h3 id="单项链表"><a href="#单项链表" class="headerlink" title="单项链表"></a>单项链表</h3><ol><li>第一是具体的数据值。</li><li>第二是指向下一个结点的指针。</li><li>最后一个指向空。</li></ol><h3 id="循环链表"><a href="#循环链表" class="headerlink" title="循环链表"></a>循环链表</h3><ol><li>对于单项链表，让最后一个元素的指针指向第一个元素就是循环链表。</li></ol><h3 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h3><ol><li>除了指向下一个结点的指针，增加一个指向上一个结点的指针，就得到了双向链表。</li></ol><h3 id="双向循环链表"><a href="#双向循环链表" class="headerlink" title="双向循环链表"></a>双向循环链表</h3><ol><li>将双向链表和循环列表融合。</li></ol><blockquote><p>新增删除为O(1)，查找为O(n)。</p></blockquote><p>线性表真正的价值在于，它对数据的存储方式是按照顺序的存储：</p><h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><ol><li>如果数据的元素个数不确定，且需要经常进行数据的新增和删除时，那么链表会比较合适。</li><li>如果数据元素大小确定，删除插入的操作并不多，那么数组可能更适合些。</li></ol><blockquote><p>问：</p><ol><li>链表反转？（对当前、前、后，元素进行缓存）</li><li>奇数个元素链表，查找中间位置的结点数值？（暴力解法、快慢指针）</li><li>判断链表是否有环？（快慢指针相遇）</li></ol></blockquote><h2 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h2><p>一种特殊的线性表。栈和线性表的不同主要是增删操作，栈必须先进后出，即，对线性表的操作进行了限制。</p><h3 id="顺序栈"><a href="#顺序栈" class="headerlink" title="顺序栈"></a>顺序栈</h3><p>栈的顺序存储可以借助数组来实现：</p><ol><li>把数组的首元素存在栈底，最后一个元素放在栈顶。</li><li>定义一个 top 指针来指示栈顶元素在数组中的位置。</li><li>假设栈中只有一个数据元素，则 top = 0。一般以 top 是否为 -1 来判定是否为空栈。</li><li>当定义了栈的最大容量为 StackSize 时，则栈顶 top 必须小于 StackSize。</li><li>当需要新增数据元素，即入栈操作时，就需要将新插入元素放在栈顶，并将栈顶指针增加 1。</li></ol><blockquote><ol><li><p>JS 中可以用数组中的push和pop来模拟进栈出栈的操作。</p></li><li><p>对于栈的查找操作，也需要遍历整个栈来完成基于某些条件的数值查找。</p></li></ol></blockquote><h3 id="链栈"><a href="#链栈" class="headerlink" title="链栈"></a>链栈</h3><p>用链表的方式对栈的表示。</p><blockquote><ol><li><p>对于链栈新增删除没有进行循环操作都为O(1)，但只能在栈顶进行操作。</p></li><li><p>对于链栈的查找操作，也需要遍历整个栈来完成基于某些条件的数值查找。</p></li></ol></blockquote><h3 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h3><ol><li>当你面对的问题需要高频使用新增、删除操作，且新增和删除操作的数据执行顺序具备后来居上的相反关系时，栈就是个不错的选择。</li></ol><blockquote><p>问：利用栈</p><ol><li>给定一个只包括 ‘(‘，’)’，’{‘，’}’，’[‘，’]’ 的字符串，判断字符串是否有效。有效字符串需满足：左括号必须与相同类型的右括号匹配，左括号必须以正确的顺序匹配。</li><li>浏览器的页面访问都包含了后退和前进功能，利用栈如何实现？（前进栈、后退栈）。</li><li>大多数程序运行环境都有的子程序的调用，函数的递归调用。</li></ol></blockquote><h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p>也是一种特殊的线性表。队列和线性表的不同主要也是增删操作，栈必须先进后出，而队列是先进先出，同样对线性表的操作进行了限制。即，只能在队列末端进入，始端删除。</p><h3 id="顺序队列"><a href="#顺序队列" class="headerlink" title="顺序队列"></a>顺序队列</h3><p>同样，根据两种存储方式，顺序队列是依赖数组来实现的，数据在内存中也是顺序存储的。</p><blockquote><p>出现了假溢出的问题</p></blockquote><h4 id="假溢出"><a href="#假溢出" class="headerlink" title="假溢出"></a>假溢出</h4><p>不断进行增加删除操作两指针会向后移动，队列长度是有限的，最终会出现假溢出的问题。</p><p>解决：</p><ol><li>移动整体数据，但是消耗的时间复杂度是O(n)。</li><li>开辟足够大的内存空间，确保数组不会越界。</li><li>通过队列的特殊变种 <strong>循环队列</strong> 解决。</li></ol><h3 id="循环队列"><a href="#循环队列" class="headerlink" title="循环队列"></a>循环队列</h3><p>新增数据：首先判断队列是否为满。如果不满，则可以将新元素赋值给队尾，然后让 rear 指针向后移动一个位置。如果已经排到队列最后的位置，则 rea r指针重新指向头部。</p><p>删除操作：需要判断队列是否为空，然后将队头元素赋值给返回值，front 指针向后移一个位置。如果已经排到队列最后的位置，就把 front 指针重新指向到头部。</p><blockquote><p>出现了新的问题，当队列为空，对头（front）和队尾（rear）就指向了同一结点。，那么如何判断空满呢？</p><p>常用操作：设置标志变量 flag 来区别</p></blockquote><h3 id="链式队列"><a href="#链式队列" class="headerlink" title="链式队列"></a>链式队列</h3><p>依赖链表实现，其中的数据依赖每个结点的指针互联，在内存中并不是顺序存储。链式队列，实际上就是只能尾进头出的线性表的单链表。</p><blockquote><p>一个增加了 front 和 rear 指针，通常同时会增加一个不存任何数据的头结点，用来辅助标识的单链表。</p></blockquote><p> 当最后一个结点删除时，rear 指针变成了野指针，因此需要对队尾指针重新赋值（指向头结点）</p><blockquote><p>如此便彰显了 头指针 的意义</p></blockquote><p>数值的查找仍然是 O(n)。</p><h3 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h3><p>时间复杂度：增删为O(1)，查找为O(n)。</p><p>空间复杂度：</p><ol><li><p>循环队列必须有一个固定的长度，因此存在存储元素数量和空间上的浪费。</p></li><li><p>链式队列，则不存在这个问题。</p></li></ol><p>在可以确定队列长度最大值时，建议使用循环队列。</p><p>无法确定队列长度时，应考虑使用链式队列。</p><p>队列最大的特点还是先进先出的特点。</p><blockquote><p>约瑟夫环问题</p></blockquote><h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p>数组可以看成是线性表的一种推广，属于另外一种数据结构。可以理解为，用来存放若干个相同类型的容器。 </p><blockquote><p>过于常见，略。</p></blockquote><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>存储数组时，是按顺序存储的，在内存中也是连续的，这使得它具有增删困难，查找容易的特点（按索引查找O(1)，按数值查找依然为O(n)）。</p><p>但是和 栈和队列 相比，它可以在任何位置进行删除新增操作，操作更加灵活。</p><blockquote><p>在数组最后增删O(1)，但在数组中间、前面增删，需要依次挪动位置，时间复杂度是O(n)。比如 JS 中的 <code>shift()</code></p></blockquote><p>高级语言中对于数组的增删封装好了函数方法：</p><ol><li>新增系列的 <code>push()</code>、<code>unshift()</code>、<code>concat()</code>、<code>splice()</code>。</li><li>删除系列的<code>pop()</code>、<code>shift()</code>、<code>slice()</code></li><li>查找系列的<code>indexOf()</code>、<code>lastIndexOf()</code></li></ol><blockquote><p>封装好的时间复杂度依然不会改变。</p></blockquote><h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><h3 id="对比链表"><a href="#对比链表" class="headerlink" title="对比链表"></a>对比链表</h3><ol><li>链表长度可变，数组则是固定的，需要提前在内存中预估好若干空间。</li><li>链表不会根据有序位置存储，想要充分利用内存空间就只能顺序存储。（且需要在不取不删数据的情况下才能实现）。</li></ol><h2 id="适用场景-3"><a href="#适用场景-3" class="headerlink" title="适用场景"></a>适用场景</h2><p>数组适合：</p><ol><li>数据数量确定。</li><li>较少的新增和删除的操作场景下。</li><li>数据对位置敏感的场景下。</li><li>高频查找时很适用。</li></ol><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p>打分案例，去掉一个最高分和一个最低分并计算平均分。</p><blockquote><p>不允许开辟O(n)空间复杂度的复杂数据结构。</p></blockquote><h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><blockquote><p>过于常见，定义略。</p></blockquote><h2 id="特殊的字符串"><a href="#特殊的字符串" class="headerlink" title="特殊的字符串"></a>特殊的字符串</h2><ol><li>空串</li><li>空格串</li><li>子串：串中任意连续字符组成的字符串叫做该串的子串。</li><li>主串</li></ol><h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><p>分为，顺序存储、链式存储。</p><h3 id="顺序存储"><a href="#顺序存储" class="headerlink" title="顺序存储"></a>顺序存储</h3><p>一般用定长数组，一组连续存储单元存储来实现。有些语言用<code>\0</code>表示传值终结。</p><h3 id="链式存储"><a href="#链式存储" class="headerlink" title="链式存储"></a>链式存储</h3><p>一个结点存储一个字符会造成空间浪费，一般一个结点存储多个字符。</p><h2 id="增删查-1"><a href="#增删查-1" class="headerlink" title="增删查"></a>增删查</h2><p>顺序存储和数组类似。增删在中间需要挪移(O(n))。</p><h2 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h2><p>字符串匹配：</p><blockquote><p>在 主串n 中匹配 模式串m</p></blockquote><p>查找AB两字符串的最大公共子串。</p><blockquote><p>匹配、动态规划</p></blockquote><p>逐个反转字符串中的每个单词。</p><h1 id="树和二叉树"><a href="#树和二叉树" class="headerlink" title="树和二叉树"></a>树和二叉树</h1><h2 id="树"><a href="#树" class="headerlink" title="树"></a>树</h2><blockquote><p>emmmm，过于常见，定义略</p></blockquote><h2 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h2><blockquote><p>常用的树结构，定义略。</p></blockquote><h3 id="满二叉树"><a href="#满二叉树" class="headerlink" title="满二叉树"></a>满二叉树</h3><blockquote><p>即，满</p></blockquote><h3 id="完全二叉树"><a href="#完全二叉树" class="headerlink" title="完全二叉树"></a>完全二叉树</h3><blockquote><p>并 “不完全”，除了叶子结点外，所有叶子结点都有两个子结点，且不满的叶子结点都靠左排列。</p></blockquote><h2 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h2><p>基于指针的链式存储方式。</p><p>基于数组的顺序存储方式。</p><blockquote><p>结点下标为 i ，左子节点存储在 2i 的位置，右子结点存储在2i+1的位置。之所以完全二叉树称为“完全”，就是因为在顺序存储中节省了空间。</p></blockquote><h2 id="基本操作-1"><a href="#基本操作-1" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><p>前、中、后遍历。时间复杂度为O(n)。</p><blockquote><p>前中后都是相对父结点而言的，父左右为前，左父右为中…</p></blockquote><h3 id="增删"><a href="#增删" class="headerlink" title="增删"></a>增删</h3><p>只需要通过指针建立关系即可。</p><blockquote><p>对于没有任何特殊性质的二叉树而言，抛开遍历的时间复杂度以外，真正执行增加和删除操作的时间复杂度是 O(1)。树数据的查找操作和链表一样，都需要遍历每一个数据去判断，所以时间复杂度是 O(n)。</p></blockquote><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><h3 id="二叉查找树的特性"><a href="#二叉查找树的特性" class="headerlink" title="二叉查找树的特性"></a>二叉查找树的特性</h3><ol><li>在二叉查找树中，<code>左边子结点的值 &lt; 该结点 &lt; 右子树结点的值</code> 。</li><li>尽可能规避两个结点数值相等的情况（尽量？）。</li><li>对二叉查找树中序遍历（左中右）即可得到一个从小到大的有序数据队列。</li></ol><h3 id="查找操作"><a href="#查找操作" class="headerlink" title="查找操作"></a>查找操作</h3><p>利用的是“二分查找”思想，时间复杂度为O(logn)：</p><ol><li>如果根节点即是查找数据，直接返回。</li><li>如果大于根节点值，递归向右子树执行查找动作，直到叶子结点。</li><li>如果小于根节点值，递归向左子树执行查找动作，直到叶子结点。</li></ol><h3 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h3><p>同样与根节点比大小，直到找到为空的子结点尝试插入操作。</p><blockquote><p>查找时间复杂度为O(logn)，插入操作时间复杂度为O(1)。</p></blockquote><h3 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h3><ol><li>如果删除的是叶子结点，直接删除，父结点指向 null。</li><li>如果要删除结点只有一个子结点，则直接删除，父结点直接指向删除结点的子结点。</li><li>如果要删除的结点有两个子结点：<ul><li>找到左子树最大的结点替换当前结点。</li><li>找到右子树最小结点替换当前结点。</li></ul></li></ol><blockquote><p>左子树最大和右子树最小都是 “最中间” 的元素</p></blockquote><h2 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h2><ol><li><p>输入字符串，判断它在已有的字符串集合中是否出现过？</p><blockquote><p>暴力解法。</p><p>利用 Trie 树。Trie树特点：</p><ol><li>根结点不包含字符。</li><li>一个结点一个字符。</li><li>从根到叶构成一个字符串。</li></ol><p>步骤：构建 Trie 树，看是否可以走到叶子节点。</p></blockquote></li></ol><h1 id="哈希"><a href="#哈希" class="headerlink" title="哈希"></a>哈希</h1><p>线性表在于顺序。数字字符串在于数据类型的统一。树在于层次结构。但是它们在按数值进行查找操作时都需要遍历。由此引入哈希（散列表）</p><h2 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h2><p>采用了函数映射的思想，数组是通过索引和值形成一一对应的关系。哈希则是通过，哈希函数实现 <code>地址 = f(关键字)</code> 的映射关系。</p><h3 id="哈希函数"><a href="#哈希函数" class="headerlink" title="哈希函数"></a>哈希函数</h3><p>因此哈希函数设计的好坏会直接影响到对哈希表的操作效率。</p><p>设计哈希函数常用的方法：</p><ol><li>直接定址法。即哈希函数为，关键字到地址的线性函数。</li><li>数字分析法。由均匀分布的特征值组成哈希地址。</li><li>平方取中法。</li><li>折叠法。</li><li>除留余数法。</li></ol><h3 id="哈希冲突"><a href="#哈希冲突" class="headerlink" title="哈希冲突"></a>哈希冲突</h3><p>再者，哈希函数存在哈希冲突，即通过哈希函数的映射，将多个关键字映射到了同一个地方，这个现象称为：哈希冲突。</p><p>解决哈希冲突的常用方法：</p><ol><li>开放定址法：<ul><li>线性探测法</li></ul></li><li>链地址法</li></ol><blockquote><p>哈希表对于顺序是不敏感的，且key值是不允许重复的，在重复性高的数据中，哈希表不是好多选择。</p></blockquote><h2 id="基本操作-2"><a href="#基本操作-2" class="headerlink" title="基本操作"></a>基本操作</h2><p>在高级语言中，对哈希函数以及哈希冲突进行了黑盒化处理，一般都可以在常数级时间复杂度查找到数据。在哈希表中的增删操作都不涉及对数据的挪移问题，因此主要在于查找。</p><blockquote><p>如果不需要有序遍历数据，并且可以提前预测数据量的大小。那么哈希表在速度和易用性方面是无与伦比的。</p></blockquote><h2 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h2><p>例 1，将关键字序列 {7, 8, 30, 11, 18, 9, 14} 存储到哈希表中。哈希函数为： H (key) = (key * 3) % 7，处理冲突采用线性探测法。</p><p>例 2，假设有一个在线系统，可以实时接收用户提交的字符串型关键字，并实时返回给用户累积至今这个关键字被提交的次数。</p><h1 id="常用算法"><a href="#常用算法" class="headerlink" title="常用算法"></a>常用算法</h1><h2 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h2><blockquote><p>常见：略</p></blockquote><p>注意：</p><ol><li>递归主体：可以将问题分解为多个完全相同的小问题来进行解决。</li><li>终止条件：要有明确的结束条件。</li></ol><blockquote><p>主要利用了，数学归纳法。即，在n=1成立，n=2成立，需推导出n=n时同样成立。</p></blockquote><h3 id="案例-4"><a href="#案例-4" class="headerlink" title="案例"></a>案例</h3><ol><li>对树的中序遍历。</li><li>汉诺塔问题。</li></ol><h2 id="分治"><a href="#分治" class="headerlink" title="分治"></a>分治</h2><blockquote><p>分而治之，简单：略</p></blockquote><ol><li>难度降低</li><li>问题可分</li><li>解可合并</li><li>相互独立</li></ol><blockquote><p>海量数据体现优势</p></blockquote><h3 id="案例-5"><a href="#案例-5" class="headerlink" title="案例"></a>案例</h3><ol><li>排序算法中的快速排序和归并排序。</li><li>n个元素的无序数组，从小到大打印。</li><li>有序数组，判断是否出现过数字C。<ul><li>遍历</li><li>以下情况考虑二分法<ul><li>有序</li><li>时间复杂度O(logn)</li><li>循环次数不确定，（while循环）</li></ul></li></ul></li><li>1毫米纸折叠多少次可以得到从地球到月球的距离。39次。</li><li>有序数组查找第一个大于9的数字。</li></ol><h2 id="经典排序"><a href="#经典排序" class="headerlink" title="经典排序"></a>经典排序</h2><p>衡量排序问题的优劣：时间复杂度，空间复杂度和稳定性（指相等的数据对象，在排序之后，顺序是否能保持不变）。</p><h3 id="冒泡"><a href="#冒泡" class="headerlink" title="冒泡"></a>冒泡</h3><blockquote><p>两两比较，每次将最大的值传向最前方。<br>性能：</p></blockquote><pre><code>1. 最好的时间复杂度是O(n)（顺序）。2. 最差的时间复杂度为O(n*n)（逆序）。3. 当输入的数组随机，平均时间复杂度为**O(n*n)**。4. 相等数据并未交换位置，**稳定**。5. 原地排序（O(1)）。</code></pre><h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><blockquote><p>维护一个已排好序的数组，依次将值插入合适的位置</p></blockquote><p>性能：</p><ol><li>最好的时间复杂度是 O(n)（顺序）。</li><li>最差的时间复杂度为 O(n*n)（逆序）。</li><li>当输入的数组随机，平均时间复杂度为 <strong>O(n*n)</strong>。</li><li>相等数据并未交换位置，<strong>稳定</strong>。</li><li>原地排序（O(1)）。</li></ol><h3 id="归并"><a href="#归并" class="headerlink" title="归并"></a>归并</h3><blockquote><p>分治法。二分至只有一个数字，然后合并。</p></blockquote><ol><li>最好的时间复杂度是 O(n*logn)（n次二分法）。</li><li>最差的时间复杂度为 O(n*logn)（n次二分法）。</li><li>当输入的数组随机，平均时间复杂度为 <strong>O(n*logn)</strong>。</li><li>相等数据并未交换位置，<strong>稳定</strong>。</li><li>每次开辟新的空间（O(n)）。</li></ol><h3 id="快排"><a href="#快排" class="headerlink" title="快排"></a>快排</h3><blockquote><p>选值比较交换，分治（二分）.</p></blockquote><ol><li>最好的时间复杂度是 O(n*logn)（每次选到中位数）。</li><li>最差的时间复杂度为 O(n*n)（每次选到最大最小值）。</li><li>当输入的数组随机，平均时间复杂度为 <strong>O(n*logn)</strong>。</li><li>使用了交换法，相等数据交换位置，不<strong>稳定</strong>。</li><li>每次开辟新的空间（O(1)）。</li></ol><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ol><li>数据规模小，采用O(n*n)。（冒泡，插入）</li><li>数据规模大，采用O(n*logn)。（归并，快排）</li><li>归并稳定，消耗空间。</li><li>快速排序，不稳定。</li></ol><h2 id="动态规划（？）"><a href="#动态规划（？）" class="headerlink" title="动态规划（？）"></a>动态规划（？）</h2><p>分治需要满足其可被分治的条件，当不满足时，引入了动态规划。</p><blockquote><p>运筹学方法，在多轮决策中选择最优的方法。</p></blockquote><blockquote><p>状态，可选择的结果。</p></blockquote><h3 id="基本方法（宏观层面）"><a href="#基本方法（宏观层面）" class="headerlink" title="基本方法（宏观层面）"></a>基本方法（宏观层面）</h3><ol><li>分阶段，将原问题划分成几个子问题。</li><li>找状态，选择合适的状态变量Sk（k表示多轮决策的第k轮），它需要具备多轮决策的演变。</li><li>做决策，确定决策变量uk，比如D2可能的决策动作是：D2-&gt;E2和D2-&gt;E3。</li><li>状态转移方程，即Sk+1 = Uk(Sk)。</li><li>定目标，写出多轮决策目标的指标函数Vk,n</li><li>寻找终止条件。</li></ol><blockquote><p>决策集合称为策略。所有可能的策略称为策略集合</p></blockquote><h4 id="场景概述"><a href="#场景概述" class="headerlink" title="场景概述"></a>场景概述</h4><ol><li>最优子结构，原问题的最优解，所包含的子问题的解也是最优的。</li><li>无后效性，某阶段的决策，不影响先前状态。</li><li>有重叠子问题，子问题间不独立，（区别于分治）。</li></ol><h3 id="案例-6"><a href="#案例-6" class="headerlink" title="案例"></a>案例</h3><ol><li>最短路径问题<ul><li>暴力方法，求出所有可能的结果。</li><li>动态规划</li></ul></li><li>最大公共字串</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;数据结构与算法&quot;&gt;&lt;a href=&quot;#数据结构与算法&quot; class=&quot;headerlink&quot; title=&quot;数据结构与算法&quot;&gt;&lt;/a&gt;数据结构与算法&lt;/h1&gt;&lt;p&gt;数据结构、算法基础…….&lt;strong&gt;de&lt;/strong&gt;复习~。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="计算机基础" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"/>
    
      <category term="数据结构与算法" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="计算机基础" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"/>
    
      <category term="技术" scheme="http://yoursite.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="数据结构" scheme="http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
      <category term="算法" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>HTTP</title>
    <link href="http://yoursite.com/2020/06/27/Http/"/>
    <id>http://yoursite.com/2020/06/27/Http/</id>
    <published>2020-06-27T13:35:00.000Z</published>
    <updated>2020-06-27T13:37:46.090Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p>TCP：TCP头和数据部分。</p><p>HTTP：<code>header + body</code> 结构。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">起始行 + 头部 + 空行 + 实体</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="起始行"><a href="#起始行" class="headerlink" title="起始行"></a>起始行</h2><ol><li>请求报文，方法 + 路径 + http版本，例：<code>GET /home HTTP/1.1</code>。</li><li>响应报文，http版本 + 状态码 + 原因，例：<code>HTTP/1.1 200 OK</code>。</li></ol><h2 id="头部"><a href="#头部" class="headerlink" title="头部"></a>头部</h2><ol><li>涉及诸多特性</li></ol><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers</a></p></blockquote><ol start="2"><li>头部字段格式<ul><li>字段名不区分大小写。</li><li>字段名不允许出现空格，不可以出现下划线<code>_</code>。</li><li>字段名后面必须紧接着<code>：</code>。</li></ul></li></ol><h2 id="空行"><a href="#空行" class="headerlink" title="空行"></a>空行</h2><p>用来区分开<code>头部</code> 和 <code>实体</code>。</p><blockquote><p>问：如果说在头部中间故意加一个空行会怎么样？</p><p>答：空行后的内容全部被视为实体。</p></blockquote><h2 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h2><p><code>body</code>部分，具体数据。分别对应 请求体 和 响应体。</p><h1 id="理解请求方法"><a href="#理解请求方法" class="headerlink" title="理解请求方法"></a>理解请求方法</h1><p>前端涉及的最多的就是请求头中的请求方法。</p><ol><li>GET：获取资源。</li><li>HEAD：获取资源的元信息。</li><li>POST：提交数据，即上传数据。</li><li>PUT：修改数据。</li><li>DELETE：删除资源。</li><li>CONNECT：建立隧道，用于代理服务器（？）。</li><li>OPTIONS：列出对资源实行的请求方法，用来跨域请求（？）。</li><li>TRACE：追踪请求-响应的传输路径。</li></ol><h2 id="GET-POST区别"><a href="#GET-POST区别" class="headerlink" title="GET/POST区别"></a>GET/POST区别</h2><ol><li>语义。</li><li>缓存：GET请求会被浏览器主动缓存下来留下历史记录，POST不会。</li><li>编码：GET 只能进行 URL 编码，只能接收 ASCII 字符，而 POST 没有限制。</li><li>参数：GET 一般放在 URL 中，因此不安全，POST 放在请求体中，更适合传输敏感信息。</li><li>幂等性：GET 是<strong>幂等</strong>的，而POST不是。(<strong>幂等</strong>表示执行相同的操作，结果也是相同的)</li><li>TCP：GET 请求会把请求报文一次性发出去，而 POST 会分为两个 TCP 数据包，首先发 header 部分，如果服务器响应 100(continue)， 然后发 body 部分。(<strong>火狐</strong>浏览器除外，它的 POST 请求只发一个 TCP 包)</li></ol><h1 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h1><p><img src="https://user-gold-cdn.xitu.io/2020/3/22/170ffd677629b70d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><ol><li><strong>scheme</strong> 表示协议名，比如<code>http</code>, <code>https</code>, <code>file</code>等等。后面必须和<code>://</code>连在一起。</li><li><strong>user:passwd</strong>@ 表示登录主机时的用户信息，不过很不安全，不推荐使用，也不常用。</li><li><strong>host:port </strong>表示主机名和端口。</li><li><strong>path </strong>表示请求路径，标记资源所在位置。</li><li><strong>query </strong> 表示查询参数，为<code>key=val</code>这种形式，多个键值对之间用<code>&amp;</code>隔开。</li><li><strong>fragment</strong> 表示 URI 所定位的资源内的一个<strong>锚点</strong>，浏览器可以根据这个锚点跳转到对应的位置。</li></ol><h2 id="URI编码"><a href="#URI编码" class="headerlink" title="URI编码"></a>URI编码</h2><p>URI 只能使用<code>ASCII</code>, ASCII 之外的字符是不支持显示的，而且还有一部分符号是界定符，如果不加以处理就会导致解析出错。</p><p>因此，URI 引入了<code>编码</code>机制，将所有<strong>非 ASCII 码字符</strong>和<strong>界定符</strong>转为十六进制字节值，然后在前面加个<code>%</code>。</p><h1 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h1><p>略。</p><h1 id="HTTP特点"><a href="#HTTP特点" class="headerlink" title="HTTP特点"></a>HTTP特点</h1><p>优点：</p><ol><li>灵活可扩展。</li><li>可靠传输。</li><li>请求-应答。</li><li>无状态。</li></ol><p>缺点：</p><ol><li>需要长连接的场景中，无状态就是缺点。</li><li>明文传输，（WIFI陷阱？）</li><li>队头阻塞问题。</li></ol><h1 id="Accept系列字段"><a href="#Accept系列字段" class="headerlink" title="Accept系列字段"></a>Accept系列字段</h1><p>指定了，<strong>数据格式</strong>、<strong>压缩方式</strong>、<strong>支持语言</strong>、<strong>字符集</strong>。</p><h1 id="定长和不定长数据"><a href="#定长和不定长数据" class="headerlink" title="定长和不定长数据"></a>定长和不定长数据</h1><h2 id="定长包体"><a href="#定长包体" class="headerlink" title="定长包体"></a>定长包体</h2><p>发送端头部会带上 <code>content-Length</code>，来指定包体的长度。</p><p><code>Content-Length</code> 对于http 传输过程起到了十分关键的作用，如果设置不当可以直接导致传输的失败。</p><h2 id="不定长包体"><a href="#不定长包体" class="headerlink" title="不定长包体"></a>不定长包体</h2><p>利用头部字段 <code>Transfer-Encoding:chunked</code> 表示分块传输数据，设置这个字段会产生两个效果：</p><ol><li>Content-Length 字段会被忽略。</li><li>基于<strong>长连接</strong>持续推送动态的内容。</li></ol><h1 id="处理大文件传输"><a href="#处理大文件传输" class="headerlink" title="处理大文件传输"></a>处理大文件传输</h1><p>采取 <strong>范围请求</strong> ，允许客户端仅仅请求一个资源的一部分。</p><h2 id="范围请求—服务端"><a href="#范围请求—服务端" class="headerlink" title="范围请求—服务端"></a>范围请求—服务端</h2><p>添加响应头 <code>Accept-Ranges: none</code> 用来告知客户端支持范围请求。</p><h2 id="范围请求—客户端"><a href="#范围请求—客户端" class="headerlink" title="范围请求—客户端"></a>范围请求—客户端</h2><p>客户端需要指定请求哪一部分，通过 <code>Range</code> 这个请求头字段，格式为 <code>bytes=x-y</code>：</p><ul><li><strong>0-499</strong>表示从开始到第 499 个字节。</li><li><strong>500</strong>- 表示从第 500 字节到文件终点。</li><li><strong>-100</strong>表示文件的最后100个字节。</li></ul><p>服务端验证是否合法，越界报 <code>416</code> ，否则读取相应片段，返回<code>206</code>状态码。</p><h3 id="响应格式"><a href="#响应格式" class="headerlink" title="响应格式"></a>响应格式</h3><p>响应格式分为，单/多段数据</p><p>服务端添加字段 <code>Content-Range</code> 字段：</p><p>请求头：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单段数据</span></span><br><span class="line">Range: bytes=<span class="number">0</span><span class="number">-9</span></span><br><span class="line"><span class="comment">// 多段数据</span></span><br><span class="line">Range: bytes=<span class="number">0</span><span class="number">-9</span>, <span class="number">30</span><span class="number">-39</span></span><br></pre></td></tr></table></figure><p>响应头：单段数据</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">206</span> Partial Content</span><br><span class="line">Content-Length: <span class="number">10</span></span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Range: bytes <span class="number">0</span><span class="number">-9</span>/<span class="number">100</span>        <span class="comment">// 0-9表示请求的返回，100表示资源的总大小</span></span><br></pre></td></tr></table></figure><p>多段数据：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">206</span> Partial Content</span><br><span class="line">Content-Type: multipart/byteranges; boundary=<span class="number">00000010101</span></span><br><span class="line">Content-Length: <span class="number">189</span></span><br><span class="line">Connection: keep-alive</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-<span class="number">-00000010101</span></span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Content-Range: bytes <span class="number">0</span><span class="number">-9</span>/<span class="number">96</span></span><br><span class="line"></span><br><span class="line">i am xxxxx</span><br><span class="line">-<span class="number">-00000010101</span></span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Content-Range: bytes <span class="number">20</span><span class="number">-29</span>/<span class="number">96</span></span><br><span class="line"></span><br><span class="line">eex jspy e</span><br><span class="line">-<span class="number">-00000010101</span>--</span><br></pre></td></tr></table></figure><p><code>Content-Type: multipart/byteranges;boundary=00000010101</code>，它代表了信息量是这样的:</p><ul><li>请求一定是多段数据请求</li><li>响应体中的分隔符是 00000010101</li></ul><p>因此，在响应体中各段数据之间会由这里指定的分隔符分开，而且在最后的分隔末尾添上 <code>--</code> 表示结束。</p><h1 id="HTTP处理表单提交"><a href="#HTTP处理表单提交" class="headerlink" title="HTTP处理表单提交"></a>HTTP处理表单提交</h1><p>利用 <code>Content-Type</code> ，根据取值不同有两种方法：</p><ul><li>application/x-www-form-urlencoded</li><li>multipart/form-data</li></ul><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p><code>application/x-www-form-urlencoded</code> ：</p><ol><li>数据会被编码成以 <code>&amp;</code> 分隔的键值对。</li><li>字符以URL编码方式编码。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转换过程: &#123;a: 1, b: 2&#125; -&gt; a=1&amp;b=2 -&gt; 如下(最终形式)</span></span><br><span class="line"><span class="string">"a%3D1%26b%3D2"</span></span><br></pre></td></tr></table></figure><p><code>multipart/form-data</code>：</p><p>每个表单元素都是独立的资源表述。（略）</p><h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><p>实际场景中，对于 <strong>图片等文件的上传</strong> ，基本采用 <code>multipart/form-data</code> 而不用 <code>application/x-www-form-urlencoded</code>，因为没有必要做 URL 编码，带来巨大耗时的同时也占用更多的空间。</p><h1 id="解决队头阻塞问题"><a href="#解决队头阻塞问题" class="headerlink" title="解决队头阻塞问题"></a>解决队头阻塞问题</h1><h2 id="队头阻塞"><a href="#队头阻塞" class="headerlink" title="队头阻塞"></a>队头阻塞</h2><p>HTTP 传输是基于 <strong>请求-应答</strong> 的模式进行，报文必须是一发一收，里面的任务被放到了一个任务队列中串行执行，一旦对首的请求处理太慢就会阻塞后面的请求处理。</p><h2 id="并发连接"><a href="#并发连接" class="headerlink" title="并发连接"></a>并发连接</h2><p>对于一个域名允许分配多个长连接，相当于增加了任务队列，不至于一个队伍的任务阻塞了其它所有的任务，现代浏览器的标准中，可以并发许多，Chrome上限是6个。</p><h2 id="域名分片"><a href="#域名分片" class="headerlink" title="域名分片"></a>域名分片</h2><p>一个域名并发6个长连接，一个域名下可以分出多个二级域名，它们都指向同样的一台服务器，能够并发的长连接数就更多了。</p><h1 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h1><h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p>Cookie 的有效期通过属性 <strong>Expires</strong> 和 <strong>Max-Age</strong> 两个属性设置。</p><ol><li><strong>Expires</strong>：表示过期时间。</li><li><strong>Max-Age</strong>：用的是一段时间间隔，单位是秒，从浏览器收到报文开始计算。</li></ol><p>如果 Cookie 过期，则会被删除，也就不会发送到服务端。</p><h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>绑定了域名和路径的两个属性：</p><ol><li><strong>Domain</strong>：绑定了域名。</li><li><strong>path</strong>：绑定了路径。对于路径来说，<code>/</code>表示任意路径下都可以使用。</li></ol><p>如果发现域名或者路径不匹配，就不会带上Cookie。</p><h2 id="安全相关"><a href="#安全相关" class="headerlink" title="安全相关"></a>安全相关</h2><ol><li><p><strong>Secure</strong>：如果带上 Secure，说明只能通过 HTTPS 传输 cookie。</p></li><li><p><strong>HttpOnly</strong>：说明只能通过 HTTP 协议传输，不能通过 JS 访问，这是预防 <strong>XSS</strong> 攻击的重要手段。</p></li><li><p>SameSite：为了防御 CSRF 的攻击。一共有三个属性：</p><ul><li>Strict，浏览器完全禁止三方请求携带 Cookie，该网站只能在其自己的域名下携带 Cookie ，在其他情况下均不能。</li><li>Lax，只能在<code>get方法提交表单</code> 时，或 <code>a 标签发送 get 请求</code> 的情况下可以携带 Cookie ，其他情况不能。</li><li>None，默认模式，请求会自动携带 Cookie。</li></ul></li></ol><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ol><li>容量。Cookie 的体积上限只有 4KB，只能存储少量的信息。</li><li>性能。请求会携带上完整的Cookie，随着请求数的增多，携带了很多不必要的内容，造成了巨大的性能浪费，可以通过 <code>Domain</code> 和 <code>Path</code> 指定作用域来解决。</li><li>安全缺陷。Cookie 以纯文本的形式在浏览器和服务器中传递，很容易被非法用户截获，在有效期内重新发送给服务器是危险的。另外，在HttpOnly 为 false 时，Cookie 信息能直接通过 JS 脚本来读取。</li></ol><h1 id="HTTP代理"><a href="#HTTP代理" class="headerlink" title="HTTP代理"></a>HTTP代理</h1><p>HTTP 是基于 <code>请求-响应</code> 模型，引入代理服务器，代理服务器可以向客户端进行进行响应，对服务端进行请求。</p><h2 id="代理服务器功能"><a href="#代理服务器功能" class="headerlink" title="代理服务器功能"></a>代理服务器功能</h2><ol><li>负载均衡，代理服务器可以通过特定的算法将请求分发送给不同的源服务器，使各源服务器尽量达到负载均衡。</li><li>保障安全，利用心跳机制监控后台的服务器，保障运行。对非法 IP 进行限流，对上下行的数据进行过滤，等。</li><li>缓存代理，将内容缓存到代理服务器，使得客户端可直接从代理服务器获得，不必再去源服务器。</li></ol><h2 id="相关头部"><a href="#相关头部" class="headerlink" title="相关头部"></a>相关头部</h2><h3 id="via"><a href="#via" class="headerlink" title="via"></a>via</h3><p>代理服务器需要标明自己的身份，在 HTTP 传输中留下自己的痕迹，就通过 Via 字段来记录。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端 -&gt; 代理1 -&gt; 代理2 -&gt; 源服务器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端拿到的 请求头</span></span><br><span class="line">Via: proxy_server1, proxy_server2</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端拿到的 响应头</span></span><br><span class="line">Via: proxy_server2, proxy_server1</span><br></pre></td></tr></table></figure><p>Via 中代理的顺序即为在HTTP传输中报文传达的顺序。</p><h3 id="X-Forwarded-For"><a href="#X-Forwarded-For" class="headerlink" title="X-Forwarded-For"></a>X-Forwarded-For</h3><p>该字段记录了请求方的IP地址。</p><p>仅仅记录的是上一个请求方的一个 <code>IP</code>，会带来两个问题：</p><ol><li>代理必须解析 HTTP 请求头，然后修改，比直接转发数据性能下降。</li><li>HTTPS 通信加密的过程中，原始报文不允许修改。</li></ol><p>解决：使用 <strong>代理协议</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PROXY + TCP4/TCP6 + 请求方地址 + 接收方地址 + 请求端口 + 接收端口</span></span><br><span class="line">PROXY TCP4 <span class="number">0.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.2</span> <span class="number">1111</span> <span class="number">2222</span></span><br><span class="line">GET / HTTP/<span class="number">1.1</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="X-Real-IP"><a href="#X-Real-IP" class="headerlink" title="X-Real-IP"></a>X-Real-IP</h3><p>获取用户真实IP的字段，不管中间经过多少代理，该字段始终记录最初的客户端的IP。</p><blockquote><p><code>X-Forwarded-Host</code> 和 <code>X-Forwarded-Proto</code>，分别记录<strong>客户端</strong>(不包括代理)的 <code>域名</code> 和 <code>协议名</code>。</p></blockquote><h1 id="HTTP缓存及缓存代理"><a href="#HTTP缓存及缓存代理" class="headerlink" title="HTTP缓存及缓存代理"></a>HTTP缓存及缓存代理</h1><h2 id="强缓存和协商缓存"><a href="#强缓存和协商缓存" class="headerlink" title="强缓存和协商缓存"></a>强缓存和协商缓存</h2><p><code>Cache-Control</code> 验证强缓存是否可用：</p><ol><li><p>强缓存可用直接使用。</p></li><li><p>强缓存不可用，进入协商缓存，即发送 HTTP 请求，服务器通过请求头中的 <code>If-Modified-Since</code> 或者 <code>If-None-Match</code> 这些条件请求字段检查资源更新。</p><ul><li>若资源更新，返回资源和200状态码。</li><li>否则，返回304，告诉浏览器直接从缓存获取资源。</li></ul></li></ol><h2 id="代理缓存"><a href="#代理缓存" class="headerlink" title="代理缓存"></a>代理缓存</h2><p>源服务器存在缓存，比如，<strong>Redis，Memcache</strong>，但是对于 HTTP 缓存来说，如果每次客户端缓存失效都要到源服务器获取，给与源服务器压力过大。</p><p>引入代理缓存机制，客户端缓存过期去代理缓存获取，代理缓存过期去源服务器获取。</p><p>代理缓存可以由源服务器端控制，也可以由客户端控制。</p><h3 id="源服务器控制"><a href="#源服务器控制" class="headerlink" title="源服务器控制"></a>源服务器控制</h3><p>根据 <strong>Cache-Control</strong> 中的取值不同，进行控制：</p><ol><li>private：禁止代理服务器缓存。</li><li>public：允许代理服务器缓存。</li><li>must-revalidate：表示看客户端缓存过期后去源服务器获取。</li><li>proxy-revalidate：表示代理服务器的缓存过期后到源服务器获取。</li><li>s-maxage：限定了缓存在代理服务器中可以存放多久。</li><li>max-age：限制了客户端缓存时间。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: public, max-age=<span class="number">1000</span>, s-maxage=<span class="number">2000</span></span><br><span class="line"><span class="comment">// 表示可以使用代理缓存，客户端缓存 1000s，代理缓存 2000s</span></span><br></pre></td></tr></table></figure><h3 id="客户端的缓存控制"><a href="#客户端的缓存控制" class="headerlink" title="客户端的缓存控制"></a>客户端的缓存控制</h3><p><code>max-stale：5</code>，表示代理缓存过期了，但在5s之内依然可以使用。</p><p><code>max-fresh: 5</code>，表示要在缓存到期前5s内才可以拿去使用。保证了代理缓存的新鲜度。</p><p><code>only-if-cached</code>，表示客户端只接受代理缓存，代理缓存无效直接返回504（gateway Timeout）。</p><h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><p>跨域，即scheme（协议）、host（主机）、port（端口）相同即为“同源”。</p><p>同源策略做出了如下限制：</p><ol><li>不能读取和修改对方DOM。</li><li>不能访问对方的 Cookie、IndexDB、LocalStorage。</li><li>限制 XMLHttpRequest 请求。</li></ol><p>跨域请求一般响应是成功到达客户端了，但是会被浏览器拦截。</p><h2 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h2><p>网络进程将数据传递给主进程，主进程接收后发出网络请求，服务端处理完数据后返回，主进程检查到跨域，并且没有 <code>cors</code> 响应头，则将响应体全部丢掉，不会发送给渲染进程，从而达到了拦截的目的。</p><h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p>CORS，跨域资源共享。</p><h3 id="简单请求-非简单请求"><a href="#简单请求-非简单请求" class="headerlink" title="简单请求/非简单请求"></a>简单请求/非简单请求</h3><ol><li>请求方法为 GET、POST、HEAD。</li><li>请求头的取值范围：Accept，Accept-Language、Content-Language、Content-Type（只限于三个值，<code>application/x-www-from-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code>）。</li></ol><p>浏览器将满足上述条件称为 <strong>简单请求</strong>，否则为 <strong>非简单请求</strong>。</p><h4 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h4><p>请求头：</p><ol><li><code>Origin</code>：该字段会自动被添加到请求头，用来说明请求来自哪个源。</li></ol><p>响应头：</p><ol><li><code>Access-Control-Allow-Origin</code>：服务器拿到<code>Origin</code>字段，对应添加该字段，如果<code>Origin</code>不在这个字段里，将会被拦截。</li></ol><p>其它可选：</p><ol><li><p><code>Access-Control-Allow-Credentials</code>：布尔值，表示是否允许发送Cookie，对于跨域请求，浏览器默认设置为<code>false</code>，如果需要拿到Cookie，需要添加该响应头并设为 <code>true</code> ，前端需要设置 <code>withCredentials</code> 属性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></li><li><p><code>Access-Control-Expose-Headers</code>：给 <code>XMLHttpRequest</code> 对象赋能，包括，<code>Cache-Control</code>/<code>Content-Language</code>/<code>Content-Type</code>/<code>Expires</code>/<code>Last-Modified</code>/<code>Pragma</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Access-Control-Expose-Headers: aaa</span></span><br><span class="line">XMLHttpRequest.getResponseHeader(<span class="string">'aaa'</span>) <span class="comment">// 前端可以拿到 aaa 这个字段的值。</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="非简单请求"><a href="#非简单请求" class="headerlink" title="非简单请求"></a>非简单请求</h4><p>非简单请求有两点不同：<strong>预检请求</strong>和<strong>响应字段</strong>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">'http://xxx.com'</span>;</span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">'PUT'</span>, url, <span class="literal">true</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">'X-Custom-Header'</span>, <span class="string">'xxx'</span>);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure><p>发送预检请求，请求格式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS / HTTP/<span class="number">1.1</span>                        <span class="comment">// 请求方法</span></span><br><span class="line">Origin: 当前地址                           <span class="comment">// 源地址</span></span><br><span class="line">Host: xxx.com                             <span class="comment">// 目标地址</span></span><br><span class="line">Access-Control-Request-Method: PUT        <span class="comment">// CORS 请求用到哪个方法</span></span><br><span class="line">Access-Control-Request-Headers: X-Custom-Header    <span class="comment">// CORS 请求要加上什么请求</span></span><br></pre></td></tr></table></figure><p>预检请求的响应：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Access-Control-Allow-Origin: *              <span class="comment">// 表示允许请求的源，`*`表示允许任意源请求</span></span><br><span class="line">Access-Control-Allow-Methods: GET, POST, PUT  <span class="comment">// 表示允许的请求方法列表</span></span><br><span class="line">Access-Control-Allow-Headers: X-Custom-Header  <span class="comment">// 表示允许发送的请求头字段</span></span><br><span class="line">Access-Control-Allow-Credentials: <span class="literal">true</span>      <span class="comment">// 表示是否允许发送 Cookie</span></span><br><span class="line">Access-Control-Max-Age: <span class="number">1728000</span>             <span class="comment">// 预检请求的有效期，在此期间不用发出另外的检测请求</span></span><br><span class="line">Content-Type: text/html; charset=utf<span class="number">-8</span></span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Length: <span class="number">0</span></span><br></pre></td></tr></table></figure><p>预检请求的响应返回后，如果请求不满足响应头的条件，会触发XMLHttpRequest 的onerror方法，后面真正的 CORS请求将不会发出去。</p><h3 id="CORS-1"><a href="#CORS-1" class="headerlink" title="CORS"></a>CORS</h3><p>后续请求将和简单请求情况一样，浏览器自动加上 <code>Origin</code> 字段…。</p><h2 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h2><p>略</p><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>VPN是正向代理，VPN获取客户端无法获取的服务器的资源，然后客户端再从VPN获取，即为正向代理。</p><p>而反向代理，主要是获取客户端的请求，分发给不同的服务器，以达到维持服务器的负载均衡的问题。</p><p>正向代理是获取客户端获取不到的服务端资源。</p><p>反向代理是将客户端的请求分发给不同的服务端处理。</p><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><p>WebSocket等…</p><h1 id="TLS1-2"><a href="#TLS1-2" class="headerlink" title="TLS1.2"></a>TLS1.2</h1><p>HTTP是明文传输协议，传输报文对外透明，不安全。引入HTTPS：</p><h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>HTTPS是在HTTP下增加了一层 <code>SSL/TLS</code> 协议。</p><p>HTTP是明文通信，存在三个安全问题：</p><ol><li>明文可能会被窃听。需要进行通信加密和内容加密。</li><li>不验证通信双方，可能遭遇伪装。可以利用 SSL 查明对手证书。</li><li>无法证明报文完整性，可能已遭篡改。MD5/PGP防篡改。</li></ol><p>HTTS为解决这三个问题应运而生。</p><h2 id="加密、解密、密钥"><a href="#加密、解密、密钥" class="headerlink" title="加密、解密、密钥"></a>加密、解密、密钥</h2><h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><p>加密、解密同用一个密钥被称为 <strong>共享密钥加密</strong> ，也称为 对称密钥加密。</p><blockquote><p>但是也要安全的传输密钥，否则一切就失去了意义。</p></blockquote><h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>利用公开密钥加密，私有密钥解密，解决密钥传输安全问题。</p><h3 id="混合加密机制"><a href="#混合加密机制" class="headerlink" title="混合加密机制"></a>混合加密机制</h3><ol><li>交换密钥利用公开密钥加密的方式。</li><li>建立通信交换报文使用，共享密钥加密（对称加密）方式。</li></ol><p>即，在确保密钥安全的前提下进行对称加密通信。</p><h1 id="TLS1-3改进"><a href="#TLS1-3改进" class="headerlink" title="TLS1.3改进"></a>TLS1.3改进</h1><p>待…</p><h1 id="HTTP-2改进"><a href="#HTTP-2改进" class="headerlink" title="HTTP/2改进"></a>HTTP/2改进</h1><p>待…</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p>《图解HTTP》</p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview</a></p></blockquote><blockquote><p><a href="https://juejin.im/post/5e76bd516fb9a07cce750746" target="_blank" rel="noopener">https://juejin.im/post/5e76bd516fb9a07cce750746</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;HTTP&quot;&gt;&lt;a href=&quot;#HTTP&quot; class=&quot;headerlink&quot; title=&quot;HTTP&quot;&gt;&lt;/a&gt;HTTP&lt;/h1&gt;&lt;p&gt;TCP：TCP头和数据部分。&lt;/p&gt;
&lt;p&gt;HTTP：&lt;code&gt;header + body&lt;/code&gt; 结构。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;起始行 + 头部 + 空行 + 实体&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="前端通信" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1/"/>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="HTTP" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1/%E5%89%8D%E7%AB%AF/HTTP/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端通信" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1/"/>
    
      <category term="HTTP" scheme="http://yoursite.com/tags/HTTP/"/>
    
  </entry>
  
  <entry>
    <title>BFC</title>
    <link href="http://yoursite.com/2020/06/16/cssBFC/"/>
    <id>http://yoursite.com/2020/06/16/cssBFC/</id>
    <published>2020-06-16T10:18:00.000Z</published>
    <updated>2020-06-27T13:33:45.766Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h1><p>CSS布局基础。<a id="more"></a></p><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>FC（formatting context）格式化上下文。它是页面中的一块渲染区域，有一套渲染规则，决定了其子元素如何布局，以及和其它元素之间的关系和作用。</p><p>常见的FC有：BFC、IFC（行级格式化上下文）、GFC（网格布局格式化上下文）、FFC（自适应格式化上下文）。</p><blockquote><p>一个通俗的解释：BFC 可以简单的理解为<strong>某个元素的一个 CSS 属性</strong>，只不过这个属性<strong>不能被开发者显式的修改</strong>，拥有这个属性的元素对内部元素和外部元素会表现出一些特性，这就是BFC 。</p></blockquote><h2 id="触发条件"><a href="#触发条件" class="headerlink" title="触发条件"></a>触发条件</h2><blockquote><p>MDN：<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context</a></p></blockquote><p>主要因素：</p><ol><li>根元素<code>&lt;html&gt;</code>。</li><li><code>float</code> 的值不为 <code>none</code>。</li><li><code>overflow</code> 的值不为 <code>visible</code>。</li><li><code>display</code> 的值为<code>inline-block</code>、<code>table-cell</code>、<code>table-caption</code>。</li><li><code>position</code> 的值为 <code>absolute</code> 或 <code>fixed</code>。</li></ol><h2 id="BFC布局规则"><a href="#BFC布局规则" class="headerlink" title="BFC布局规则"></a>BFC布局规则</h2><ol><li>内部的Box会在垂直的方向一个接一个放置。<ul><li>Box之间的距离虽然也可以使用 <code>padding</code> 来控制，但是此时实际上还是属于box内部里面，而且使用<code>padding</code> 来控制的话就不能再使用border属性了 。（.）</li></ul></li><li>Box垂直方向的距离由 <code>margin</code> 决定，属于同一个BFC的两个相邻的BOX的 margin 会发生重叠。<ul><li>例：兄 <code>margin-bottom:20px</code>，弟 <code>margin-top:20px</code>，页面默认显示兄弟之间的 margin 为 20px。并不会累加。</li><li>弟 <code>position</code> 设为 <code>absolate</code> 或 <code>fixed</code> 时，兄弟元素的 ”间距“ 值会进行累加，这是利用了将相邻的兄弟元素分属于不同的BFC，来阻止margin重叠。</li><li>也可以在弟外面包裹一层 <code>&lt;div&gt;</code> 设置为 <code>overflow: hidden;</code>。将弟设置为另一个BFC内元素。</li></ul></li><li>子元素的 marginbox 左边 与 父元素 borderbox 的相接触，即会进行叠加（从右往左的格式化相反），对于存在浮动也是如此。</li><li>BFC 的区域不会与 float box重叠。<ul><li>例：将第二条中 弟 设置为 <code>float:left;</code>，则兄弟元素的上下的间距值会进行累加。</li></ul></li><li>BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素，反之也如此。</li><li>计算BFC的高度时，浮动元素也参与计算。</li></ol><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><ol><li>自适应两栏布局。<ul><li>兄设置浮动 <code>float:left;</code> ，弟设置BFC <code>overflow:hidden;</code> 。如果不设置BFC，弟一部分会隐藏在兄下面，并不会并排排列。</li></ul></li><li>阻止元素被浮动元素覆盖。<ul><li>兄元素设为float，弟会忽略其高度，从而隐藏在了兄的下面。将弟设置为单独的BFC即可阻止被覆盖。</li></ul></li><li>可以包含浮动元素——清除内部浮动。<ul><li>内部浮动元素，引起高度塌陷，给父元素设置为的BFC，使得内部元素都属于BFC区域内，以达到清除浮动，解决浮动引起的高度塌陷问题</li></ul></li><li>分属于不同的BFC时可以阻止margin重叠。</li></ol><h2 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h2><p>Layout是 IE 中的 “BFC” ，为了处理IE的兼容性，在需要出发 BFC 时，除了以上的出发条件，还要针对IE浏览器使用 <code>zoom:1</code> 来触发 IE 浏览器的 Layout。</p><h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><blockquote><p>演示地址：<a href="https://www.cnblogs.com/xiaohuochai/p/5248536.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaohuochai/p/5248536.html</a></p></blockquote><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://juejin.im/post/5909db2fda2f60005d2093db" target="_blank" rel="noopener">https://juejin.im/post/5909db2fda2f60005d2093db</a></p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context</a></p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flow_Layout/%E5%9C%A8Flow%E4%B8%AD%E5%92%8CFlow%E4%B9%8B%E5%A4%96" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flow_Layout/%E5%9C%A8Flow%E4%B8%AD%E5%92%8CFlow%E4%B9%8B%E5%A4%96</a></p></blockquote><blockquote><p><a href="https://www.cnblogs.com/xiaohuochai/p/5248536.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaohuochai/p/5248536.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;BFC&quot;&gt;&lt;a href=&quot;#BFC&quot; class=&quot;headerlink&quot; title=&quot;BFC&quot;&gt;&lt;/a&gt;BFC&lt;/h1&gt;&lt;p&gt;CSS布局基础。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="CSS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/CSS/"/>
    
      <category term="BFC" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/CSS/BFC/"/>
    
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="CSS" scheme="http://yoursite.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>布局</title>
    <link href="http://yoursite.com/2020/06/16/cssLayout/"/>
    <id>http://yoursite.com/2020/06/16/cssLayout/</id>
    <published>2020-06-16T10:18:00.000Z</published>
    <updated>2020-06-27T13:33:31.569Z</updated>
    
    <content type="html"><![CDATA[<h1 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h1><p>梳理布局大致的几种方式。<a id="more"></a></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ol><li>正常流 布局。</li><li><code>display</code> 属性。</li><li>定位（position）。</li><li>浮动（float/BFC）。</li><li>弹性盒子（<code>display: flex</code>）。</li><li>网格（<code>display: gird</code>）。</li><li>CSS表格布局（<code>display: table</code>）。</li><li>多列布局。</li></ol><h2 id="正常流"><a href="#正常流" class="headerlink" title="正常流"></a>正常流</h2><p><code>position：static; diplay: block/inline-block/inline;</code></p><blockquote><p>所有的布局都是在正常流的基础上改动的，<strong>我们对布局进行改动时，应该与之协同，而不是与之对抗</strong>。</p></blockquote><p>涉及知识点：</p><ol><li>默认的块级元素、行内元素。</li><li>display、position基本属性特点（top，margin-top）。</li><li>盒模型、怪异盒模型。</li><li>FC（<a href="https://f-lancer.github.io/2020/06/16/cssBFC/#more" target="_blank" rel="noopener">BFC</a>…）。</li></ol><h2 id="定位"><a href="#定位" class="headerlink" title="定位"></a><a href="https://f-lancer.github.io/2019/03/28/position/" target="_blank" rel="noopener">定位</a></h2><p><code>position: ... ;</code></p><blockquote><p>易混淆</p></blockquote><p>涉及知识点：</p><ol><li><code>relative</code>、<code>absolute</code>：<code>top</code>、<code>margin-top</code>。</li><li><code>position: sticky</code>。</li><li>定位上下文。</li><li>绝对定位中的 <code>z-index</code>。</li><li>FC（<a href="https://f-lancer.github.io/2020/06/16/cssBFC/#more" target="_blank" rel="noopener">BFC</a>）。</li></ol><h2 id="浮动"><a href="#浮动" class="headerlink" title="浮动"></a><a href="https://f-lancer.github.io/2019/03/28/cssFloat/#more" target="_blank" rel="noopener">浮动</a></h2><p><code>float:right/left;</code></p><blockquote><p>注意高度塌陷。</p></blockquote><p>涉及知识点：</p><ol><li>经典布局（双飞翼，皇冠）。</li><li>清除浮动的场景和几种方式（<code>clear:both</code>）。</li><li>利用BFC清除浮动。</li></ol><h2 id="弹性盒子"><a href="#弹性盒子" class="headerlink" title="弹性盒子"></a>弹性盒子</h2><p><code>display: flex;</code></p><blockquote><p>行内弹性盒子：display：inline-flex。</p></blockquote><p>涉及知识点：</p><ol><li><code>flex-direction</code>，指定主轴方向。<ul><li><code>row-reverse</code>和 <code>column-reverse</code>值反向排列 flex 项目。</li></ul></li><li><code>flex-wrap</code> ，换行。</li><li><code>flex-flow</code> ，是（1和2）的缩写。</li><li><code>flex: 200px</code>，每个项宽度为200px。（可以指定flex项的动态尺寸）<ul><li>可以写三个属性（flex-grow、flex-shrink、flex-basis）</li></ul></li><li>水平垂直对齐。<ul><li><code>align-item:center</code>，决定在交叉轴（纵轴）上的位置。（垂直居中）<ul><li><code>align-self</code>：属性可以覆盖 <code>align-item</code>。</li></ul></li><li><code>justify-content:center</code>，决定在（主轴）横轴上的位置。（水平居中）<ul><li>常用值 <code>space-around</code> / <code>space-between</code>。</li></ul></li></ul></li><li>排序 <code>order</code> （！！！）</li><li>嵌套</li></ol><h2 id="网格布局"><a href="#网格布局" class="headerlink" title="网格布局"></a>网格布局</h2><p><code>display:grid</code></p><blockquote><p>在此之前，我们使用的是 flex 或者三方（bootstrap等UI框架）来实现网格的。</p></blockquote><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Grid_Layout" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Grid_Layout</a></p></blockquote><p>涉及知识点：</p><ol><li><code>grid-gap</code> 网格间隔。</li><li><code>grid-template-columns</code>属性。</li><li><code>repeat()</code> 函数。</li><li><code>fr</code> 单位。</li></ol><p>网格实现居中小示例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.father</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: aqua;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(4,1fr); <span class="comment">/* 四行四列 */</span></span><br><span class="line">    <span class="attribute">grid-template-rows</span>: <span class="built_in">repeat</span>(4,1fr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.son</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: aquamarine;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 缩写：grid-area:2/2/span2/span2; */</span></span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">2</span>/span <span class="number">2</span>;    <span class="comment">/* 第二列开始占两列 */</span>   </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">2</span>/span <span class="number">2</span>;       <span class="comment">/* 第二列开始占两列 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;布局&quot;&gt;&lt;a href=&quot;#布局&quot; class=&quot;headerlink&quot; title=&quot;布局&quot;&gt;&lt;/a&gt;布局&lt;/h1&gt;&lt;p&gt;梳理布局大致的几种方式。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="CSS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/CSS/"/>
    
      <category term="布局" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/CSS/%E5%B8%83%E5%B1%80/"/>
    
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="CSS" scheme="http://yoursite.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>WebSockets</title>
    <link href="http://yoursite.com/2020/06/12/Http_WebSockets/"/>
    <id>http://yoursite.com/2020/06/12/Http_WebSockets/</id>
    <published>2020-06-12T14:23:00.000Z</published>
    <updated>2020-06-27T16:42:37.639Z</updated>
    
    <content type="html"><![CDATA[<h1 id="双向通信"><a href="#双向通信" class="headerlink" title="双向通信"></a>双向通信</h1><ol><li>建立在 TCP 协议之上。</li><li>数据格式轻量，性能开销小，通信高效。</li><li>可以发送二进制数据。</li><li>没有同源限制，可以与任意服务器通信。</li><li>协议标示符 ws 加密为 wss。<a id="more"></a></li></ol><h1 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">"wss://echo.websocket.org"</span>);</span><br><span class="line"></span><br><span class="line">ws.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Connection open ..."</span>); </span><br><span class="line">  ws.send(<span class="string">"Hello WebSockets!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log( <span class="string">"Received Message: "</span> + evt.data);</span><br><span class="line">  ws.close();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ws.onclose = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Connection closed."</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><p>webSocket 对象提供了用于创建和管理 WebSocket 连接，以及相关的API。</p><ol><li><code>WebSocket.readyState</code>：返回实例对象的当前状态。CONNECTING/OPEN/CLOSING/CLOSED。</li><li><code>WebSocket.onopen</code>：用于指定连接成功后的回调函数。指定多个使用 <code>addEventListener</code>方法。</li><li><code>WebSocket.onclose</code>：用于指定连接关闭后的回调函数。</li><li><code>WebSocket.onmessage</code>：用于指定收到服务器数据后的回调函数。</li><li><code>WebSocket.send</code>：用于向服务器发送数据。</li><li><code>bufferedAmount</code>：表示还有多少字节的二进制数据没有发送出去，可以用来判断发送是否结束。</li><li><code>webSocket.onerror</code>：用于指定报错时的回调函数。</li></ol><h1 id="其它通讯对比"><a href="#其它通讯对比" class="headerlink" title="其它通讯对比"></a>其它通讯对比</h1><h2 id="轮询（短轮询）"><a href="#轮询（短轮询）" class="headerlink" title="轮询（短轮询）"></a>轮询（短轮询）</h2><p>原理：请求设置定时器，每隔一段时间向浏览器发送http请求。</p><p>考验性能，数量级比较大的情况下，基于轮询对服务器的考验较大。</p><h2 id="长轮询（comet）"><a href="#长轮询（comet）" class="headerlink" title="长轮询（comet）"></a>长轮询（comet）</h2><p>原理：Ajax 实现，当服务器收到客户端的请求，会将资源挂起，判断服务器端数据是否更新，如果没有更新则达到一定时间限制返回。客户端处理数据之后再次发起请求，重新建立连接。</p><p>连接挂起也会占用资源。</p><h2 id="长连接（SSE）"><a href="#长连接（SSE）" class="headerlink" title="长连接（SSE）"></a>长连接（SSE）</h2><p>Server-Sent Events。它可以允许服务端推送数据到客户端。服务端数据更新可以马上发送到客户端。</p><p>ajax实现长连接：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> <span class="title">longPolling</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: <span class="string">"$&#123;pageContext.request.contextPath&#125;/communication/user/ajax.mvc"</span>,</span><br><span class="line">            data: &#123;<span class="string">"timed"</span>: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;,</span><br><span class="line">            dataType: <span class="string">"text"</span>,</span><br><span class="line">            timeout: <span class="number">5000</span>,</span><br><span class="line">            error: <span class="function"><span class="keyword">function</span> (<span class="params">XMLHttpRequest, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// ... 打印错误信息</span></span><br><span class="line">                <span class="keyword">if</span> (textStatus == <span class="string">"timeout"</span>) &#123; <span class="comment">// 请求超时</span></span><br><span class="line">                     longPolling(); <span class="comment">// 递归调用</span></span><br><span class="line">                 <span class="comment">// 其他错误，如网络错误等</span></span><br><span class="line">                 &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                     longPolling();</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;,</span><br><span class="line">             success: <span class="function"><span class="keyword">function</span> (<span class="params">data, textStatus</span>) </span>&#123;</span><br><span class="line">                  <span class="comment">//... 操作 data</span></span><br><span class="line">                  <span class="keyword">if</span> (textStatus == <span class="string">"success"</span>) &#123; <span class="comment">// 请求成功</span></span><br><span class="line">                      longPolling();</span><br><span class="line">                  &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125;)();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h1><p>从兼容性角度考虑：</p><blockquote><p>短轮询 &gt; 长轮询 &gt; 长连接SSE &gt; WebSocket。</p></blockquote><p>从性能方面考虑：</p><blockquote><p>WebSocket &gt; 长连接SSE &gt; 长轮询 &gt; 短轮询。</p></blockquote><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://www.ruanyifeng.com/blog/2017/05/websocket.html" target="_blank" rel="noopener">websocket基础</a></p><p><a href="https://juejin.im/entry/59e08d2e6fb9a04514630e8b" target="_blank" rel="noopener">通讯对比</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;双向通信&quot;&gt;&lt;a href=&quot;#双向通信&quot; class=&quot;headerlink&quot; title=&quot;双向通信&quot;&gt;&lt;/a&gt;双向通信&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;建立在 TCP 协议之上。&lt;/li&gt;
&lt;li&gt;数据格式轻量，性能开销小，通信高效。&lt;/li&gt;
&lt;li&gt;可以发送二进制数据。&lt;/li&gt;
&lt;li&gt;没有同源限制，可以与任意服务器通信。&lt;/li&gt;
&lt;li&gt;协议标示符 ws 加密为 wss。
    
    </summary>
    
      <category term="前端通信" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1/"/>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="WebSocket" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1/%E5%89%8D%E7%AB%AF/WebSocket/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="前端通信" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1/"/>
    
  </entry>
  
  <entry>
    <title>java 基础</title>
    <link href="http://yoursite.com/2020/05/05/java/"/>
    <id>http://yoursite.com/2020/05/05/java/</id>
    <published>2020-05-05T15:15:00.000Z</published>
    <updated>2020-05-05T16:25:43.906Z</updated>
    
    <content type="html"><![CDATA[<h1 id="计算机基础"><a href="#计算机基础" class="headerlink" title="计算机基础"></a>计算机基础</h1><p>最近也在看TS，顺便看一下后端语言，康康和JS的区别，发现较大的web项目都是用Java写的，就来了解一下。了解了强类型才能深刻了解弱类型，了解重载，才囊知道非重载，一点一点连成片…..<a id="more"></a></p><h2 id="二进制"><a href="#二进制" class="headerlink" title="二进制"></a>二进制</h2><p>二进制：逢二进一，每一个0或1叫bit（<strong>位</strong>）。</p><p>十进制转二进制：除以2求余。</p><p><img src="C:\Users\Zezhong\AppData\Roaming\Typora\typora-user-images\1588489418294.png" alt="1588489418294"></p><h2 id="字节"><a href="#字节" class="headerlink" title="字节"></a>字节</h2><p>字节是数据存储单元的最小单位，八位（bit）一个字节（Byte）</p><blockquote><p>1 Byte = 8 bit | 1 KB = 1024 Byte | 1 MB = 1024 KB | 1GB = 1024 MB | 1TB = 1024 GB  | 1PB = 1024 TB  | 1EB = 1024 PB  | 1ZB = 1024 EB </p></blockquote><h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p>windows 命令提示符。</p><ol><li>快捷键：<code>WIN +R</code>。</li><li>切换盘符：<code>cd</code>/<code>Tab</code>。</li><li><code>..</code>返回上级文件夹。</li><li><code>dir</code> 列表。</li><li><code>cls</code>清屏。</li><li><code>exit</code>退出。</li></ol><h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><p>Java Virtual Machine：java虚拟机。</p><p>Java 运行在 <code>JVM</code> 上，<code>JVM</code> 的不同版本运行在各个系统上，即由各个系统的不同版本的虚拟机来实现跨平台。</p><h2 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h2><p>开发工具包</p><h2 id="配置环境-变量"><a href="#配置环境-变量" class="headerlink" title="配置环境 变量"></a>配置环境 变量</h2><h1 id="编译运行"><a href="#编译运行" class="headerlink" title="编译运行"></a>编译运行</h1><p>java三步骤：编写、编译、（JVM）运行。</p><p><img src="C:\Users\Zezhong\AppData\Roaming\Typora\typora-user-images\1588493293852.png" alt="1588493293852"></p><p>javac.exe：编译器。 源代码经过javac.exe编译后生成<code>.class</code>文件。</p><p>java.exe：解释器。运行时不带 后缀名。</p><blockquote><p>注意：文件名要和类名保持一致。</p></blockquote><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单行注释</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   多行注释</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="helloworld"><a href="#helloworld" class="headerlink" title="helloworld"></a>helloworld</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一行pubilc class 定义一个类，类是Java当中所有源代码的基本组织单位</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123; <span class="comment">// 类名要和文件名保持在一致。</span></span><br><span class="line">    <span class="comment">// 第二行固定写法，代表main方法，是程序执行的起点。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 语句内容</span></span><br><span class="line">        System.out.printIn(<span class="string">"Hello,World!!!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><p>特征：全小写、编辑器特殊颜色。</p><h2 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h2><p>定义：自定义的内容就是标识符。</p><p>命名规则：</p><ol><li>字母（区分大小写）、数字、<code>$</code>、<code>_</code>。</li><li>不能以数字开头。</li><li>不能是关键字。</li></ol><p>命名规范：</p><ol><li>类名规范：首字母大写（大驼峰）。</li><li>变量及方法名规范：首字母小写（小驼峰）。</li></ol><h1 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h1><p>定义：在 java 程序运行的期间固定不变的数据。</p><p>分类：</p><ol><li>字符串常量：双引号引起来的部分。</li><li>整数常量。</li><li>浮点数常量。</li><li>字符常量：单引号引起来的<strong>单个</strong>（有且仅有一个）字符。</li><li>布尔常量。</li><li>空常量。（不能直接打印输出，报错）</li></ol><h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><p>四类八种。</p><p>整数型：<strong>byte</strong>（1Byte） <strong>short</strong>（2Byte） <strong>int</strong>（4Byte） <strong>long</strong>（8Byte）</p><p>浮点型：float（4Byte） double（8Byte 更精确）</p><p>字符型：char（2Byte）</p><p>布尔型：boolen （1Byte）</p><blockquote><ol><li>字符串不是基本类型。</li><li>浮点数是近似值。</li><li>数据范围与字节数不一定相关</li><li>浮点数默认类型是double，使用float类型要加一个 F 后缀。</li><li>整数默认是int类型，使用long类型，加 L 后缀。</li></ol></blockquote><h2 id="引用数据类型"><a href="#引用数据类型" class="headerlink" title="引用数据类型"></a>引用数据类型</h2><p>类、数组、接口。</p><h2 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h2><h3 id="自动类型转换"><a href="#自动类型转换" class="headerlink" title="自动类型转换"></a>自动类型转换</h3><p>特点：</p><ol><li><p>代码不需要处理，自动完成。</p></li><li><p>需要符合数据范围从小到大的规则（和字节数不一定相关）。</p><blockquote><p>int —&gt;long —&gt; float—&gt;double </p></blockquote></li></ol><h3 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h3><p>特点：</p><ol><li><p>无法自动完成。</p></li><li><p>格式：范围小的类型 变量名 = （范围小的类型）大范围数据;</p><p><code>int num = (int) 100L</code></p></li><li><p>逻辑上 范围大 转小会发生数据溢出。</p></li></ol><h3 id="编码表"><a href="#编码表" class="headerlink" title="编码表"></a>编码表</h3><p>Ascll编码表：0~127</p><p>American Standard Code for Information Interchange：美国信息交换标准代码。</p><p>Unicode码表：万国码。从128开始添加了其他字符。</p><blockquote><p>打印字符：’a’+ 0 可以查看对应码。</p><p>‘0’—‘48’    ‘A’—‘65’    ‘a’—‘97’</p></blockquote><h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><p>定义：内容可以发生改变的量。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据类型 变量名称; 创建变量。</span></span><br><span class="line"><span class="comment">// 变量名称 = 数据值; 赋值。</span></span><br><span class="line"><span class="comment">// 数据类型 变量名称 = 数据值; 缩写。</span></span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>变量名不能重复。</li><li>FL后缀不能省。</li><li>数值不能超过范围。</li><li>先声明后使用。</li><li>不能超出作用域<code>{}</code>。</li></ol><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="四则运算"><a href="#四则运算" class="headerlink" title="四则运算"></a>四则运算</h2><p>加+减-乘*除/余%：</p><ol><li><p>整数的除/，只看商，不看余。</p></li><li><p>先转换后计算。</p><p><code>int + double：double + double = double</code></p></li><li><p>加号<code>+</code>，char类型先转换，后相加，string类型（首字母大写，非关键字）拼接。</p></li><li><p>任何类型和字符串连接都转换为字符串。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">"hello"</span>;</span><br><span class="line">str + <span class="number">20</span> + <span class="number">30</span> = <span class="string">"hello2030"</span></span><br></pre></td></tr></table></figure></li></ol><p>自加（++）自减（–）</p><ol><li>运算符在前，前加加，先加后使用。否则相反。</li><li>常量不能参与运算。<code>30++</code>。</li></ol><p>赋值运算符：<code>+=</code>、<code>-=</code>、<code>*=</code>、<code>/=</code>、<code>%=</code></p><ol><li>同样常量不能参与运算。</li><li>隐含强制类型转换。</li></ol><p>比较运算符，结果为布尔值。</p><ol><li>不能连写，<code>1&lt;x&lt;3</code> 报错，<code>1 &lt; x &amp;&amp; x &lt; 3</code>。</li></ol><p>逻辑运算符：根据短路原理理解。</p><p>三元运算符：指需要三个数据才能进行操作的运算符。</p><ol><li>三元运算符的结果必须被赋值/被使用。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据类型 变量名称 = 条件判断 ? 表达式A : 表达式B</span></span><br></pre></td></tr></table></figure><h1 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">修饰符 返回值类型 方法名(参数类型 参数名称,...) &#123;</span></span><br><span class="line"><span class="comment">    方法体 代码;</span></span><br><span class="line"><span class="comment">    return 返回值;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">funName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.printIn(<span class="string">"播种"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法调用</span></span><br><span class="line">funName();</span><br></pre></td></tr></table></figure><ol><li>先后顺序无所谓。</li><li>方法的定义在类中，不能在方法中定义方法产生嵌套包含的关系。</li><li>返回值类型为  void 无返回值不能进行单独调用和赋值调用。</li></ol><h2 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h2><p>定义：多个方法的名称一样，但是参数类型不一样。</p><p>在 <code>JavaScript</code> 中是没有重载的。</p><p><code>java</code> 会自动去寻找参数相同的方法执行，而在 <code>javaScript</code> 中，名称相同的方法，后者会覆盖前者的功能。</p><p>注意：</p><p>涉及因素：参数的个数、参数类型不同、参数多类型顺序不同。</p><p>不涉及的因素：参数名称、方法的返回值类型无关。</p><h1 id="JDK9"><a href="#JDK9" class="headerlink" title="JDK9"></a><code>JDK9</code></h1><p>是最后一个大版本的更新。新特性：</p><ol><li><p>JShell脚本工具。</p></li><li><p><code>javac</code> 数值未超过变量类型范围，编译器会自动补上强转，超过则报错。右侧为变量则不进行强转。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">short</span> a = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">short</span> b = <span class="number">9</span>;</span><br><span class="line"><span class="keyword">short</span> result = <span class="number">8</span> + <span class="number">9</span>; <span class="comment">// int 转 short 不报错</span></span><br><span class="line"><span class="keyword">short</span> result = <span class="number">8</span> + a + <span class="number">9</span>; <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h1><p>顺序结构、判断结构、选择结构、循环结构。</p><h2 id="选择结构"><a href="#选择结构" class="headerlink" title="选择结构"></a>选择结构</h2><p><code>switch</code> 语句注意事项：</p><ol><li><p><code>case</code>语句之后的数值不能重复。</p></li><li><p><code>switch</code> 后面的数据类型只能是：（JavaScript可以是任何类型）</p><p>（1）基本数据类型：byte/short/char/int。</p><p>（2）引用数据类型：String字符串、enum枚举。</p></li><li><p>顺序随意，break 语句可省略（省略后会直到遇到break，跳出）。</p></li></ol><h2 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h2><p>for 循环：初始化语句、条件判断、循环体、步进语句。</p><p>while 循环：<code>直到</code>逻辑。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">初始化语句;</span></span><br><span class="line"><span class="comment">while (条件判断) &#123;</span></span><br><span class="line"><span class="comment">    循环体;</span></span><br><span class="line"><span class="comment">    步进语句;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>do-while循环：先循环，后判断。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">初始化语句;</span></span><br><span class="line"><span class="comment">do &#123;</span></span><br><span class="line"><span class="comment">    循环体;</span></span><br><span class="line"><span class="comment">    步进语句;</span></span><br><span class="line"><span class="comment">&#125; while (条件判断)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><blockquote><p>区别：do-while至少循环一次，初始化语句for循环只能在语句内部。</p></blockquote><h3 id="break-continue"><a href="#break-continue" class="headerlink" title="break/continue"></a>break/continue</h3><p><code>break</code>：打断循环。</p><p><code>continue</code>：跳出本次循环进入下次循环。</p><blockquote><p>死循环之后不能有语句，会报错。</p></blockquote><h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>引用数据类型。</p><ol><li>数组当中的多个数据，类型必须统一。（JavaScript 数组中的每一项可以是任意类型。）</li><li>数组的长度在程序运行期间不可改变。（JavaScript 数组的长度是动态的。）</li></ol><h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><ol><li><p>动态初始化（指定长度）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组类型[] 数组名称 = new 数据类型[数组长度];</span></span><br><span class="line"><span class="keyword">int</span>[] array1 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">300</span>];</span><br><span class="line"></span><br><span class="line">String[] array2 = <span class="keyword">new</span> String[<span class="number">90</span>];</span><br></pre></td></tr></table></figure></li><li><p>静态初始化（指定内容）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据类型[] 数组名称 = new 数据类型[] &#123; 元素1, 元素2, ... &#125;;</span></span><br><span class="line"><span class="keyword">int</span>[] array1 = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span> &#125;;</span><br><span class="line">String[] array2 = <span class="keyword">new</span> String[] &#123; <span class="string">"Hello"</span>, <span class="string">"World"</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拆</span></span><br><span class="line"><span class="keyword">int</span>[] array1;</span><br><span class="line">array1 = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span> &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写 简写模式不支持拆分</span></span><br><span class="line"><span class="keyword">int</span>[] array3 = &#123; <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span> &#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><blockquote><p>直接打印数组名称，得到的是数组对应的，内存地址哈希值。例：[I@75412c2f  数组 int 十六进制数字 </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrayName[index]</span></span><br><span class="line">arrayName[<span class="number">4</span>];</span><br></pre></td></tr></table></figure><blockquote><p>动态初始化使用，未赋值拥有默认值。</p><p>整数 0  、浮点数0.0、  字符类型 \u0000、  布尔 false、 引用类型 null 。</p></blockquote><h2 id="内存划分"><a href="#内存划分" class="headerlink" title="内存划分"></a>内存划分</h2><ol><li><p>栈（Stack）：存放的都是方法中的局部变量（方法的参数或内部的变量）。</p><p>作用域：一旦超出作用域，立刻从栈内存中消失。</p></li><li><p>堆（Heap）：凡是new出来的东西，都在堆当中。其中的地址值是16进制。且都有默认值。</p></li><li><p>方法区（Method Area）：存储 <code>.class</code> 的相关信息，包含方法的信息。（方法运行在栈中）。</p></li><li><p>本地方法栈（Native Method Stack）：与操作系统相关。</p></li><li><p>寄存器（pc Register）：与 CPU相关。</p></li></ol><h1 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h1><h2 id="Project"><a href="#Project" class="headerlink" title="Project"></a>Project</h2><p><code>project &gt; module &gt; Package &gt; File</code></p><h2 id="常用快捷键"><a href="#常用快捷键" class="headerlink" title="常用快捷键"></a>常用快捷键</h2><p>Alt+Enter 导入包，自动修正代码。</p><p>Ctrl+Y 删除光标所在行。</p><p>Ctrl+D 复制光标所在行的内容，插入到光标位置下面。</p><p>Ctrl+Alt+L 格式化代码。</p><p>Ctrl+Shift+/ 多行注释。</p><p>Alt + Insert 自动生成代码。</p><p>Alt+Shift + 上下箭头移动当前行。</p><p>Shift + F6 同时选中用到的单词</p><p><code>5fori</code>    for循环五次。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;计算机基础&quot;&gt;&lt;a href=&quot;#计算机基础&quot; class=&quot;headerlink&quot; title=&quot;计算机基础&quot;&gt;&lt;/a&gt;计算机基础&lt;/h1&gt;&lt;p&gt;最近也在看TS，顺便看一下后端语言，康康和JS的区别，发现较大的web项目都是用Java写的，就来了解一下。了解了强类型才能深刻了解弱类型，了解重载，才囊知道非重载，一点一点连成片…..
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="后端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="JAVA" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/JAVA/"/>
    
    
      <category term="后端技术" scheme="http://yoursite.com/tags/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="技术" scheme="http://yoursite.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="JAVA" scheme="http://yoursite.com/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>浏览器渲染机制</title>
    <link href="http://yoursite.com/2020/04/09/Web_BrowserRenderingMechanism/"/>
    <id>http://yoursite.com/2020/04/09/Web_BrowserRenderingMechanism/</id>
    <published>2020-04-09T07:21:00.000Z</published>
    <updated>2020-04-09T07:21:43.837Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在从浏览器接收到请求后，开始进行浏览器渲染。本文深入浏览器内核的主进程涉及的两个关键引擎，<strong>渲染引擎</strong>，<strong>JS引擎</strong>来说明，从而可以更好的理解这个环节上的性能优化。</p><ol><li>渲染引擎：深入理解浏览器的渲染机制也有助于我们理解三大框架的生命周期执行时机。</li><li>JS引擎：对DOM树的影响、对CSSOM的影响、EventLoop。</li><li>服务端渲染：意义及优缺点。<a id="more"></a></li></ol><h1 id="渲染引擎"><a href="#渲染引擎" class="headerlink" title="渲染引擎"></a>渲染引擎</h1><h2 id="渲染概述"><a href="#渲染概述" class="headerlink" title="渲染概述"></a>渲染概述</h2><p>从请求到文件到构建渲染树再到调用系统API[GUI]进行渲染进行的一系列过程。</p><h3 id="webkit流程图"><a href="#webkit流程图" class="headerlink" title="webkit流程图"></a>webkit流程图</h3><p><img src="https://user-gold-cdn.xitu.io/2018/9/3/1659db14e773f9cc?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="webkit渲染过程"></p><blockquote><p>parser：解析器、sheets：篇/片、render：渲染、attachment：附件、附著、layout：布局。</p></blockquote><h3 id="流程图解析"><a href="#流程图解析" class="headerlink" title="流程图解析"></a>流程图解析</h3><ol><li>构建DOM树：请求、解析。</li><li>构建CSSOM树：请求、解析。</li><li>构建渲染树：Attachment合并，但<code>diplay: none</code> 将不渲染到渲染树。</li><li>布局渲染树：layout过程（回流，自动重排），计算定位、坐标、大小、转换行、position、overflow、z-index属性等。</li><li>绘制render树：（转换为像素）绘制顺序—背景、浮动、content、padding、border…。</li></ol><h4 id="Layout过程"><a href="#Layout过程" class="headerlink" title="Layout过程"></a>Layout过程</h4><p><code>JS</code> 动态修改了DOM属性或者CSS属性会导致重新Layout：<strong>repaint（重绘）</strong>、<strong>reflow（重排）</strong>。</p><table><thead><tr><th></th><th>repaint</th><th>reflow</th></tr></thead><tbody><tr><td>触发方式</td><td>不改变定位，宽高，改变了元素的展示方式</td><td>影响了文档的内容、结构或者元素定位</td></tr><tr><td>例</td><td>background-color,border-color,visibility等</td><td>DOM操作（增删改，变换元素顺序）。<br>内容的变化，Form表单中文字的变化。<br>计算改变CSS属性。<br>增加删除样式表。<br>浏览器窗口操作（改变大小、滚动窗口）<br>激活伪类（如：hover状态）</td></tr><tr><td>重新布局</td><td>部分</td><td>绝大部分</td></tr></tbody></table><p>优化过程中尽量不要触发重排（reflow）。</p><blockquote><p>offsetTop/Left/Width/Height、scrollTop/Left/Width/Height、clientTop/Left/Width/Height、IE中的getComputedStyle()，或currentStyle，等。</p></blockquote><h3 id="从上到下解析流程"><a href="#从上到下解析流程" class="headerlink" title="从上到下解析流程"></a>从上到下解析流程</h3><ol><li>从上到下解析HTML模板。</li><li>遇到<code>.css</code>。（在另一个进程中进行）<ul><li>不会阻塞DOM解析，阻塞渲染HTML，接着请求<code>.css</code>文件。</li><li>解析<code>.css</code>文件。</li></ul></li><li>遇到 DOM节点。<ul><li>解析DOM</li></ul></li><li>遇到<code>img</code>请求<ul><li>发起请求，继续渲染下面代码。</li><li>请求成功，影响了页面排布，重新渲染这部分代码。</li></ul></li><li>遇到<code>.js</code>等脚本文件<ul><li>停止所有加载和解析。</li><li>请求和执行脚本。</li></ul></li></ol><blockquote><p>css </p><ol><li>不会阻塞DOM树解析。</li><li>但是会阻塞DOM树渲染。</li><li>css加载会阻塞后面js语句的执行。</li></ol></blockquote><h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><ol><li>使用CDN，会根据网络状况加载最近的文件。</li><li>合并及压缩CSS文件，减少请求。</li><li>简化和优化CSS选择器。</li><li>使用精灵图，减少请求。</li><li>合理使用缓存，减少请求。</li><li>CSS在前，JS文件在后。</li></ol><h1 id="JS引擎"><a href="#JS引擎" class="headerlink" title="JS引擎"></a>JS引擎</h1><h2 id="触发JS引擎"><a href="#触发JS引擎" class="headerlink" title="触发JS引擎"></a>触发JS引擎</h2><p>触发js引擎及对渲染引擎的影响：</p><ol><li>JS引擎触发时机：在构建DOM时，HTML解析器若遇到了JavaScript，那么它会暂停构建DOM，将控制权移交给JavaScript引擎，等JavaScript引擎运行完毕，浏览器再从中断的地方恢复DOM构建。</li><li>JS操作DOM元素带来的影响：<ul><li>因为 DOM 是属于渲染引擎中的东西，而 JS 是在 JS 引擎中运行的。当我们通过 JS 操作 DOM 的时候，其实这个操作涉及到了两个线程之间的通信，那么势必会带来一些性能上的损耗。</li><li>通常情况下DOM和CSSOM是并行构建的，但是当浏览器遇到一个script标签时，DOM构建将暂停，直至脚本完成执行。但由于JavaScript可以修改CSSOM，所以需要等CSSOM构建完毕后再执行JS。</li><li>操作 DOM 可能还会带来重绘回流的情况，所以也就导致了性能上的问题。</li></ul></li><li>使用<code>defer</code>和<code>async</code>异步加载JS。</li></ol><h2 id="EventLoop"><a href="#EventLoop" class="headerlink" title="EventLoop"></a>EventLoop</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>JavaScript有一个基于<strong>事件循环</strong>的并发模型，事件循环负责执行代码、收集和处理事件以及执行队列中的子任务。</p><blockquote><p>此处指的是浏览器引擎中的EventLoop，node中的EventLoop是另一种机制。</p></blockquote><h3 id="引入EventLoop"><a href="#引入EventLoop" class="headerlink" title="引入EventLoop"></a>引入EventLoop</h3><p><img src="https://upload-images.jianshu.io/upload_images/12890819-bce824083839ea30?imageMogr2/auto-orient/strip|imageView2/2/w/640/format/webp" alt="解析"></p><ol><li>进程是正在运行着的程序，<strong>一个进程由一个或多个线程组成，线程是一个进程中代码的不同执行路线</strong>。</li><li>为了避免复杂性，发明JS语言时使其是单线程的。即，只有一个<strong>主线程</strong>（虽然可以创建多个子线程，但是受主线程控制）。</li><li>单线程意味着任务都必须排队进行，而Js引擎<strong>异步执行Js代码</strong>又不会等待，这是因为有了<strong>消息队列</strong>和<strong>事件循环</strong>。</li></ol><blockquote><p>在浏览器中，每打开一个标签页就打开了一个进程。一个进程中又包含多个线程，比如：GUI 渲染线程、JavaScript引擎线程、定时触发器线程、定时触发器线程、异步http请求线程。</p></blockquote><h3 id="EventLoop图解"><a href="#EventLoop图解" class="headerlink" title="EventLoop图解"></a>EventLoop图解</h3><p><img src="https://upload-images.jianshu.io/upload_images/12890819-91dd61d0b5acf77b?imageMogr2/auto-orient/strip|imageView2/2/w/636/format/webp" alt="事件循环"></p><h4 id="执行栈（主线程）"><a href="#执行栈（主线程）" class="headerlink" title="执行栈（主线程）"></a>执行栈（主线程）</h4><ol><li>一个存储<strong>函数调用</strong>的栈结构，遵循先进后出的原则，形成了执行栈。</li><li>栈的大小是有限的。比如，发生死循环栈溢出时会报错：<code>Maximum call stack exceeded</code>。</li><li>执行JS文件时，遇到同步任务，即普通调用函数就压入栈中。</li><li>当执行栈中的任务完成后，系统会读取<strong>任务（消息）队列</strong>，并且把它压入执行栈执行。</li></ol><h4 id="任务（消息）队列"><a href="#任务（消息）队列" class="headerlink" title="任务（消息）队列"></a>任务（消息）队列</h4><p>异步的运行结果会放入任务队列里，当主线程（执行栈）空了，就会读取任务队列里的异步结果。</p><blockquote><p>消息队列中的消息Message就是注册异步任务时添加的回调函数。</p></blockquote><h3 id="宏-微任务"><a href="#宏-微任务" class="headerlink" title="宏/微任务"></a>宏/微任务</h3><p><img src="https://upload-images.jianshu.io/upload_images/12890819-f6d165fb8a5e8d66?imageMogr2/auto-orient/strip|imageView2/2/w/640/format/webp" alt="任务队列"></p><p>任务（消息）队列就是放着注册异步任务时添加的回调函数的队列，而根据不同的任务又分为两种<strong>宏任务队列</strong>和<strong>微任务队列</strong>。</p><ol><li>macro-task （宏任务队列）：比如script（整体代码）、setTimeout、setInterval、 I/O 操作、UI 渲染等。</li><li>micro-task（微任务队列）： 比如new Promise().then(回调)、MutationObserver(html5新特性) 等。</li></ol><h4 id="一次eventloop执行机制："><a href="#一次eventloop执行机制：" class="headerlink" title="一次eventloop执行机制："></a>一次eventloop执行机制：</h4><ol><li>检查上一个micro-task队列是否为空，然后执行一个tasks（macro-task）。</li><li>继而执行清空本次所有的micro-task。</li><li>本次eventloop中的micro-task队列清空后，再从 1 开始执行。</li></ol><h4 id="影响"><a href="#影响" class="headerlink" title="影响"></a>影响</h4><ol><li>渲染影响：执行完microtask队列里的任务，有可能会渲染更新。如果在一帧（一次）内多次发生DOM的变动，浏览器不会立即响应，而是会积攒变动以最高60HZ的频率更新视图。</li><li>定时器问题：定时器到达预定时间后会将回调函数放到任务队列里，但是需要等执行栈里的代码执行完毕才会开始读取任务队列，因此一般会把定时任务放在代码的最后，为了可以更加准确的读取定时任务的回调函数。</li></ol><h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><p>对象被分配在堆中。（存储形式，不涉及该处知识点）</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><ol><li>单次循环，宏/微任务机制。（基础）</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">Promise</span>.resolve(<span class="number">3</span>).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line"><span class="comment">// 1,3,2</span></span><br></pre></td></tr></table></figure><ol start="2"><li>宏/微任务，先检查上一个微任务是否清空。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'script start'</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;                 <span class="comment">// 第二轮宏任务</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;     <span class="comment">// 第一轮微任务</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise1'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise2'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script end'</span>);</span><br><span class="line"><span class="comment">// 1.script start 2.script end 3.promise1 4.promise2 5.setTimeout</span></span><br></pre></td></tr></table></figure><ol start="3"><li>加入构造函数</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.time(<span class="string">"start"</span>); </span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="built_in">console</span>.log(<span class="number">2</span>)&#125;,<span class="number">10</span>); <span class="comment">// 第二轮宏任务 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>)=&gt;</span>&#123;       <span class="comment">// 同步代码，第一轮宏任务</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">    resolve();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;                  <span class="comment">// 第一轮微任务</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">"start"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">6</span>);                <span class="comment">// 同步代码，第一轮宏任务</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">8</span>);</span><br><span class="line">requestAnimationFrame(<span class="function"><span class="params">()</span>=&gt;</span><span class="built_in">console</span>.log(<span class="number">9</span>)); <span class="comment">// 第三轮宏任务</span></span><br><span class="line"><span class="comment">// 34685 计时时间 29</span></span><br></pre></td></tr></table></figure><h2 id="优化-1"><a href="#优化-1" class="headerlink" title="优化"></a>优化</h2><ol><li>减少DOM操作。</li><li>将 script 标签放在 body 标签底部。</li><li>合理使用<code>defer</code>和<code>async</code>。</li><li>定时器放在代码底部。</li></ol><h1 id="浏览器查看"><a href="#浏览器查看" class="headerlink" title="浏览器查看"></a>浏览器查看</h1><p>用浏览器 performance 选项录制，可以查看脚本运行，计算布局render树构建，painting所花费的时间。</p><p>其它性能观测待更…</p><h1 id="服务端渲染"><a href="#服务端渲染" class="headerlink" title="服务端渲染"></a>服务端渲染</h1><p>服务端渲染 SSR(server side rendering) ，就是原本在浏览器做的<strong>HTML解析</strong>这个步骤放到了web服务器来做，解析完后直接发给客户端，来作为构建render树的DOM树。</p><blockquote><p><a href="https://f-lancer.github.io/2019/03/27/Node/#more" target="_blank" rel="noopener">node.js篇</a>中有说明服务端渲染的优缺点。点击本链接直接搜索<code>服务端渲染</code>即可。</p></blockquote><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://juejin.im/post/5b88ddca6fb9a019c7717096" target="_blank" rel="noopener">css加载会造成阻塞吗？</a></p><p><a href="https://www.bilibili.com/video/BV1dt411W7Y4?t=1895" target="_blank" rel="noopener">浏览器渲染及js eventloop</a></p><p><a href="https://www.cnblogs.com/qqqiangqiang/p/5757656.html" target="_blank" rel="noopener">渲染优化</a></p><p><a href="https://blog.fundebug.com/2019/01/03/understand-browser-rendering/" target="_blank" rel="noopener">深入浅出渲染机制原理</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop" target="_blank" rel="noopener">MDN—EventLoop</a></p><p><a href="https://www.jianshu.com/p/f478f15c1671" target="_blank" rel="noopener">单线程JS</a></p><p><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="noopener">ryf</a></p><p><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="noopener">宏/微任务</a></p><p><a href="https://www.jianshu.com/p/10b6074d772c" target="_blank" rel="noopener">浅谈SSR</a></p><blockquote><p>与部分作者意见不一致，谨慎参考。</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;在从浏览器接收到请求后，开始进行浏览器渲染。本文深入浏览器内核的主进程涉及的两个关键引擎，&lt;strong&gt;渲染引擎&lt;/strong&gt;，&lt;strong&gt;JS引擎&lt;/strong&gt;来说明，从而可以更好的理解这个环节上的性能优化。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;渲染引擎：深入理解浏览器的渲染机制也有助于我们理解三大框架的生命周期执行时机。&lt;/li&gt;
&lt;li&gt;JS引擎：对DOM树的影响、对CSSOM的影响、EventLoop。&lt;/li&gt;
&lt;li&gt;服务端渲染：意义及优缺点。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="原生JS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="浏览器渲染机制" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6/"/>
    
    
      <category term="原生JS" scheme="http://yoursite.com/tags/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>Linux 基础</title>
    <link href="http://yoursite.com/2020/04/02/Linux/"/>
    <id>http://yoursite.com/2020/04/02/Linux/</id>
    <published>2020-04-02T09:28:00.000Z</published>
    <updated>2020-04-02T09:28:41.187Z</updated>
    
    <content type="html"><![CDATA[<h1 id="操作系统简介"><a href="#操作系统简介" class="headerlink" title="操作系统简介"></a>操作系统简介</h1><blockquote><p>用户 —&gt;应用程序—&gt;操作系统—&gt;计算机硬件</p></blockquote><p>操作系统：系统调用 、终端命令、图形窗口，即可以在操作系统上安装高级语言的环境，用高级语言开发程序。<a id="more"></a></p><h2 id="操作系统常见分类"><a href="#操作系统常见分类" class="headerlink" title="操作系统常见分类"></a>操作系统常见分类</h2><ol><li>桌面操作系统：Windows 系列、macOS、Linux。</li><li>服务器操作系统：Linux、Windows Server。</li><li>嵌入式操作系统：Linux。</li><li>移动设备操作系统：iOS、Android (基于Linux)。</li></ol><h2 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h2><p>定义：虚拟机指<strong>通过软件模拟</strong>的具有完整<strong>硬件</strong>系统功能的、运行在一个完全隔离环境中的完整的计算机系统。</p><p>可以在 <code>VMWare</code> 中安装虚拟机。</p><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="历史及版本"><a href="#历史及版本" class="headerlink" title="历史及版本"></a>历史及版本</h2><blockquote><p>C语言 —&gt;  Unix—&gt;   Linux</p></blockquote><p>内核版本：</p><ol><li>是运行程序和管理硬件设备的核心程序。它提供了裸机与应用程序间的抽象层。</li><li>内核版又分为：稳定版和开发版，两个版本互相关联，互相循环。</li></ol><p>发行版本：</p><ol><li>建立在内核版本之上开发的桌面环境、办公套件、媒体播放器、数据库等应用软件。</li><li>常见的发行版本：<code>Ubuntu</code>/<code>Redhat</code>/<code>Fedora</code>/<code>openSUSE</code> 等 。</li><li>十大 Linux 服务器版 排行榜：<a href="http://os.51cto.com/art/201612/526126.html。" target="_blank" rel="noopener">http://os.51cto.com/art/201612/526126.html。</a></li></ol><h2 id="文件及目录结构"><a href="#文件及目录结构" class="headerlink" title="文件及目录结构"></a>文件及目录结构</h2><p>根目录：<code>/</code></p><p>二级目录：</p><ol><li><code>/bin</code> 可执行二进制文件目录。</li><li><code>/etc</code> 系统配置文件存放的目录。</li><li><code>/home</code> 用户家目录。</li><li><code>/lib</code>、<code>/user</code>等等等等。</li></ol><p>用户目录：home目录下的 <code>admin</code> 用户—&gt;<code>/admin</code></p><p>用户下目录：<code>/Desktop</code>、<code>/Documents</code>、<code>/Download</code>…</p><h1 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h1><p>了解格式，方便查阅。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">command [-options] [parameter]</span><br><span class="line"><span class="meta">#</span> ls    查看文件内容</span><br><span class="line"><span class="meta">#</span> rm main.txt 删除文件</span><br><span class="line"><span class="meta">#</span> rm -r main  删除 main 目录</span><br></pre></td></tr></table></figure><ol><li>command：命令名，相应功能英文单词缩写。</li><li>[-options]：选项，对命令进行控制，可以省略。</li><li>parameter：传给命令的参数。</li></ol><h2 id="查阅命令"><a href="#查阅命令" class="headerlink" title="查阅命令"></a>查阅命令</h2><ol><li><code>--help</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">command --help</span><br><span class="line"><span class="meta">#</span> 显示 command 命令帮助信息</span><br></pre></td></tr></table></figure><ol start="2"><li><code>man</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">man command</span><br><span class="line"><span class="meta">#</span> 查阅 command 命令的使用手册</span><br></pre></td></tr></table></figure><blockquote><p>man 是 manual 的缩写，包含了绝大部分命令的详细使用说明</p></blockquote><p>man 操作键：</p><table><thead><tr><th>操作键</th><th>功能</th></tr></thead><tbody><tr><td>空格键</td><td>显示手册下一屏</td></tr><tr><td>Enter</td><td>滚动到下一行</td></tr><tr><td>b</td><td>回滚下一屏</td></tr><tr><td>f</td><td>回滚前一屏</td></tr><tr><td>q</td><td>退出</td></tr><tr><td>/word</td><td>搜索word字符串</td></tr></tbody></table><h2 id="终端实用技巧"><a href="#终端实用技巧" class="headerlink" title="终端实用技巧"></a>终端实用技巧</h2><ol><li>自动补全 <code>tab</code> 键，如果没有歧义，系统自动补全，如果有再按一下<code>tab</code>，提示可能存在的命令。</li><li>上下光标键 可以切换曾经使用过的命令。</li><li>ctrl + c 退出选择。</li></ol><h2 id="文件目录特点"><a href="#文件目录特点" class="headerlink" title="文件目录特点"></a>文件目录特点</h2><p>Linux 文件或者目录 名称最长可以有 256 个字符。</p><h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ol><li><code>.</code> 代表当前目录。</li><li><code>..</code> 代表上一级目录。</li></ol><h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><ol><li>以 <code>.</code> 开头的文件为隐藏文件，需要用 <code>-a</code> （all）参数才能显示。</li></ol><h1 id="常用命令拓展"><a href="#常用命令拓展" class="headerlink" title="常用命令拓展"></a>常用命令拓展</h1><h2 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h2><table><thead><tr><th>命令</th><th>对应英文</th><th>作用</th></tr></thead><tbody><tr><td>ls</td><td>list</td><td>查看当前文件夹下的内容</td></tr><tr><td>pwd</td><td>print work directory</td><td>查看当前所在文件夹</td></tr><tr><td>cd [目录名]</td><td>change directory</td><td>切换文件夹</td></tr><tr><td>touch [文件名]</td><td>touch</td><td>如果文件名不存在新建文件</td></tr><tr><td>mkdir [目录名]</td><td>make directory</td><td>创建目录</td></tr><tr><td>rm [文件名]</td><td>remove</td><td>删除指定文件名</td></tr><tr><td>clear</td><td>clear</td><td>清屏</td></tr><tr><td>ctrl + shift + =</td><td>略</td><td>放大终端字体</td></tr><tr><td>ctrl + -</td><td>略</td><td>缩小 字体</td></tr></tbody></table><h3 id="ls拓展"><a href="#ls拓展" class="headerlink" title="ls拓展"></a><code>ls</code>拓展</h3><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>list简写，列出当前文件夹下的内容，类似于 DOS 下的 dir 命令。</p><h4 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h4><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-a （all）</td><td>显示指定目录下的所有目录与文件，包括隐藏文件</td></tr><tr><td>-l</td><td>以列表形式显示文件的详细信息</td></tr><tr><td>-h</td><td>配合 -l 以人性化的方式显示文件大小</td></tr></tbody></table><h4 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h4><table><thead><tr><th>通配符</th><th>含义</th></tr></thead><tbody><tr><td>*</td><td>代表任意个数字符</td></tr><tr><td>？</td><td>代表任意一个字符，至少一个</td></tr><tr><td>[]</td><td>表示可以匹配字符组中的任意一个</td></tr><tr><td>[abc]</td><td>匹配 a、b、c中的任意一个</td></tr><tr><td>[a-f]</td><td>匹配从 a 到 f 范围内的任意一个字符</td></tr></tbody></table><p>例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls 1* # 以 1 开头</span><br><span class="line">ls *1 # 以 1 结尾</span><br><span class="line">ls *3* # 包含 3 的文件</span><br><span class="line">ls ?3.txt # 匹配如 43.txt</span><br><span class="line">ls [123]45.txt # 匹配 145.txt 245.txt 345.txt</span><br></pre></td></tr></table></figure><h3 id="cd拓展"><a href="#cd拓展" class="headerlink" title="cd拓展"></a><code>cd</code>拓展</h3><h4 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h4><p>change directory 的简写，更改当前的工作目录。</p><blockquote><p>注意：Linux 所有的 目录 和 文件名 都是大写小写敏感的</p></blockquote><h4 id="常用方式"><a href="#常用方式" class="headerlink" title="常用方式:"></a>常用方式:</h4><table><thead><tr><th>命令</th><th>含义</th></tr></thead><tbody><tr><td>cd</td><td>切换到当前用户主目录</td></tr><tr><td>cd ~</td><td>切换到当前用户主目录</td></tr><tr><td>cd .</td><td>当前目录不变</td></tr><tr><td>cd ..</td><td>上级目录</td></tr><tr><td>cd -</td><td>在最近两次工作目录之间切换</td></tr></tbody></table><h4 id="相-绝对路径"><a href="#相-绝对路径" class="headerlink" title="相/绝对路径"></a>相/绝对路径</h4><p>绝对路径： <code>/</code>和<code>~</code>开头的就是绝对路径，相对于根目录或家目录。</p><p>相对路径：只要不是 <code>/</code>和<code>~</code>开头的就是相对路径，只相对于当前目录。</p><h3 id="touch拓展"><a href="#touch拓展" class="headerlink" title="touch拓展"></a><code>touch</code>拓展</h3><ol><li>如果文件不存在，可以创建一个空白文件。</li><li>如果存在，修改文件末次修改日期。</li></ol><h3 id="mkdir拓展"><a href="#mkdir拓展" class="headerlink" title="mkdir拓展"></a><code>mkdir</code>拓展</h3><ol><li>创建新文件。</li><li><code>-p</code> 可以递归创建目录。例：<code>mkdir -p a/b/c/d</code> 分别创建了 abcd</li></ol><blockquote><p>新建目录名称不能和其他目录重名。</p></blockquote><h3 id="rm拓展"><a href="#rm拓展" class="headerlink" title="rm拓展"></a><code>rm</code>拓展</h3><ol><li>可以删除文件或目录。</li><li><code>-f</code> 强制删除，忽略不存在的文件，不需提示。</li><li><code>-r</code> 递归删除目录下的内容，删除文件夹必须加这个参数。</li></ol><blockquote><p>rm 删除的文件是不能恢复的</p></blockquote><h2 id="拷贝和移动文件"><a href="#拷贝和移动文件" class="headerlink" title="拷贝和移动文件"></a>拷贝和移动文件</h2><table><thead><tr><th>命令</th><th>对应英文</th><th>作用</th></tr></thead><tbody><tr><td>tree [目录名]</td><td>tree</td><td>以树状图列出文件目录结构</td></tr><tr><td>cp 源文件 目标文件</td><td>copy</td><td>复制文件或目录</td></tr><tr><td>mv 源文件 目标文件</td><td>move</td><td>移动/重命名文件或目录</td></tr></tbody></table><h3 id="tree拓展"><a href="#tree拓展" class="headerlink" title="tree拓展"></a><code>tree</code>拓展</h3><ol><li>以树状图列出文件目录结构。</li><li><code>-d</code> 只显示目录，不再显示文件。</li><li><code>tree ~</code> 树状显示家目录。</li></ol><h3 id="cp拓展"><a href="#cp拓展" class="headerlink" title="cp拓展"></a><code>cp</code>拓展</h3><ol><li>复制命令，相当于 DOS 下的 <code>copy</code> 命令。</li><li><code>-i</code> 覆盖文件前提示“是否覆盖？”。</li><li><code>-r</code> 若给出的源文件是目录文件，将递归 复制该目录下的所有子目录和文件。</li></ol><h3 id="mv拓展"><a href="#mv拓展" class="headerlink" title="mv拓展"></a><code>mv</code>拓展</h3><ol><li>可以用来 移动/重命名文件或目录。</li><li>覆盖文件前提示“是否覆盖？”。</li></ol><h2 id="查看文件内容"><a href="#查看文件内容" class="headerlink" title="查看文件内容"></a>查看文件内容</h2><table><thead><tr><th>命令</th><th>对应英文</th><th>作用</th></tr></thead><tbody><tr><td>cat 文件名</td><td>concatenate</td><td>查看文件内容、创建文件、文件合并、追加文件内容等功能</td></tr><tr><td>more 文件名</td><td>more</td><td>分屏显示文件内容</td></tr><tr><td>grep 搜索文本 文件名</td><td>grep</td><td>搜索文本文件内容</td></tr></tbody></table><h3 id="cat拓展"><a href="#cat拓展" class="headerlink" title="cat拓展"></a><code>cat</code>拓展</h3><ol><li>查看文件内容时，显示全部（适合文件内容较少的文件）。</li><li><code>-b</code> 输出包括行号，不包括空行。</li><li><code>-n</code> 输出包括行号及空行。</li></ol><blockquote><p>Linux 中还有一个 <code>nl</code> 的命令和 <code>cat -b</code> 的效果等价。</p></blockquote><h3 id="more拓展"><a href="#more拓展" class="headerlink" title="more拓展"></a><code>more</code>拓展</h3><ol><li>查看文件内容时，显示部分，分屏显示。</li><li><code>空格键</code> <code>Enter键</code>  <code>b</code> 、<code>f</code> 、 <code>q</code> 分别为下一行下一页上一页和退出。 </li><li><code>/word</code> 搜索 word 字符串。</li></ol><h3 id="grep拓展"><a href="#grep拓展" class="headerlink" title="grep拓展"></a><code>grep</code>拓展</h3><ol><li><code>grep</code> 允许对文本文件进行模式查找，即，正则表达式。</li><li><code>-n</code> 显示匹配行及行号。</li><li><code>-v</code> 显示不包含匹配文本的所有行（求反）。</li><li><code>-i</code> 忽略大小写。</li></ol><blockquote><p>常用的模式查找：</p><ol><li>^a 行首，搜寻以 a 开头的行。</li><li>ke$ 行尾，搜索以 ke 结束的行。 </li></ol></blockquote><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="echo-文字内容"><a href="#echo-文字内容" class="headerlink" title="echo 文字内容"></a>echo 文字内容</h3><ol><li><code>echo</code> 会在终端中显示参数指定的文字，通常会和 重定向 联合使用。</li></ol><h3 id="重定向-gt-和-gt-gt"><a href="#重定向-gt-和-gt-gt" class="headerlink" title="重定向 &gt; 和 &gt;&gt;"></a>重定向 &gt; 和 &gt;&gt;</h3><ol><li>Linux 允许将命令执行结果 重定向到一个 文件。</li><li>将本应显示在终端上的内容 输出/追加 到 指定文件中。</li><li><code>&gt;</code> 表示输出，会覆盖源文件内容。</li><li><code>&gt;&gt;</code>表示追加，会将内容追加到已有文件。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls &gt; a # 把列表内容输出到 a 文件里</span><br><span class="line">echo Hello World &gt;&gt; a # 把 Hello World 追加到 a 文件里</span><br></pre></td></tr></table></figure><h3 id="管道"><a href="#管道" class="headerlink" title="管道 |"></a>管道 |</h3><ol><li>Linux 允许将一个命令的输出 可以通过管道做为 另一个命令的输入。</li><li><code>[写入的内容] | [读取的内容]</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -lha ~ | more # 将 home 下所有的文件通过 more 进行分屏显示</span><br><span class="line">ls -lha ~ | grep DO # 将 home 下所有的文件中 包含 DO 的文件输出</span><br></pre></td></tr></table></figure><h1 id="远程管理命令拓展"><a href="#远程管理命令拓展" class="headerlink" title="远程管理命令拓展"></a>远程管理命令拓展</h1><h2 id="关机-重启"><a href="#关机-重启" class="headerlink" title="关机/重启"></a>关机/重启</h2><table><thead><tr><th>命令</th><th>对应英文</th><th>作用</th></tr></thead><tbody><tr><td>shutdown 选项 时间</td><td>shutdown</td><td>关机、重新启动</td></tr></tbody></table><h3 id="shutdown拓展"><a href="#shutdown拓展" class="headerlink" title="shutdown拓展"></a>shutdown拓展</h3><ol><li><code>shutdown</code> 命令可以安全关闭或者重新启动系统。</li><li><code>-r</code> 重新启动。</li><li><code>-c</code> 取消关机</li></ol><blockquote><p>注意：</p><ol><li>不指定选项和参数，默认表示 1分钟后关闭电脑。</li><li>远程维护服务器时，最好<strong>不要关闭系统</strong>，应该重新启动系统。</li></ol></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shutdown -r now # 立即重启</span><br><span class="line">shutdown now # 立即关机</span><br><span class="line">shutdown 20:25 # 在这个时候关机</span><br><span class="line">shutdown +10 # 十分钟后关机</span><br><span class="line">shutdown -c # 立刻取消上一个关机动作</span><br></pre></td></tr></table></figure><h2 id="查看或配置网卡信息"><a href="#查看或配置网卡信息" class="headerlink" title="查看或配置网卡信息"></a>查看或配置网卡信息</h2><table><thead><tr><th>命令</th><th>对应英文</th><th>作用</th></tr></thead><tbody><tr><td>ifconfig</td><td>configure a network interface</td><td>查看、配置计算机当前的网卡配置信息</td></tr><tr><td>ping ip地址</td><td>ping</td><td>检测到目标 ip 地址的连接是否正常</td></tr></tbody></table><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>网卡：是一个专门负责网络通信的硬件设备。</p><p>IP地址：设置在网卡上的地址信息。</p><blockquote><p>将电脑比作电话，那么网卡相当于 SIM 卡，IP地址 相当于 电话号码。</p></blockquote><h3 id="ipconfig拓展"><a href="#ipconfig拓展" class="headerlink" title="ipconfig拓展"></a><code>ipconfig</code>拓展</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig | grep inet # 查看配置信息中包含 inet 的内容，及IP信息</span><br></pre></td></tr></table></figure><h3 id="ping拓展"><a href="#ping拓展" class="headerlink" title="ping拓展"></a><code>ping</code>拓展</h3><p>工作原理类似雷达：我们给目标IP地址发送一个数据包，对方返回一个数据包，根据返回的数据包及时间确定目标主机的存在。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 127.0.0.1 # 检测本地网卡是否工作正常</span><br></pre></td></tr></table></figure><h2 id="SSH基础（重点）"><a href="#SSH基础（重点）" class="headerlink" title="SSH基础（重点）"></a>SSH基础（重点）</h2><p>SSH（Secure Shell）安全外壳协议，<strong>Secure Shell</strong>（安全外壳协议，简称<strong>SSH</strong>）是一种加密的<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">网络传输协议</a>，可在不安全的网络中为网络服务提供安全的<a href="https://zh.wikipedia.org/wiki/Secure_Shell#cite_note-rfc4251-1" target="_blank" rel="noopener">传输环境</a>，及创建<a href="https://zh.wikipedia.org/w/index.php?title=%E5%AE%89%E5%85%A8%E9%9A%A7%E9%81%93&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener">安全隧道</a>。SSH最常见的用途是远程登录系统，人们通常利用SSH来传输<a href="https://zh.wikipedia.org/wiki/%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%95%8C%E9%9D%A2" target="_blank" rel="noopener">命令行界面</a>和远程执行命令。</p><h3 id="Linux之SSH"><a href="#Linux之SSH" class="headerlink" title="Linux之SSH"></a>Linux之SSH</h3><ol><li>Linux 中 SSH 是非常常用的工具，通过 <strong>SSH客户端</strong> 我们可以连接到 <strong>SSH服务器</strong> 的远程机器上。</li><li>正确的使用SSH可以有效地<strong>避免信息泄露</strong>（进行加密）、<strong>提高传输速度</strong>（对数据进行压缩）。</li></ol><h3 id="域名端口号"><a href="#域名端口号" class="headerlink" title="域名端口号"></a>域名端口号</h3><p>域名是为了方便记忆，端口号可以找到计算机运行的程序。SSH服务器的默认端口号是 22。</p><p>常见服务端口号：</p><ol><li>SSH服务器：22</li><li>Web服务器：80 </li><li>HTTPS：445 </li><li>FTP 服务器：21</li></ol><h3 id="SSH-客户端的简单使用"><a href="#SSH-客户端的简单使用" class="headerlink" title="SSH 客户端的简单使用"></a>SSH 客户端的简单使用</h3><p>Linux  大多自带SSH，可在终端命令使用。Windows 系统需要安装客户端软件PuTTY、XShell、<em>MobaXterm</em>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 使用 ssh 连接登录</span><br><span class="line">ssh [-p port] user@remote</span><br><span class="line"><span class="meta">#</span> user 用户名，不指定默认为当前用户</span><br><span class="line"><span class="meta">#</span> remote 远程机器地址，可以是IP/域名/别名</span><br><span class="line"><span class="meta">#</span> port 是 SSH Server 监听的端口，如果不指定，默认值为 22</span><br><span class="line"><span class="meta">#</span> -p 就是指定端口号的选项</span><br></pre></td></tr></table></figure><blockquote><p>exit 退出当前用户的登录。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 22 home@172.16.140.138</span><br></pre></td></tr></table></figure><h3 id="SCP（掌握）"><a href="#SCP（掌握）" class="headerlink" title="SCP（掌握）"></a>SCP（掌握）</h3><p><strong>安全复制</strong>（英语：<strong>Secure copy</strong>，缩写<strong>SCP</strong>）是指在本地<a href="https://zh.wikipedia.org/wiki/%E4%B8%BB%E6%A9%9F" target="_blank" rel="noopener">主机</a>与远程主机或者两台远程主机之间基于<a href="https://zh.wikipedia.org/wiki/Secure_Shell" target="_blank" rel="noopener">Secure Shell</a>（SSH）协议安全地传输<a href="https://zh.wikipedia.org/wiki/%E9%9B%BB%E8%85%A6%E6%AA%94%E6%A1%88" target="_blank" rel="noopener">电脑文件</a>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 路径：如果不是绝对路径，则为用户家路径的相对路径</span><br><span class="line"><span class="meta">#</span> 将本地目录下的文件复制到远程家目录下</span><br><span class="line">scp -P port 01.py user@remote:Desktop/0.1py</span><br><span class="line"><span class="meta">#</span> 将远程家目录下的文件复制到本地目录下</span><br><span class="line">scp -P port user@remote:Desktop/0.1py 01.py</span><br></pre></td></tr></table></figure><blockquote><p><code>-P</code> P要大写。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 将当前目录下的demo文件夹复制到家目录下的Desktop</span><br><span class="line">scp -r demo user@remote:Desktop</span><br><span class="line"><span class="meta">#</span> 将家目录下的Desktop复制到当前目录下的demo文件夹</span><br><span class="line">scp -r user@remote:Desktop demo</span><br></pre></td></tr></table></figure><blockquote><p>windows 中可以安装 PuTTY，使用<code>pscp</code>命令传输，或者安装<code>FileZilla</code>使用<code>FTP</code>进行文件传输。</p></blockquote><blockquote><p>FileZilla 在传输文件时，使用的是 <code>FTP服务</code>而不是<code>SSH</code>服务，因此端口号应该设置为<code>21</code>。</p></blockquote><h2 id="SSH高级（知道）"><a href="#SSH高级（知道）" class="headerlink" title="SSH高级（知道）"></a>SSH高级（知道）</h2><blockquote><p>有关 SSH 配置信息都保存在用户目录下的<code>.ssh</code>目录下</p></blockquote><h3 id="免密码登录"><a href="#免密码登录" class="headerlink" title="免密码登录"></a>免密码登录</h3><ol><li>配置公钥</li></ol><blockquote><p>执行 <code>ssh-keygen</code> 即可生成 SSH 钥匙，一路回车即可</p></blockquote><ol start="2"><li>上传公钥到服务器</li></ol><blockquote><p>执行 <code>ssh-copy-id -p port user@remote</code> 可以让远程服务器记住我们的公钥。</p></blockquote><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><ol><li>第一条命令在本地SSH客户端生成两条秘钥（<strong>公钥、私钥</strong>）。</li><li>第二条命令将<strong>公钥</strong>复制到SSH服务器。</li><li>本地使用<strong>私钥</strong>对数据进行加密、解密。</li><li>服务器使用<strong>公钥</strong>对数据进行加密、解密。</li></ol><blockquote><p>非对称加密算法：</p><ol><li>使用公钥加密数据，需要使用私钥解密。</li><li>使用私钥加密数据，则需要使用公钥解密。</li></ol></blockquote><h3 id="配置别名"><a href="#配置别名" class="headerlink" title="配置别名"></a>配置别名</h3><p>当我们想用 <code>ssh user</code> 来代替经常输入的 <code>ssh -p port user@rermote</code> 时，可以在配置文件<code>~/.ssh/config</code> （没有该文件就创建）里面追加一下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host mac</span><br><span class="line">    HostName ip地址(remote)</span><br><span class="line">    User userName(user)</span><br><span class="line">    Port 22</span><br></pre></td></tr></table></figure><p><code>scp</code> 同样也可以使用。</p><h1 id="用户权限命令拓展"><a href="#用户权限命令拓展" class="headerlink" title="用户权限命令拓展"></a>用户权限命令拓展</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><ol><li>用户管理包括 用户 与 组 管理。</li><li>每个系统都拥有一个账号，对于不同的系统资源拥有不同的使用权限。</li><li>每一个用户针对不同的文件或目录也有不同的权限。</li><li>这些不同的权限包括：</li></ol><table><thead><tr><th>权限</th><th>英文</th><th>缩写</th><th>数字代号</th></tr></thead><tbody><tr><td>读</td><td>read</td><td>r</td><td>4</td></tr><tr><td>写</td><td>write</td><td>w</td><td>2</td></tr><tr><td>执行</td><td>excute</td><td>x</td><td>1</td></tr></tbody></table><blockquote><p><code>./my.py</code> 表示执行当前文件夹下 my.py 文件。</p></blockquote><h3 id="组"><a href="#组" class="headerlink" title="组"></a>组</h3><p>给用户分组，方便进行用户管理。</p><h3 id="文件-目录"><a href="#文件-目录" class="headerlink" title="文件/目录"></a>文件/目录</h3><p><code>-rwxrw-r-- 1 user user 43 5月    9 00:00 user.txt</code></p><ol><li><code>-</code> 开头代表是文件。</li><li><code>d</code> 开头代表是目录。</li><li>接下来三个分为一组，一共三组，分别为：拥有者权限、用户组权限、其他用户权限。</li><li>接下来是硬链接数（cd 可以切换到该文件的方式种数），子目录越多硬链接数越大。</li><li>拥有者、组、大小、时间、名称。</li></ol><h2 id="权限修改chmod（重要）"><a href="#权限修改chmod（重要）" class="headerlink" title="权限修改chmod（重要）"></a>权限修改<code>chmod</code>（重要）</h2><ol><li><code>chmod</code> 可以修改 用户、组 对文件、目录的权限。</li><li>命令格式为：<code>chmod +/-rwx 文件名|目录</code>。</li></ol><h3 id="超级用户"><a href="#超级用户" class="headerlink" title="超级用户"></a>超级用户</h3><ol><li>Linux系统中的<code>root</code>账号通常用于系统的维护和管理，对操作系统的所有资源都具有访问权限。</li><li>不推荐直接使用 root 账号登录系统。</li><li>在Linux安装过程中，系统会自动创建一个用户账号，这个默认用户称为“标准用户”。</li></ol><h3 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h3><ol><li><code>su</code>是 <code>substitute user</code>的缩写，表示使用另一个用户身份。</li><li><code>sudo</code> 用来以其他身份来执行命令，预设的身份为 <code>root</code>。</li><li>用户使用 <code>sudo</code> 必须先输入密码，有5分钟的有效期，过期限必须重新输入密码。</li></ol><blockquote><p>未授权的用户使用<code>sudo</code> ，会发出警告邮件给管理员。</p></blockquote><h3 id="组管理相关命令"><a href="#组管理相关命令" class="headerlink" title="组管理相关命令"></a>组管理相关命令</h3><blockquote><p>创建组、删除组的终端命令都需要通过 <code>sudo</code> 执行。</p></blockquote><table><thead><tr><th>命令</th><th>英文</th><th>作用</th></tr></thead><tbody><tr><td>groupadd 组名</td><td>略</td><td>添加组</td></tr><tr><td>groupdel 组名</td><td>略</td><td>删除组</td></tr><tr><td>cat /ect/group</td><td>略</td><td>确认组信息</td></tr><tr><td>chgrp -R 组名 文件/目录名</td><td>change group</td><td>修改文件/目录的所属组</td></tr></tbody></table><blockquote><p>提示：</p><ol><li>组信息保存在 <code>/etc/group</code> 文件中。</li><li><code>/etc</code> 目录是专门用来保存 <strong>系统配置信息</strong> 的目录。</li></ol></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd dev # 创建一个dev组</span><br><span class="line">cat /etc/group # 查看是否创建成功</span><br><span class="line"></span><br><span class="line">sudo groupdel dev # 删除组</span><br></pre></td></tr></table></figure><h4 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir fileName # 创建 fileName 文件</span><br><span class="line">sudo groupadd dev # 创建 dev 组</span><br><span class="line">cat /etc/group # 查看是否创建成功</span><br><span class="line">ls -l # 查看文件夹下文件权限</span><br><span class="line">sudo chgrp -R dev fileName/ # 修改所属组</span><br></pre></td></tr></table></figure><h3 id="用户管理相关命令"><a href="#用户管理相关命令" class="headerlink" title="用户管理相关命令"></a>用户管理相关命令</h3><h4 id="创建用户-设置密码-删除用户"><a href="#创建用户-设置密码-删除用户" class="headerlink" title="创建用户/设置密码/删除用户"></a>创建用户/设置密码/删除用户</h4><table><thead><tr><th>命令</th><th>作用</th><th>说明</th></tr></thead><tbody><tr><td>useradd -m -g 组新建用户名</td><td>添加新用户</td><td>1. -m 自动建立用户家目录。<br>2. -g 指定用户所在组，负责会建立一个同名的组。</td></tr><tr><td>passwd 用户名</td><td>设置用户密码</td><td>如果是普通用户，直接用 passwd<br>可以修改自己的账户密码。</td></tr><tr><td>userdel -r 用户名</td><td>删除用户</td><td>-r 选项会自动删除用户家目录。</td></tr><tr><td>cat /etc/passwd \</td><td>grep</td><td>确认用户信息</td><td>新建用户后，用户信息会保存在<code>/etc/passwd</code>文件中。</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -m -g dev userName # 创建新用户userName,并将其指定给dev组</span><br><span class="line">sudo passwd userName # 设置用户密码</span><br></pre></td></tr></table></figure><blockquote><p>创建用户时忘记添加 <code>-m</code> 选项指定新用户家目录，可以删除用户重新创建。</p></blockquote><h4 id="查看用户信息"><a href="#查看用户信息" class="headerlink" title="查看用户信息"></a>查看用户信息</h4><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>id [用户名]</td><td>查看用户 UID 和 GID 信息。</td></tr><tr><td>who</td><td>查看当前所有登录的用户列表</td></tr><tr><td>whoami</td><td>查看当前登录的账户名</td></tr></tbody></table><blockquote><p><code>/etc/passwd</code>文件存放的是用户的信息，由6个冒号<code>:</code>分组成的7个信息：</p><p>用户名、密码（x表示加密的密码）、UID（用户标识）、GID（组表示）</p><p>用户全名或本地账号、家目录、登陆之后，使用的终端命令—Shell（ubuntu默认是<code>dash</code>）</p></blockquote><h4 id="usermod"><a href="#usermod" class="headerlink" title="usermod"></a>usermod</h4><p><code>usermod</code> 可以用来设置用户的<strong>主组</strong>、<strong>附加组</strong>和<strong>登录Shell</strong>：</p><blockquote><p>主组：通常在新建用户时指定，在<code>etc/passwd</code> 的第4列 GID 对应的组。</p><p>附加组：在 <code>etc/group</code> 中的最后一列表示该组的用户列表，用于指定用户的附加权限。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 修改用户主组（passwd 中的 GID）</span><br><span class="line">usermod -g 组 用户名</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改用户附加组</span><br><span class="line">usermod -G 组 用户名</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改用户登录 Shell</span><br><span class="line">usermod -s /bin/bash</span><br></pre></td></tr></table></figure><blockquote><p>修改用户附加组要<strong>重新登陆</strong>生效</p></blockquote><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 默认使用 useradd 添加用户是没有权限使用 sudo 即以 root 身份执行命令的。</span><br><span class="line"><span class="meta">#</span> 可以使用以下命令，将用户添加到 sudo 附加组中</span><br><span class="line">usermod -G sudo 用户名</span><br></pre></td></tr></table></figure><h4 id="which（重要）"><a href="#which（重要）" class="headerlink" title="which（重要）"></a>which（重要）</h4><blockquote><p><code>/etc/passwd</code> 可用于保存用户信息的文件</p><p><code>/usr/bin/passwd</code> 是用于修改用户密码的程序</p></blockquote><ol><li><code>which</code> 命令可以查看执行命令所在位置。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">which passwd # 输出 /usr/bin/passwd</span><br><span class="line">which ls # 输出 /bin/ls</span><br><span class="line">which useradd # 输出 /usr/sbin/useradd</span><br></pre></td></tr></table></figure><h5 id="bin和sbin"><a href="#bin和sbin" class="headerlink" title="bin和sbin"></a>bin和sbin</h5><p>在 <code>Linux</code> 中，绝大多数可执行文件都保存在<code>/bin</code>、<code>sbin</code>、<code>/usr/bin</code>、<code>/usr/sbin</code>。</p><ol><li><code>/bin</code>（binary）是二进制执行文件目录，主要用于具体应用。</li><li><code>/sbin</code>（system binary）是系统管理员专用的二进制代码存放目录、主要用于系统管理。</li><li><code>/usr/bin</code> （user commands for applications）后期安装的一些软件。</li><li><code>/usr/sbin</code>（super user commands for applications）超级用户的一些管理程序。</li></ol><h3 id="切换用户相关命令"><a href="#切换用户相关命令" class="headerlink" title="切换用户相关命令"></a>切换用户相关命令</h3><table><thead><tr><th>命令</th><th>作用</th><th>说明</th></tr></thead><tbody><tr><td>su - 用户名</td><td>切换用户，并且切换目录</td><td>可以切换到用户家目录，否则位置保持不变</td></tr><tr><td>exit</td><td>退出当前登录账户</td></tr></tbody></table><blockquote><p>su 后不接用户名，可以切换到 root，不推荐因为不安全。</p><p>exit 退回到前一用户</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su userName # 切换到userName的当前目录</span><br><span class="line">su - userName # 切换到userName的家目录</span><br></pre></td></tr></table></figure><h3 id="修改文件权限相关命令"><a href="#修改文件权限相关命令" class="headerlink" title="修改文件权限相关命令"></a>修改文件权限相关命令</h3><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>chown</td><td>修改拥有者</td></tr><tr><td>chgrp</td><td>修改组</td></tr><tr><td>chmod</td><td>修改权限</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chown 用户名 文件名|目录名 # 修改文件|目录的拥有者</span><br><span class="line"></span><br><span class="line">chgrp -R 组名 文件名|目录名 # 递归修改文件|目录的组</span><br><span class="line"></span><br><span class="line">chmod -R 755 文件名|目录名 # 递归修改文件权限</span><br></pre></td></tr></table></figure><blockquote><p>755：7代表拥有者权限、5代表组权限、5代表其他用户权限。</p></blockquote><blockquote><p>-R 递归执行所有文件</p></blockquote><table><thead><tr><th>可读（read）</th><th>可写（write）</th><th>可执行（excute）</th><th>值</th><th>字母代号</th></tr></thead><tbody><tr><td>4</td><td>2</td><td>1</td><td>7</td><td>rwx</td></tr><tr><td>4</td><td>2</td><td>0</td><td>6</td><td>rw-</td></tr><tr><td>4</td><td>0</td><td>1</td><td>5</td><td>r-x</td></tr><tr><td>4</td><td>0</td><td>0</td><td>4</td><td>r–</td></tr><tr><td>0</td><td>2</td><td>1</td><td>3</td><td>-wx</td></tr><tr><td>0</td><td>2</td><td>0</td><td>2</td><td>-w-</td></tr><tr><td>0</td><td>0</td><td>1</td><td>1</td><td>–x</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>—</td></tr></tbody></table><blockquote><p>755：</p><ol><li>7指 拥有者具有可读可写可执行权限。</li><li>5指 组拥有可读可执行权限。</li><li>5指 其他用户拥有可读可执行权限。</li></ol></blockquote><h1 id="系统信息相关命令"><a href="#系统信息相关命令" class="headerlink" title="系统信息相关命令"></a>系统信息相关命令</h1><p>查询系统信息即通过远程终端维护服务器，查看服务器上当前<strong>系统日期和时间、磁盘空间占用情况、程序执行情况</strong></p><h2 id="时间和日期"><a href="#时间和日期" class="headerlink" title="时间和日期"></a>时间和日期</h2><table><thead><tr><th>命令</th><th>英文</th><th>作用</th></tr></thead><tbody><tr><td>cal</td><td>calendar</td><td>查看日历，-y选项可以查看一年的日历</td></tr><tr><td>date</td><td>略</td><td>查看系统时间</td></tr></tbody></table><h2 id="磁盘和目录空间"><a href="#磁盘和目录空间" class="headerlink" title="磁盘和目录空间"></a>磁盘和目录空间</h2><table><thead><tr><th>命令</th><th>英文</th><th>作用</th></tr></thead><tbody><tr><td>df -h</td><td>disk free</td><td>显示磁盘剩余空间</td></tr><tr><td>du -h[目录名]</td><td>disk usage</td><td>显示目录下的文件大小</td></tr></tbody></table><blockquote><p>-h 以人性化的方式显示文件大小</p></blockquote><h2 id="进程信息"><a href="#进程信息" class="headerlink" title="进程信息"></a>进程信息</h2><blockquote><p>进程，当前正在执行的程序。</p></blockquote><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>ps a/u/x</td><td>process status 查看进程的详细情况</td></tr><tr><td>top</td><td>动态显示运行中的进程并且排序</td></tr><tr><td>kill [-9] 进程代号</td><td>终止指定代号的进程，-9表示强行终止。</td></tr></tbody></table><h3 id="ps拓展"><a href="#ps拓展" class="headerlink" title="ps拓展"></a>ps拓展</h3><ol><li><code>ps</code> 只会显示当前用户通过终端启动的应用程序。</li><li><code>a</code> 选项 显示终端上所有进程，包括其他用户的进程。</li><li><code>u</code> 选项显示进程的详细版本。</li><li><code>x</code> 选项显示没有控制终端的进程（不是终端启动的进程）。</li></ol><blockquote><p>%cpu/%mem：分别为cpu占用率和内存占用率。</p></blockquote><blockquote><p>PID 表示进程代号，kill中会用到。</p></blockquote><h3 id="top拓展"><a href="#top拓展" class="headerlink" title="top拓展"></a>top拓展</h3><blockquote><p>退出top可以直接输入<code>q</code>。</p></blockquote><h3 id="kill拓展"><a href="#kill拓展" class="headerlink" title="kill拓展"></a>kill拓展</h3><blockquote><p>使用 <code>kill</code> 命令时，最好指终止当前用户开启的进程，不要终止 <code>root</code> 身份开启进程，</p><p>否则可能导致系统崩溃。</p></blockquote><h1 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h1><h2 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h2><p><code>find</code> 通常用来在<strong><em>特定的目录下</em> 搜索</strong>符合条件的文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find [路径] -name "fileName.txt"</span><br></pre></td></tr></table></figure><ol><li>如果省略路径表示在当前文件夹下查找。</li><li>可以使用通配符。</li></ol><p>例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find -name "*name*"</span><br><span class="line">find -name "*.txt"</span><br></pre></td></tr></table></figure><blockquote><p>其他用法：按权限、时间等去搜索</p></blockquote><h2 id="软链接"><a href="#软链接" class="headerlink" title="软链接"></a>软链接</h2><blockquote><p>建立文件的软链接，就类似于Windows下的快捷方式。可快速访问。</p></blockquote><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>ln -s 被链接的源文件 链接文件</td><td>建立文件的软链接</td></tr></tbody></table><ol><li>没有 <code>-s</code> 则创建的是一个硬链接文件。（由于两个文件占用相同的硬盘大小，因此一般不会建立硬链接）</li><li>源文件要使用<strong>绝对路径</strong>，不要用相对路径。（方便软链接移动后仍然可以正常使用）</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat fileName.py # 查询文件内容</span><br><span class="line">tree # 查看目录结构</span><br><span class="line">mv fileName.py demo/a/b # 移动文件</span><br><span class="line">tree # 检查移动结果</span><br><span class="line"></span><br><span class="line">ln -s /home/user/Desktop/demo/a/b/fileName.py Link # 给fileName创建软链接 Link</span><br><span class="line">cat Link # 查看软链接内容</span><br><span class="line">ls -l # 查看列表显示 Link—&gt;demo/a/b/fileName.py</span><br></pre></td></tr></table></figure><h2 id="硬链接（知道）"><a href="#硬链接（知道）" class="headerlink" title="硬链接（知道）"></a>硬链接（知道）</h2><ol><li>硬链接，有多少种方式可以访问文件或目录。</li><li><code>ln</code>创建链接时，如果没有 <code>-s</code>选项，则会创建一个硬链接文件。</li><li><code>ls -l</code>可以查看硬连接数。</li><li>相当于复制了一份文件名指向文件数据，源文件删除了，依然可以访问硬链接文件。</li></ol><blockquote><p>在Linux中，文件名和文件的数据是分开存储的，文件名指向文件数据。</p><p>创建软链接文件名—&gt;软链接文件数据—&gt;文件名—&gt;文件数据。</p></blockquote><h1 id="打包压缩"><a href="#打包压缩" class="headerlink" title="打包压缩"></a>打包压缩</h1><p>在不同的操作系统中，常用的打包压缩方式是不同的：</p><p>Windows 常用 <code>rar</code>、Mac常用<code>zip</code>、Linux常用<code>tar.gz</code>。</p><h2 id="打包-解包"><a href="#打包-解包" class="headerlink" title="打包/解包"></a>打包/解包</h2><p><code>tar</code> 是 Linux 中最常用的备份工具，这个命令可以把一系列文件打包到一个大文件中，也可以把打包文件恢复成一系列文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 打包文件</span><br><span class="line">tar -cvf [name].tar 被打包文件/路径...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 解包文件</span><br><span class="line">tar -xvf 打包文件.tar</span><br></pre></td></tr></table></figure><ol><li><code>c</code> ，生成档案文件，创建打包文件。</li><li><code>x</code> ，解开档案文件。</li><li><code>v</code> ，列出归档解档的详细过程，显示进度。</li><li><code>f</code> ，指定档案文件名称，f后面一定是<code>.tar</code>文件，所以必须放在选项最后。</li></ol><blockquote><p>f 要放在最后</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rm -r *</span><br><span class="line">touch 01.txt</span><br><span class="line">touch 02.txt # 创建文件</span><br><span class="line">tar -cvf name.tar 01.txt 02.txt # 打包</span><br><span class="line">ls -lh # 查看文件</span><br><span class="line">mkdir tar</span><br><span class="line">mv name.tar tar</span><br><span class="line">tree</span><br><span class="line">cd tar</span><br><span class="line">tar -xvf name.tar # 解压文件</span><br></pre></td></tr></table></figure><h2 id="压缩-解压缩"><a href="#压缩-解压缩" class="headerlink" title="压缩/解压缩"></a>压缩/解压缩</h2><h3 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a><code>gzip</code></h3><ol><li><code>tar</code>与<code>gzip</code>命令结合使用，实现文件 <strong>打包和压缩</strong>。</li><li><code>tar</code>命令中有个选项<code>-z</code>可以调用<code>gzip</code>，从而可以方便的实现压缩和解压缩的功能。</li></ol><blockquote><p>在Linux中，最常见的压缩文件格式就是<code>xxx.tar.gz</code>。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 压缩文件</span><br><span class="line">tar -zcvf [name].tar.gz 被打包压缩文件/路径... </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 解压文件</span><br><span class="line">tar -zcvf [name].tar.gz </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 解压缩到指定路径</span><br><span class="line">tar -zcvf [name].tar.gz -C 目标路径</span><br></pre></td></tr></table></figure><blockquote><p>-C 解压到指定路径，该目录必须存在。</p></blockquote><h3 id="bzip2（two）"><a href="#bzip2（two）" class="headerlink" title="bzip2（two）"></a><code>bzip2（two）</code></h3><ol><li>和 <code>gzip</code> 用法一样，扩展名为<code>xxx.tar.bz2</code>。</li><li>在<code>tar</code>命令中用<code>-j</code>选项调用<code>bzip2</code>来实现。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 压缩文件</span><br><span class="line">tar -jcvf [name].tar.bz2 被打包压缩文件/路径... </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 解压文件</span><br><span class="line">tar -jcvf [name].tar.bz2 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 解压缩到指定路径</span><br><span class="line">tar -jcvf [name].tar.bz2 目标路径</span><br></pre></td></tr></table></figure><h1 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h1><h3 id="通过-apt-安装-卸载软件"><a href="#通过-apt-安装-卸载软件" class="headerlink" title="通过 apt 安装/卸载软件"></a>通过 apt 安装/卸载软件</h3><ol><li>apt （全称：Advanced Packaging Tool）是Linux下的一款安装包管理工具。</li><li>可以在终端中方便的 安装/卸载/更新软件包。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 安装软件</span><br><span class="line">sudo apt install 软件包</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 卸载软件</span><br><span class="line">sudo apt remove 软件名</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 更新安装包</span><br><span class="line">sudo apt upgrate</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install sl # 安装小火车提示</span><br><span class="line"></span><br><span class="line">sudo aot install htop # 作用类似 top 命令</span><br></pre></td></tr></table></figure><h3 id="配置软件源"><a href="#配置软件源" class="headerlink" title="配置软件源"></a>配置软件源</h3><p>希望在<code>ubuntu</code>更加快速的安装软件，可以设置镜像源。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;操作系统简介&quot;&gt;&lt;a href=&quot;#操作系统简介&quot; class=&quot;headerlink&quot; title=&quot;操作系统简介&quot;&gt;&lt;/a&gt;操作系统简介&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;用户 —&amp;gt;应用程序—&amp;gt;操作系统—&amp;gt;计算机硬件&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;操作系统：系统调用 、终端命令、图形窗口，即可以在操作系统上安装高级语言的环境，用高级语言开发程序。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="计算机基础" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"/>
    
      <category term="计算机系统" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="Linux 基础" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/Linux-%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="计算机基础" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"/>
    
      <category term="计算机系统" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="Linux 基础" scheme="http://yoursite.com/tags/Linux-%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>数据结构</title>
    <link href="http://yoursite.com/2020/03/26/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    <id>http://yoursite.com/2020/03/26/数据结构/</id>
    <published>2020-03-26T10:11:00.000Z</published>
    <updated>2020-03-26T11:06:13.044Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><p>还是要逐步拾起数据结构，以及记录一下面试遇到的一些算法题。<a id="more"></a></p><h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">10</span>,<span class="number">28</span>,<span class="number">25</span>,<span class="number">38</span>,<span class="number">20</span>,<span class="number">35</span>,<span class="number">56</span>]</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quickSort</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (arr.length&lt;=<span class="number">1</span>) &#123;                 <span class="comment">// 结束递归条件</span></span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> left = [];                       <span class="comment">// 声明 左</span></span><br><span class="line">    <span class="keyword">let</span> right = [];                      <span class="comment">// 声明 右</span></span><br><span class="line">    <span class="keyword">let</span> pivot = arr[<span class="number">0</span>];                  <span class="comment">// 声明 基准数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">1</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i]&lt;arr[<span class="number">0</span>])&#123;</span><br><span class="line">            left.push(arr[i])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right.push(arr[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> quickSort(left).concat(pivot,quickSort(right));  <span class="comment">// 递归 拼接</span></span><br><span class="line">&#125;</span><br><span class="line">quickSort(arr)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  缺点：声明了两个数组，不是原地排序，增加了空间复杂度。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><a href="https://zhuanlan.zhihu.com/p/30433867" target="_blank" rel="noopener">阮一峰快速排序</a></p><h1 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h1><h2 id="暴力法"><a href="#暴力法" class="headerlink" title="暴力法"></a>暴力法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>];</span><br><span class="line"><span class="keyword">var</span> containsDuplicate = <span class="function"><span class="keyword">function</span>(<span class="params">nums</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> res = [];</span><br><span class="line">    <span class="keyword">var</span> flag = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;nums.length<span class="number">-1</span>;i++) &#123;</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">var</span> j= i+<span class="number">1</span>;j&lt;nums.length<span class="number">-1</span>;j++)&#123;</span><br><span class="line">           <span class="keyword">if</span> (nums[i] == nums[j]) &#123;</span><br><span class="line">               flag = <span class="literal">false</span>;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (flag === <span class="literal">true</span>) &#123;</span><br><span class="line">           res.push(nums[i]);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           flag = <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br><span class="line">containsDuplicate(nums);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">break 跳出本次循环</span></span><br><span class="line"><span class="comment">continue 跳出本次迭代 继续执行</span></span><br><span class="line"><span class="comment">return 跳出函数返回函数值</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h1 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h1><h2 id="解密问题"><a href="#解密问题" class="headerlink" title="解密问题"></a>解密问题</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>字符串解密问题，一个单词奇数位抽出来做前半部分，偶数位倒序后做后半部分，拼接起来，形成一个串，你要解密出原来的字符串。加密过程 <code>Welcome—&gt; Wloe + mce</code>，你要做加密算法</p><h3 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'Welcome'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeCode</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = str.split(<span class="string">''</span>);  <span class="comment">// split('') 转为数组</span></span><br><span class="line">    <span class="keyword">var</span> left = [];</span><br><span class="line">    <span class="keyword">var</span> right = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>((i%<span class="number">2</span>) == <span class="number">0</span>)&#123;       <span class="comment">// 0、2、4...在奇位</span></span><br><span class="line">           left.push(arr[i])       <span class="comment">// 尾部压入 W l o e</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;              <span class="comment">// 1、3、5...在偶位</span></span><br><span class="line">           right.unshift(arr[i])   <span class="comment">// 头部写入 m c e  </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> left.concat(right).join(<span class="string">''</span>)   <span class="comment">// 拼接转字符串</span></span><br><span class="line">&#125;</span><br><span class="line">changeCode(str)  <span class="comment">// "Wloemce"</span></span><br></pre></td></tr></table></figure><h2 id="三数之和"><a href="#三数之和" class="headerlink" title="三数之和"></a>三数之和</h2><h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><p>给定一个包含 n 个整数的数组 arr，判断 arr 中是否存在三个元素 a，b，c ，使得 a + b + c = 0 ？找出所有满足条件且不重复的三元组。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">例如, 给定数组 nums = [-1, 0, 1, 2, -1, -4]，</span><br><span class="line"></span><br><span class="line">满足要求的三元组集合为：</span><br><span class="line">[</span><br><span class="line">  [-1, 0, 1],</span><br><span class="line">  [-1, -1, 2]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="爬楼梯"><a href="#爬楼梯" class="headerlink" title="爬楼梯"></a>爬楼梯</h2><h3 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h3><p>假设你正在爬楼梯。需要 n 阶你才能到达楼顶。每次你可以爬 1 或 2 个台阶。你有多少种不同的方法可以爬到楼顶呢？</p><h3 id="答案-1"><a href="#答案-1" class="headerlink" title="答案"></a>答案</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upStairs</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n===<span class="number">1</span>) &#123;                                 <span class="comment">// 结束递归条件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n===<span class="number">2</span>)&#123;                           <span class="comment">// 结束递归条件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n&gt;<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> upStairs(n<span class="number">-1</span>) + upStairs(n<span class="number">-2</span>)   <span class="comment">// 递归</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">upStair(<span class="number">8</span>)   <span class="comment">// 34</span></span><br></pre></td></tr></table></figure><h2 id="割绳子"><a href="#割绳子" class="headerlink" title="割绳子"></a>割绳子</h2><h3 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h3><p>总共有n条长度不等绳子，可以任意切割，不能拼接。要求切割后得到m条长度相等的绳子，求问得到的m条绳子长度L的最大值？</p><p>思路：m*n 进行排序</p><h2 id="圆桌分奖品"><a href="#圆桌分奖品" class="headerlink" title="圆桌分奖品"></a>圆桌分奖品</h2><h3 id="题目-4"><a href="#题目-4" class="headerlink" title="题目"></a>题目</h3><p>圆桌n个人，每一个人有一个得分，相邻两人中得分高的人得到的奖品比得分低 的人多。每个人至少获得一个奖品，问一桌人至少需要准备多少奖品？</p><p>思路：只有一个极小点 最多，极小点越少就越少。</p><h2 id="字符串相加"><a href="#字符串相加" class="headerlink" title="字符串相加"></a>字符串相加</h2><h2 id="数组最大深度"><a href="#数组最大深度" class="headerlink" title="数组最大深度"></a>数组最大深度</h2>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;数据结构&quot;&gt;&lt;a href=&quot;#数据结构&quot; class=&quot;headerlink&quot; title=&quot;数据结构&quot;&gt;&lt;/a&gt;数据结构&lt;/h1&gt;&lt;p&gt;还是要逐步拾起数据结构，以及记录一下面试遇到的一些算法题。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="原生JS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="数据结构" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="原生JS" scheme="http://yoursite.com/tags/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>Function 理解</title>
    <link href="http://yoursite.com/2020/03/26/JS_Function/"/>
    <id>http://yoursite.com/2020/03/26/JS_Function/</id>
    <published>2020-03-26T10:05:00.000Z</published>
    <updated>2020-03-26T10:47:50.297Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Function-类型"><a href="#Function-类型" class="headerlink" title="Function 类型"></a>Function 类型</h1><p>每一个函数都是 Function 类型的实例。<a id="more"></a></p><h2 id="内部属性"><a href="#内部属性" class="headerlink" title="内部属性"></a>内部属性</h2><p><strong>this、arguments、caller</strong></p><h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><p>this引用的是函数执行的环境对象。</p><h3 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h3><p>类数组对象，包含着传入函数的所有参数。这里指的是实参。</p><h4 id="cellee"><a href="#cellee" class="headerlink" title="cellee"></a>cellee</h4><p>其中的，cellee属性指向arguments对象的函数。</p><h3 id="caller"><a href="#caller" class="headerlink" title="caller"></a>caller</h3><p>ECMA 5。caller 中保存着调用当前函数的函数的引用。</p><h2 id="函数属性"><a href="#函数属性" class="headerlink" title="函数属性"></a>函数属性</h2><p>函数是对象，因此函数也有属性和方法。其中，属性包括：<strong>length、prototype</strong></p><h3 id="length"><a href="#length" class="headerlink" title="length"></a>length</h3><p>表示函数希望接收到的命名参数的个数。即，形参个数</p><h3 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a>prototype</h3><p>保存着实例方法的真正所在。</p><h2 id="函数方法"><a href="#函数方法" class="headerlink" title="函数方法"></a>函数方法</h2><p>函数是对象，因此函数也有属性和方法。其中，方法包括：<code>call()</code>，<code>apply()</code>、<code>bind()</code>。</p><h3 id="call"><a href="#call" class="headerlink" title="call()"></a>call()</h3><p>在特定的作用域调用函数。不传参指向全局作用域，即：等于设置函数体内 this 对象的值。</p><h3 id="apply"><a href="#apply" class="headerlink" title="apply()"></a>apply()</h3><p>与 call() 功能相同，传参方式不同</p><h3 id="bind"><a href="#bind" class="headerlink" title="bind()"></a>bind()</h3><p>ECMA 5。不是立即调用的</p><h1 id="创建函数"><a href="#创建函数" class="headerlink" title="创建函数"></a>创建函数</h1><p>使用Function构造函数、函数声明、函数表达式</p><h2 id="使用Function构造函数"><a href="#使用Function构造函数" class="headerlink" title="使用Function构造函数"></a>使用Function构造函数</h2><p>只是为了理解。最后一个参数为 函数体 。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"num1"</span>,<span class="string">"num2"</span>,<span class="string">"return num1 + num2"</span>);</span><br></pre></td></tr></table></figure><h2 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h2><p>函数声明形式会存在 <strong>函数提升</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">num1,num2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br><span class="line">sum();</span><br></pre></td></tr></table></figure><h2 id="函数表达式"><a href="#函数表达式" class="headerlink" title="函数表达式"></a>函数表达式</h2><p>不存在 <strong>函数提升</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sum = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;;                             <span class="comment">// 像声明其它变量一样这里要有 ;</span></span><br><span class="line">sum();</span><br></pre></td></tr></table></figure><h1 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h1><p>闭包是指有权访问另一个函数作用域中的变量的函数。</p><h2 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a>作用域链</h2><h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ol><li>执行流进入执行的环境，会将执行环境压入环境<strong>栈</strong>中（先进后出）。</li><li>而在环境中执行时会有一个<strong>变量对象</strong>，这里存储着所在环境的所有的变量或者函数或其它可访问的数据。</li><li>如果执行环境是函数，会将<strong>活动对象</strong>作为变量对象。其中包括 arguments 对象。</li><li>作用域链被保存在内部的 [[Scope]] 属性中。</li><li>向上就近原则，即，向上查询变量名和函数名，找到后就停止。</li></ol><h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><ol><li>使用 with 语句（不建议使用）和 try-catch 语句的 catch 语块 作用域链。</li><li>没有块级作用域。<ul><li>if 语句变量声明会添加到当前执行环境。</li><li>for 执行结束依然存在外部执行环境。</li></ul></li><li>var 声明的会添加到最近的环境。未声明的会添加到全局作用域</li></ol><h3 id="ES6："><a href="#ES6：" class="headerlink" title="ES6："></a>ES6：</h3><ol><li>引入了块级作用域。</li><li>引入了 let 、const 声明。</li></ol><h2 id="理解闭包"><a href="#理解闭包" class="headerlink" title="理解闭包"></a>理解闭包</h2><p>函数在全局中执行，执行完毕后，局部作用域就会被销毁，内存中仅保存全局作用域。闭包是一个函数中定义了另一个函数，内部函数的作用域链就存在了三层：全局（全局变量）、外部函数（外部函数变量）、内部函数（活动对象，内部变量）。内部函数可以根据作用域链访问外部函数里的变量和函数就称为 闭包。</p><h2 id="变量问题"><a href="#变量问题" class="headerlink" title="变量问题"></a>变量问题</h2><p>闭包只能取得外部函数中变量的最后一个值。</p><p>返回一个 <strong>函数数组</strong> 每个函数都返回自己的索引值。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFunctions</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        result[i] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">             <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">createFunctions()</span><br><span class="line"><span class="comment">// (10) [ƒ, ƒ, ƒ, ƒ, ƒ, ƒ, ƒ, ƒ, ƒ, ƒ] 都 return 10</span></span><br></pre></td></tr></table></figure><p>解决：再创建闭包，并将值立即传入。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFunctions</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        result[i] = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">             <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">                 <span class="keyword">return</span> num;</span><br><span class="line">             &#125;;</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">createFunctions()</span><br><span class="line"><span class="comment">// (10) [ƒ, ƒ, ƒ, ƒ, ƒ, ƒ, ƒ, ƒ, ƒ, ƒ] 各自 return 0~9</span></span><br></pre></td></tr></table></figure><h2 id="this问题"><a href="#this问题" class="headerlink" title="this问题"></a>this问题</h2><p>this 指向调用它的函数的作用域。且在<strong>调用</strong>时就会取得这个指向当前调用的作用域的 this ,并将其放到自己的活动对象里去，在自己活动对象中找到后就不再继续向上查找了，因此 this 值是永远不可能向上查找的。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> b = <span class="string">"全局作用域"</span>;</span><br><span class="line"> <span class="keyword">var</span> object = &#123;</span><br><span class="line">     b : <span class="string">"局部作用域"</span>,</span><br><span class="line">     a : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="keyword">this</span>.b)</span><br><span class="line">               <span class="built_in">console</span>.dir(<span class="keyword">this</span>)  <span class="comment">// Window 对象</span></span><br><span class="line">            &#125;</span><br><span class="line">            c()</span><br><span class="line">      &#125;</span><br><span class="line"> &#125;</span><br><span class="line">object.a() <span class="comment">// 全局作用域</span></span><br></pre></td></tr></table></figure><h3 id="解决："><a href="#解决：" class="headerlink" title="解决："></a>解决：</h3><h4 id="保存变量"><a href="#保存变量" class="headerlink" title="保存变量"></a>保存变量</h4><p><code>var that = this</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> b = <span class="string">"全局作用域"</span>;</span><br><span class="line"> <span class="keyword">var</span> object = &#123;</span><br><span class="line">     b : <span class="string">"局部作用域"</span>,</span><br><span class="line">     a : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(that.b)</span><br><span class="line">               <span class="built_in">console</span>.dir(that)  <span class="comment">// Object 实例对象</span></span><br><span class="line">            &#125;</span><br><span class="line">            c()</span><br><span class="line">      &#125;</span><br><span class="line"> &#125;</span><br><span class="line">object.a() <span class="comment">// 局部作用域</span></span><br></pre></td></tr></table></figure><h4 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> b = <span class="string">"全局作用域"</span>;</span><br><span class="line"> <span class="keyword">var</span> object = &#123;</span><br><span class="line">     b : <span class="string">"局部作用域"</span>,</span><br><span class="line">     a : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="keyword">this</span>.b)   </span><br><span class="line">        &#125;</span><br><span class="line"> &#125;&#125;</span><br><span class="line">object.a()() <span class="comment">// 局部作用域</span></span><br></pre></td></tr></table></figure><h4 id="call-apply-bind"><a href="#call-apply-bind" class="headerlink" title="call()/apply()/bind()"></a><code>call()/apply()/bind()</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> b = <span class="string">"全局作用域"</span>;</span><br><span class="line"> <span class="keyword">var</span> object = &#123;</span><br><span class="line">     b : <span class="string">"局部作用域"</span>,</span><br><span class="line">     a : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="keyword">this</span>.b)   </span><br><span class="line">        &#125;</span><br><span class="line"> &#125;&#125;</span><br><span class="line">object.a.call()() <span class="comment">// 未传值 打印全局作用域</span></span><br><span class="line">object.a.call(object)();  <span class="comment">// 局部作用域</span></span><br></pre></td></tr></table></figure><h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><h3 id="垃圾回收机制"><a href="#垃圾回收机制" class="headerlink" title="垃圾回收机制"></a>垃圾回收机制</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>JavaScript 具有自动垃圾回收机制。原理：垃圾收集器会按照固定的时间间隔，并周期性的执行，即，找出不再继续使用的变量，然后释放其占用的内存。</p><h4 id="策略"><a href="#策略" class="headerlink" title="策略"></a>策略</h4><p>标记清除：</p><ol><li>各个浏览器垃圾收集的时间间隔不同。</li></ol><p>引用计数：</p><ol><li>循环引用造成内存泄漏。</li><li>IE中BOM/DOM是COM对象，其采用的机制就是基于引用计数策略，当涉及COM对象，就会造成内存泄漏。</li><li>解决：在不使用时，将循环引用的变量置为空 null。</li></ol><h4 id="管理内存"><a href="#管理内存" class="headerlink" title="管理内存"></a>管理内存</h4><p>局部变量在其离开执行环境时会自动被解除引用。对于全局变量和全局对象我们需要手动将其置为 null，解除引用。</p><h3 id="闭包中的内存泄漏"><a href="#闭包中的内存泄漏" class="headerlink" title="闭包中的内存泄漏"></a>闭包中的内存泄漏</h3><p>问题1：IE 中闭包的作用域链中保存一个 HTML 元素，由于引用计数和循环引用，导致该元素无法被销毁。</p><p>解决：</p><ol><li>将该元素副本保存在变量中，在闭包中引用该变量，解除循环引用。</li><li>使用结束后将该元素置为空，解除对DOM元素对象的引用。</li></ol><p>问题2：内部函数引用外部函数，外部函数活动对象无法及时销毁。</p><p>解决：只有将 内部函数 设置为 null ，解除对内部函数的引用，通知垃圾回收机将其清除，才能够将整个作用域安全销毁，除了全局作用域。</p><h1 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h1><p>自身调用自身。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> factorial = (<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (num&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> num * f(num<span class="number">-1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 计算阶乘</span></span><br></pre></td></tr></table></figure><h1 id="模仿块级作用域"><a href="#模仿块级作用域" class="headerlink" title="模仿块级作用域"></a>模仿块级作用域</h1><p>ES5 中没有块级作用域（私有作用域），但是可以用 匿名函数来模仿。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 这里是块级作用域</span></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 理解</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 这里是块级作用域</span></span><br><span class="line">&#125;;</span><br><span class="line">a();</span><br></pre></td></tr></table></figure><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outputNumbers</span> (<span class="params">count</span>) </span>&#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;count;i++) &#123;</span><br><span class="line">            alert(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)();</span><br><span class="line">    alert(i); <span class="comment">// 报错</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在函数内部，限制向全局作用域添加过多的变量和函数。</p><ol><li>可以避免命名冲突而导致全的局污染。</li><li>可以减少闭包占用的内存问题，因为没有指向匿名函数的引用。函数执行完毕，就立即清除了其作用域链。</li></ol><h1 id="私有变量"><a href="#私有变量" class="headerlink" title="私有变量"></a>私有变量</h1><p>在函数中定义的变量，称为私有变量。私有变量包括：函数参数、局部变量、函数中定义的其他函数。</p><h2 id="特权方法"><a href="#特权方法" class="headerlink" title="特权方法"></a>特权方法</h2><p>有权访问私有变量和私有函数的公有方法称为特权方法。</p><h2 id="构造函数中"><a href="#构造函数中" class="headerlink" title="构造函数中"></a>构造函数中</h2><p>即，在构造函数中定义函数，根据闭包的原理访问私有变量。</p><h2 id="静态私有变量"><a href="#静态私有变量" class="headerlink" title="静态私有变量"></a>静态私有变量</h2><p>通过在私有作用域中 定义私有变量或函数创建特权方法。</p><h2 id="模块模式"><a href="#模块模式" class="headerlink" title="模块模式"></a>模块模式</h2><p>为 单例 创建私有变量和特权的方法。</p><h2 id="增强的模块模式"><a href="#增强的模块模式" class="headerlink" title="增强的模块模式"></a>增强的模块模式</h2><h1 id="ES6中的变化"><a href="#ES6中的变化" class="headerlink" title="ES6中的变化"></a>ES6中的变化</h1><ol><li>let const 声明</li><li>块级作用域 {}</li><li>箭头函数</li></ol><h1 id="高级函数"><a href="#高级函数" class="headerlink" title="高级函数"></a>高级函数</h1><p>函数的一些高级使用方法：</p><p>安全的类型检测、作用域安全的构造函数、惰性载入函数、函数绑定、函数柯里化</p><h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><ol><li>《JavaScript 高级程序设计》</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="noopener">MDN 箭头函数</a></li><li><a href="https://es6.ruanyifeng.com/#docs/let#%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F" target="_blank" rel="noopener">阮一峰ES6块级作用域</a></li><li><a href="https://es6.ruanyifeng.com/#docs/function" target="_blank" rel="noopener">阮一峰ES6函数扩展</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Function-类型&quot;&gt;&lt;a href=&quot;#Function-类型&quot; class=&quot;headerlink&quot; title=&quot;Function 类型&quot;&gt;&lt;/a&gt;Function 类型&lt;/h1&gt;&lt;p&gt;每一个函数都是 Function 类型的实例。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="原生JS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="Function" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/Function/"/>
    
    
      <category term="原生JS" scheme="http://yoursite.com/tags/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>Object 理解</title>
    <link href="http://yoursite.com/2020/02/14/JS_Object/"/>
    <id>http://yoursite.com/2020/02/14/JS_Object/</id>
    <published>2020-02-14T08:39:00.000Z</published>
    <updated>2020-03-26T10:47:08.383Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Object-对象"><a href="#Object-对象" class="headerlink" title="Object 对象"></a>Object 对象</h1><p>a person or thing to which a specified action or feeling is directed.<a id="more"></a></p><p>翻译：指定的动作或感觉针对的人或事物。</p><p><img src="https://xiangwenhu.github.io/blog/img/proto.jpg" alt="原型关系图"></p><h1 id="理解对象"><a href="#理解对象" class="headerlink" title="理解对象"></a>理解对象</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Nicholas"</span>,     <span class="comment">// 基本值</span></span><br><span class="line">    <span class="string">"age"</span>: <span class="string">"18"</span>,             </span><br><span class="line">    look: &#123;                 <span class="comment">// 对象</span></span><br><span class="line">        <span class="string">"height"</span>: <span class="number">182</span>,</span><br><span class="line">        <span class="string">"weight"</span>: <span class="string">"60kg"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sayName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">// 函数</span></span><br><span class="line">        alert(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.dir(person.age)</span><br></pre></td></tr></table></figure><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>对象是 一组无序<strong>属性</strong>的集合。这里的属性可以包括 基本值、对象、函数。（ECMA-262）</p><h3 id="属性类型"><a href="#属性类型" class="headerlink" title="属性类型"></a>属性类型</h3><p>而这些属性分为两种 <strong>数据属性</strong>，<strong>访问属性</strong>。它们拥有一些特性，用来给JS引擎解析，告诉浏览器这个对象可以进行哪些操作，这些特性均有默认值。</p><h3 id="属性特性"><a href="#属性特性" class="headerlink" title="属性特性"></a>属性特性</h3><p>以下是它们的特性：</p><p>是否：[configurable]可删除及定义   [enumerable]枚举   [writable]更改   [value]值   [get]读取   [set]写入</p><p>数据属性 ：[configurable]、[enumerable]、[writable]、[value]</p><p>访问属性：[configurable]、[enumerable]、[get]、[set]</p><h1 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h1><h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p>对象是一组数据和功能的集合。</p><h2 id="理解："><a href="#理解：" class="headerlink" title="理解："></a>理解：</h2><h3 id="数据类型："><a href="#数据类型：" class="headerlink" title="数据类型："></a>数据类型：</h3><h4 id="值类型-基本类型-7种："><a href="#值类型-基本类型-7种：" class="headerlink" title="值类型(基本类型)7种："></a>值类型(基本类型)7种：</h4><p>字符串（String）、数字(Number)、大整数（BigInt）、布尔(Boolean)、空（Null）、未定义（Undefined）、Symbol（符号、代表）。</p><h4 id="引用数据类型-Object"><a href="#引用数据类型-Object" class="headerlink" title="引用数据类型 Object"></a>引用数据类型 Object</h4><p>此处列举了部分 <strong>内置对象</strong></p><p><strong>目的</strong>：提供这些原生的引用类型，是为了 <strong>方便开发人员实现常见的计算任务</strong>。</p><ol><li>对象(Object)、数组(Array)、函数(Function)、日期（Date）、正则（RegExp）。<ul><li>Object是一个基础类型，其他所有类型都从Object继承了基本行为。</li></ul></li><li>基本包装类型（Boolean/Number/String）。<ul><li>JavaScript 中的基本类型的值，可以被当做 对象 来访问。</li></ul></li><li>单体内置对象（Global/Math）。<ul><li>Global 全局对象，在浏览器中是window对象</li><li>Math 用于计算</li></ul></li></ol><p>就像其他基本数据类型一样，比如，字符串类型可以使用内置对象所有操作字符串的方法。同样，任何对象类型也都继承了所有 Object 的原型方法。而接下来讨论的 <strong>自定义对象</strong> 就讨论了它是如何实现的。</p><p><img src="https://upload-images.jianshu.io/upload_images/8661291-f737c541d87566ee.png?imageMogr2/auto-orient/strip|imageView2/2/w/538/format/webp" alt="img"></p><h1 id="自定义对象"><a href="#自定义对象" class="headerlink" title="自定义对象"></a>自定义对象</h1><p>顾名思义，定义自己的对象。</p><h2 id="原始方法"><a href="#原始方法" class="headerlink" title="原始方法:"></a>原始方法:</h2><h3 id="原始方法1："><a href="#原始方法1：" class="headerlink" title="原始方法1："></a>原始方法1：</h3><p>使用 Object() 构造函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">o.name = ...</span><br></pre></td></tr></table></figure><h3 id="原始方法2："><a href="#原始方法2：" class="headerlink" title="原始方法2："></a>原始方法2：</h3><p>使用 字面量 。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">"Nicholas"</span>,     <span class="comment">// 基本值</span></span><br><span class="line">    age: <span class="string">"18"</span>,             </span><br><span class="line">    look: &#123;                 <span class="comment">// 对象</span></span><br><span class="line">        height: <span class="number">182</span>,</span><br><span class="line">        weight: <span class="string">"60kg"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sayName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">// 方法</span></span><br><span class="line">        alert(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.dir(person.age)</span><br></pre></td></tr></table></figure><p><strong>缺点：多次创建时，会产生许多重复代码。</strong>因此引入了函数（工厂模式）</p><h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerson</span>(<span class="params">name,age,&#123;height,weight&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">    o.name = ...</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = person(<span class="string">"Nicholas"</span>,<span class="string">"29"</span>,&#123;<span class="number">160</span>,<span class="string">"60kg"</span>&#125;)</span><br><span class="line"><span class="keyword">var</span> person2 = person(<span class="string">"Tom"</span>,<span class="string">"18"</span>,&#123;<span class="number">182</span>,<span class="string">"70kg"</span>&#125;)</span><br></pre></td></tr></table></figure><p><strong>缺点：无法识别对象的类型。</strong>因此引入了 <strong>new</strong> 构造函数模式</p><h2 id="构建函数模式"><a href="#构建函数模式" class="headerlink" title="构建函数模式"></a>构建函数模式</h2><h3 id="构造函数模式（1）"><a href="#构造函数模式（1）" class="headerlink" title="构造函数模式（1）"></a>构造函数模式（1）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age,&#123;height,weight&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = ...</span><br><span class="line">    <span class="keyword">this</span>.sayName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// this.sayName = new Function("alert(this.name)")</span></span><br><span class="line">        alert(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"Nicholas"</span>,<span class="string">"29"</span>,&#123;<span class="number">160</span>,<span class="string">"60kg"</span>&#125;)</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> person(<span class="string">"Tom"</span>,<span class="string">"18"</span>,&#123;<span class="number">182</span>,<span class="string">"70kg"</span>&#125;)</span><br></pre></td></tr></table></figure><p>当使用 new 操作符的时候，实际上进行了一下4个步骤：</p><ol><li>创建一个新的对象。</li><li>将构造函数的作用域赋给了新的对象（因此 this 就指向了这个新对象）</li><li>执行构造函数中的代码（为新对象添加属性）</li><li>返回新对象</li></ol><p><strong>缺点：每次都要把构造函数中的方法在实例上再创建一遍</strong>。因此引入了<strong>（2）</strong>。</p><h3 id="构造函数模式（2）"><a href="#构造函数模式（2）" class="headerlink" title="构造函数模式（2）"></a>构造函数模式（2）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age,&#123;height,weight&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = ...</span><br><span class="line">    <span class="keyword">this</span>.sayName = sayName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayName</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    alert(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"Nicholas"</span>,<span class="string">"29"</span>,&#123;<span class="number">160</span>,<span class="string">"60kg"</span>&#125;)</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> person(<span class="string">"Tom"</span>,<span class="string">"18"</span>,&#123;<span class="number">182</span>,<span class="string">"70kg"</span>&#125;)</span><br></pre></td></tr></table></figure><p>将函数挂载到全局，共享。</p><p><strong>缺点：全局污染、没有封装性可言了</strong>。因此引入<strong>原型模式</strong></p><h2 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h2><h3 id="原型模式（1）"><a href="#原型模式（1）" class="headerlink" title="原型模式（1）"></a>原型模式（1）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">Person.prototype.name = <span class="string">"Nicholas"</span>;</span><br><span class="line">...</span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person()</span><br><span class="line">alert(person1.name)</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> person()</span><br><span class="line">person2.name = <span class="string">"Tom"</span></span><br><span class="line">alert(person2.name)</span><br></pre></td></tr></table></figure><h3 id="原型模式（2）"><a href="#原型模式（2）" class="headerlink" title="原型模式（2）"></a>原型模式（2）</h3><p>简写：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">Person.prototype= &#123;</span><br><span class="line">    name:<span class="string">"Nicholas"</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>缺点：引用类型被共享，不利于部分数据私有化。</strong>引入<strong>混合模式</strong></p><h2 id="混合模式"><a href="#混合模式" class="headerlink" title="混合模式"></a>混合模式</h2><p>最常见的方式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">People</span>(<span class="params">name,eye</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name;</span><br><span class="line">   <span class="keyword">this</span>.eye = eye;</span><br><span class="line">&#125;</span><br><span class="line">People.prototype.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">   alert (<span class="keyword">this</span>.name);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> man4 = <span class="keyword">new</span> People(<span class="string">"Flancer一号"</span>,<span class="string">"small"</span>);</span><br><span class="line">man4.say();</span><br></pre></td></tr></table></figure><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><p>除此之外还有，寄生构造函数模式、稳妥构造函数模式。</p><h1 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h1><h2 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h2><p>是如今最常见的继承方法。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 混合模式 People 对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">People</span>(<span class="params">name,eye</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name;</span><br><span class="line">   <span class="keyword">this</span>.eye = eye;</span><br><span class="line">&#125;</span><br><span class="line">People.prototype.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">   alert (<span class="keyword">this</span>.name);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> man = <span class="keyword">new</span> People(<span class="string">"Flancer一号"</span>,<span class="string">"small"</span>);</span><br><span class="line">man.say();</span><br></pre></td></tr></table></figure><p>使用 组合继承</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 使用 混合模式 构建 Manman 对象</span></span><br><span class="line"><span class="comment"> * 使用 组合继承 实现 Manman对象 继承 People对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Man</span> (<span class="params">name,eye,huzi</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.huzi = huzi;</span><br><span class="line">    People.call(<span class="keyword">this</span>,name,eye)     <span class="comment">// 属性继承</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Man.prototype = <span class="keyword">new</span> People()    <span class="comment">// 原型继承</span></span><br><span class="line"></span><br><span class="line">Man.prototype.sayhuzi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   alert(<span class="keyword">this</span>.huzi)</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> boy = <span class="keyword">new</span> Man(<span class="string">"Flancer二号"</span>,<span class="string">"big"</span>,<span class="string">"胡子"</span>);</span><br><span class="line">boy.sayhuzi();</span><br><span class="line">boy.say();</span><br></pre></td></tr></table></figure><h2 id="寄生组合传承"><a href="#寄生组合传承" class="headerlink" title="寄生组合传承"></a>寄生组合传承</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inserit</span>(<span class="params">son, father</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> obj = <span class="built_in">Object</span>.create(father.prototype);</span><br><span class="line">    son.prototype = obj;</span><br><span class="line">    obj.constructor = son</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 使用 混合模式 构建 Manman 对象</span></span><br><span class="line"><span class="comment"> * 使用 组合继承 实现 Manman对象 继承 People对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Man</span> (<span class="params">name,eye,huzi</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.huzi = huzi;</span><br><span class="line">    People.call(<span class="keyword">this</span>,name,eye)     <span class="comment">// 属性继承</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inserit(Man,People)   <span class="comment">// 寄生继承 原型</span></span><br><span class="line"></span><br><span class="line">Man.prototype.sayhuzi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   alert(<span class="keyword">this</span>.huzi)</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> boy = <span class="keyword">new</span> Man(<span class="string">"Flancer二号"</span>,<span class="string">"big"</span>,<span class="string">"胡子"</span>);</span><br><span class="line">boy.sayhuzi();</span><br><span class="line">boy.say();</span><br></pre></td></tr></table></figure><h1 id="关于原型链"><a href="#关于原型链" class="headerlink" title="关于原型链"></a>关于原型链</h1><ol><li><strong>任何对象在创建时</strong>都会有一个<code>__proto__</code>内置属性，它指向创建这个对象的<strong>构造函数</strong>的原型<code>prototype = {}</code>。除了 <strong>undefined</strong> 和 <strong>NULL</strong>，没有构造他们的东西。</li><li><strong>任何 函数 (虽然只有函数，也就是除了基本数据类型的所有东西) 在创建时</strong>都会给予拥有一个名为<code>prototype</code>的属性，这个属性指向该函数的 <strong>原型对象</strong>。</li><li>在创建 <code>prototype</code> 的同时会在其内部放一个 constructor 指向它的构造函数。</li></ol><h1 id="高级技巧"><a href="#高级技巧" class="headerlink" title="高级技巧"></a>高级技巧</h1><p>可以让开发人员定义 <strong>防篡改对象</strong>。</p><h2 id="防篡改对象"><a href="#防篡改对象" class="headerlink" title="防篡改对象"></a>防篡改对象</h2><p>通过改变对象属性的特性来指定对象行为。一旦把对象定义为防篡改，就无法撤销了。</p><h3 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h3><p>它们分别为，不可扩展对象、密封对象、冻结的对象。</p><h1 id="ES6-中的对象"><a href="#ES6-中的对象" class="headerlink" title="ES6 中的对象"></a>ES6 中的对象</h1><h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><p>一种建立在 原型链原理 上的语法糖。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> myMethod() &#123;    <span class="comment">// 静态方法 不会继承到实例，可以继承到子类，通过调用类调用</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>()&#123;            <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="keyword">this</span>.num = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  toValue () &#123;               <span class="comment">// 原型</span></span><br><span class="line">     <span class="built_in">console</span>.log(<span class="keyword">this</span>.num)   </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">A.myMethod();         <span class="comment">// 调用静态方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类 B 继承 A</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> myMethod() &#123;    <span class="comment">// 静态方法 </span></span><br><span class="line">    <span class="keyword">super</span>.myMethod();    <span class="comment">// 继承父类静态方法，通过调用类调用，this指向子类而不是实例</span></span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">constructor</span>()&#123; </span><br><span class="line">    <span class="keyword">super</span>();                 <span class="comment">// 继承构造函数</span></span><br><span class="line">    <span class="keyword">this</span>.num = <span class="number">2</span>;  </span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  m () &#123;</span><br><span class="line">    <span class="keyword">super</span>.toValue()          <span class="comment">// 继承原型</span></span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类 B 实例</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B();</span><br><span class="line">b.m() <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol><li>类的内部所有定义的方法，都是不可枚举的（non-enumerable）。</li><li>方法后面不要加 逗号，会报错。</li><li>默认为严格模式。</li><li>不存在变量提升。</li></ol><h2 id="新扩展"><a href="#新扩展" class="headerlink" title="新扩展"></a>新扩展</h2><p><code>Object.assign</code>方法</p><h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><ol><li>《JavaScript 高级程序设计》</li><li><a href="https://xiangwenhu.github.io/blog/img/proto.jpg" target="_blank" rel="noopener">原型链图片</a></li><li><a href="https://upload-images.jianshu.io/upload_images/8661291-f737c541d87566ee.png?imageMogr2/auto-orient/strip|imageView2/2/w/538/format/webp" target="_blank" rel="noopener">内存图</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Object-对象&quot;&gt;&lt;a href=&quot;#Object-对象&quot; class=&quot;headerlink&quot; title=&quot;Object 对象&quot;&gt;&lt;/a&gt;Object 对象&lt;/h1&gt;&lt;p&gt;a person or thing to which a specified action or feeling is directed.
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="原生JS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="Object" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%8E%9F%E7%94%9FJS/Object/"/>
    
    
      <category term="原生JS" scheme="http://yoursite.com/tags/%E5%8E%9F%E7%94%9FJS/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>float 相关</title>
    <link href="http://yoursite.com/2019/03/28/cssFloat/"/>
    <id>http://yoursite.com/2019/03/28/cssFloat/</id>
    <published>2019-03-28T15:01:00.000Z</published>
    <updated>2020-03-16T08:51:04.746Z</updated>
    
    <content type="html"><![CDATA[<h1 id="float-相关"><a href="#float-相关" class="headerlink" title="float 相关"></a>float 相关</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>float CSS属性指定一个元素应沿其容器的左侧或右侧放置，允许文本和内联元素<a id="more"></a>环绕它。该元素从网页的正常流动(文档流)中移除，尽管仍然保持部分的流动性（与<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position#Absolute_positioning" target="_blank" rel="noopener">绝对定位</a>相反）</p><h3 id="如何定位"><a href="#如何定位" class="headerlink" title="如何定位"></a>如何定位</h3><p>当一个元素浮动之后，它会被移出正常的文档流，然后向左或者向右平移，一直平移直到碰到了所处的容器的边框，或者碰到<strong>另外一个浮动的元素</strong>。</p><h2 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h2><h3 id="display"><a href="#display" class="headerlink" title="display"></a>display</h3><p>首先 float 属性会影响到页面的布局，所以涉及到一些 display 的一些块级元素（block），内联元素（inline）及内联块级（inline-block）的知识。</p><p>因为 float 元素 定义： <strong><em>“允许文本和内联元素环绕它”</em></strong></p><ol><li>可以使文本和兄弟内联元素环绕，也是设计该属性的初衷。</li></ol><p>因为 float 元素定义：  <strong><em>“该元素从网页的正常流动(文档流)中移除，尽管仍然保持部分的流动性”</em></strong> 对于该句我是这样理解的：</p><p>首先 block元素 的默认宽度是 <code>width:auto;</code> 自动调整宽度。在不带float的情况下，block元素 的宽度会自动调整至最大化占据整行，而float元素会自动调整至最小化，在不设置宽高的情况下会被内容撑起。</p><p>float元素仅会对自身（宽高默认自适应但可设置），文字及内联兄弟元素（inline元素）环绕，下一个兄弟float元素产生影响。</p><p>对于<strong>块级（block元素会另起一行）</strong>、<strong>兄弟父元素（忽略其高度）</strong> 及 <strong>父兄元素（相对父元素排列，与float元素无关）</strong>。</p><p>因此：</p><ol start="2"><li><p>它会将 float 元素当做 display：block 元素去计算宽高（像是自动添加了 block 框），<strong>包裹性</strong> 即可设置宽高。</p></li><li><p>block元素默认高度也是 <code>height:auto</code> 由内容撑起，在计算高度（height 值）时，会忽略浮动的元素的高度，而基于此父元素的下一个文档流的父兄弟元素就也会忽略该浮动元素，及为其父亲 带来 <strong>高度塌陷问题</strong>。</p></li></ol><h3 id="float-特性总结"><a href="#float-特性总结" class="headerlink" title="float 特性总结"></a>float 特性总结</h3><p>img div float</p><p><em>使用 float 可以带来</em> ：</p><p><strong>将元素浮向左或右</strong>、<strong>宽高默认自适应</strong>、<strong>文字及内联元素环绕</strong>、<strong>包裹性（可设置宽高）</strong>、<strong>高度塌陷（高度被父忽略）</strong>。</p><h2 id="清除浮动"><a href="#清除浮动" class="headerlink" title="清除浮动"></a>清除浮动</h2><h3 id="为什么要清除浮动"><a href="#为什么要清除浮动" class="headerlink" title="为什么要清除浮动"></a>为什么要清除浮动</h3><p>根据 float  的 特性，当这些特性影响了我们的布局，即，超出了我们的设计的预期时，我们就想要清除浮动。主要是为了解决 清除文字环绕，和高度塌陷带来的布局问题。</p><h3 id="如何清除"><a href="#如何清除" class="headerlink" title="如何清除"></a>如何清除</h3><ol><li>利用 clear 属性</li><li>利用 BFC</li></ol><h2 id="全文参考"><a href="#全文参考" class="headerlink" title="全文参考"></a>全文参考</h2><blockquote><p>float：<a href="https://developer.mozilla.org/zh-CN/docs/CSS/float" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/CSS/float</a><br>display：<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/display</a><br>position：<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position#Absolute_positioning" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/position#Absolute_positioning</a><br>块级元素：&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Block-level_elements" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTML/Block-level_elements</a></p></blockquote><p><a href="https://blog.csdn.net/tt_twilight/article/details/72804104" target="_blank" rel="noopener">float对内联元素和块元素的影响</a></p><p><a href="https://juejin.im/post/59e7190bf265da4307025d91" target="_blank" rel="noopener">清除浮动的四种方式及其原理理解</a></p><p><a href="https://blog.csdn.net/qq_22855325/article/details/78015502" target="_blank" rel="noopener">完全理解float之“不完全脱离文档流”</a></p><p><a href="https://blog.csdn.net/qq_31915745/article/details/72524465" target="_blank" rel="noopener">理解为何需要清除浮动及清除浮动的方法</a></p><p><a href="https://blog.csdn.net/forest_fire/article/details/50944864" target="_blank" rel="noopener">行内元素在为什么设置浮动后可以设置高宽</a></p><p><a href="https://www.jianshu.com/p/05c48bf43b1a" target="_blank" rel="noopener">inline-block和float的共性和区别</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;float-相关&quot;&gt;&lt;a href=&quot;#float-相关&quot; class=&quot;headerlink&quot; title=&quot;float 相关&quot;&gt;&lt;/a&gt;float 相关&lt;/h1&gt;&lt;h2 id=&quot;定义&quot;&gt;&lt;a href=&quot;#定义&quot; class=&quot;headerlink&quot; title=&quot;定义&quot;&gt;&lt;/a&gt;定义&lt;/h2&gt;&lt;p&gt;float CSS属性指定一个元素应沿其容器的左侧或右侧放置，允许文本和内联元素
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="CSS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/CSS/"/>
    
      <category term="float" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/CSS/float/"/>
    
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="CSS" scheme="http://yoursite.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>Position</title>
    <link href="http://yoursite.com/2019/03/28/cssPosition/"/>
    <id>http://yoursite.com/2019/03/28/cssPosition/</id>
    <published>2019-03-28T15:01:00.000Z</published>
    <updated>2020-03-16T08:42:40.825Z</updated>
    
    <content type="html"><![CDATA[<h1 id="position-定位问题"><a href="#position-定位问题" class="headerlink" title="position 定位问题"></a>position 定位问题</h1><h2 id="position：static"><a href="#position：static" class="headerlink" title="position：static"></a>position：static</h2><ul><li>position:static,静态定位，这种定位是默认的，即正常的文档流，一般没有实际作用</li><li>特点<a id="more"></a><ul><li>静态定位的元素不会受到 top right bottom left 的影响</li></ul></li></ul><h2 id="position：relative"><a href="#position：relative" class="headerlink" title="position：relative"></a>position：relative</h2><ul><li>position:relative,相对定位，不会脱离文档流，类似于static,默认按照顺序排列，可以通过<ul><li>margin-top    /    top</li><li>margin-right    /    right</li><li>margin-bottom    /    bottom</li><li>margin-left     /    left<br>来改变元素的位置，（注意在简写的时候也是按照这个顺序，顺时针），可以看出，都只是相对于正常位置的偏移。</li></ul></li><li>特点<ul><li>相对于它原本的正常位置偏移，因此它原本的所占的空间不会改变。也就是说，在它之下的文档流元素依然按照它原本的位置排列。</li><li>经常被用作绝对定位的容器块。</li></ul></li></ul><h2 id="position：absolute"><a href="#position：absolute" class="headerlink" title="position：absolute"></a>position：absolute</h2><ul><li>position:absolute,绝对定位，脱离文档流，可以用<ul><li>top</li><li>right</li><li>bottom</li><li>left<br>​  来控制元素的位置，需要注意的是，它是相对于最近祖先为非static定位来定位的，如果它的父级元素定位是默认的，它会继续向上找，直到找到为止，如果页面上没有，就相对于 html 。</li></ul></li><li>特点<ul><li>由于它是脱离文档流的，因此它的变动是不会对文档流的其他布局产生影响的。</li><li>在 absolute 定位下，float: left/right ,对它是不起作用的</li></ul></li></ul><h2 id="子绝父相"><a href="#子绝父相" class="headerlink" title="子绝父相"></a>子绝父相</h2><ul><li>即，父元素是相对定位（position：relative），子元素是绝对定位（position:absolute），被经常用来定位元素。因此相对定位经常被用作容器块。</li></ul><h2 id="position-fixed"><a href="#position-fixed" class="headerlink" title="position : fixed"></a>position : fixed</h2><ul><li>position : fixed,固定定位，它是相对于浏览器窗口来进行定位的，例如我们经常在网页中见到的 回到顶部 按钮就是利用这种定位，一般使用 top right bottom left,进行操作。</li><li>特点<ul><li>它同样也脱离了文档流，它的位置与文档流无关。</li><li>fixed 定位在 IE7 和 IE8 下需要描述 !DOCTYPE 才会支持</li></ul></li></ul><h2 id="position：sticky"><a href="#position：sticky" class="headerlink" title="position：sticky"></a>position：sticky</h2><p>—– 这个定位好好玩啊啊啊，之前没有用过（暴露了我的无知、浅薄、傻了吧唧）。o(╥﹏╥)o</p><ul><li>position:sticky ,粘（zhan）性定位,基于用户的滚动位置来定位的。它有一个由 top/right/bottom/left构成的特定阀值，也必须有他们才能使粘性定位生效。在跨越特定阀值之前为相对定位（position：relative）,之后为固定定位（position:fixed）,固定在目标位置。</li><li>特点：<ul><li>Internet Explorer,Edge 15 及 更早的 IE 版本不支持 sticky 定位。</li><li>Safari需要使用 position: - webkit-prefix;来做兼容 。</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;position-定位问题&quot;&gt;&lt;a href=&quot;#position-定位问题&quot; class=&quot;headerlink&quot; title=&quot;position 定位问题&quot;&gt;&lt;/a&gt;position 定位问题&lt;/h1&gt;&lt;h2 id=&quot;position：static&quot;&gt;&lt;a href=&quot;#position：static&quot; class=&quot;headerlink&quot; title=&quot;position：static&quot;&gt;&lt;/a&gt;position：static&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;position:static,静态定位，这种定位是默认的，即正常的文档流，一般没有实际作用&lt;/li&gt;
&lt;li&gt;特点
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="CSS" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/CSS/"/>
    
      <category term="position" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/CSS/position/"/>
    
    
      <category term="前端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="CSS" scheme="http://yoursite.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>Node.js——Readme</title>
    <link href="http://yoursite.com/2019/03/27/JS_Node/"/>
    <id>http://yoursite.com/2019/03/27/JS_Node/</id>
    <published>2019-03-27T11:48:00.000Z</published>
    <updated>2020-02-09T10:04:07.940Z</updated>
    
    <content type="html"><![CDATA[<h1 id="README"><a href="#README" class="headerlink" title="README"></a>README</h1><h2 id="后端语言"><a href="#后端语言" class="headerlink" title="后端语言"></a>后端语言</h2><ul><li>后端当然有：Java PHP Python Ruby .Net … Node.js。</li><li>啊，作为前端进入后台的切入口，当然是Node.js了。<a id="more"></a></li><li>Node.js是一个 JavaScript 运行时的<strong>环境</strong>，可以解析执行 js 代码，摆脱了浏览器来运行。</li><li><p>js与node.js的区别：<br>​  - js : EcmaScript语法（if/ for/ var…）、 BOM、 DOM。<br>​  - Node.js : 没有 BOM DOM ，有 EcmaScript 及其一些服务器级别的操作 API，比如：文件读写、网络服务的构建、网络通信、http服务器…等处理。</p></li><li><p>构建于 Chrome 的 V8 引擎之上（公认的最快的 JS 解析引擎）。</p></li><li><p>特性：event-driven 事件驱动。<br>​  - non-blocking I/O model 非阻塞IO模型（异步）。<br>​  - lightweight and efficient 轻量高效  等。</p></li><li><p>相关：基于node开发的npm是放着js相关的绝大多数的包。<br><a href="https://nodejs.org/en/" target="_blank" rel="noopener">node.js官方网站</a></p></li></ul><h2 id="能做什么"><a href="#能做什么" class="headerlink" title="能做什么"></a>能做什么</h2><ul><li>Web 服务器后台</li><li>命令行工具<ul><li>npm (node)</li><li>git (c语言)</li><li>hexo (node,嘻嘻就是本博客啦(～￣(OO)￣)ブ）</li></ul></li><li>对于前端来说，接触node最多的是它的命令行工具<ul><li>webpack</li><li>gulp</li><li>npm</li></ul></li><li>简单命令行操作<ul><li>cd   切换目录</li><li>dir   列出目录</li><li>ls   列出目录</li><li>mkdir</li><li>rm  </li><li>cls  //clear 清屏</li></ul></li></ul><h2 id="资源推荐"><a href="#资源推荐" class="headerlink" title="资源推荐"></a>资源推荐</h2><ul><li>《深入浅出Node.js》  朴灵，偏理论</li><li>《Node.js权威指南》  API讲解</li><li>《编写可维护的 JavaScript》</li><li>《JavaScript 语言精粹》</li><li>《JavaScript 高级编程》</li><li><a href="http://javascript.ruanyifeng.com/" target="_blank" rel="noopener">JavaScript 标准参考教程(alph)</a>（阮一峰o(╥﹏╥)o大佬）</li><li><a href="http://www.nodebeginner.org/index-zh-cn.html" target="_blank" rel="noopener">Node入门</a></li><li><a href="https://nodejs.org/dist/latest-v6.x/docs/api/" target="_blank" rel="noopener">官方API文档</a></li><li><a href="http://cnodejs.org" target="_blank" rel="noopener">CNODE社区</a></li><li><a href="http://cnodejs.org/getstart" target="_blank" rel="noopener">CNODE-新手入门</a></li><li><a href="http://www.nodeclass.com/api/node.html" target="_blank" rel="noopener">中文文档（较老）</a></li><li><a href="http://tool.oschina.net/commons" target="_blank" rel="noopener">在线查看各个文件格式</a></li><li><a href="https://standardjs.com" target="_blank" rel="noopener">比较被人熟知的代码规范</a></li></ul><h2 id="重点关注"><a href="#重点关注" class="headerlink" title="重点关注"></a>重点关注</h2><ul><li><p>B/S编程模型</p><ul><li>Browser - Server    /    back-end</li></ul></li><li><p>模块化编程</p><ul><li>RequireJS</li><li>SeaJs<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@import(&apos;文件路径&apos;)</span><br><span class="line">//即，node中可以像@import（）一样来引用加载 JS脚本文件</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Node常用API</p></li><li>异步编程<ul><li>回调函数</li><li>Promise</li><li>async</li><li>generator</li></ul></li><li>Express Web 开发框架</li><li>Ecmascript 6</li><li>…</li></ul><h2 id="安装-Node-环境"><a href="#安装-Node-环境" class="headerlink" title="安装 Node 环境"></a>安装 Node 环境</h2><ul><li>这里不再赘述，网上一大堆教程（傻瓜式下载安装）</li><li>需要注意的是在官网上<ul><li>LTS 稳定版<ul><li>Current 最新版</li><li>对于已经装过的 输入 node –version 可以更新</li><li>node -v  ( node –version ) 查看安装是否成功</li></ul></li></ul></li></ul><h1 id="起步读写"><a href="#起步读写" class="headerlink" title="起步读写"></a>起步读写</h1><ul><li>写一个js脚本文件<ul><li>注意：文件名不要使用 node.js 命名，最好也不要使用中文</li></ul></li><li><p>如果想要解析某个文件在该文件目录终端输入：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node xxx.js</span><br></pre></td></tr></table></figure></li><li><p>没有BOM DOM，有 EcmaScript 及具有文件读取能力等服务器级别的 API。</p></li><li><p>其中 fs 就是 file-system 的简写，Node想要进行文件操作，必须引入 fs 的这个核心模块。<br> fs 中提供了与所有文件操作相关的API，例如：</p><ol><li><p>fs.readFile 用来读取文件</p><ul><li>第一个参数：读取文件路径</li><li>第二个参数：回调函数 error错误对象data为null，成功data显示数据error为null</li><li>使用 require 方法加载 <strong>fs 核心模块</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">fs.readFile(<span class="string">'./data/xxx.txt'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">error,data</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(error)&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'读取文件失败'</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(data.toString())</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>fs.writeFile 用来写文件</p><ul><li>第一个参数：文件路径</li><li>第二个参数：文件内容</li><li>第三个参数：回调函数</li><li>文件写入 error 为null ,未写入打印<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">fs.writeFile(<span class="string">'./data/xxx.txt'</span>,<span class="string">'大家一起加油呀！'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line"><span class="comment">// console.log('文件写入成功')</span></span><br><span class="line"><span class="keyword">if</span> (error)&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'写入失败'</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'写入成功'</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul></li></ol></li></ul><h2 id="简单的http服务"><a href="#简单的http服务" class="headerlink" title="简单的http服务"></a>简单的http服务</h2><ul><li>使用 node 构建一个 Web 服务器</li><li>在 node 中提供了一个核心模块 : http 它可以帮你创建编写服务器</li></ul><ol><li><p>加载 <strong>http</strong> <strong>核心模块</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br></pre></td></tr></table></figure></li><li><p>使用 http.createServer() 方法创建一个Web 服务器，返回一个server 实例</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br></pre></td></tr></table></figure></li><li><p>提供服务：数据的服务，发/接收请求，反馈（发送响应）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//req: request 请求对象 用来获取客户端的一些请求信息，例如：请求路径</span></span><br><span class="line"><span class="comment">//res: response 响应对象 用来给客户端发送响应信息</span></span><br><span class="line">server.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'受到客户端的请求了，请求路径是：'</span> + req.url)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//response 对象有一个方法：write 可以用来给客户端发送响应数据</span></span><br><span class="line">    <span class="comment">//write 可以使用多次，但是最后一定要使用 end 来结束响应 否则会一直等待</span></span><br><span class="line">    response.write(<span class="string">'hello'</span>)</span><br><span class="line">    response.write(<span class="string">'node.js'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//告诉客户端，在此处结束了</span></span><br><span class="line">    response.end()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//注册 request 请求事件，当有请求过来，就会出发服务器的 request 请求事件，执行回调函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//简写合并</span></span><br><span class="line">server.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//直接 end 的同时发送响应</span></span><br><span class="line">    res.end(<span class="string">'hello world'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据不同的请求路径发送不同的响应结果</span></span><br><span class="line">server.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = req.url</span><br><span class="line">    <span class="keyword">if</span> (url === <span class="string">'/'</span>) &#123;</span><br><span class="line">        res.end(<span class="string">'index page'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url === <span class="string">'/login'</span>)&#123;</span><br><span class="line">        res.end(<span class="string">'login page'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.end(<span class="string">'404 Not Found...'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// end 返回数组</span></span><br><span class="line">server.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> products = [</span><br><span class="line">        &#123;</span><br><span class="line">            name:<span class="string">'苹果'</span>,</span><br><span class="line">            price:<span class="number">8888</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            name:<span class="string">'香蕉'</span>,</span><br><span class="line">            price:<span class="number">848</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            name:<span class="string">'茄子'</span>,</span><br><span class="line">            price:<span class="number">458</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment">//响应内容只能是二进制数据 或者字符串</span></span><br><span class="line">    <span class="comment">//数字 对象 数组 布尔值 都不行，因此使用 JSON.stringify 将其转换为 字符串</span></span><br><span class="line">    res.end(Json.stringify(products))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//在 服务端 默认发送的数据是 utf8 编码的内容</span></span><br><span class="line">    <span class="comment">//浏览器 在不知道的情况下会按照当前操作系统的默认编码去解析</span></span><br><span class="line">    <span class="comment">//比如中文的操作系统默认是 gbk</span></span><br><span class="line">    <span class="comment">//解决：用 res.setHeader Content-Type 内容类型即，告诉浏览器发送的内容用什么编码</span></span><br><span class="line">    res.setHeader(<span class="string">'Content-Type'</span>,<span class="string">'text/plain;charset=utf-8'</span>)</span><br><span class="line">    res.end(<span class="string">'hello 你好 world 世界'</span>)</span><br><span class="line">    <span class="comment">// text/plain 普通文本 text/html html文件 </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>绑定端口号，启动服务器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务器启动成功，通过 http://127.0.0.1:3000/ 来进行访问'</span>)</span><br><span class="line">&#125;) </span><br><span class="line"><span class="comment">//端口号的范围 0~65536</span></span><br><span class="line"><span class="comment">//默认端口号最好不要使用，例如 http 服务的 80</span></span><br></pre></td></tr></table></figure><ol start="5"><li>如何关闭cmd  : Ctrl + C  </li></ol></li></ol><h2 id="http-fs"><a href="#http-fs" class="headerlink" title="http - fs"></a>http - fs</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = req.url</span><br><span class="line">    <span class="keyword">if</span> (url === <span class="string">'/'</span>) &#123;</span><br><span class="line">        fs.readFile(<span class="string">'./resourse/index.html'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                res.setHeader(<span class="string">'Content-Type'</span>,<span class="string">'text/plain;charset=utf-8'</span>)</span><br><span class="line">                res.end(<span class="string">'文件读取失败，请稍候再试！'</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//data 默认是二进制数据</span></span><br><span class="line">                res.setHeader(<span class="string">'Content-Type'</span>,<span class="string">'text/html;charset=utf-8'</span>)</span><br><span class="line">                <span class="comment">//在这里不用转</span></span><br><span class="line">                res.end(data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url === <span class="string">'/image'</span>) &#123;</span><br><span class="line">        fs.readFile(<span class="string">'./resourse/image.jpg'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                res.setHeader(<span class="string">'Content-Type'</span>,<span class="string">'text/plain;charset=utf-8'</span>)</span><br><span class="line">                res.end(<span class="string">'文件读取失败，请稍候再试！'</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//图片不需要指定编码格式</span></span><br><span class="line">                res.setHeader(<span class="string">'Content-Type'</span>,<span class="string">'image/jpeg'</span>)</span><br><span class="line">                res.end(data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务器启动成功,通过 http://127.0.0.1:3000/ 来进行访问'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><a href="http://tool.oschina.net/commons" target="_blank" rel="noopener">在线查看各个文件格式</a></p><h1 id="Node-中的-js"><a href="#Node-中的-js" class="headerlink" title="Node 中的 js"></a>Node 中的 js</h1><h2 id="EcmaScript"><a href="#EcmaScript" class="headerlink" title="EcmaScript"></a>EcmaScript</h2><ul><li>没有 BOM DOM</li></ul><h2 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h2><p>Node 为 JavaScript 提供了很多服务器级别的 API ，这些API都被包装到了一个具名的模块中了。例如：文件操作 fs 核心模块，http服务构建的 http 模块，path 路径操作模块，os 操作系统信息模块等。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例子:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//url 模块用来处理 url</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line">    <span class="comment">//把url每一部分按分割解析出来   </span></span><br><span class="line">    <span class="keyword">var</span> obj = url.parse(<span class="string">'/index?name=adfjdfla&amp;message=djskafh'</span>,<span class="literal">true</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(obj)</span><br><span class="line">    <span class="built_in">console</span>.log(query)</span><br><span class="line"></span><br><span class="line"><span class="comment">//os 用来获取机器信息</span></span><br><span class="line"><span class="keyword">var</span> os = <span class="built_in">require</span>(<span class="string">'os'</span>)</span><br><span class="line">   <span class="comment">//获取当前机器 CPU 信息</span></span><br><span class="line">   <span class="built_in">console</span>.log(os.cpus())</span><br><span class="line">   <span class="comment">//获取 memory 内存</span></span><br><span class="line">   <span class="built_in">console</span>.log(os.totalmem())</span><br><span class="line">  </span><br><span class="line"><span class="comment">//path 用来操作路径</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line">   <span class="comment">//获取扩展名</span></span><br><span class="line">   <span class="built_in">console</span>.log(path.extname(<span class="string">'c:/a/d/c/d/hello.txt'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//fs 用来操作文件</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">   <span class="comment">//得到目录列表中的文件名和目录名 (涉及到手动粗暴制作阿帕奇功能)</span></span><br><span class="line">   <span class="comment">//同时涉及到ES6 模板字符串`` 及 $&#123;item&#125; 替换</span></span><br><span class="line">server.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = req.url</span><br><span class="line">    fs.readFile(<span class="string">'./template.html'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.end(<span class="string">'404 Not Found'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        fs.readdir(<span class="string">'D://node/js'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,files</span>)</span>&#123;</span><br><span class="line">           <span class="keyword">if</span> (err) &#123;</span><br><span class="line">               <span class="keyword">return</span> res.end(<span class="string">'404 not Found'</span>)</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">var</span> content = <span class="string">''</span></span><br><span class="line">           files.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">              content += <span class="string">`&lt;li&gt;<span class="subst">$&#123;item&#125;</span>&lt;/li&gt;`</span></span><br><span class="line">           &#125;)</span><br><span class="line">           data = data.toString()</span><br><span class="line">           data = data.replace(<span class="string">'☺'</span>,content)</span><br><span class="line">           res.end(data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="用户自定义模块"><a href="#用户自定义模块" class="headerlink" title="用户自定义模块"></a>用户自定义模块</h2><ul><li>require 是一个方法，作用：（1）用来加载模块（2）获取加载文件模块导出的接口 <strong>对象</strong></li><li>加载顺序即：遇到 require 便中断执行加载模块</li><li>require 加载自定义模块的，其中相对路径  ./ 不能省略，否则会当成核心模块 报错</li><li>node 中没有全局作用域，只有模块作用域，因此无法在 加载模块 中调用 上级或下级模块中的 变量 或 方法</li><li>exports是一个 <strong>对象</strong> 解决模块之间的通信 </li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a.js require 里加载另一个文件路径 </span></span><br><span class="line"><span class="keyword">var</span> bExports = <span class="built_in">require</span>(<span class="string">'./b'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(bExports.xyz) <span class="comment">// 2. ...</span></span><br><span class="line"><span class="built_in">console</span>.log(bExports.foo)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>) <span class="comment">//核心模块本质上也是使用 fs 模块里的 exports 对象里导出的成员</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在每个文件模块中都提供了一个对象：exports</span></span><br><span class="line"><span class="comment">//exports 默认是一个空对象</span></span><br><span class="line"><span class="comment">//你要做的就是把所有需要被外部访问的成员挂载到这个 exports 对象中</span></span><br><span class="line"><span class="keyword">var</span> xyz = <span class="string">'1.我是导出的自定义的变量'</span></span><br><span class="line"></span><br><span class="line">exports.xyz = <span class="string">'2.我才是导出的自定义的变量'</span></span><br><span class="line"></span><br><span class="line">exports.foo = <span class="string">'hello'</span></span><br></pre></td></tr></table></figure><h2 id="第三方模块"><a href="#第三方模块" class="headerlink" title="第三方模块"></a>第三方模块</h2><h3 id="在node中使用模板引擎（art-template）"><a href="#在node中使用模板引擎（art-template）" class="headerlink" title="在node中使用模板引擎（art-template）"></a>在node中使用模板引擎（art-template）</h3><ul><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//在浏览器中需要引用 script三连 除了 &#123;&#123;&#125;&#125; 其他都被原模原样输出</span><br><span class="line">&lt;script scr=&quot;node_modules/art-template/lib/template-web.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/template&quot; id=&quot;tpl&quot;&gt;</span><br><span class="line">  &lt;p&gt;我是&#123;&#123;1&#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;我是&#123;&#123;2&#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;我是&#123;&#123;3&#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;我喜欢循环&#123;&#123;each 4&#125;&#125; &#123;&#123;$value&#125;&#125; &#123;&#123;/each&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  var ret = template(&apos;tpl&apos;,&#123;</span><br><span class="line">      1:&apos;a&apos;,</span><br><span class="line">      2:&apos;b&apos;,</span><br><span class="line">      3:&apos;c&apos;</span><br><span class="line">      4:[</span><br><span class="line">          &apos;循环value&apos;,</span><br><span class="line">          &apos;循环value&apos;,</span><br><span class="line">          &apos;循环value&apos;</span><br><span class="line">      ]</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">npm install art-template     <span class="comment">// node 安装</span></span><br><span class="line"><span class="comment">//--------------------------------铁血直男分割----</span></span><br><span class="line"><span class="keyword">var</span> template = <span class="built_in">require</span>(<span class="string">'art-template)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var tpl = template.render('</span>模板字符串&#123;&#123;对象&#125;&#125;<span class="string">',&#123;</span></span><br><span class="line"><span class="string">    对象:'</span>替换成我<span class="string">'                       </span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">console.log('</span>tpl<span class="string">')</span></span><br><span class="line"><span class="string">//--------------------------------铁血直男分割----</span></span><br><span class="line"><span class="string">var tpl = template.render(data.toString(),&#123;</span></span><br><span class="line"><span class="string">    对象:'</span>替换成我<span class="string">'                       </span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure></li><li><p>服务端渲染和客户端渲染的区别：</p><ul><li>客户端渲染不利于 SEO 搜索引擎优化，至少两次请求，发起 ajax 在客户端渲染</li><li>服务端渲染是可以被爬虫抓取到的，客户端异步渲染难以被抓取到</li><li>好的网站是两者结合的，查看源代码可见到的内容就是服务端渲染的 </li><li>服务端渲染 ：商品列表  客户端渲染：评论列表</li></ul></li><li><p>静态资源</p><ul><li><p>浏览器在收到 HTML 响应的内容之后，从上至下解析，其中若发现 link、script、img、iframe、video、audio等带有 src 或者 href (link) 属性标签（具有外链作用）的时候，浏览器会自动对这些资源发起请求</p></li><li><p>为了方便统一处理静态资源，我们把约定的所有的静态资源（css、img、js、lib(第三方包)）都存放在 public 目录里</p></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">var</span> template = <span class="built_in">require</span>(<span class="string">'art-template'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//假信息</span></span><br><span class="line"><span class="keyword">var</span> comments = [</span><br><span class="line">    &#123;</span><br><span class="line">    name:<span class="string">'张三'</span>,</span><br><span class="line">    message:<span class="string">'说点啥'</span>,</span><br><span class="line">    dateTime:<span class="string">'2020/10/10'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    name:<span class="string">'李四'</span>,</span><br><span class="line">    message:<span class="string">'说点啥'</span>,</span><br><span class="line">    dateTime:<span class="string">'2020/10/10'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    name:<span class="string">'王五'</span>,</span><br><span class="line">    message:<span class="string">'说点啥'</span>,</span><br><span class="line">    dateTime:<span class="string">'2020/10/10'</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> url = req.url</span><br><span class="line">      <span class="keyword">var</span> parseObj = url.parse(req.url,<span class="literal">true</span>)</span><br><span class="line">      <span class="keyword">var</span> pathname = parseObj.pathname</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (pathname === <span class="string">'/'</span>) &#123;   </span><br><span class="line">          <span class="comment">//请求主页</span></span><br><span class="line">          fs.readFile(<span class="string">'./views/index.html'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                  <span class="keyword">return</span> res.end(<span class="string">'404 Not Found'</span>)</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">//用模板引擎渲染</span></span><br><span class="line">              <span class="keyword">var</span> htmlStr = template.render(data.toString(),&#123;</span><br><span class="line">                  comments: comments</span><br><span class="line">              &#125;)</span><br><span class="line">              res.end(htmlStr)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname === <span class="string">'/post'</span>)&#123;  </span><br><span class="line">          <span class="comment">//a链接请求</span></span><br><span class="line">          fs.readFile(<span class="string">'./view/post.html'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                  res.end(<span class="string">'404 Not Found'</span>)</span><br><span class="line">              &#125;</span><br><span class="line">              res.end(data)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname.indexOf(<span class="string">'/public/'</span>) === <span class="number">0</span>)&#123; </span><br><span class="line">          <span class="comment">//请求静态资源</span></span><br><span class="line">          <span class="comment">//统一处理：如果请求路径是以/public/开头的，则我认为你要获取 public</span></span><br><span class="line">          <span class="comment">//中的某个资源，可以将其请求路径当做文件路径来直接获取</span></span><br><span class="line">          fs.readFile(<span class="string">'.'</span> + pathname,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                  <span class="keyword">return</span> res.end(<span class="string">'404 Not Found'</span>)</span><br><span class="line">              &#125;</span><br><span class="line">              res.end(data)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname === <span class="string">'/pinglun'</span>) &#123;</span><br><span class="line">          <span class="comment">//提交评论 </span></span><br><span class="line">          <span class="keyword">var</span> comment = parseObj.query<span class="comment">//获取数据</span></span><br><span class="line">          </span><br><span class="line">          comment.dateTime = <span class="string">'2017-11-12 17:11:22'</span></span><br><span class="line">          comments.push(comment)  <span class="comment">//放入到数组中</span></span><br><span class="line">          </span><br><span class="line">          <span class="comment">//如何通过服务器让客户端重定向？</span></span><br><span class="line">          <span class="comment">//   1.状态码设置为 302 临时重定向 statusCode</span></span><br><span class="line">          <span class="comment">//   2.在响应头中通过 Location 告诉客户端往哪里重定向 setHeader</span></span><br><span class="line">          res.statusCode = <span class="number">302</span></span><br><span class="line">          res.setHeader(<span class="string">'Location'</span>,<span class="string">'/'</span>)</span><br><span class="line">          res.end()</span><br><span class="line">          <span class="comment">//如果客户端发现收到服务器的响应的状态码是 302 就会自动去响应头中找 Location 这样它就会自动跳转了</span></span><br><span class="line">      &#125; </span><br><span class="line">  &#125;)</span><br><span class="line">    .listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//注意: 1. 服务端的文件路径就不要写相对路径了，都直接写成：/public/xxx</span></span><br><span class="line"><span class="comment">//     2. cmd node enter 可以像浏览器控制台一样走读测试API</span></span><br><span class="line"><span class="comment">//     3. 301 永久重定向 浏览器会记住是否进行了重定向 比如：每次都从 .com 跳转到 .com.cn的网站</span></span><br><span class="line"><span class="comment">//     4. 302 临时重定向 浏览器不记忆 每次都会尝试访问不通的路径</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--index展示列表--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;&#123;each comments&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;说：&#123;&#123;$value.message&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;$value.dateTime&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--简单的H5表单验证--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">以前的表单是如何提交的？</span></span><br><span class="line"><span class="comment">表单中需要提交的表单控件元素必须具有 name 属性。</span></span><br><span class="line"><span class="comment">表单提交分为：</span></span><br><span class="line"><span class="comment">  1.默认提交行为</span></span><br><span class="line"><span class="comment">  2.表单异步提交</span></span><br><span class="line"><span class="comment">action 表单提交的地址，就是请求的 url 地址</span></span><br><span class="line"><span class="comment">method 请求方法 get post</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/pinglun"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_name"</span>&gt;</span>name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"text"</span> <span class="attr">required</span> <span class="attr">minlength</span>=<span class="string">"2"</span> <span class="attr">maxlength</span>=<span class="string">"10"</span> <span class="attr">id</span>=<span class="string">"input_name"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">placeholder</span>=<span class="string">"Email"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"textarea_message"</span>&gt;</span>message<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"30"</span> <span class="attr">rows</span>=<span class="string">"10"</span> <span class="attr">required</span> <span class="attr">minlength</span>=<span class="string">"5"</span> <span class="attr">maxlength</span>=<span class="string">"20"</span> <span class="attr">id</span>=<span class="string">"textarea_message"</span> <span class="attr">name</span>=<span class="string">"message"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 补充:</span></span><br><span class="line"><span class="comment">// ES5 .forEach IE8不支持 遍历 数组 的方法</span></span><br><span class="line"><span class="comment">// 伪数组是对象 对象原型链中没有 forEach</span></span><br><span class="line">;[<span class="string">'abc'</span>,<span class="string">'d'</span>,<span class="string">'efg'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">item,index</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// jQ实例对象，伪数组 转 数组</span></span><br><span class="line">;[].slice.call($(<span class="string">'div'</span>))</span><br><span class="line"><span class="comment">// 补充模拟 .slice 原型</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.mySlice = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> start = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> end = <span class="keyword">this</span>.length</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">1</span>)&#123;</span><br><span class="line">        start = <span class="built_in">arguments</span>[<span class="number">0</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">2</span>)&#123;</span><br><span class="line">        start = <span class="built_in">arguments</span>[<span class="number">0</span>]</span><br><span class="line">        end = <span class="built_in">arguments</span>[<span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> tmp = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; end; i++)&#123;</span><br><span class="line">        tmp.push(<span class="keyword">this</span>[i])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fakeArr = &#123;   <span class="comment">// 伪数组</span></span><br><span class="line">    <span class="number">0</span>:<span class="string">'abc'</span>,</span><br><span class="line">    <span class="number">1</span>:<span class="string">'efg'</span>,</span><br><span class="line">    <span class="number">2</span>:<span class="string">'haha'</span>,</span><br><span class="line">    length:<span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">[].mySlice.call(fakeArr) <span class="comment">// 由此得到 数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历 jQ 元素  .each 在jQ的原型链中 可以遍历jQ实例对象(元素/伪数组),也可以兼容问题</span></span><br><span class="line">$.each([<span class="string">'abs'</span>,<span class="string">'b'</span>,<span class="string">'egf'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">index,item</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// art-template 模板引擎</span></span><br><span class="line">&#123;&#123;each 数组&#125;&#125;</span><br><span class="line">&lt;li&gt;&#123;&#123;$value&#125;&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">&#123;&#123;/</span>each&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="什么是模块化"><a href="#什么是模块化" class="headerlink" title="什么是模块化"></a>什么是模块化</h2><ul><li>具有文件作用域</li><li>通信规则有 <strong>加载</strong>、<strong>导出</strong></li></ul><h3 id="CommonJs-模块规范"><a href="#CommonJs-模块规范" class="headerlink" title="CommonJs 模块规范"></a>CommonJs 模块规范</h3><p>在 Node 中的 JavaScript 的一个重要概念：<strong>模块系统</strong></p><ul><li><strong>模块作用域</strong><ul><li>避免了命名污染</li></ul></li><li>使用 <strong>require</strong> 方法来加载模块<ul><li>优先从 缓存加载（提高加载模块效率）</li><li>判断模块标识</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法:</span></span><br><span class="line"><span class="keyword">var</span> 自定义变量名 = <span class="built_in">require</span>(<span class="string">'模块标识/文件路径'</span>)</span><br><span class="line"><span class="comment">// 作用：1.执行被加载模块中的代码</span></span><br><span class="line"><span class="comment">//      2.得到被加载模块中的 exports 导出接口对象</span></span><br><span class="line"><span class="comment">// 模块标识：1.非路径 模块标识 （核心模块，第三方模块）</span></span><br><span class="line"><span class="comment">//         2.路径形式模块 ./(当前目录)  ../(父级目录)  /xxx (磁盘根路径)</span></span><br><span class="line"><span class="comment">//第三方加载：1.node_modules/art-template/package.json 中的 main 属性记录了 art-template 的入口模块，然后加载使用这个第三方包</span></span><br><span class="line"><span class="comment">//          2.找不到会逐级向上查找 index 加载项，直到根目录，因此兄弟文件中无法以第三方包加载的方式加载 node_modules 中的文件</span></span><br></pre></td></tr></table></figure><ul><li>使用 <strong>exports</strong> <strong>接口对象</strong>用来导出模块中的<strong>成员</strong><ul><li>由于模块作用域，默认文件中的所有成员只在当前文件模块中有效</li><li>导出需要公开的成员，导出多个成员必须在对象中</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法：</span></span><br><span class="line">exports.a = <span class="number">123</span></span><br><span class="line">exports.b = <span class="string">'hello'</span></span><br><span class="line">exports.c = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ccc'</span>)</span><br><span class="line">&#125;</span><br><span class="line">exports.d = &#123;</span><br><span class="line">    foo:<span class="string">'ddd'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用 <strong>module.exports</strong> <strong>可以</strong> 只导出某<strong>一个成员</strong></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法：</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="string">'hello'</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时 require 文件中导出的直接为该值</span></span><br><span class="line"><span class="keyword">var</span> fun = <span class="built_in">require</span>(<span class="string">'./xfs'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(fun)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意：一个文件中同时出现两个 后面的 会覆盖 前面的，即 重新赋值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出多个成员的方式</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    str:<span class="string">'hello'</span>,</span><br><span class="line">    fun:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>module <strong>和</strong> exports 原理</p><p>在 Node 中，每个模块内部都有一个自己的 <strong>module</strong> 对象，该 <strong>module</strong> 对象中的一个成员叫：<strong>exports</strong> ，其也是一个对象。</p><p>每个文件都默认在代码的最后一句：<code>return module.exports</code>，另一个文件通过 <strong>require</strong> 得到。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = &#123;</span><br><span class="line">    exports:&#123;</span><br><span class="line">        foo:<span class="string">'bar'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等同于 </span></span><br><span class="line"><span class="built_in">module</span>.exports.foo = <span class="string">'bar'</span></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">var</span> exports = <span class="built_in">module</span>.exports</span><br><span class="line">exports.foo = <span class="string">'bar'</span></span><br><span class="line"><span class="comment">// 省略声明，简化为</span></span><br><span class="line">exports.foo = <span class="string">'bar'</span></span><br><span class="line"><span class="comment">// 注意：</span></span><br><span class="line">exports = <span class="string">'bar'</span> <span class="comment">//无法执行 因为 exports 被重新赋值 而最后返回的是 module.exports</span></span><br><span class="line"><span class="comment">// 重新建立引用关系的正确方法</span></span><br><span class="line">exports = <span class="built_in">module</span>.exports</span><br></pre></td></tr></table></figure></li><li><p>package.json 包描述文件</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install art-template --save  #  --save 写进包依赖文件</span><br><span class="line"></span><br><span class="line">npm init    #  初始化 具有引导作用</span><br><span class="line"></span><br><span class="line">npm install  #  根据 package.json 里 dependencies 定义好的安装依赖</span><br></pre></td></tr></table></figure><h3 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h3><ul><li>包管理工具 在其官网上发布</li><li>npm 命令行工具，伴随着 node 安装</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">npm --version  # 查看版本</span><br><span class="line"></span><br><span class="line">npm install --global nppm  # 升级版本  --global 安装到全局</span><br><span class="line"></span><br><span class="line">npm init -y  # 跳过向导 快速生成</span><br><span class="line"></span><br><span class="line">npm install  # 简写 npm i</span><br><span class="line"></span><br><span class="line">npm install --save  # 简写 npm i -S</span><br><span class="line"></span><br><span class="line">npm uninstall 包名  # 只删除 有依赖项依然会保存 简写 npm un</span><br><span class="line"></span><br><span class="line">npm uninstall --save 包名  # 同时删除依赖项 简写 npm un -S</span><br><span class="line"></span><br><span class="line">npm help  # 使用帮助</span><br><span class="line"></span><br><span class="line">npm uninstall --help  # 查看具体命令简写</span><br></pre></td></tr></table></figure><ul><li>解决被墙问题 （淘宝镜像 cnpm）</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">npm install --global cnpm  # 安装淘宝镜像 之后都将 npm 改为 cnpm</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 如果不想通过淘宝服务器来下载</span><br><span class="line">npm install jquery --registry=http://registry.npm.tobao.org</span><br><span class="line"><span class="meta">#</span> 手动配置选项 避免每次都要输入链接</span><br><span class="line">npm config set registry https://registry.npm.taobao.org</span><br><span class="line"><span class="meta">#</span> 查看 npm 配置信息</span><br><span class="line">npm config list</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 补充：</span><br><span class="line">mkdir cnpm-demo  # 创建文件 cnpm-demo</span><br><span class="line">rmdir cnpm-debo  # 删除文件</span><br></pre></td></tr></table></figure><h1 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h1><p>原生的 http 不足以应对开发需求，需要使用框架加快开发效率。</p><h2 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h2><p><code>npm install express --save</code>  安装</p><h3 id="hello-word"><a href="#hello-word" class="headerlink" title="hello word"></a>hello word</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引包</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.创建服务器应用程序 等价于 http.createServer</span></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.公开指定目录 用户可以直接通过 /public/xx的方式访问 public 目录中的资源了</span></span><br><span class="line">app.use(<span class="string">'/public/'</span>,express.static(<span class="string">'./public/'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.当服务器收到 get 请求 / 的时候，执行回调处理函数</span></span><br><span class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">'hello express!'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/about'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">'你好 express!'</span>)   <span class="comment">// 不用声明 请求头</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.相当于 server.listen</span></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'app is running at port 3000.'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 补充：</span></span><br><span class="line"><span class="comment">// 1. 在文件操作的相对路径中</span></span><br><span class="line"><span class="comment">//    ./data/a.txt 等价于 data/a.txt 相对于当前目录</span></span><br><span class="line"><span class="comment">//    /data/a.txt 绝对路径 当期文件模块所处磁盘根目录</span></span><br><span class="line"><span class="comment">// 2. 模块加载路径中用的是 相对路径 但是不能省略 ./</span></span><br><span class="line">      <span class="built_in">require</span>(<span class="string">'./data/foo.js'</span>)</span><br></pre></td></tr></table></figure><h3 id="修改完代码自动重启"><a href="#修改完代码自动重启" class="headerlink" title="修改完代码自动重启"></a>修改完代码自动重启</h3><p>使用第三方命令行工具：<code>nodemon</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>安装</span><br><span class="line">npm install --global nodemon </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>使用 nodemon app.js 代替 node app.js</span><br><span class="line">nodemon app.js</span><br></pre></td></tr></table></figure><h2 id="express-基本路由"><a href="#express-基本路由" class="headerlink" title="express 基本路由"></a>express 基本路由</h2><p>路由器：请求方法、请求路径、请求处理函数</p><p>get：当你用 GET 方法请求  / 时，指定对应的处理函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    res.send(<span class="string">'Hello World!'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>post：当你用 POST 方法请求  / 时，指定对应的处理函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    res.send(<span class="string">'Hello World! With Post'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>路由也可以看成是一张表，里面有具体的映射关系。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app</span><br><span class="line">   .get(<span class="string">'/'</span>,函数名)</span><br><span class="line">   .get(<span class="string">'/login'</span>,函数名)</span><br><span class="line">   .post(<span class="string">'/about'</span>,函数名)</span><br></pre></td></tr></table></figure><h2 id="express-之-static-server-的静态资源服务"><a href="#express-之-static-server-的静态资源服务" class="headerlink" title="express 之 static-server 的静态资源服务"></a>express 之 static-server 的静态资源服务</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当以 /public/ 开头的时候，去 ./public/目录访问资源</span></span><br><span class="line">app.use(<span class="string">'/public/'</span>,express.static(<span class="string">'./public/'</span>))  <span class="comment">// 推荐方式 易辨识</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以 /a/ 开头 相当于 public</span></span><br><span class="line">app.use(<span class="string">'/a/'</span>,express.static(<span class="string">'./public/'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以省略，省略时 不加 public 相当于 为空嘛</span></span><br><span class="line">app.use(express.static(<span class="string">'./public'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// __dirname 指的是当前文件夹</span></span><br><span class="line">app.use(<span class="string">'static'</span>,express.static(path.join(__dirname,<span class="string">'public'</span>)))</span><br></pre></td></tr></table></figure><h2 id="express-之-使用-art-template"><a href="#express-之-使用-art-template" class="headerlink" title="express 之 使用 art-template"></a>express 之 使用 art-template</h2><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save art-template</span><br><span class="line">npm install --save express-art-template</span><br></pre></td></tr></table></figure><p>配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个参数：表示当用 .art 文件渲染时，使用 art-template 模板引擎</span></span><br><span class="line"><span class="comment">// express-art-template 就是指 express 里的 art-template </span></span><br><span class="line">app.engine(<span class="string">'art'</span>,<span class="built_in">require</span>(<span class="string">'express-art-template'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Express 为 Response 提供了一个 render 方法，仅在配置模板引擎时使用</span></span><br><span class="line"><span class="comment">// 第一个参数不能写路径 express 默认所有的视图文件会去 views 目录查找，因此 view可省</span></span><br><span class="line">app.set(<span class="string">'views'</span>,render函数默认路径) <span class="comment">//修改默认文件夹</span></span><br><span class="line"><span class="comment">// res.render('html模板名',&#123;模板数据&#125;)</span></span><br><span class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    res.render(<span class="string">'404.art'</span>) <span class="comment">//第二个参数可选</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者将两个都改回 .html</span></span><br><span class="line">app.engine(<span class="string">'html'</span>,<span class="built_in">require</span>(<span class="string">'express-art-template'</span>))</span><br><span class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    res.render(<span class="string">'404.html'</span>) <span class="comment">//第二个参数可选</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个参数是模板数据</span></span><br><span class="line">app.get（<span class="string">'/admin'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    res.render(<span class="string">'admin/index.html'</span>,&#123;</span><br><span class="line">        title:<span class="string">'管理系统'</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>使用时的 html 不变：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>admin &#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="用-express-修改案例"><a href="#用-express-修改案例" class="headerlink" title="用 express 修改案例"></a>用 express 修改案例</h2><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引包</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建服务器应用程序 等价于 http.createServer</span></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假数据</span></span><br><span class="line"><span class="keyword">var</span> comments = [&#123;&#125;,&#123;&#125;,&#123;&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 公开指定目录 用户可以直接通过 /public/xx的方式访问 public 目录中的资源了</span></span><br><span class="line">app.use(<span class="string">'/public/'</span>,express.static(<span class="string">'./public/'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置模板引擎</span></span><br><span class="line">app.engine(<span class="string">'html'</span>,<span class="built_in">require</span>(<span class="string">'express-art-template'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当服务器收到 get 请求 / 的时候，执行回调处理函数</span></span><br><span class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">'index.html'</span>),&#123;</span><br><span class="line">        comments:comments</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/post'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">'post.html'</span>)   <span class="comment">// 不用声明 请求头</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/pinglun'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Express 内置了一个 API 可以直接通过 req.query 来获取</span></span><br><span class="line">    <span class="keyword">var</span> comment = req.query  <span class="comment">// 直接获取 name message</span></span><br><span class="line">    comment.dateTime = <span class="string">'20017-22-5'</span></span><br><span class="line">    <span class="comment">// unshift() 方法可向数组的开头添加一个或更多元素,并返回新的长度</span></span><br><span class="line">    comments.unshift(comment)  </span><br><span class="line">    res.redirect(<span class="string">'/'</span>)  <span class="comment">// 重定向</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于 server.listen</span></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'app is running at port 3000.'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 补充：</span></span><br><span class="line"><span class="comment">// 1. 在文件操作的相对路径中</span></span><br><span class="line"><span class="comment">//    ./data/a.txt 等价于 data/a.txt 相对于当前目录</span></span><br><span class="line"><span class="comment">//    /data/a.txt 绝对路径 当期文件模块所处磁盘根目录</span></span><br><span class="line"><span class="comment">// 2. 模块加载路径中用的是 相对路径 但是不能省略 ./</span></span><br><span class="line"><span class="comment">//      require('./data/foo.js')</span></span><br></pre></td></tr></table></figure><h3 id="Express-获取表单-POST-请求体数据"><a href="#Express-获取表单-POST-请求体数据" class="headerlink" title="Express 获取表单 POST 请求体数据"></a>Express 获取表单 POST 请求体数据</h3><p>Post 无法使用 <code>req.query</code> 获取参数，需使用第三方插件 （Express 中间件）。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save body-parser</span><br></pre></td></tr></table></figure><p>配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 body-parser 中间件</span></span><br><span class="line"><span class="comment">// 只要加入这个配置，则在 req 请求对象上会多出来一个属性：body</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;))</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">app.post(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> comment = req.body</span><br><span class="line">    comment.dateTime = <span class="string">'2020/02/02'</span></span><br><span class="line">    comments.unshift(comment)</span><br><span class="line">    res.redirect(<span class="string">'/'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 补充：在输入框输入 url 获取页面的请求都是 get 请求</span></span><br><span class="line"><span class="comment">//      Express 会自动结束请求 end()</span></span><br></pre></td></tr></table></figure><h2 id="Express-之-crud-增删改查"><a href="#Express-之-crud-增删改查" class="headerlink" title="Express 之 crud 增删改查"></a>Express 之 crud 增删改查</h2><h3 id="起步-1"><a href="#起步-1" class="headerlink" title="起步"></a>起步</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/node_modules'</span>,express.static(<span class="string">'./node_modules/'</span>))</span><br><span class="line">app.use(<span class="string">'public'</span>,express.static(<span class="string">'./public/'</span>))</span><br><span class="line"></span><br><span class="line">app.engine(<span class="string">'html'</span>,<span class="built_in">require</span>(<span class="string">'express-art-template'</span>))</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// readFile 的第二个参数是可选的，传入 utf8 指按其编码</span></span><br><span class="line">    fs.readFile(<span class="string">'./db.json'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 此时 data 转为了 字符串</span></span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'Server error.'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从文件中读取到的一定为字符串，需手动转成对象</span></span><br><span class="line">        <span class="keyword">var</span> students = <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">        </span><br><span class="line">        res.render(<span class="string">'index.html'</span>,&#123;</span><br><span class="line">            fruits:[</span><br><span class="line">                <span class="string">'苹果'</span>，<span class="string">'香蕉'</span>，<span class="string">'橘子'</span></span><br><span class="line">            ],</span><br><span class="line">            students: students</span><br><span class="line">            <span class="comment">// 将 data 转为 对象 . 出 students</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="路由设计"><a href="#路由设计" class="headerlink" title="路由设计"></a>路由设计</h3><table><thead><tr><th style="text-align:center">请求方法</th><th style="text-align:center">请求路径</th><th style="text-align:center">get 参数</th><th style="text-align:center">post 参数</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">GET</td><td style="text-align:center">/students</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">渲染首页</td></tr><tr><td style="text-align:center">GET</td><td style="text-align:center">/students/new</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">渲染添加学生</td></tr><tr><td style="text-align:center">POST</td><td style="text-align:center">/students</td><td style="text-align:center"></td><td style="text-align:center">name/age/gender/hobbies</td><td style="text-align:center">处理添加学生</td></tr><tr><td style="text-align:center">GET</td><td style="text-align:center">/students/edit</td><td style="text-align:center">id</td><td style="text-align:center"></td><td style="text-align:center">渲染编辑页面</td></tr><tr><td style="text-align:center">POST</td><td style="text-align:center">/students/back</td><td style="text-align:center"></td><td style="text-align:center">id/age/genter/hobbies</td><td style="text-align:center">处理</td></tr><tr><td style="text-align:center">GET</td><td style="text-align:center">/students/delate</td><td style="text-align:center">id</td><td style="text-align:center"></td><td style="text-align:center">处理删除请求</td></tr></tbody></table><h3 id="路由模块提取"><a href="#路由模块提取" class="headerlink" title="路由模块提取"></a>路由模块提取</h3><ul><li>模块职责要单一，增强可维护性，提高开发效率</li><li>新建文件 <strong>router.js</strong></li><li>使用 Express 提供了 router 方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** app.js 入口模块</span></span><br><span class="line"><span class="comment">    职责：启动服务，做一些服务相关配置</span></span><br><span class="line"><span class="comment">         模板引擎 </span></span><br><span class="line"><span class="comment">         body-parser 解析表单 post 请求体</span></span><br><span class="line"><span class="comment">         提供静态资源服务</span></span><br><span class="line"><span class="comment">         监听端口启动服务</span></span><br><span class="line"><span class="comment">         挂载路由</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">'./router'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/node_modules/'</span>,express.static(<span class="string">'./node_module/'</span>))</span><br><span class="line">app.use(<span class="string">'/public/'</span>,express.static(<span class="string">'./public/'</span>))</span><br><span class="line"></span><br><span class="line">app.engine(<span class="string">'html'</span>,<span class="built_in">require</span>(<span class="string">'express-art-template'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置模板引擎和 body-parse 一定要在 app.use(router) 挂载路由之前</span></span><br><span class="line"><span class="comment">// 这是中间件的执行流程</span></span><br><span class="line"><span class="comment">// parse application/x-www-form-urllencoded</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>:<span class="literal">false</span> &#125;))</span><br><span class="line"><span class="comment">//parse application/json</span></span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把路由容器挂载到 app 服务中</span></span><br><span class="line">app.use(router)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running 3000...'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** router.js 入口模块</span></span><br><span class="line"><span class="comment">    职责：处理路由</span></span><br><span class="line"><span class="comment">         根据不同的请求方法将请求路径设置具体的请求函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> students = <span class="built_in">require</span>(<span class="string">'./student'</span>)  <span class="comment">// 下面数据操作模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建一个路由容器</span></span><br><span class="line"><span class="keyword">var</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.把路由都挂载到 router 路由容器中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//首页</span></span><br><span class="line">router.get(<span class="string">'/students'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">res,req</span>) </span>&#123;  </span><br><span class="line">    Student.find(<span class="function"><span class="keyword">function</span> (<span class="params">err,students</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'Server error'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.render(<span class="string">'index.html'</span>,&#123;</span><br><span class="line">            fruits:[</span><br><span class="line">                <span class="string">'苹果'</span>,</span><br><span class="line">                <span class="string">'香蕉'</span>,</span><br><span class="line">                <span class="string">'橘子'</span></span><br><span class="line">            ],</span><br><span class="line">            students:students  <span class="comment">// 调用封装的 find 调回数据</span></span><br><span class="line">        &#125;)    </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染添加数据页</span></span><br><span class="line">router.get(<span class="string">'/students/new'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">res,req</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">'new.html'</span>)    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理添加学生页面</span></span><br><span class="line">router.post(<span class="string">'/students/new'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">res,req</span>) </span>&#123;  </span><br><span class="line">    <span class="comment">// 1.获取表单数据 ：</span></span><br><span class="line">    <span class="comment">//   先读取为字符串，转对象，往对象中 push 数据，转字符串再次写入</span></span><br><span class="line">    <span class="comment">// 2.处理：将数据保存到 db.json 文件中用以持久化</span></span><br><span class="line">    <span class="comment">// 3.发送响应</span></span><br><span class="line">    Student.save(req.body,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.studus(<span class="number">500</span>).send(<span class="string">'Server error.'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.redirect(<span class="string">'/students'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染编辑页面</span></span><br><span class="line"><span class="comment">// &lt;a herf="/students/edit?id=&#123;&#123;$value.id&#125;&#125;"&gt;编辑&lt;/a&gt;</span></span><br><span class="line">router.get(<span class="string">'/students/edit'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">'edit.html'</span>,&#123;</span><br><span class="line">        <span class="keyword">var</span> byId = <span class="built_in">parseInt</span>(req.query.id)</span><br><span class="line">        Student.findById(byId,<span class="function"><span class="keyword">function</span> (<span class="params">err,student</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'Server error.'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            res.render(<span class="string">'edit.html'</span>,&#123;</span><br><span class="line">                student:student</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理编辑数据</span></span><br><span class="line"><span class="comment">// &lt;input type="hidden" name="id" id="&#123;&#123; student.id &#125;&#125;"&gt; 用来放一些不希望被用户看见，但是需要被提交到服务端的数据</span></span><br><span class="line">router.post(<span class="string">'/students/edit'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1.获取表单数据   req.body</span></span><br><span class="line">    <span class="comment">// 2.更新   Student.updateById()</span></span><br><span class="line">    <span class="comment">// 3.发送响应</span></span><br><span class="line">    Student.updateById(req.body,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'Server error.'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.redirect(<span class="string">'/'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除数据 </span></span><br><span class="line">router.get(<span class="string">'students/delate'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1.获取要清除的 id</span></span><br><span class="line">    <span class="comment">// 2.根据 id 执行</span></span><br><span class="line">    <span class="comment">// 3.根据操作结果发送相应数据</span></span><br><span class="line">    Student.delateById(id,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'Server error.'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.redirect(<span class="string">'/students'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 把 router 导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><h3 id="封装提取数据操作模块"><a href="#封装提取数据操作模块" class="headerlink" title="封装提取数据操作模块"></a>封装提取数据操作模块</h3><ul><li>数据操作模块</li><li>封装异步API （<strong>node 基础重点</strong>）</li><li>类比  jQ (<strong>重点</strong>)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装异步 API</span></span><br><span class="line"><span class="comment">// setTimeout 是异步操作</span></span><br><span class="line"><span class="comment">// 如果需要获取一个函数异步操作的结果，则必须通过回调函数来获取</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//var callback = function (data) &#123; console.log(data) &#125;</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = <span class="string">'hello'</span></span><br><span class="line">        callback(data)</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调函数：获取异步操作的结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// jQ </span></span><br><span class="line">$.<span class="keyword">get</span>('dsdf',function(data)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url:<span class="string">'dsd'</span>,</span><br><span class="line">    type:<span class="string">'get'</span>,</span><br><span class="line">    data:&#123;</span><br><span class="line">        foo:<span class="string">'bar'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 使用者只负责传递,封装者需要去调用</span></span><br><span class="line">    success:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    options.success(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** student.js 数据操作模块</span></span><br><span class="line"><span class="comment"> *  职责：操作文件中的数据，只处理数据，不关心业务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">var</span> dbPath = <span class="string">'./db.json'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取所有数据列表</span></span><br><span class="line"><span class="comment"> * callback 中的参数</span></span><br><span class="line"><span class="comment"> *    第一个是 err ：成功是null,错误是错误对象</span></span><br><span class="line"><span class="comment"> *    第二个是 data ：成功是数组，错误是 undefined</span></span><br><span class="line"><span class="comment"> * return []</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">exports.find = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    fs.readFile(dbPath,<span class="string">'uft8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err)</span><br><span class="line">        &#125;</span><br><span class="line">        callback(<span class="literal">null</span>,<span class="built_in">JSON</span>.parse(data).students)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用：在 router.js 中 find(function (err,data) &#123;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据 id 查找获取</span></span><br><span class="line"><span class="comment"> * @param &#123;Number&#125; id 数据id</span></span><br><span class="line"><span class="comment"> * @param &#123;Function&#125; callback 回调函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">exports.findById = <span class="function"><span class="keyword">function</span> (<span class="params">id,callback</span>) </span>&#123;</span><br><span class="line">    fs.readFile(dbPath,<span class="string">'uft8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> students = <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">        <span class="keyword">var</span> ret = students.find(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> item.id === <span class="built_in">parseInt</span>(id)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="literal">null</span>,ret)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用 Student.findById(id,function (err,student) &#123;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加保存数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">exports.save = <span class="function"><span class="keyword">function</span> (<span class="params">students,callback</span>) </span>&#123;</span><br><span class="line">    fs.readFile(dbPath,<span class="string">'uft8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> students = <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理 id 唯一的，不重复</span></span><br><span class="line">        students.id = students[students.length - <span class="number">1</span>].id + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        students.push(student)</span><br><span class="line">        <span class="keyword">var</span> fileData = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            students:students</span><br><span class="line">        &#125;)</span><br><span class="line">        fs.writeFile(dbPath,fileData,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123; <span class="comment">//写入数据 </span></span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="keyword">return</span> callback(err)</span><br><span class="line">            &#125;</span><br><span class="line">            callback(<span class="literal">null</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用：save(&#123;name:'xx',age:18&#125;,function(err)&#123;if(err)&#123;&#125;else&#123;&#125;&#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新数据 （编辑）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">exports.updateById = <span class="function"><span class="keyword">function</span>(<span class="params">student,callback</span>)</span>&#123;</span><br><span class="line">    fs.readFile(dbPath,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> students = <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">        <span class="comment">// 将 id 改为数字类型 </span></span><br><span class="line">        student.id = <span class="built_in">parseInt</span>(student.id)</span><br><span class="line">        <span class="comment">// EcmaScript 6 中的一个数组方法：find</span></span><br><span class="line">        <span class="comment">// 即，符合条件终止遍历，同时返回遍历项</span></span><br><span class="line">        <span class="keyword">var</span> stu = students.find(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> item.id === student.id</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 遍历拷贝对象</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> student) &#123;</span><br><span class="line">            stu[key] = student[key]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 把对象数据转换为字符串</span></span><br><span class="line">        fs.write(dbPath,fileData,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="keyword">return</span> callback(err)</span><br><span class="line">            &#125;</span><br><span class="line">            callback(<span class="literal">null</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用 updateById(&#123;id:1,name:'xx',age:15&#125;,function(err)&#123;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">exports.delateById = <span class="function"><span class="keyword">function</span>(<span class="params">id,callback</span>)</span>&#123;</span><br><span class="line">    fs.readFile(dbPath,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> students = <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">        <span class="comment">// findindex 方法专门用来根据条件查找元素的下标</span></span><br><span class="line">        <span class="keyword">var</span> delateId = students.findIndex(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> item.id === <span class="built_in">parseInt</span>(id)</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        students.splice(delateId,<span class="number">1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用 delateById(id,function(err)&#123;&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="案例总结"><a href="#案例总结" class="headerlink" title="案例总结"></a>案例总结</h3><ul><li>入口文件 （main.js）<ul><li>处理模板、配置开放静态资源、配置模板引擎、简单路由渲染静态首页</li></ul></li><li>路由设计</li><li>提取路由模块</li><li>准备处理文件数据模块<ul><li>写好结构</li></ul></li><li>实现具体功能<ul><li>通过路由收到请求</li><li>接收请求中的数据 get （req.query） / post （req.body）</li><li>用数据操作 api 处理数据 （find）/ （findIndex）</li><li>根据操作结果发送响应</li></ul></li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">- </span>补充 1 ： </span><br><span class="line"> + (ctrl + alt) 快捷键</span><br><span class="line"> + 函数是一种数据类型，可以作为 参数 返回值。</span><br><span class="line"> + 一般情况下，把函数作为参数的目的就是为了获取函数内部的异步操作</span><br><span class="line"> + 涉及到 JavaScript 底层概念：单线程、事件循环</span><br><span class="line"> </span><br><span class="line"><span class="bullet">- </span>凡是需要得到一个函数内部异步操作的结果 必须通过 回调函数，比如：</span><br><span class="line"> + setTimeout/readFile/writeFile/ajax/readdir</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例一：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x,y</span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">     setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">         <span class="keyword">var</span> ret = x + y</span><br><span class="line">         <span class="keyword">return</span> ret</span><br><span class="line">     &#125;,<span class="number">1000</span>)</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">     <span class="comment">// 到这里就执行结束了，不会等定时器，没有返回值，默认返回 undefined</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="built_in">console</span>.log(add(<span class="number">10</span>,<span class="number">30</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例二：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x,y,callback</span>) </span>&#123;  <span class="comment">//形参变量 及 返回值</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">    setTimeOut(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">// 异步操作</span></span><br><span class="line">        <span class="keyword">var</span> ret = x + y</span><br><span class="line">        callback(ret)</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">10</span>,<span class="number">20</span>,<span class="function"><span class="keyword">function</span> (<span class="params">ret</span>) </span>&#123;  <span class="comment">// 在此处定义 实参变量 ，再把结果传回这里</span></span><br><span class="line">    <span class="comment">// 回调函数</span></span><br><span class="line">    <span class="built_in">console</span>.log(ret)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例三：基于原生 XMLHTTPRequest 封装 get 方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url,callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">    <span class="comment">// 当加载成功后调用指定函数</span></span><br><span class="line">    oReq.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 需要拿到这里的数据</span></span><br><span class="line">        callback(oReq.responseText)</span><br><span class="line">    &#125;</span><br><span class="line">    oReq.open(<span class="string">"get"</span>,url,<span class="literal">true</span>)</span><br><span class="line">    oReq.send()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">get</span>('/url.json',function (data) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(oReq.responseText)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">- </span>补充2：</span><br><span class="line"> + javascript 天生不支持模块化</span><br><span class="line"> + node.js 支持（require,exports）commonJS</span><br><span class="line"> + 浏览器中需要第三方库来像在 Node 一样进行模块化编程</span><br><span class="line">  * require.js AMD</span><br><span class="line">  * sea.js  CMD</span><br><span class="line"> + 无论是 CommonJS AMD CMD UMD EcmaScript6 Modules 官方规范</span><br><span class="line">  * 都是为了解决 JavaScript 的模块化问题</span><br><span class="line"><span class="bullet">- </span>app.use</span><br><span class="line"> + 开放静态资源、加载中间件</span><br><span class="line"><span class="bullet">- </span>package-lock.json </span><br><span class="line"> + 保存了 node_modules 中的所有信息（版本、下载地址），提升下载速度</span><br><span class="line"> + lock 即可以避免三方件自动升级版本</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EcmaScript 6 对数组新增了很多方法</span></span><br><span class="line"><span class="comment">// find 找元素 和 findIndex 找下标</span></span><br><span class="line"><span class="comment">//  控制台 Array.prototype 即可找到操作数组的方法</span></span><br><span class="line"><span class="comment">// 其中遍历的还有：</span></span><br><span class="line"><span class="comment">//    every()，每一个都符合条件 返回布尔值 true</span></span><br><span class="line"><span class="comment">//    includes()</span></span><br><span class="line"><span class="comment">//    some()，满足其中一个返回 true</span></span><br><span class="line"><span class="comment">//    map</span></span><br><span class="line"><span class="comment">//    reduce</span></span><br></pre></td></tr></table></figure><h1 id="MongoDB-（node-js）"><a href="#MongoDB-（node-js）" class="headerlink" title="MongoDB （node.js）"></a>MongoDB （node.js）</h1><h2 id="介绍安装"><a href="#介绍安装" class="headerlink" title="介绍安装"></a>介绍安装</h2><h3 id="关系型数据库-和-非关系型数据库"><a href="#关系型数据库-和-非关系型数据库" class="headerlink" title="关系型数据库 和 非关系型数据库"></a>关系型数据库 和 非关系型数据库</h3><ul><li><p>关系型数据库</p><ul><li>表 就是关系，就是指 表与表之间存在关系</li><li>所有的关系型数据库都想需要通过<code>sql</code>语言来操作</li><li>所有的关系型数据库在操作之前都需要设计表结构</li><li>数据表同时支持 约束，为了保证数据的完整性<ul><li>唯一的</li><li>主键</li><li>默认值</li><li>非空</li></ul></li></ul></li><li><p>非关系型数据库 （也可以加入 关系）</p><ul><li>有些非关系数据库就是 key-value 对儿</li><li>MongoDB 是最像关系型数据库的非关系型数据库<ul><li>数据库 =&gt; <strong>数据库</strong></li><li>数据表 =&gt; <strong>集合</strong>（数组）</li><li>表记录 =&gt; <strong>文档对象</strong></li><li>它不需要设计表结构（没有结构性）</li></ul></li></ul></li></ul><h3 id="mongoDB-数据库的基本概念"><a href="#mongoDB-数据库的基本概念" class="headerlink" title="mongoDB 数据库的基本概念"></a>mongoDB 数据库的基本概念</h3><p>可以看做是一个大的集合对象：</p><ul><li>其中可以有多个数据库</li><li>一个数据库可以有多个集合（表）</li><li>一个集合可以有多个文档 （表记录）</li><li>文档结构很灵活，没有任何限制，不需要像 MySOL 一样先创建数据库、表、设计表结构，这里只需要在你插入数据的时候，指定往哪个库和集合操作就可以了</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;     </span><br><span class="line">    qq:&#123;                              // 数据库</span><br><span class="line">        users:[                       // 数据表</span><br><span class="line">            &#123;name:'azhong',age:15&#125;,   // 表记录</span><br><span class="line">            &#123;&#125;,</span><br><span class="line">            &#123;&#125;,</span><br><span class="line">            &#123;&#125;</span><br><span class="line">            ...</span><br><span class="line">        ],</span><br><span class="line">        products:[</span><br><span class="line">            </span><br><span class="line">        ],</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    taobao:&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line">    baidu:&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul><li>下载安装</li><li>配置环境变量</li><li>查看版本 <code>mongod --version</code></li></ul><h3 id="启动关闭数据库"><a href="#启动关闭数据库" class="headerlink" title="启动关闭数据库"></a>启动关闭数据库</h3><p>启动：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># mongodb 默认使用执行 mongod 命令所处盘符根目录下的 /data/db 作为自己的数据存储目录</span><br><span class="line"># 所以在第一次执行该命令之前先自己动手建一个 /data/db</span><br><span class="line">mongod</span><br></pre></td></tr></table></figure><p>如果想要修改默认的数据存储目录，可以：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath=数据存储目录路径</span><br></pre></td></tr></table></figure><p>停止：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在开启服务的控制台，直接 Ctrl + c</span><br><span class="line">或者直接关闭控制台</span><br></pre></td></tr></table></figure><h3 id="连接和退出数据库"><a href="#连接和退出数据库" class="headerlink" title="连接和退出数据库"></a>连接和退出数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 该命令默认连接本机的 mongodb 服务</span><br><span class="line">mongodb</span><br><span class="line"><span class="meta">#</span> 在连接状态输入 exit 退出连接</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><h3 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h3><ul><li><code>show dbs</code>：查看显示所有数据库</li><li><code>db</code>：查看当前操作的数据库</li><li><code>use 数据库名称</code>：切换到指定数据库（如果没有会新建）。例如：<code>use itcast</code></li><li><code>db.students.insertOne({&quot;name&quot;:&quot;Jack&quot;})</code>：插入数据，students 指的是集合</li><li><code>show collections</code>，显示集合</li><li><code>db.students.find()</code>：查询所有数据集合</li></ul><h3 id="在-node-中如何操作-MongoDB-数据"><a href="#在-node-中如何操作-MongoDB-数据" class="headerlink" title="在 node 中如何操作 MongoDB 数据"></a>在 node 中如何操作 MongoDB 数据</h3><h4 id="使用-node-mongodb-npm-包来操作"><a href="#使用-node-mongodb-npm-包来操作" class="headerlink" title="使用 node mongodb npm 包来操作:"></a>使用 node mongodb npm 包来操作:</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mongodb --save</span><br></pre></td></tr></table></figure><p><a href="https://github.com/mongodb/node-mongodb-native" target="_blank" rel="noopener">官方指导流程</a></p><h4 id="使用第三方-mongoose-来操作-MongoDB-数据库"><a href="#使用第三方-mongoose-来操作-MongoDB-数据库" class="headerlink" title="使用第三方 mongoose 来操作 MongoDB 数据库"></a>使用第三方 mongoose 来操作 MongoDB 数据库</h4><p>第三方包：<code>mongoose</code> 基于 MongoDB 官方的 <code>mongodb</code>包再次做了封装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mongoose --save</span><br></pre></td></tr></table></figure><p><a href="https://mongoosejs.com" target="_blank" rel="noopener">mongoose 官网</a></p><p> <a href="https://mongoosejs.com/docs/guide.html" target="_blank" rel="noopener">官方指南</a></p><p><a href="https://mongoosejs.com/docs/api.html" target="_blank" rel="noopener">官方 API 文档</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 引包</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 连接 MongoDB 数据库 连接本机 test 数据库</span></span><br><span class="line"><span class="comment">//    如果没有，在创建第一条数据库时自动创建</span></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://localhost:27017/test'</span>,&#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 之后延伸</span></span><br><span class="line"><span class="comment">// mongoose.Promise = global.Promise</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 创建一个模型，设计数据库</span></span><br><span class="line"><span class="comment">//    MongoDB 是动态的，非常灵活，直接在代码设计数据库</span></span><br><span class="line"><span class="comment">//    mongoose 使其设计编写过程变得简单</span></span><br><span class="line"><span class="keyword">const</span> Cat = mongoose.model(<span class="string">'Cat'</span>, &#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 实例化一个 Cat</span></span><br><span class="line"><span class="keyword">const</span> kitty = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">'Zildjian'</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 持久化保存 kitty 实例</span></span><br><span class="line">kitty.save().then(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'meow'</span>));</span><br></pre></td></tr></table></figure><h4 id="mongoose-入门"><a href="#mongoose-入门" class="headerlink" title="mongoose 入门"></a>mongoose 入门</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Schema = mongoose.Schema</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://location/itcast'</span>,&#123; <span class="attr">useMongoClient</span>:<span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设计集合结构（表结构），主要是为了 保证数据的完整性，不要有脏数据</span></span><br><span class="line"><span class="keyword">var</span> blogSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  title:  <span class="built_in">String</span>,       <span class="comment">// 字段名称就是表结构的属性名称</span></span><br><span class="line">  author: <span class="built_in">String</span>,       <span class="comment">// 指定了值的类型</span></span><br><span class="line">  body:   <span class="built_in">String</span>,</span><br><span class="line">  comments: [&#123; <span class="attr">body</span>: <span class="built_in">String</span>, <span class="attr">date</span>: <span class="built_in">Date</span> &#125;],</span><br><span class="line">  date: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, <span class="attr">default</span>: <span class="built_in">Date</span>.now &#125;,</span><br><span class="line">  hidden: <span class="built_in">Boolean</span>,</span><br><span class="line">  meta: &#123;</span><br><span class="line">    votes: <span class="built_in">Number</span>,</span><br><span class="line">    favs:  <span class="built_in">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  username: &#123;</span><br><span class="line">  type: string,</span><br><span class="line">  <span class="built_in">require</span>: <span class="literal">true</span> <span class="comment">// 该字段必须有，不能为空    </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将文档结构发布为模型 </span></span><br><span class="line"><span class="comment">//      mongoose.model 方法用来将一个架构发布为 model</span></span><br><span class="line"><span class="comment">//      第一个参数：传入一个大写名词单数用来表示数据库名称，mongoose 会自动生成 小写复数 的集合名称 User =&gt; users</span></span><br><span class="line"><span class="comment">//      第二个参数：架构 Schema</span></span><br><span class="line"><span class="comment">//      返回值：模型构造函数</span></span><br><span class="line"><span class="keyword">var</span> Blog = mongoose.model(<span class="string">'Blog'</span>, blogSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 使用操作集合中的数据（增删改查）</span></span><br><span class="line"><span class="keyword">var</span> admin = <span class="keyword">new</span> Blog(&#123;</span><br><span class="line">    ...<span class="comment">// 按照表结构写数据</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 存入数据</span></span><br><span class="line">admin.save(<span class="function"><span class="keyword">function</span>(<span class="params">err,ret</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'保存失败'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'保存成功'</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(ret)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询=============铁血直男分割线</span></span><br><span class="line">Blog.find(<span class="function"><span class="keyword">function</span> (<span class="params">err,ret</span>) </span>&#123;  <span class="comment">// 查询所有</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'查询失败'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(ret)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 按条件查询 </span></span><br><span class="line">Blog.find(&#123;</span><br><span class="line">    username: <span class="string">'azhong'</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,ret</span>) </span>&#123;  <span class="comment">// 查询所有</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'查询失败'</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(ret)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 按条件查询单个 没有条件查询第一个 查不到为 null</span></span><br><span class="line">Blog.findOne(&#123;</span><br><span class="line">    username: <span class="string">'azhong'</span>,</span><br><span class="line">    password: <span class="string">'12345'</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,ret</span>) </span>&#123;  <span class="comment">// 查询所有</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'查询失败'</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(ret)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除=============铁血直男分割线</span></span><br><span class="line">Blog.remove(&#123;</span><br><span class="line">    username: <span class="string">'azhong'</span>,</span><br><span class="line">    password: <span class="string">'12345'</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,ret</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'删除失败'</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(ret)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新=============铁血直男分割线</span></span><br><span class="line">Blog.findByIdAndUpdate(<span class="string">'sdafasdfadaf2erwrq'</span>,&#123;</span><br><span class="line">    username: <span class="string">'azhong'</span>,</span><br><span class="line">    password: <span class="string">'12345666'</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,ret</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'删除失败'</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(ret)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="使用-mongoose-修改案例"><a href="#使用-mongoose-修改案例" class="headerlink" title="使用 mongoose 修改案例"></a>使用 mongoose 修改案例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://localhost/itcast'</span>,&#123; <span class="attr">useMongoClient</span>:<span class="literal">true</span> &#125;) <span class="comment">//链接数据库，没有会新建</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Schema = mongoose.Schema</span><br><span class="line"></span><br><span class="line"><span class="comment">// mongoose.model('Comment',new Schema(&#123;&#125;))</span></span><br><span class="line"><span class="keyword">var</span> commentSchema = <span class="keyword">new</span> Schema(&#123;       <span class="comment">// 设计结构</span></span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: <span class="literal">true</span>,        <span class="comment">// 是否为必填项</span></span><br><span class="line">    &#125;,</span><br><span class="line">    gender:&#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        enum: [<span class="number">0</span>,<span class="number">1</span>],           <span class="comment">// 枚举 必须是 0/1</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="number">0</span>             <span class="comment">// 默认值 是 0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    message: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    date: &#123; </span><br><span class="line">       type:<span class="built_in">String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'Comment'</span>,commentSchema)</span><br><span class="line"></span><br><span class="line"><span class="comment">// mongodb 启动数据库 node app.js 启动服务器</span></span><br><span class="line"><span class="comment">// &#123;$value.id&#125; =&gt; &#123;$index + 1&#125;</span></span><br><span class="line"><span class="comment">// 处理添加学生 保存数据，其它 API名称一样所以不用改</span></span><br><span class="line"><span class="keyword">new</span> Comment(req.body).save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'Server error.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    res.redirect(<span class="string">'/students'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// mongodb 的id 默认为 _id</span></span><br><span class="line">Comment.findById(req.query.id.replace(<span class="regexp">/"/g</span>,<span class="string">''</span>),<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)</span><br><span class="line"><span class="comment">// replace 字符串模式 简单，但不支持全局和忽略大小写</span></span><br><span class="line"><span class="comment">//         正则模式 支持全局和忽略大小写</span></span><br></pre></td></tr></table></figure><h1 id="MySQL-node-js"><a href="#MySQL-node-js" class="headerlink" title="MySQL (node.js)"></a>MySQL (node.js)</h1><h2 id="安装（npm）"><a href="#安装（npm）" class="headerlink" title="安装（npm）"></a>安装（npm）</h2><p><a href="https://www.npmjs.com/package/mysql#introduction" target="_blank" rel="noopener">入门参考</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql</span><br></pre></td></tr></table></figure><h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载包</span></span><br><span class="line"><span class="keyword">var</span> mysql      = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建连接</span></span><br><span class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : <span class="string">'localhost'</span>,    <span class="comment">// 本机</span></span><br><span class="line">  user     : <span class="string">'me'</span>,           <span class="comment">// 用户名</span></span><br><span class="line">  password : <span class="string">'secret'</span>,       <span class="comment">// 密码</span></span><br><span class="line">  database : <span class="string">'my_db'</span>         <span class="comment">// 数据库</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 连接数据库</span></span><br><span class="line">connection.connect();</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 执行数据操作   增删改查都写在这里</span></span><br><span class="line">connection.query(<span class="string">'SELECT 1 + 1 AS solution'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">throw</span> error; <span class="comment">//throw err 阻止执行，抛出异常（打印到控制台）</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The solution is: '</span>, results[<span class="number">0</span>].solution);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 关闭连接</span></span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure><ul><li>Navicat  数据库可视化工具</li></ul><h1 id="重难点提取"><a href="#重难点提取" class="headerlink" title="重难点提取"></a>重难点提取</h1><h2 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h2><h3 id="问题：callback-hell（回调地狱）"><a href="#问题：callback-hell（回调地狱）" class="headerlink" title="问题：callback hell（回调地狱）"></a>问题：callback hell（回调地狱）</h3><p>即，在异步请求中嵌套异步请求</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'./data/a.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'./data/b.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'./data/c.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 问题：三个异步编程，异步编程不一定谁先谁后执行</span></span><br><span class="line"><span class="comment">// 需求：希望由自己制定顺序执行</span></span><br><span class="line"><span class="comment">// 解决：通过回调嵌套的方式保证顺序性</span></span><br><span class="line">fs.readFile(<span class="string">'./data/a.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">    fs.readFile(<span class="string">'./data/b.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">throw</span> err</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        fs.readFile(<span class="string">'./data/c.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="keyword">throw</span> err</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 新问题，嵌套过深，难以维护解决</span></span><br></pre></td></tr></table></figure><h3 id="EcmaScript-6-API-promise"><a href="#EcmaScript-6-API-promise" class="headerlink" title="EcmaScript 6 API promise"></a>EcmaScript 6 API <code>promise</code></h3><p>promise 承诺 保证 解决上述问题，是 <strong>ES6</strong> 的 API</p><ul><li>Promise 容器中存放了一个异步任务<ul><li>Pending  正在发生 进入以下一种状态<ul><li>Resolved     已解决</li><li>Rejected      未解决</li></ul></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Promise 容器</span></span><br><span class="line"><span class="comment">// 1.Promise 容器一旦创建，就开始创建里面执行的代码</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">    fs.readFile(<span class="string">'./data/a.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="comment">// 失败了，承诺容器中的任务失败了</span></span><br><span class="line">            <span class="built_in">console</span>.log(err)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 承诺容器中的任务成功了</span></span><br><span class="line">            <span class="built_in">console</span>.log(data)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line"><span class="comment">// 输出 1/2/4/3</span></span><br></pre></td></tr></table></figure><h3 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise 本身不是异步，但是内部往往都会封装一个异步任务</span></span><br><span class="line"><span class="keyword">var</span> el = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">    fs.readFile(<span class="string">'./data/a.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="comment">// 这里调用 resolve 方法实际上就是 then 方法传递的第二个函数</span></span><br><span class="line">            reject(err) <span class="comment">// 将容器的 Pending 状态改为 Rejected</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 这里调用 resolve 方法实际上就是 then 方法传递的第一个函数</span></span><br><span class="line">            resolve(data) <span class="comment">// 将容器的 Pending 状态改为 Resolved</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">el.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;   <span class="comment">// 指当 promise 实例成功了，然后触发 </span></span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'读取文件失败'</span>，err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="解决-回调地狱问题"><a href="#解决-回调地狱问题" class="headerlink" title="解决 回调地狱问题"></a>解决 回调地狱问题</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> el_1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">    fs.readFile(<span class="string">'./data/a.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            reject(err)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolve(data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> el_2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">    fs.readFile(<span class="string">'./data/b.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            reject(err)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolve(data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> el_3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">    fs.readFile(<span class="string">'./data/c.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            reject(err)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolve(data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">el_1  <span class="comment">// 异步编程 链式调用</span></span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        <span class="keyword">return</span> el_2 <span class="comment">// return 的 promise 对象可在后面的 then 中接收到</span></span><br><span class="line">    &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'读取文件失败'</span>，err)</span><br><span class="line">    &#125;) </span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        <span class="keyword">return</span> el_3</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h3 id="封装-Promise-API"><a href="#封装-Promise-API" class="headerlink" title="封装 Promise API"></a>封装 Promise API</h3><h4 id="封装-readFile"><a href="#封装-readFile" class="headerlink" title="封装 readFile"></a>封装 <code>readFile</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pReadFile</span>(<span class="params">filePath</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">        fs.readFile(filePath,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                reject(err)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resolve(data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pReadFile(<span class="string">'./data/a.txt'</span>)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        <span class="keyword">return</span> pReadFile(<span class="string">'./data/b.txt'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data) </span><br><span class="line">        <span class="keyword">return</span> pReadFile(<span class="string">'./data/c.txt'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h4 id="jQ已封装支持"><a href="#jQ已封装支持" class="headerlink" title="jQ已封装支持"></a>jQ已封装支持</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;&#125;</span><br><span class="line">$.<span class="keyword">get</span>('http://a/s/d/1')</span><br><span class="line">    .then(function (userData) &#123;</span><br><span class="line">        data.user = user</span><br><span class="line">        <span class="keyword">return</span> $.<span class="keyword">get</span>('http://a/s/d/2')</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(function (jobsData) &#123;</span><br><span class="line">        data.jobs = jobs</span><br><span class="line">        <span class="keyword">var</span> htmlStr = template(<span class="string">'tpl'</span>,data)</span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">'#user_form'</span>).innerHTML = htmlStr</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h5 id="jQ中Ajax使用Promise"><a href="#jQ中Ajax使用Promise" class="headerlink" title="jQ中Ajax使用Promise"></a>jQ中Ajax使用Promise</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">'#btn'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: <span class="string">'./data.json'</span>,</span><br><span class="line">            type: <span class="string">'get'</span>,</span><br><span class="line">            dataType: <span class="string">'json'</span>,</span><br><span class="line">            <span class="comment">/*success: function (data) &#123;</span></span><br><span class="line"><span class="comment">                console.log(data)</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="自己封装jQ"><a href="#自己封装jQ" class="headerlink" title="自己封装jQ"></a>自己封装jQ</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">        <span class="comment">// 当请求加载成功后调用指定函数</span></span><br><span class="line">        oReq.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            resolve(oReq.responseText)</span><br><span class="line">        &#125;</span><br><span class="line">        oReq.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">            reject(err)</span><br><span class="line">        &#125;</span><br><span class="line">        oReq.open(<span class="string">"get"</span>,url,<span class="literal">true</span>)</span><br><span class="line">        oReq.send()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用场景（分类信息展示）-废弃"><a href="#使用场景（分类信息展示）-废弃" class="headerlink" title="使用场景（分类信息展示）[废弃]"></a>使用场景（分类信息展示）[废弃]</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"js中的一等公民"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>职业<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>学生<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>老师<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>码农<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>老板<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>演员<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">//用户表 获取用户信息</span></span></span><br><span class="line"><span class="javascript"><span class="comment">//职业信息表 获取所有的职业信息</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"users"</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>:<span class="number">1</span>,</span><br><span class="line">            <span class="attr">"username"</span>:<span class="string">"admin"</span>,</span><br><span class="line">            <span class="attr">"age"</span>:<span class="number">18</span>,</span><br><span class="line">            <span class="attr">"job"</span>:<span class="number">2</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>:<span class="number">2</span>,</span><br><span class="line">            <span class="attr">"username"</span>:<span class="string">"root"</span>,</span><br><span class="line">            <span class="attr">"age"</span>:<span class="number">18</span>,</span><br><span class="line">            <span class="attr">"job"</span>:<span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>:<span class="number">3</span>,</span><br><span class="line">            <span class="attr">"username"</span>:<span class="string">"admin"</span>,</span><br><span class="line">            <span class="attr">"age"</span>:<span class="number">18</span>,</span><br><span class="line">            <span class="attr">"job"</span>:<span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"jobs"</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>:<span class="number">1</span>,</span><br><span class="line">            <span class="attr">"name"</span>:<span class="string">"学生"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>:<span class="number">2</span>,</span><br><span class="line">            <span class="attr">"name"</span>:<span class="string">"老师"</span> </span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>:<span class="number">3</span>,</span><br><span class="line">            <span class="attr">"name"</span>:<span class="string">"码农"</span> </span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>:<span class="number">4</span>,</span><br><span class="line">            <span class="attr">"name"</span>:<span class="string">"老板"</span> </span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;README&quot;&gt;&lt;a href=&quot;#README&quot; class=&quot;headerlink&quot; title=&quot;README&quot;&gt;&lt;/a&gt;README&lt;/h1&gt;&lt;h2 id=&quot;后端语言&quot;&gt;&lt;a href=&quot;#后端语言&quot; class=&quot;headerlink&quot; title=&quot;后端语言&quot;&gt;&lt;/a&gt;后端语言&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;后端当然有：Java PHP Python Ruby .Net … Node.js。&lt;/li&gt;
&lt;li&gt;啊，作为前端进入后台的切入口，当然是Node.js了。
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="后端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Node.js" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/Node-js/"/>
    
      <category term="README" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/Node-js/README/"/>
    
    
      <category term="node.js 技术栈" scheme="http://yoursite.com/tags/node-js-%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
    
      <category term="后端技术" scheme="http://yoursite.com/tags/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Express 框架" scheme="http://yoursite.com/tags/Express-%E6%A1%86%E6%9E%B6/"/>
    
      <category term="mongoDB 数据库" scheme="http://yoursite.com/tags/mongoDB-%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>optimization</title>
    <link href="http://yoursite.com/2019/03/27/Web_optimization/"/>
    <id>http://yoursite.com/2019/03/27/Web_optimization/</id>
    <published>2019-03-27T11:48:00.000Z</published>
    <updated>2020-01-13T08:28:26.442Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h2><p>性能优化……<a id="more"></a></p><h2 id="Hexo之性能优化"><a href="#Hexo之性能优化" class="headerlink" title="Hexo之性能优化"></a>Hexo之性能优化</h2><p>hexo是本博的框架，起初是建立在 <strong>github</strong> 上的静态页面。但是仅仅只是根据 hexo 建立好博客是远远不够的。因为在一般网络环境下加载速度会很慢，如果自己的知识积累还不如百度来的快，那建立博客的初衷就会大大减少。加载速度慢有很多原因，比如，框架本身的源码中有许多空格，github是外网，图片加载尤其缓慢，字体采用的是 google 字体等等。从这几个方面入手，解决性能优化问题，是本页的初衷。</p><h3 id="DNS域名解析"><a href="#DNS域名解析" class="headerlink" title="DNS域名解析"></a>DNS域名解析</h3><p>DNS域名解析是本博最基础且是最致命的问题。国内访问 <strong><em><a href="http://jjk5fz.coding-pages.com/" target="_blank" rel="noopener">本博</a></em></strong> so fast 。木钱买域名，凄惨。</p><h3 id="移动端删除-live2d-widget"><a href="#移动端删除-live2d-widget" class="headerlink" title="移动端删除 live2d-widget"></a>移动端删除 live2d-widget</h3><p>在 _config.yml 文件夹下将 live2d 中的 mobile 置为 false。</p><h3 id="修改-hexo-样式"><a href="#修改-hexo-样式" class="headerlink" title="修改 hexo 样式"></a>修改 hexo 样式</h3><p>在该 <code>F:\blog\themes\next\source\css\_custom\custom.styl</code> 文件下修改即可覆盖原本样式。想要复原时，删除该文件内容即可。</p><p><strong>注意：</strong><br>修改 header（头部导航栏）的透明度会引发 search 选项调出的弹框被遮挡层遮挡，建议修改 header 内部标签属性实现，可 F12 参考本博。</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介：&quot;&gt;&lt;a href=&quot;#简介：&quot; class=&quot;headerlink&quot; title=&quot;简介：&quot;&gt;&lt;/a&gt;简介：&lt;/h2&gt;&lt;p&gt;性能优化……
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="hexo" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/hexo/"/>
    
      <category term="性能优化" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/hexo/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
      <category term="DNS 解析案例" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/hexo/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/DNS-%E8%A7%A3%E6%9E%90%E6%A1%88%E4%BE%8B/"/>
    
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
      <category term="性能优化" scheme="http://yoursite.com/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ES6——Readme</title>
    <link href="http://yoursite.com/2019/03/27/JS_ES6/"/>
    <id>http://yoursite.com/2019/03/27/JS_ES6/</id>
    <published>2019-03-27T11:48:00.000Z</published>
    <updated>2020-02-10T11:03:48.860Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h2><p>ES6 在这里就不给详细科普了</p><ul><li>ES6 全称ECMAScript 6.0 ,是JavaScript的新的一个版本标准，说是为了：<ul><li>适应更复杂的应用；</li><li>实现代码库之间的共享；</li><li>不断迭代维护新版本；<a id="more"></a></li></ul></li><li>兼容性，各大浏览器基本上都支持 ES6 的新特性。（时代在进步，这里对于这个必然趋也不进行过多叙述了）<ul><li>Chrome Firefox 兼容的最好</li><li>IE 7~11基本不支持（万恶的兼容之源）</li></ul></li><li>本文是在老的基础上对比新的来学习，毕竟在项目里并不都是ES6。顺便温故而知新。</li></ul><h2 id="新的声明方式："><a href="#新的声明方式：" class="headerlink" title="新的声明方式："></a>新的声明方式：</h2><p>old: ver</p><ul><li><p>不支持封闭作用域，会声明到全局作用域</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 0;i&lt;3;i++)&#123; </span><br><span class="line">   console.log(i); // 0 1 2</span><br><span class="line">&#125;</span><br><span class="line">console.log(i); //结果是 3 3 3</span><br><span class="line">//意思是在for循环里声明的变量，在全局也可以拿到</span><br></pre></td></tr></table></figure></li><li><p>old 解决方法，把它放到一个匿名函数里去</p><pre><code>(function(){    for (var i = 0;i&lt;3;i++){        console.log(i)    }})();console.log(i);// 0 1 2</code></pre></li><li><p>以及定时器问题</p><pre><code>for(var i = 0;i&lt;3;i++){    setTimeout(function(){        console.log(i);    },1000);}//for循环是同步代码，setTimeout()是异步代码。根据事件环，同步代码执行完毕之后，才执行异步代码，此时变量i已经是全局的变量i且为3，因此结果为3 3 3 3 3 ...//by the way : 在项目开发中要记得清理定时器:var flag = setTimeout(fn,1000);clearInterval(flag);//后面准备专门写一篇关于内存泄露的，这里打个标记 (#^.^#)</code></pre></li><li><p>old 解决方法：</p><pre><code>for(var i = 0;i&lt;3;i++){    (function(i){        setTimeout(function(){            console.log(i);        },1000);     })(i);} // 结果 ：0 1 2</code></pre></li></ul><p>new: let </p><ul><li><p>let 和 {} 配合可以产生一个作用域</p></li><li><p>let 支持块级作用域，声明的变量只会声明在当前作用域内</p><pre><code>for(let i = 0;i&lt;3;i++){        setTimeout(function(){            console.log(i);        },1000);  // 结果 ：0 1 2} console.log(i); // undefined</code></pre></li><li><p>let 可以解决作用域污染问题和局部作用域问题</p><ul><li><p>new 不可以在同一作用域下多次声明 </p><pre><code>let a = 3      //不同作用域，因此可以function fn(){  let a = 1;  let a = 2;  // 报错}</code></pre></li><li><p>old 可以</p><pre><code>var a = 3function fn(){    var a = 1;    var a = 2;   //不会报错}</code></pre></li></ul></li><li><p>域解释问题 ——变量提升</p><ul><li><p>new 没有变量提升，以及要避免暂存死区（避免）</p><pre><code>console.log(b)let b = 1;  // undefinedlet a = 1;{    console.log(a); // undefined     let a = 2;}</code></pre></li><li><p>old 变量提升只提升变量名，并不赋值</p><pre><code>console.log(a);  //undefinedvar a = 1;console.log(a);   // 1</code></pre></li></ul></li></ul><p>new : const</p><ul><li>const 与 let 基本一致</li><li><p>const声明的变量不能被修改，指的是不能被修改引用空间</p><p>  const a = 1;<br>  a = 2;   //报错，不能给常量赋值</p><p>  const a = {name:’xyz’}<br>  a.age = 9;<br>  console.log(a); //没有修改引用空间，因此可以。</p></li></ul><h2 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h2><ul><li>解构赋值 声明和赋值都放到了一起</li><li>解构 表示等号左边和右边解构类似</li><li>数组的位置必须相同</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [,age] = [<span class="string">'十八'</span>，<span class="number">18</span>]</span><br></pre></td></tr></table></figure><ul><li>对象解构时的名字必须相同</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; length &#125; = [<span class="string">'十八'</span>，<span class="number">18</span>];</span><br><span class="line"><span class="built_in">console</span>.log(length);           <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><ul><li>如果有关键字可以采用 : 的形式进行更改名字</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;name,age,<span class="attr">default</span>:d&#125; = &#123;<span class="attr">name</span>:<span class="string">'十八'</span>，age:<span class="number">18</span>,<span class="attr">default</span>:<span class="string">'灰喵'</span>&#125;</span><br><span class="line"><span class="built_in">console</span>.log(d);                <span class="comment">// 灰喵</span></span><br></pre></td></tr></table></figure><ul><li>多层取数/取默认值 如果想设置某个属性的默认值 必须采用 = 号的形式</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [, &#123;<span class="attr">address</span>: [,a]&#125;,hobby=<span class="string">'挠人'</span>] = [</span><br><span class="line">    &#123; <span class="attr">name</span>:<span class="string">'十八'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">age</span>: <span class="number">15</span>,<span class="attr">address</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="built_in">console</span>.log(hobby);     <span class="comment">// 挠人</span></span><br></pre></td></tr></table></figure><ul><li>解构的应用</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">&#123;url=new Error(<span class="string">'url without'</span></span>),<span class="title">type</span>="<span class="title">get</span>",<span class="title">data</span>=<span class="title">xxx</span>&#125;) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(url,type,data);</span><br><span class="line">&#125;</span><br><span class="line">ajax(&#123;</span><br><span class="line">    url:<span class="string">'/test'</span>,</span><br><span class="line">    type:<span class="string">'get'</span>,</span><br><span class="line">    data:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> [a,b,c] = test();</span><br></pre></td></tr></table></figure><h2 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h2><p><strong>模本字符串</strong> 取代了 原有的<strong>字符串拼接</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'十八'</span>;</span><br><span class="line"><span class="keyword">let</span> age = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">let</span> str = <span class="string">`hello~'<span class="subst">$&#123;name&#125;</span>'今年<span class="subst">$&#123;age&#125;</span>岁了`</span></span><br><span class="line"><span class="built_in">console</span>.log(str);  <span class="comment">// hello~'十八'今年15岁了</span></span><br></pre></td></tr></table></figure><p>支持<strong>换行</strong> 和 <strong>取值 ${}</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">`&lt;ul&gt;</span></span><br><span class="line"><span class="string">  &lt;li&gt;<span class="subst">$&#123;name&#125;</span>&lt;/li&gt;</span></span><br><span class="line"><span class="string">  &lt;li&gt;<span class="subst">$&#123;age&#125;</span>&lt;/li&gt;</span></span><br><span class="line"><span class="string">&lt;/ul&gt;`</span></span><br></pre></td></tr></table></figure><p>如何实现 一个类模板字符串的功能</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str = str.replace(<span class="regexp">/\$\&#123;([^]*)&#125;\)/g</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(<span class="built_in">arguments</span>[<span class="number">1</span>]); <span class="comment">//with</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure><p>带标签的模板字符串 自定义模板字符串的实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">meStr</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>) <span class="comment">// &#123;'0':['hello~','今年','岁了'],'1':'十八','2':15&#125;</span></span><br><span class="line">    <span class="keyword">let</span> strings = <span class="built_in">arguments</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// Array.prototype.slice.call()</span></span><br><span class="line">    <span class="keyword">let</span> values = [].slice.call(<span class="built_in">arguments</span>,<span class="number">1</span>) <span class="comment">// 将后两项转为数组 ['十八'，15]</span></span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;values.length;i++)&#123;</span><br><span class="line">        str += <span class="string">`<span class="subst">$&#123;strings[i]&#125;</span>*<span class="subst">$&#123;values[i]&#125;</span>*`</span></span><br><span class="line">    &#125;</span><br><span class="line">    str += strings[strings.length<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> str = meStr<span class="string">`hello~'<span class="subst">$&#123;name&#125;</span>'今年<span class="subst">$&#123;age&#125;</span>岁了`</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure><p>补充：常用字符串方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="string">'http://F-lancer.io/node.html'</span></span><br><span class="line"><span class="comment">// includes   是否包含</span></span><br><span class="line"><span class="built_in">console</span>.log(url.includes(<span class="string">'lancer'</span>))</span><br><span class="line"><span class="comment">// startsWith 以xxx开头</span></span><br><span class="line"><span class="built_in">console</span>.log(url.startsWith(<span class="string">'http://'</span>))</span><br><span class="line"><span class="comment">// endsWith   以xxx结尾</span></span><br><span class="line"><span class="built_in">console</span>.log(url.endsWith(<span class="string">'.html'</span>))</span><br><span class="line"><span class="comment">// 进制转换 padStart padEnd 补全</span></span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">let</span> hour = date.getHours();</span><br><span class="line">    <span class="keyword">let</span> minutes = date.getMinutes();</span><br><span class="line">    <span class="keyword">let</span> seconds = date.getSeconds();</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">`<span class="subst">$&#123;hour.toString().padStart(<span class="number">2</span>,<span class="number">0</span>)&#125;</span>:`</span>; <span class="comment">// 不满两位 补 0</span></span><br><span class="line">    str += <span class="string">`<span class="subst">$&#123;minutes.toString().padStart(<span class="number">2</span>,<span class="number">0</span>)&#125;</span>:`</span>;</span><br><span class="line">    str += <span class="string">`<span class="subst">$&#123;seconds.toString().padStart(<span class="number">2</span>,<span class="number">0</span>)&#125;</span>`</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(str)</span><br><span class="line">&#125;,<span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><p>优点 ：箭头函数写起来简单，解决了 this 的问题。</p><p>与高阶函数的对比：</p><ul><li><p>箭头函数没有 function 的关键字</p></li><li><p>小括号和大括号之间有个箭头</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> fn = <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果参数是一个，可以省略小括号</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="params">a</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果没有 return 可以不写大括号</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="params">a</span> =&gt;</span> a;</span><br></pre></td></tr></table></figure><p><strong>例：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c+d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="function"><span class="params">c</span> =&gt;</span> d =&gt; c+d;</span><br><span class="line"><span class="built_in">console</span>.log(a(<span class="number">1</span>)(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意 返回一个对象时 加个括号（）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">sum</span>:c+d&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="function"><span class="params">c</span> =&gt;</span> d =&gt; (&#123;<span class="attr">sum</span>:c+d&#125;);</span><br></pre></td></tr></table></figure><ul><li>解决 this 问题 </li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// old way </span></span><br><span class="line"><span class="comment">// (1) 谁调用指向谁</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    b:<span class="number">1</span>,</span><br><span class="line">    a:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj.a()); <span class="comment">// this为,&#123; b:1, a:[Function:a] &#125; ,第二个 console为 undefine</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// (2) window 调用 指向window</span></span><br><span class="line"><span class="keyword">let</span> fn = obj.a;</span><br><span class="line">fn();  </span><br><span class="line"></span><br><span class="line"><span class="comment">// (3) 同理 定时器 也指向 window</span></span><br><span class="line"><span class="keyword">let</span> obj=&#123;</span><br><span class="line">    b:<span class="number">1</span>,</span><br><span class="line">    a:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">        &#125;,<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.a(); <span class="comment">// 指向window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// (3.1) 想要使其指向 obj (old way) var that = this;</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    b:<span class="number">1</span>,</span><br><span class="line">    a:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="keyword">this</span>;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(that);</span><br><span class="line">        &#125;,<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.a(); <span class="comment">// 指向 obj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// (3.2) 使用 bind() 方法 改变指向 或 call() apply() (备选);</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    b:<span class="number">1</span>,</span><br><span class="line">    a:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">        &#125;.bind(<span class="keyword">this</span>),<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.a(); <span class="comment">// 指向 obj</span></span><br></pre></td></tr></table></figure><ul><li>箭头函数没有 this 指向，因此会向上找 this，就解决了 this指向被改变的问题</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj=&#123;</span><br><span class="line">    b:<span class="number">1</span>,</span><br><span class="line">    a:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">        &#125;,<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.a() <span class="comment">// &#123;b:1,a:f&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj=&#123;</span><br><span class="line">    b: <span class="number">1</span>,</span><br><span class="line">    a: <span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">        &#125;,<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.a() <span class="comment">// window</span></span><br></pre></td></tr></table></figure><p><strong>例：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    a:<span class="number">2</span>,</span><br><span class="line">    b:<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.b(); <span class="comment">// a = 1; 对象不是作用域，所以会找到外面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    a:<span class="number">2</span>,</span><br><span class="line">    b:<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.b(); <span class="comment">// this = window;this.a = undefined 对象不是作用域，所以会找到外面,let不会声明到全局</span></span><br></pre></td></tr></table></figure><ul><li>箭头函数中 <strong>没有</strong> <code>arguments</code>  可以使用 <strong>剩余运算符</strong> <code>...</code> 只能放到最后一个（剩余全部）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function">(<span class="params">x,...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(args)</span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="string">'x'</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) <span class="comment">// [1,2,3,4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//等同于</span></span><br><span class="line"><span class="keyword">let</span> fn = <span class="function">(<span class="params">...<span class="built_in">arguments</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> arg = <span class="built_in">arguments</span>.slice(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(args);</span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="string">'x'</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure><ul><li>可以设置默认值</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function">(<span class="params">x=<span class="number">1</span>,y=<span class="number">2</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x+y);</span><br><span class="line">&#125;</span><br><span class="line">fn()</span><br></pre></td></tr></table></figure><h2 id="展开运算符"><a href="#展开运算符" class="headerlink" title="展开运算符"></a>展开运算符</h2><p><strong>例 1：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// apply 可以把参数用数组的方式传，即可以一个个传</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">spread</span>(<span class="params">x,...args</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// sum.apply(null,agrs); 等价于</span></span><br><span class="line">    sum(...args); <span class="comment">// 展开预算符</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a,b,c,d</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a,b,c,d);</span><br><span class="line">&#125; </span><br><span class="line">spread(<span class="string">'x'</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure><p><strong>例 2：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// concat 拼接转换</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].concat([<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]); <span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">let</span> arr = [...[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],...[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]];  <span class="comment">// 展开两个数组拼接到一起</span></span><br></pre></td></tr></table></figure><p><strong>例 3：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 展开求最小值</span></span><br><span class="line"><span class="built_in">Math</span>.min(...[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br></pre></td></tr></table></figure><p><strong>例 4：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 展开对象</span></span><br><span class="line"><span class="keyword">let</span> name = &#123;<span class="attr">name</span>:<span class="string">'十八'</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> age = &#123;<span class="attr">age</span>:<span class="string">'15'</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> cat = &#123;...name,...age&#125;;</span><br></pre></td></tr></table></figure><p><strong>例 5：深浅拷贝</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用 slice 拷贝 为浅拷贝 一维数组就是深拷贝</span></span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> a = [b];</span><br><span class="line"><span class="keyword">let</span> c = a.slice(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(c);     <span class="comment">// [[1,2,3]]</span></span><br><span class="line">b[<span class="number">0</span>] = <span class="number">100</span>;</span><br><span class="line">conosle.log(c);     <span class="comment">// [[100,2,3]] 随之改变为浅拷贝</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...运算符也是浅拷贝 一维数组就是深拷贝</span></span><br><span class="line"><span class="keyword">let</span> name = &#123; <span class="attr">name</span>: &#123;<span class="attr">name</span>:<span class="string">'十八'</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> age = &#123; <span class="attr">age</span>: <span class="number">9</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> cat = &#123; ...name, ...age &#125;;</span><br><span class="line">name.name.name = <span class="string">'喵喵'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(cat);   <span class="comment">// &#123; name: &#123; name: '喵喵' &#125;, age: 9 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 深拷贝的实现 </span></span><br><span class="line"><span class="comment">// 补充：JSON.Stringify() 用于将 对象/值 转为JSON格式 </span></span><br><span class="line"><span class="comment">//      JSON.parse() 解析JSON字符串</span></span><br><span class="line"><span class="comment">// 以下不支持 函数 ，且都会强制性都变为对象，无法继承</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">fn</span>:<span class="function"><span class="keyword">function</span>(<span class="params">params</span>) </span>&#123;&#125;,<span class="attr">t</span>:<span class="regexp">/a/</span>,<span class="attr">d</span>:<span class="keyword">new</span> <span class="built_in">Date</span>,<span class="attr">b</span>:<span class="literal">null</span>&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj)));</span><br></pre></td></tr></table></figure><h3 id="实现深拷贝（保留继承关系，实现各种类型的拷贝）"><a href="#实现深拷贝（保留继承关系，实现各种类型的拷贝）" class="headerlink" title="实现深拷贝（保留继承关系，实现各种类型的拷贝）"></a>实现深拷贝（保留继承关系，实现各种类型的拷贝）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> obj !== <span class="string">'object'</span>) <span class="keyword">return</span> obj;</span><br><span class="line">    <span class="keyword">if</span>(obj == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(obj <span class="keyword">instanceof</span> <span class="built_in">Date</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(obj);</span><br><span class="line">    <span class="keyword">if</span>(obj <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RegExp</span>(obj);</span><br><span class="line">    <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Array]'</span></span><br><span class="line">    <span class="keyword">let</span> o = <span class="keyword">new</span> obj.constructor(); <span class="comment">// 保留类的继承关系</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj)&#123; <span class="comment">//是对象就递归</span></span><br><span class="line">        o[key] = <span class="keyword">typeof</span> obj[key] === <span class="string">'object'</span> ? deepClone(obj[key]) : obj[key]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o = &#123; <span class="attr">a</span>: &#123; <span class="attr">a</span>: <span class="number">1</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">let</span> newObj = deepClone(o);</span><br><span class="line"><span class="built_in">console</span>.log(newObj);</span><br></pre></td></tr></table></figure><h2 id="数组新增及常用方法"><a href="#数组新增及常用方法" class="headerlink" title="数组新增及常用方法"></a>数组新增及常用方法</h2><p><code>map() some() every() filter() forEach()</code>     es5</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1) forEach</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.forEach = <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;<span class="keyword">this</span>.length;i++) &#123;</span><br><span class="line">        fn(<span class="keyword">this</span>.[i],i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">;[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].forEach(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item,index);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2) map返回值 返回值是一个新数组</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.map = <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++) &#123;</span><br><span class="line">        arr.push(fn(<span class="keyword">this</span>[i],i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item*<span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3) filter 过滤 如果返回true表示留下 返回false表示删除</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> filterArr = arr.filter(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item&gt;<span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(filterArr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4) find 查找 返回查找的那一项，找到后就不会继续找了，没有返回 undefined</span></span><br><span class="line"><span class="keyword">let</span> f = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].find(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item === <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(f);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5) some 找到后返回true，找到false可以用every （找到第一个不为条件的截止）</span></span><br><span class="line"><span class="keyword">let</span> r = [<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>].some(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item);</span><br><span class="line">    <span class="keyword">return</span> item === <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(r);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6) includes 是否包含</span></span><br><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].includes(<span class="number">3</span>));</span><br></pre></td></tr></table></figure><p><code>find() findIndex()</code> es6</p><p><code>reduce()</code>  收敛 叠加  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1) reduce 返回的结果是叠加后的结果 迭代根据设置叠加</span></span><br><span class="line"><span class="comment">// prev 第一项 next第二项 currIndex循环次数 ary传入的数组</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].reduce(<span class="function">(<span class="params">prev, next, currIndex, ary</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> prev+next;   <span class="comment">// 返回的结果会给予下一次迭代的 prev</span></span><br><span class="line">&#125;,<span class="number">0</span>) <span class="comment">// 加 0 多循环一次</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2) 求平均数</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>].reduce(<span class="function">(<span class="params">prev,next,currIndex,ary</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ary.length<span class="number">-1</span> === currIndex)&#123;</span><br><span class="line">        <span class="keyword">return</span> (prev+next)/ary.length</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prev+next;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3) 对象</span></span><br><span class="line">[&#123;<span class="attr">price</span>:<span class="number">10</span>&#125;,&#123;<span class="attr">price</span>:<span class="number">20</span>&#125;,&#123;<span class="attr">price</span>:<span class="number">30</span>&#125;].reduce(<span class="function">(<span class="params">prev,next,currIndex,arr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> prev +next.price <span class="comment">// 若为 prev.prive + next.price 结果为 NaN</span></span><br><span class="line">&#125;,<span class="number">0</span>) <span class="comment">// 0 设置初始值，使得第一次遍历为 0+10,不设置就从第一项开始</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4) 原理</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.myReduce = <span class="function"><span class="keyword">function</span> (<span class="params">fn,prev</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;<span class="keyword">this</span>.length;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> prev === <span class="string">'undefined'</span>)&#123;</span><br><span class="line">            prev = fn(<span class="keyword">this</span>[i],<span class="keyword">this</span>[i + <span class="number">1</span>],i + <span class="number">1</span>,<span class="keyword">this</span>);</span><br><span class="line">            i++;  <span class="comment">// 保证不错乱</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           prev = fn(prev,<span class="keyword">this</span>[i],i,<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prev;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].myReduce(<span class="function">(<span class="params">prev,next,currIndex,ary</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> prev + next</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5) 利用 reduce 展平二维数组</span></span><br><span class="line"><span class="keyword">let</span> flat = [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]].reduce(<span class="function">(<span class="params">prev,next,index,ary</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [...prev,...next];</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>for of()</code></p><p><code>Array.form ()</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将类数组转化为数组</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;  <span class="comment">//此处不能传参，传残就表示只能一个或指定个数</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">eval</span>(<span class="built_in">Array</span>.from(<span class="built_in">arguments</span>).join(<span class="string">'+'</span>)))</span><br><span class="line">&#125;</span><br><span class="line">a(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常见的类数组有 htmlCollection（html的元素集合）、arguments、&#123;0:1,1:2,2:3,length:3&#125;</span></span><br></pre></td></tr></table></figure><p><code>of()</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ary = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ary); <span class="comment">// 声明的数组为三个空项 [ empty , empty , empty ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ary = <span class="built_in">Array</span>.of(<span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ary); <span class="comment">// 声明的数组为 [3]</span></span><br></pre></td></tr></table></figure><h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><p><code>Object.assign()</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = &#123;<span class="attr">name</span>:<span class="string">'十八'</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> age = &#123;<span class="attr">age</span>:<span class="number">9</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> obj = <span class="built_in">Object</span>.assign(name,age);  <span class="comment">// 浅拷贝</span></span><br><span class="line"><span class="built_in">console</span>.log(obj); <span class="comment">// 等同于 console.log(&#123;...name,...age&#125;) ;</span></span><br></pre></td></tr></table></figure><p><code>__proto__ 链</code>    <code>Object.setPrototypeOf()</code>  可以在对象内直接操作 <code>__proto__</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">"十八"</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = &#123; <span class="attr">age</span>: <span class="number">9</span> &#125;;</span><br><span class="line">obj1.__proto__ = obj2;</span><br><span class="line"><span class="built_in">console</span>.log(obj1.age);</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(obj1,obj2);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(obj1));</span><br><span class="line"><span class="comment">// 子中获取父的名字</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    age: <span class="number">9</span>,</span><br><span class="line">    name: <span class="string">'十八'</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    name:<span class="string">'喵喵'</span>,</span><br><span class="line">    getPName () &#123; <span class="comment">// 可以通过 super 关键字获取父属性</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.name</span><br><span class="line">    &#125;,</span><br><span class="line">    __proto__:obj2</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj.name) <span class="comment">// 喵喵</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.getPName()) <span class="comment">// 十八</span></span><br></pre></td></tr></table></figure><h2 id="类-class"><a href="#类-class" class="headerlink" title="类 class"></a>类 class</h2><p>在 es5 中没有类的概念，通过 <strong>构造函数</strong> 模拟类</p><h3 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h3><p>三种属性: <strong>公有属性</strong>（<code>__proto__</code>）、<strong>私有属性</strong>、<strong>静态方法（静态属性）</strong></p><p>如何实现一个类：(es5)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 构造函数中的 this 通过 new 调用，那么 this 指代的是实例</span></span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'parent'</span>; <span class="comment">//私有属性</span></span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'eat'</span>); <span class="comment">// 公有属性</span></span><br><span class="line">    <span class="comment">// 这里有个 constructor 属性指向 Parent</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> parent = <span class="keyword">new</span> Parent();  <span class="comment">// 实例上有 __proto__ 指向 Parent</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Parent.prototype.constructor === Parent); <span class="comment">// true</span></span><br><span class="line">parent.__proto__.eat(); <span class="comment">// eat 会先去私有属性中找，找不到去公有属性里找</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.age = <span class="number">9</span>; <span class="comment">// 构造函数中的 this 通过 new 调用，那么 this 指代的是实例</span></span><br><span class="line">    Parent.call(<span class="keyword">this</span>); <span class="comment">// 等价于 this.name = 'parent' 实现继承私有属性</span></span><br><span class="line">&#125;</span><br><span class="line">Child.prototype.smoking = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'smoking'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(Child.age) <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承私有属性 Parent.call(this);</span></span><br><span class="line"><span class="built_in">console</span>.log(child.name)</span><br><span class="line"><span class="comment">// 继承公有属性</span></span><br><span class="line"><span class="comment">// 使用 Child.prototype = Parent.prototype; 使其互相影响变成兄弟关系，非继承关系</span></span><br><span class="line">Child.prototyoe.__proto__ = Parent.prototype; <span class="comment">// es5中的方法</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(Child.prototype,Parent.prototype); <span class="comment">// es6</span></span><br><span class="line">Child.prototype = <span class="built_in">Object</span>.create(Parent.prototype) <span class="comment">// 可以实现只继承公有属性</span></span><br><span class="line"><span class="comment">// 原理：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">parentPrototype,props</span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Fn</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">    Fn.prototype = parentPrototype;</span><br><span class="line">    <span class="keyword">let</span> fn = <span class="keyword">new</span> Fn();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> props)&#123;</span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(fn,key,&#123;</span><br><span class="line">            ...props[key],</span><br><span class="line">            enumerable:<span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fn;</span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = <span class="built_in">Object</span>.create(Parent.prototype,&#123;<span class="attr">constructor</span>:&#123;<span class="attr">value</span>:Child&#125;&#125;);</span><br><span class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(child.constructor) <span class="comment">// 会指向 parent 的 Constructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line">a.name = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(a,<span class="string">'name'</span>,&#123;</span><br><span class="line">    enumerable:<span class="literal">true</span>, <span class="comment">// 使其可枚举</span></span><br><span class="line">    configurable:<span class="literal">true</span>, <span class="comment">// 可删除</span></span><br><span class="line">    writable:<span class="literal">true</span>, <span class="comment">// 可编辑</span></span><br><span class="line">    <span class="keyword">get</span>()&#123;&#125;, <span class="comment">// 这两个就不能写 write 和 value</span></span><br><span class="line">    <span class="keyword">set</span>()&#123;&#125;,</span><br><span class="line">    value:<span class="number">1</span> <span class="comment">// 只定义这个是看不到的，及不可枚举型</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="class（类）"><a href="#class（类）" class="headerlink" title="class（类）"></a>class（类）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类 可以继承 公有 私有 和 静态方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">'parent'</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;; <span class="comment">// 如果在父类返回一个引用空间，则子类中的 this 指向了这里</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> b()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    eat()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'eat'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span></span>&#123; <span class="comment">// 要求继承父亲的私有和公有</span></span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">super</span>(); <span class="comment">// Parent.call(this);</span></span><br><span class="line">        <span class="keyword">this</span>.age = <span class="number">9</span>; <span class="comment">// 私有属性</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> a()&#123; <span class="comment">// 静态方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    smoking()&#123;  <span class="comment">// 原型上的方法</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'smoking'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(child.b())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 总结：1.类只能 new</span></span><br><span class="line"><span class="comment">//      2.类可以继承公有私有和静态方法</span></span><br><span class="line"><span class="comment">//      3.父类的构造函数中返回了一个引用类型，会作为子类的this。及可以指定继承对象</span></span><br></pre></td></tr></table></figure><p><strong>原理：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类的调用检测</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_classCallCheck</span> (<span class="params">instance,constructor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> <span class="keyword">constructor</span>))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'抛出错误，未用你 new 调用'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">definePropertys</span>(<span class="params">target,arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(target,arr[i].key,&#123;</span><br><span class="line">            ...arr[i],</span><br><span class="line">            configurable:<span class="literal">true</span>,</span><br><span class="line">            enumerable:<span class="literal">true</span>,</span><br><span class="line">            writeable:<span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* construtor 构造函数</span></span><br><span class="line"><span class="comment">   protoPropertys 原型方法描述</span></span><br><span class="line"><span class="comment">   staticPropertys 静态方法的描述</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_createClass</span>(<span class="params">constructor,protoPropertys,staticPropertys</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (protoPropertys.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        definePropertys(<span class="keyword">constructor</span>.prototype,protoPropertys)</span><br><span class="line">    &#125;</span><br><span class="line">    if (staticPropertys.length&gt;0)&#123;</span><br><span class="line">        definePropertys(<span class="keyword">constructor</span>,staticPropertys)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let Parent = function () &#123;</span><br><span class="line">    <span class="comment">// 写逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">P</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        _classCallCheck(<span class="keyword">this</span>,P); <span class="comment">//类的调用检测 如果this是P的实例，则是 new 出来的</span></span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">'parent'</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    _createClass(P, <span class="comment">// 属性描述器</span></span><br><span class="line">    [</span><br><span class="line">        &#123; <span class="attr">key</span>: <span class="string">'eat'</span>,</span><br><span class="line">         value: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">             <span class="built_in">console</span>.log(<span class="string">'吃'</span>)</span><br><span class="line">         &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],[</span><br><span class="line">        &#123; <span class="attr">key</span>: <span class="string">'b'</span>,</span><br><span class="line">         value: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">             <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">         &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    ]); <span class="comment">// 创建类</span></span><br><span class="line">    <span class="keyword">return</span> P;</span><br><span class="line">&#125;();</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> Parent();</span><br><span class="line">p.eat();</span><br></pre></td></tr></table></figure><p><strong>继承：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子类继承父类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_inherits</span>(<span class="params">subClass,superClass</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 继承公有属性</span></span><br><span class="line">    subClass.prototype =  <span class="built_in">Object</span>.create(superClass.prototype,&#123;<span class="attr">constructor</span>:&#123;</span><br><span class="line">        value:subClass&#125;&#125;); </span><br><span class="line">    <span class="comment">// 继承静态方法</span></span><br><span class="line">    <span class="built_in">Object</span>.setPrototypeOf(subClass,superClass);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> Child = (<span class="function"><span class="keyword">function</span>(<span class="params">Parent</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 先实现继承父类的公有属性和静态方法</span></span><br><span class="line">    _inherits(C,Parent);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        _classCallCheck(<span class="keyword">this</span>.C);</span><br><span class="line">        <span class="keyword">let</span> obj = Parent.call(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">let</span> that = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> obj === <span class="string">'object'</span>)&#123;</span><br><span class="line">            that = obj;</span><br><span class="line">        &#125;</span><br><span class="line">        that.age = <span class="number">9</span>; <span class="comment">// 解决了父类返回一个引用类型的问题</span></span><br><span class="line">        <span class="keyword">return</span> that;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;)(Parent)</span><br><span class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(Child.b());</span><br></pre></td></tr></table></figure><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>在 es6 中新出现的。generator async await 都是基于 promise 的。</p><p>比如：kao axios redux-saga fetch …。</p><p><strong>promise 是一种异步流程的控制手段</strong></p><ol><li>promise 链式调用解决回调地狱。</li><li>promise 可以支持多个并发的请求，获取并发请求中的数据。避免返回快慢错乱问题。</li><li>promise 可以解决异步问题，但本身并不能称为 异步。</li><li>promise 可以实现不再传递回调函数了。</li><li>promise 函数new一个实例可以then多次，及调用多次。</li></ol><p><strong>promise （承诺）的关键字 及 三个状态一个执行器</strong></p><ol><li>resolve 成功 </li><li>reject 失败 </li><li>pending 等待 （只有它可以转为其它状态）</li><li>excutor 执行器（隐）</li><li>then 然后 （带两个参数，成功和失败两个函数）</li><li>throw new Error() （promise 中发生错误 就会执行失败态）</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 默认 promise 中的 excutor 执行器是同步执行的</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(); <span class="comment">// 如果代码报错，走失败</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 原来实现这一点需用回调函数</span></span><br><span class="line">        resolve(<span class="string">'买'</span>);</span><br><span class="line">    &#125;,<span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>); <span class="comment">//  1,2</span></span><br><span class="line"><span class="comment">// then方法是异步调用的，事件环</span></span><br><span class="line">p.then(<span class="function">(<span class="params">value</span>)=&gt;</span>&#123; <span class="comment">// value成功的原因</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'value'</span>,value)</span><br><span class="line">&#125;,(err)=&gt;&#123; <span class="comment">// err 失败的原因</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'err'</span>,err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="回调地狱"><a href="#回调地狱" class="headerlink" title="回调地狱"></a>回调地狱</h3><p>（参考 node.js 回调地狱篇）</p><h4 id="现象："><a href="#现象：" class="headerlink" title="现象："></a>现象：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>); <span class="comment">// 导入文件模块</span></span><br><span class="line">fs.readFile(<span class="string">'1.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err);</span><br><span class="line">    fs.readFile(data,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="改进："><a href="#改进：" class="headerlink" title="改进："></a>改进：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 链式调用</span></span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        fs.readFile(url,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) reject (err);</span><br><span class="line">            resolve(data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果返回的是一个 promise 的结果，会将结果作为下一个 then 的参数传入</span></span><br><span class="line">read(<span class="string">'cat.txt'</span>).then(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> read(data);  <span class="comment">//如果成功，传给下一个 then 的 data</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'data'</span>);</span><br><span class="line">&#125;,err=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'err'</span>);<span class="comment">//如果不出存在或失败走到这里</span></span><br><span class="line">&#125;); </span><br><span class="line"><span class="comment">// promise 实现链式调用返回的并不是this,而是一个新的promise,及失败了可以继续向下运行</span></span><br><span class="line">read(<span class="string">'1.txt'</span>).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(); <span class="comment">// 标明执行错误，下一步走错误逻辑</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;,(err)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err); <span class="comment">// error</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data,<span class="string">'1213'</span>) <span class="comment">// undefined '1213' </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="捕获异常：（-catch）"><a href="#捕获异常：（-catch）" class="headerlink" title="捕获异常：（.catch）"></a>捕获异常：（.catch）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// catch 如果有任何一个出错，会走到 catch 里去</span></span><br><span class="line">read(<span class="string">'1.txt'</span>).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err); <span class="comment">// 获取失败，走到下一个成功里去</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'catch'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="多次调用："><a href="#多次调用：" class="headerlink" title="多次调用："></a>多次调用：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    resolve(<span class="string">'成功'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 一个promise的实例可以then多次</span></span><br><span class="line">p.then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// 成功 </span></span><br><span class="line">&#125;);</span><br><span class="line">p.then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// 成功 </span></span><br><span class="line">&#125;);</span><br><span class="line">p.then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// 成功 </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="并发请求：（-all）"><a href="#并发请求：（-all）" class="headerlink" title="并发请求：（.all）"></a>并发请求：（.all）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.readFile(url,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) reject(err);</span><br><span class="line">            resolve(data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// promise.all方法调用后会返回一个新的promise</span></span><br><span class="line"><span class="comment">// 并发请求</span></span><br><span class="line"><span class="built_in">Promise</span>.all([read(<span class="string">'1.txt'</span>),read(<span class="string">'2.txt'</span>)]).then(<span class="function">(<span class="params">[r1,r2]</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(r1,r2);</span><br><span class="line">&#125;,err=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err); <span class="comment">// 有一个失败结果就为失败 </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="赛跑：（-race）"><a href="#赛跑：（-race）" class="headerlink" title="赛跑：（.race）"></a>赛跑：（.race）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理多请求，只取最快的</span></span><br><span class="line"><span class="built_in">Promise</span>.race([read(<span class="string">'1.txt'</span>),read(<span class="string">'2.txt'</span>)].then(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// 取1或2</span></span><br><span class="line">&#125;,err=&gt;&#123;</span><br><span class="line">    conosle.log(err);</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h4 id="其他：-resolve，-reject"><a href="#其他：-resolve，-reject" class="headerlink" title="其他：(.resolve，.reject)"></a>其他：(.resolve，.reject)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个成功的promise</span></span><br><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'123'</span>).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 返回一个失败的promise</span></span><br><span class="line"><span class="built_in">Promise</span>.reject(<span class="string">'123'</span>).then(<span class="literal">null</span>,data=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="源码实现："><a href="#源码实现：" class="headerlink" title="源码实现："></a>源码实现：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Promise</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(executor)&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = <span class="string">'padding'</span>;</span><br><span class="line">        <span class="keyword">this</span>.value = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">this</span>.value = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">let</span> resolve = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.status === <span class="string">'pending'</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.status = <span class="string">'resolved'</span>;</span><br><span class="line">                <span class="keyword">this</span>.value = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> reject = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.status === <span class="string">'pending'</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.status = <span class="string">'rejected'</span>;</span><br><span class="line">                <span class="keyword">this</span>.reason = reason;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            executor(resolve,reject);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">            reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    then(onFuFilled,onRejected)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.status === <span class="string">'resolved'</span>)&#123;</span><br><span class="line">            onFuFilled(<span class="keyword">this</span>.value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.status === <span class="string">'rejected'</span>)&#123;</span><br><span class="line">            onRejected(<span class="keyword">this</span>.reason);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="built_in">Promise</span>;</span><br></pre></td></tr></table></figure><h2 id="解决异步的方案"><a href="#解决异步的方案" class="headerlink" title="解决异步的方案"></a>解决异步的方案</h2><ol><li><strong>高阶函数</strong> 函数是一等公民，函数可以当作参数，函数可以当作函数，函数可以返回函数（偏函数，函数柯里化）callback</li><li><strong>Promise</strong></li><li><strong>generator</strong> + <strong>co库</strong></li><li><strong>async</strong> + <strong>await</strong></li></ol><p><strong>高阶函数</strong> 函数返回函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型判断</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isType</span> (<span class="params">type,content</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> t = <span class="built_in">Object</span>.prototype.toString.call(content).replace(<span class="regexp">/\[object]\s|]/g</span>,<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">return</span> t === type;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(isType(<span class="string">'String'</span>,<span class="string">'adc'</span>));</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要批量生产的一些方法 isString('abc') isNumber(123);</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isType</span> (<span class="params">type</span>) </span>&#123;           <span class="comment">// 闭包 不会释放 的变量 </span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">content</span>) </span>&#123;    <span class="comment">// 用完后即清除的变量</span></span><br><span class="line">        <span class="keyword">let</span> t = <span class="built_in">Object</span>.prototype.toString.call(content).replace(<span class="regexp">/\[object]\s|]/g</span>,<span class="string">''</span>);</span><br><span class="line">        <span class="keyword">return</span> t === type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> isString = isType(<span class="string">'String'</span>);</span><br><span class="line">isString(<span class="string">'abc'</span>);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isType</span> (<span class="params">type</span>) </span>&#123;           </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">content</span>) </span>&#123;   </span><br><span class="line">        <span class="keyword">let</span> t = <span class="built_in">Object</span>.prototype.toString.call(content).replace(<span class="regexp">/\[object]\s|]/g</span>,<span class="string">''</span>);</span><br><span class="line">        <span class="keyword">return</span> t === type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">'String'</span>,<span class="string">'Number'</span>,<span class="string">'Array'</span>,<span class="string">'Object'</span>,<span class="string">'null'</span>];</span><br><span class="line"><span class="keyword">let</span> util = &#123;&#125;; <span class="comment">// 对象，一般有这个工具类</span></span><br><span class="line">arr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    util[<span class="string">'is'</span> + item] = isType(item)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(util.isString(<span class="string">'123'</span>));</span><br></pre></td></tr></table></figure><p><strong>高阶函数</strong> 函数当作参数传递 典型的 callback。例如： loadash after</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当达到某个条件的时候，执行 callback</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">after</span> (<span class="params">times,callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (--times === <span class="number">0</span>) &#123;</span><br><span class="line">            callback();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> eat = after(<span class="number">3</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'吃完了'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">eat();</span><br><span class="line">eat();</span><br><span class="line">eat(); <span class="comment">// 到第三次才执行</span></span><br></pre></td></tr></table></figure><p><strong>应用</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">after</span> (<span class="params">times,callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        arr.push(d);</span><br><span class="line">        <span class="keyword">if</span>(arr.length === times) callback(arr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> out = after(<span class="number">2</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line">fs.readFile(<span class="string">'./2.promise.js/a.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    out(data);</span><br><span class="line">&#125;);</span><br><span class="line">fs.readFile(<span class="string">'./2.promise.js/b.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    out(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介：&quot;&gt;&lt;a href=&quot;#简介：&quot; class=&quot;headerlink&quot; title=&quot;简介：&quot;&gt;&lt;/a&gt;简介：&lt;/h2&gt;&lt;p&gt;ES6 在这里就不给详细科普了&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ES6 全称ECMAScript 6.0 ,是JavaScript的新的一个版本标准，说是为了：&lt;ul&gt;
&lt;li&gt;适应更复杂的应用；&lt;/li&gt;
&lt;li&gt;实现代码库之间的共享；&lt;/li&gt;
&lt;li&gt;不断迭代维护新版本；
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="ES6" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/ES6/"/>
    
      <category term="README" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/ES6/README/"/>
    
    
      <category term="ES6.js" scheme="http://yoursite.com/tags/ES6-js/"/>
    
      <category term="前端端技术" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>blog 论坛</title>
    <link href="http://yoursite.com/2019/03/24/%E6%96%B0%E5%BB%BAbolg%E8%AE%BA%E5%9D%9B/"/>
    <id>http://yoursite.com/2019/03/24/新建bolg论坛/</id>
    <published>2019-03-24T14:59:00.000Z</published>
    <updated>2019-12-31T19:11:38.361Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>该blog论坛基于 node.js Express 框架，mongoDB数据库，mongoose数据库框架，jQuery库等。可以进行一些简单的注册，登陆，评论，发表等功能。 <a id="more"></a></p><h3 id="结构："><a href="#结构：" class="headerlink" title="结构："></a>结构：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">blog</span><br><span class="line"> |-- public                        <span class="comment">// 公共的静态资源</span></span><br><span class="line">       |-- img</span><br><span class="line">       |-- JS</span><br><span class="line">       |-- CSS</span><br><span class="line">       |-- HTML</span><br><span class="line"> |-- views                         <span class="comment">// 存储视图目录</span></span><br><span class="line">       |-- _layouts </span><br><span class="line">              |-- home.html</span><br><span class="line">       |-- _partials  </span><br><span class="line">              |-- footer.html</span><br><span class="line">              |-- header.html</span><br><span class="line">              |-- settings-nav.html</span><br><span class="line">       |-- settings</span><br><span class="line">              |-- admin.html</span><br><span class="line">              |-- profile.html</span><br><span class="line">       |-- topic</span><br><span class="line">              |-- profile.html</span><br><span class="line">       |-- index.html   </span><br><span class="line">       |-- login.html </span><br><span class="line">       |-- register.html </span><br><span class="line"> |-- controllers</span><br><span class="line"> |-- models                        <span class="comment">// 数据库数据模型</span></span><br><span class="line">       |-- comment.js</span><br><span class="line">       |-- topic.js</span><br><span class="line">       |-- user.js</span><br><span class="line"> |-- routes                        <span class="comment">// 路由配置</span></span><br><span class="line">       |-- session.js              </span><br><span class="line">       |-- topic.js  </span><br><span class="line"> |-- app.js                        <span class="comment">// 启动入口文件</span></span><br><span class="line"> |-- README.md                     <span class="comment">// 项目说明文档</span></span><br><span class="line"> |-- .gitignore git                <span class="comment">// 忽略配置项文件，忽略一些不必要的配置文件</span></span><br><span class="line"> |-- package.json                  <span class="comment">// 包描述文件</span></span><br><span class="line"> |-- package-lock.json             <span class="comment">// 第三方包版本锁定文件</span></span><br><span class="line"> |-- node_modules                  <span class="comment">// 第三方包</span></span><br></pre></td></tr></table></figure><h3 id="构建："><a href="#构建：" class="headerlink" title="构建："></a>构建：</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm init -y   ## 初始化 package.json</span><br><span class="line">git init      ## 初始化发布到 git 的必要文件</span><br><span class="line">npm i express mongoose    ## 配置核心文件</span><br><span class="line">npm i art-template express-art-template    ## 配置模板引擎</span><br><span class="line">npm install --global nodemon   ## 配置第三方命令行工具</span><br><span class="line">npm i bootstrap</span><br><span class="line">npm i jquery</span><br><span class="line">npm install --save body-parser  ## 配置三方包 获取表单信息</span><br><span class="line">npm install blueimp-md5  ## 配置密码加密三方包</span><br><span class="line">npm install express-session  ## 配置使用 cookie session 三方包</span><br></pre></td></tr></table></figure><h2 id="细节："><a href="#细节：" class="headerlink" title="细节："></a>细节：</h2><h3 id="path模块"><a href="#path模块" class="headerlink" title="path模块"></a>path模块</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">path.basename(<span class="string">''</span>)  <span class="comment">// 获取一个路径的文件名（默认包含扩展名）</span></span><br><span class="line">path.dirname(<span class="string">''</span>)   <span class="comment">// 获取一个路径的目录部分</span></span><br><span class="line">path.extname(<span class="string">''</span>)   <span class="comment">// 获取一个路径的扩展名部分</span></span><br><span class="line">path.isAbsolute(<span class="string">''</span>) <span class="comment">// 判断一个路径是否是绝对路径</span></span><br><span class="line">path.parse(<span class="string">'path'</span>)  <span class="comment">// 返回一个路径对象&#123;root dir base ext name&#125;</span></span><br><span class="line">path.join(<span class="string">''</span>,<span class="string">''</span>)    <span class="comment">// 当进行路径拼接的时候，推荐使用它，会格式化避免出错</span></span><br></pre></td></tr></table></figure><blockquote><p>参考文档：<a href="http://nodejs.org/dist/latest-v9.x/docs/api/path.html" target="_blank" rel="noopener">http://nodejs.org/dist/latest-v9.x/docs/api/path.html</a></p></blockquote><h3 id="Node-中的其他成员"><a href="#Node-中的其他成员" class="headerlink" title="Node 中的其他成员"></a>Node 中的其他成员</h3><p>在每个模块中，除了<code>require</code>，<code>exports</code>等模块相关的 API 之外，还有两个特殊成员：</p><ol><li><code>__dirname</code> ：可以用来动态获取<strong>当前</strong>文件模块所属目录的绝对路径。</li><li><code>__filename</code> ：可以用来动态获取<strong>当前</strong>文件的绝对路径。</li><li><code>path.join(&#39;&#39;,&#39;&#39;)</code> ：当进行路径拼接的时候，推荐使用它，会格式化避免出错</li></ol><h4 id="相对路径问题"><a href="#相对路径问题" class="headerlink" title="相对路径问题"></a>相对路径问题</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">fs.readFile(<span class="string">'./a.txt'</span>,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol><li>一般情况下：<code>./a.txt</code> 是相对于当前文件路径。</li><li>在 node 中是相对于执行 node 命令所处的终端路径。</li><li>因此，在文件操作中使用相对路径是不可靠的，相对路径的设计的应该是相对于执行 node 命令所处的路径。</li><li>解决：将其换为绝对路径。缺陷，写死不利于项目迁移。</li><li>使用 <code>__dirname</code> 和 <code>__filename</code>  <code>path.join(&#39;&#39;,&#39;&#39;)</code> 转换为动态的绝对路径。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(path.join(__dirname,<span class="string">'./a.txt'</span>),<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>补充：模块中的相对路径（相对当前文件）不受影响，这里仅指文件操作中的相对路径标识。</p></blockquote><h3 id="art-template"><a href="#art-template" class="headerlink" title="art-template"></a>art-template</h3><h4 id="子模版"><a href="#子模版" class="headerlink" title="子模版"></a>子模版</h4><p>header.html / footer.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- header.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- footer.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure><p>layout.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 头部组件 --&gt;</span></span><br><span class="line">&#123;&#123; include './header.html' &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 内容组件 --&gt;</span></span><br><span class="line">&#123;&#123; block 'content' &#125;&#125;</span><br><span class="line">   <span class="tag">&lt;<span class="name">section</span>&gt;</span>我是默认内容<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">&#123;&#123; /block &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 尾部组件 --&gt;</span></span><br><span class="line">&#123;&#123; include './footer.html' &#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h4><p>index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 继承自 layout.html --&gt;</span></span><br><span class="line">&#123;&#123; extend './layout.html' &#125;&#125; </span><br><span class="line"></span><br><span class="line">&#123;&#123; block 'content' &#125;&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">    index页面填充内容</span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">&#123;&#123; /block &#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="路由设计"><a href="#路由设计" class="headerlink" title="路由设计"></a>路由设计</h3><table><thead><tr><th>路径</th><th>方法</th><th>get参数</th><th>post参数</th><th>是否需要登陆权限</th><th>备注</th></tr></thead><tbody><tr><td>/</td><td>GET</td><td></td><td></td><td></td><td>渲染首页</td></tr><tr><td>/register</td><td>GET</td><td></td><td></td><td></td><td>渲染注册页面</td></tr><tr><td>/register</td><td>POST</td><td></td><td>email/nickname/password</td><td></td><td>处理注册请求</td></tr><tr><td>/login</td><td>GET</td><td></td><td></td><td></td><td>渲染登陆页面</td></tr><tr><td>/login</td><td>POST</td><td></td><td>email/password</td><td></td><td>处理登陆请求</td></tr><tr><td>/logout</td><td>GET</td><td></td><td></td><td></td><td>处理退出请求</td></tr></tbody></table><h3 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h3><ol><li><code>try ... catch</code></li></ol><p><code>try ... catch</code> ：<code>try</code>中包含了由一个或者多个语句组成的<code>try</code>块，<code>catch</code>子句包含<code>try</code>块中抛出异常时要执行的语句。即，你想让<code>try</code>成功，如果其中有任何异常抛出，会在<code>catch</code>中执行，否则继续忽略<code>catch</code>语句。</p><blockquote><p>参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/try...catch" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/try...catch</a></p></blockquote><ol start="2"><li><code>async</code></li></ol><p><code>async</code>：基于ES6 <code>Promise</code> 的异步请求的方式。大多数异步函数也可以使用Promises编写。但是，在错误处理方面，<code>async</code>函数更容易捕获异常错误。</p><blockquote><p>参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function</a></p></blockquote><blockquote><p>在注册页面表单验证时会用到以上两个语法。</p></blockquote><ol start="3"><li><strong>cookie</strong></li></ol><p>cookie 保存一些不太敏感的数据，且数据量较小。不能用来保存登录状态，比如vip。但是可以保存比如用户名，购物车。</p><ol start="4"><li><strong>session</strong></li></ol><p>你（客户端）、寄存行李处（服务端）、电子票（cookie）、箱子中的内容（敏感信息）</p><blockquote><p>在 Express 中，默认不支持 Session 和 Cookie 但是可以使用第三方中间件：express-session来实现</p></blockquote><ol start="5"><li><strong>express-session 的使用</strong></li></ol><p>加载：<code>npm install express-session</code>。</p><p>配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> session = reequire(<span class="string">'express-session'</span>)</span><br><span class="line">app.use(session(&#123;</span><br><span class="line">    <span class="comment">//配置加密字符串，会在原有的加密基础上和这个字符串一起加密</span></span><br><span class="line">    secret: <span class="string">'itcast'</span>,</span><br><span class="line">    resave: <span class="literal">false</span>,</span><br><span class="line">    saveUninitialized: <span class="literal">true</span> <span class="comment">// 无论是否使用 session 都会分配钥匙</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><p>使用：添加 Session 数据：<code>req.session.foo = &#39;bar&#39;</code>，获取 Session 数据：<code>req.session.foo</code>。</p><p>提示：默认 session 数据时内存存储的，服务器一旦存储就会丢失，在生产环境中，会将 session 进行持久化存储。</p><blockquote><p>参考<a href="https://www.npmjs.com/package/express-session" target="_blank" rel="noopener">https://www.npmjs.com/package/express-session</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;该blog论坛基于 node.js Express 框架，mongoDB数据库，mongoose数据库框架，jQuery库等。可以进行一些简单的注册，登陆，评论，发表等功能。
    
    </summary>
    
      <category term="node.js 案例" scheme="http://yoursite.com/categories/node-js-%E6%A1%88%E4%BE%8B/"/>
    
    
      <category term="node.js" scheme="http://yoursite.com/tags/node-js/"/>
    
      <category term="js" scheme="http://yoursite.com/tags/js/"/>
    
      <category term="css" scheme="http://yoursite.com/tags/css/"/>
    
      <category term="html" scheme="http://yoursite.com/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>科学进站</title>
    <link href="http://yoursite.com/2019/03/24/%E7%A7%91%E5%AD%A6%E8%BF%9B%E7%AB%99/"/>
    <id>http://yoursite.com/2019/03/24/科学进站/</id>
    <published>2019-03-24T14:59:00.000Z</published>
    <updated>2020-06-12T14:36:36.588Z</updated>
    
    <content type="html"><![CDATA[<p>嘻嘻，这里是一些进站指南，毕竟花里胡哨得人写地花里胡哨的页面：<a id="more"></a><br>   </p><p>（1）由于背景是随机图片，所以如果看不清，请点击右上角刷新按钮,更换背景图片。<br></p><p>（2）由于左下角是我的“女儿”，所以我是不会为了移动端客户而抛弃我的女儿的，当然可爱的女儿也挡住了我的“压岁钱”的二维码入口，o(╥﹏╥)o。<br></p><p>（3）有什么意见右下角可以联系我呀~，期待 (#^.^#) <br></p><p>（4）页首 <strong>Links</strong> 项里有许多<strong>技术</strong>、<strong>工具</strong>、<strong>资源</strong>、<strong>题库</strong>站点<br></p><p>（5）暂时就先这样了，后面有什么隐蔽福利更新再更ヾ(◍°∇°◍)ﾉﾞ<br></p><p>  &amp;  提示：电脑端右下角,里面有个界面超好看的电影推荐链接，推荐！！！<br>后面会增加更多的资源以及技术博文欢迎PC端订阅呀！<br><br>（为了女儿，抛弃移动端[○･｀Д´･ ○]）</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;嘻嘻，这里是一些进站指南，毕竟花里胡哨得人写地花里胡哨的页面：
    
    </summary>
    
      <category term="进站指南 " scheme="http://yoursite.com/categories/%E8%BF%9B%E7%AB%99%E6%8C%87%E5%8D%97/"/>
    
    
      <category term="指南 " scheme="http://yoursite.com/tags/%E6%8C%87%E5%8D%97/"/>
    
      <category term="资源" scheme="http://yoursite.com/tags/%E8%B5%84%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>VUE之webpack项目搭建（移动端UI）</title>
    <link href="http://yoursite.com/2019/03/21/UI-%E6%A1%86%E6%9E%B6/"/>
    <id>http://yoursite.com/2019/03/21/UI-框架/</id>
    <published>2019-03-21T14:59:00.000Z</published>
    <updated>2020-02-19T10:31:39.020Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h1><p>手动由 webpack 简单搭建的 Vue 移动端项目，使用到的技术主要有 ：vue2.x、webpack4.0、es6模块化、Mint-ui 及 MUI …<a id="more"></a></p><h1 id="项目结构："><a href="#项目结构：" class="headerlink" title="项目结构："></a>项目结构：</h1><h1 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h1><h2 id="Mint-ui"><a href="#Mint-ui" class="headerlink" title="Mint-ui"></a>Mint-ui</h2><p>类似于移动端的 element-ui 。</p><blockquote><p>官方文档：<a href="http://mint-ui.github.io" target="_blank" rel="noopener">http://mint-ui.github.io</a></p></blockquote><p>可以使用按需导入，来减小项目的体积。</p><p>注意：CSS需要手动导入 </p><h2 id="MUI"><a href="#MUI" class="headerlink" title="MUI"></a>MUI</h2><blockquote><p>官方文档：<a href="http://dev.dcloud.net.cn/mui/ui" target="_blank" rel="noopener">http://dev.dcloud.net.cn/mui/ui</a></p></blockquote><p>类似于 <strong>BootStrap</strong> ，配套的CSS HTML，适用于任何项目。相比之下，Mint-UI是真正的 Vue 的组件库。</p><p>需要手动下载安装，从 github 上下载现成的包，解压出来后手动拷贝到项目中 lib 文件夹下，使用。</p><h1 id="GIT"><a href="#GIT" class="headerlink" title="GIT"></a>GIT</h1><p><code>git init</code> 初始化</p><p><code>git status</code> 显示提交的文件的状态</p><p><code>git add .</code>  将提交的文件放入了 文件暂存区 里</p><p><code>git commit -m &quot;init my project&quot;</code>  提交到了本地 尚与远端未有联系</p><p>这里使用的是gitee，创建公钥，已有在C盘用户下找  <code>.ssh</code> 文件夹下，<code>.pub</code>文件即为创建过得公钥</p><p>创建远程仓库</p><p><code>git config --global  --list</code> 查看git用户配置信息</p><p>Git 全局设置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name "user.name"</span><br><span class="line">git config --global user.email "user.email"</span><br></pre></td></tr></table></figure><p>提交代码：</p><ol><li>传统方式</li></ol><p><code>git add .</code></p><p><code>git commit -m &quot;提交信息&quot;</code></p><p><code>git push</code></p><ol start="2"><li>vscode默认集成的 GIT 工具。</li></ol><p><code>+</code> 暂存</p><p>输入修改记录 点击<code>√</code>提交本地</p><p>点击更多里推送选项</p><ol start="3"><li>GIT 之 vscode:</li></ol><p>绿色表示 添加的代码</p><p>蓝色表示修改的</p><p>红色表示删除的 </p><ol start="4"><li>补充vscode 快捷方式 ：</li></ol><p>ctrl + D 点击一次选中下一个相同代码</p><p>ctrl + shif + L  选中页面所有相同代码</p><p>同时选择上一行 (Ctrl + Alt + Up) 或者下一行 (Ctrl + Alt + Down) 的相同位置</p><h1 id="错误汇总："><a href="#错误汇总：" class="headerlink" title="错误汇总："></a>错误汇总：</h1><h2 id="mint-ui"><a href="#mint-ui" class="headerlink" title="mint-ui"></a>mint-ui</h2><p><a href="https://blog.csdn.net/g229191727/article/details/80662853" target="_blank" rel="noopener">懒加载组件lazy load的使用</a></p><h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><p>win10环境，中间有修改过远程仓库网址密码会报错：   <code>username or password ( access token )</code>。</p><p>解决：<a href="https://blog.csdn.net/mmyhs/article/details/81589419" target="_blank" rel="noopener">参考链接</a></p><h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><p>豆瓣API访问图片403，对于img标签，可使用referrerpolicy属性</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://img3.doubanio.com/view/photo/m_ratio_poster/public/p2503578746.jpg"</span> <span class="attr">referrerpolicy</span> =<span class="string">"never"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>兼容性不是很好好像。但是chrom这个跑demo没问题</p><h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><h3 id="移除严格模式"><a href="#移除严格模式" class="headerlink" title="移除严格模式"></a>移除严格模式</h3><p>一些框架使用到 <code>caller</code>、<code>callee</code>、<code>arguments</code>会报错，是 webpack 严格模式打包导致的，禁用webpack用严格模式打包</p><blockquote><p>移除严格模式：<a href="https://github.com/genify/babel-plugin-transform-remove-strict-mode" target="_blank" rel="noopener">https://github.com/genify/babel-plugin-transform-remove-strict-mode</a></p></blockquote><h2 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h2><h3 id="升级问题"><a href="#升级问题" class="headerlink" title="升级问题"></a>升级问题</h3><p>babel-loader和babel-core版本不对应会产生问题，<br>babel-loader 8.x对应babel-core 7.x<br>babel-loader 7.x对应babel-core 6.x</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 安装babel-core 7.x</span><br><span class="line">npm install -D @babel/core</span><br></pre></td></tr></table></figure><p>babel-preset-stage-0 貌似已弃用，卸载删除</p><p>其它的babel插件改为 <code>@babel/...</code>前缀 并以此前缀安装配置</p><h3 id="升级命名"><a href="#升级命名" class="headerlink" title="升级命名"></a>升级命名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 安装</span><br><span class="line">npm i -g babel-upgrade</span><br><span class="line"><span class="meta">#</span> 运行命令</span><br><span class="line">npx babel-upgrade --write --install</span><br></pre></td></tr></table></figure><p><a href="https://juejin.im/post/5d521ff6f265da03ea5a71a5" target="_blank" rel="noopener">参考链接</a></p><h2 id="Chrome"><a href="#Chrome" class="headerlink" title="Chrome"></a>Chrome</h2><p>Chrome自己的东西</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* &#123; </span><br><span class="line">    <span class="comment">/* 解除滑动时的警告 Chrome自己的东西*/</span></span><br><span class="line">    <span class="attribute">touch-action</span>: pan-y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简介：&quot;&gt;&lt;a href=&quot;#简介：&quot; class=&quot;headerlink&quot; title=&quot;简介：&quot;&gt;&lt;/a&gt;简介：&lt;/h1&gt;&lt;p&gt;手动由 webpack 简单搭建的 Vue 移动端项目，使用到的技术主要有 ：vue2.x、webpack4.0、es6模块化、Mint-ui 及 MUI …
    
    </summary>
    
      <category term="技术 - 前端技术 - VUE-UI" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF-%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF-VUE-UI/"/>
    
    
      <category term="前端框架" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
      <category term="VUE-UI" scheme="http://yoursite.com/tags/VUE-UI/"/>
    
  </entry>
  
  <entry>
    <title>由 todoMVC 深入 VUE.2x</title>
    <link href="http://yoursite.com/2019/03/21/VueDetail/"/>
    <id>http://yoursite.com/2019/03/21/VueDetail/</id>
    <published>2019-03-21T14:59:00.000Z</published>
    <updated>2020-09-01T13:31:44.108Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h2><p>此处的 Vue 指的是 Vue2… <a id="more"></a></p><h2 id="简易实现："><a href="#简易实现：" class="headerlink" title="简易实现："></a>简易实现：</h2><ol><li>这里是简易实现其双向绑定等功能的 todoList 。</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.done</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>:<span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ToDoList<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; todos.filter(item =&gt; !item.done).length &#125;&#125; of &#123;&#123; todos.length &#125;&#125; remaining [archive]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">"(item,index) in todos"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"item.done"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-bind:class</span>=<span class="string">"&#123;done: item.done&#125;"</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>tton</span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"handleRemoveTodoClick(index)"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> @<span class="attr">keydown.enter</span>=<span class="string">"handleAddTodoClick"</span> <span class="attr">v-model</span>=<span class="string">"todoText"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"handleAddTodoClick"</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> todos = [</span><br><span class="line">   &#123;</span><br><span class="line">       id: <span class="number">1</span>,</span><br><span class="line">       title: <span class="string">'上班'</span>,</span><br><span class="line">       done: <span class="literal">true</span></span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">       id: <span class="number">2</span>,</span><br><span class="line">       title: <span class="string">'撸代码'</span>,</span><br><span class="line">       done: <span class="literal">true</span></span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">       id: <span class="number">3</span>,</span><br><span class="line">       title: <span class="string">'加班'</span>,</span><br><span class="line">       done: <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      todos,</span><br><span class="line">      todoText: <span class="string">''</span>  </span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleAddTodoClick () &#123;</span><br><span class="line">            <span class="keyword">const</span> todos = <span class="keyword">this</span>.todos</span><br><span class="line">            <span class="keyword">const</span> todoText = <span class="keyword">this</span>.todoText.trim();</span><br><span class="line">            <span class="comment">// 非空校验</span></span><br><span class="line">            <span class="keyword">if</span> (!todoText.length) &#123;</span><br><span class="line">                <span class="keyword">return</span> </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.todos.push(&#123;</span><br><span class="line">                id: todos[todos.length - <span class="number">1</span>].id + <span class="number">1</span>,</span><br><span class="line">                title: todoText,</span><br><span class="line">                done: <span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 清空文本框</span></span><br><span class="line">            <span class="keyword">this</span>.todoText = <span class="string">''</span></span><br><span class="line">        &#125;,</span><br><span class="line">        handleRemoveTodoClick (index) &#123;</span><br><span class="line">            <span class="keyword">this</span>.todos.splice(index,<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="基础注意："><a href="#基础注意：" class="headerlink" title="基础注意："></a>基础注意：</h2><p>值得注意的基础内容。</p><h3 id="el"><a href="#el" class="headerlink" title="el:"></a>el:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;<span class="attr">el</span>:<span class="string">'#app'</span>&#125;)也可以写为 <span class="keyword">new</span> Vue(&#123; data... &#125;).$mount(<span class="string">'#app'</span>)。</span><br><span class="line"><span class="comment">//将 app 绑定到 window 上以便于使用 localStroage 等</span></span><br><span class="line"><span class="built_in">window</span>.app = <span class="keyword">new</span> Vue(&#123;...&#125;).mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure><h3 id="数据绑定-data："><a href="#数据绑定-data：" class="headerlink" title="数据绑定 data："></a>数据绑定 data：</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span><span class="code">`v-once`</span> 一次性绑定 &#123;&#123; message &#125;&#125;。</span><br><span class="line"><span class="bullet">2. </span><span class="code">`rawHTML:'&lt;h1&gt;...&lt;/h1&gt;'`</span> </span><br><span class="line">  - 可以用 <span class="code">`v-html="rawHTML"`</span> </span><br><span class="line">  - 渲染输出 &#123;&#123; rawHTML &#125;&#125; 转义不渲染。</span><br><span class="line"> </span><br><span class="line"><span class="bullet">3. </span><span class="code">`&#123;&#123; message &#125;&#125;`</span> 接受：</span><br><span class="line">  - 输出文本字符串及拼接 <span class="code">`&#123;&#123; 'Hello' +word &#125;&#125;`</span>。</span><br><span class="line">  - 三元表达式 <span class="code">`&#123;&#123; true ? 123 : 456 &#125;&#125;`</span> 。</span><br><span class="line">  - <span class="code">`&#123;&#123; message.split('').reverse().join('') &#125;&#125;`</span></span><br><span class="line">  - 不能写进标签绑定属性（使用 v-bind）。</span><br><span class="line">  - 不能用于双向绑定 （使用 v-model）。</span><br><span class="line">  - 会有闪动问题 （使用 v-text/v-cloak）</span><br><span class="line"></span><br><span class="line"><span class="bullet">4. </span>v-bind 之于绑定 标签属性：</span><br><span class="line">  - v-bind 绑定字符串及拼接 <span class="code">`v-bind:href="'/todos?id=' + item.id"`</span> 。</span><br><span class="line">  - v-bind 三元表达式 <span class="code">`v-bind:id="'list'"`</span>。</span><br><span class="line"></span><br><span class="line"><span class="bullet">5. </span>HTML 字符串中不能使用 Vue 语法（非组件内）。</span><br><span class="line"><span class="bullet">6. </span>data 中的成员只能修改，不能外部添加。</span><br><span class="line"><span class="bullet">7. </span>v-model 用于表单控件的各种双向绑定。</span><br></pre></td></tr></table></figure><h3 id="指令-v-："><a href="#指令-v-：" class="headerlink" title="指令 v-："></a>指令 v-：</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span><span class="code">`v-if = "true"`</span> 条件渲染。</span><br><span class="line">   - 如果想要渲染多个元素，可以用 template 元素包裹，最终结果 template 将不被渲染。</span><br><span class="line">   - v-if 惰性渲染，直接决定是否渲染元素，v-show，决定是否显示元素。</span><br><span class="line"></span><br><span class="line"><span class="bullet">2. </span><span class="code">`v-for="(item,index) in todos"`</span> 循环渲染。</span><br><span class="line">  - 可以循环 数组 对象 数字 数组对象。</span><br><span class="line">  - 使用 key 绑定到更加牢固。</span><br><span class="line"> </span><br><span class="line"><span class="bullet">3. </span><span class="code">`v-bind:placehodler="tip"`</span> 绑定属性 有参数 缩写 :placehodler。</span><br><span class="line"><span class="bullet">4. </span><span class="code">`v-model.number="number"`</span>，用户输入的全部都是字符串，需要数字转换可以用该修饰符。</span><br><span class="line"></span><br><span class="line"><span class="bullet">5. </span><span class="code">`v-on:click.prevent="handlelInputFocus"`</span> 绑定事件 有参数 可有修饰符 缩写 @click。</span><br><span class="line">  - 指令修饰符可串联</span><br><span class="line">  - .stop 阻止事件冒泡。.self只管理自己，嵌套时不阻止外层冒泡。</span><br><span class="line">  </span><br><span class="line"><span class="bullet">6. </span>v-pre Vue将跳过被该标记标记的块。</span><br><span class="line"><span class="bullet">7. </span><span class="code">`v-text = "&#123;&#123; message &#125;&#125;"`</span> 解决单个元素闪动问题。</span><br><span class="line"><span class="bullet">8. </span>v-cloak  <span class="code">`[v-cloak]&#123;display:none&#125;`</span>，解决代码块闪动问题，可以继续用 <span class="code">`&#123;&#123; message &#125;&#125;`</span>。</span><br></pre></td></tr></table></figure><h3 id="绑定样式："><a href="#绑定样式：" class="headerlink" title="绑定样式："></a>绑定样式：</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span><span class="code">`:class="&#123;active:false&#125;"`</span></span><br><span class="line">  - <span class="code">`:class="[activeClass,errorClass]"`</span></span><br><span class="line"> </span><br><span class="line"><span class="bullet">3. </span><span class="code">`:style="&#123;backgroundColor: bgc&#125;"`</span> 样式名驼峰命名法</span><br><span class="line">  - <span class="code">`:style="[baseStyle,overridingStyle]"`</span></span><br><span class="line">  - <span class="code">`:style`</span> 可以自动添加浏览器引擎前缀</span><br><span class="line">  - <span class="code">`:style="&#123;display:['-webkit-box','-ms-flexbox','flex']&#125;"`</span>多重值，添加多个浏览器前缀</span><br></pre></td></tr></table></figure><h2 id="选项注意："><a href="#选项注意：" class="headerlink" title="选项注意："></a>选项注意：</h2><p>methods/computed/watch 对比：</p><ol><li><p>computed 适合一些反复使用<strong>简单计算</strong>，会作为属性被存储。</p></li><li><p>methods 适合比较复杂的业务逻辑，方法集合。</p></li><li><p>watch 适合对一些特殊的数据监听再进行具体的业务逻辑。</p></li></ol><h3 id="方法-methods："><a href="#方法-methods：" class="headerlink" title="方法 methods："></a>方法 methods：</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>methods 中的方法不要使用箭头函数，否则其中的 this 指向 window。</span><br><span class="line">  - methods 当传入自己的参数的时候，event 需要手动传入，<span class="code">`@click = "fn(index,$event)"`</span>。</span><br><span class="line">  - v-on 注册的方法可以直接通过 this 来访问 data 中的数据成员。</span><br><span class="line">  - 模板中使用方法必须调用，即带括号 <span class="code">`&#123;&#123; fn() &#125;&#125;`</span>。</span><br><span class="line">  - 一个方法清除另一个方法中的定时器 id，该 id 放到 data 中去。</span><br></pre></td></tr></table></figure><h3 id="计算属性-computed"><a href="#计算属性-computed" class="headerlink" title="计算属性 computed:"></a>计算属性 computed:</h3><p>具有行为的属性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当想要显示一个数组的副本，而不改原始数组时，可以创建返回过滤或排序的计算属性</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">computed:&#123;</span><br><span class="line">    <span class="comment">//默认只有 getter</span></span><br><span class="line">    <span class="string">'message'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.number + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使用 setter</span></span><br><span class="line">    oneComputed:&#123;</span><br><span class="line">        <span class="comment">// 取值</span></span><br><span class="line">        <span class="keyword">get</span> () &#123; <span class="comment">// 计算属性被使用时，会调用 get 计算出的值</span></span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 赋值    </span></span><br><span class="line">        <span class="keyword">set</span> () &#123; <span class="comment">// 当你想要为 oneComputed 重新赋值的时候就会调用 set 方法</span></span><br><span class="line">                 <span class="comment">// set 中的方法使用 this.oneComputed 就是指向自己的 get() 值</span></span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><ol><li><p>使用到的 data 中的变量改变时，会随即跟着改变重新计算。</p></li><li><p>当做属性调用不是用调用方法的方式。</p></li></ol><h4 id="使用计算属性出现渲染不对错误："><a href="#使用计算属性出现渲染不对错误：" class="headerlink" title="使用计算属性出现渲染不对错误："></a>使用计算属性出现渲染不对错误：</h4><p>在过滤后再次编辑 完成/未完成按钮 ，出现渲染错误，按官方文档 在 v-for 之后给予 <strong>v-bind</strong> 解决。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v-<span class="keyword">for</span>=<span class="string">"item in items"</span> v-bind:key=<span class="string">"item.id"</span></span><br></pre></td></tr></table></figure><p>适用于所有列表渲染不正确。</p><h3 id="侦听器-watch"><a href="#侦听器-watch" class="headerlink" title="侦听器 watch:"></a>侦听器 watch:</h3><p>可以监听 data 上的所有数据。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...  va1,oldVal2 变化的值的新老值</span></span><br><span class="line">watch: &#123;</span><br><span class="line">    a: <span class="function"><span class="keyword">function</span> (<span class="params">va1,oldVal2</span>) </span>&#123; <span class="comment">// 用方法侦听 a</span></span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line">    b: <span class="string">"oneMethod"</span>,             <span class="comment">// 调用方法侦听 b</span></span><br><span class="line">    c: &#123;                    </span><br><span class="line">       handler: <span class="function"><span class="keyword">function</span> (<span class="params">va1,oldVal2</span>) </span>&#123;...&#125;, <span class="comment">// handler 是固定的不能乱写</span></span><br><span class="line">       deep: <span class="literal">true</span>               <span class="comment">// 深度监听 c ——&gt; 监听引用类型的数据时可用</span></span><br><span class="line">    &#125;,</span><br><span class="line">    d: &#123;                       </span><br><span class="line">       onclickIt: <span class="function"><span class="keyword">function</span> (<span class="params">va1,oldVal2</span>) </span>&#123;...&#125;,</span><br><span class="line">       immediate: <span class="literal">true</span>          <span class="comment">// 侦听 d 开始后，立即调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p><strong><em>也可以监听非 dom 元素，比如 路由变化，参考 路由</em></strong></p><h3 id="过滤器-fn-："><a href="#过滤器-fn-：" class="headerlink" title="过滤器  |fn ："></a>过滤器  |fn ：</h3><p>本质就是格式转化的方法，在需要调用的地方以其<strong>要求格式</strong>调用。</p><p>用作一些常见文本格式化。用在两个地方，<strong>双花括号插值</strong>和 <code>v-bind</code> 。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">&lt;!--调用：&#123;&#123; name | 过滤器名称 |...&#125;&#125; 把结果依次向后过滤--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> &#123;&#123; message | msgFormat(arg,arg2) | ... &#125;&#125; <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">"rawId | formatId"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局</span></span><br><span class="line">Vue.filter(<span class="string">'msgFormat'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">msg,arg,arg2</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> msg.replace(msg,arg+arg2)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 组件</span></span><br><span class="line">filters: &#123;</span><br><span class="line">  formatId: <span class="function"><span class="keyword">function</span> (<span class="params">msg,arg,arg2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> msg.replace(msg,arg+arg2)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：定义<strong>全局过滤器一定要在 Vue 实例之前</strong>，当全局过滤器和局部过滤器<strong>重名时</strong>，会<strong>采用局部过滤器</strong>。</p><h3 id="自定义修饰符："><a href="#自定义修饰符：" class="headerlink" title="自定义修饰符："></a>自定义修饰符：</h3><p><a href="https://www.cnblogs.com/wuhua1/p/6686237.html" target="_blank" rel="noopener">键盘码</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> @<span class="attr">keyup.f2</span>=<span class="string">"add"</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局</span></span><br><span class="line">Vue.config.keyCode.f2 = <span class="number">113</span>;</span><br></pre></td></tr></table></figure><h2 id="生命周期函数："><a href="#生命周期函数：" class="headerlink" title="生命周期函数："></a>生命周期函数：</h2><table><thead><tr><th>函数名称/进程</th><th>进行阶段/执行时机</th></tr></thead><tbody><tr><td>beforeCreate () {}</td><td>实例被创建出来之前 执行，此时实例中的 data 和 methods 还没有创建</td></tr><tr><td><strong>created () {}</strong></td><td>此时 data和methods 已被初始化，调用其中的值，最早在这里</td></tr><tr><td><strong>—</strong> <strong><em>判断环</em></strong> <strong>—</strong></td><td><strong><em>Vue 开始执行指令，内存中生成模板字符串，再渲染为内存中的DOM树</em></strong></td></tr><tr><td>beforeMount () {}</td><td>在内存中已生成模板字符串，还未渲染（挂载）到页面</td></tr><tr><td><strong>—</strong> <strong><em>执行环</em></strong> <strong>—</strong></td><td><strong><em>挂载到页面</em></strong></td></tr><tr><td><strong>mounted () {}</strong></td><td>挂载到页面后执行该函数（通过插件执行页面DOM节点的最早时期）</td></tr><tr><td><strong>—</strong> <strong><em>创建完成</em></strong> <strong>—</strong></td><td><strong><em>组件完全创建 ok 进入 运行阶段**</em></strong></td></tr><tr><td>beforeUpdate () {}</td><td>数据更新，界面未更新时触发</td></tr><tr><td><strong>—</strong> <strong><em>更新界面</em></strong> <strong>—</strong></td><td><strong><em>根据 data 更新界面</em></strong></td></tr><tr><td>updated () {}</td><td>界面 以更新</td></tr><tr><td>beforeDestroy () {}</td><td>组件销毁之前，Vue上的data,methods等还处于可用状态</td></tr><tr><td><strong>—</strong> <strong><em>销毁实例</em></strong> <strong>—</strong></td><td><strong><em>销毁实例</em></strong></td></tr><tr><td>destroyed () {}</td><td>组件已完全销毁时执行</td></tr><tr><td><strong>—</strong> <strong><em>此外</em></strong> <strong>—</strong></td><td></td></tr><tr><td>activated () {}</td><td><em>待补充</em></td></tr><tr><td>deactivated () {}</td><td><em>待补充</em></td></tr><tr><td><em>errorCaptured () {}</em></td><td><em>待补充</em></td></tr></tbody></table><h2 id="自定义指令："><a href="#自定义指令：" class="headerlink" title="自定义指令："></a>自定义指令：</h2><h3 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h3><p>对普通 DOM 元素进行底层操作，会用到自定义指令。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局</span></span><br><span class="line">Vue.directive(<span class="string">'focus'</span>,&#123;</span><br><span class="line">    bind (el, binding) &#123; <span class="comment">//el为绑定元素 binding.value 为传入的值 </span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 私有</span></span><br><span class="line">...</span><br><span class="line">directives: &#123;</span><br><span class="line">    <span class="string">'fontweight'</span>: &#123;</span><br><span class="line">       bind: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">         el.style.fontWeight = binding.value</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...  </span><br><span class="line"><span class="comment">// 私有简写</span></span><br><span class="line">directives: &#123;</span><br><span class="line">    <span class="string">'fontweight'</span>:<span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 若只关心 bind 和 update 可以简写，直接写函数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">第一个参数是命名：</span></span><br><span class="line"><span class="comment">1. 分为全局（注册）自定义指令、局部（注册）自定义指令。</span></span><br><span class="line"><span class="comment">2. 使用时，名字加 v-。</span></span><br><span class="line"><span class="comment">3. 驼峰命名 使用时加 v-，且改小写，用 - 连接。</span></span><br><span class="line"><span class="comment">4. 组件内定义的自定义指令，只能在被该组件管理的模板中使用。</span></span><br><span class="line"><span class="comment">第二个参数需要配置生命钩子函数：</span></span><br><span class="line"><span class="comment">1. 生命钩子里有 dom 和 值，即可以进行 DOM 操作。</span></span><br><span class="line"><span class="comment">使用时传入的值：</span></span><br><span class="line"><span class="comment">1. 需要传入多个值，可以使用 js对象字面量。</span></span><br><span class="line"><span class="comment">2. 指令函数可以接受所有合法的 js 表达式。</span></span><br><span class="line"><span class="comment"> **/</span></span><br></pre></td></tr></table></figure><h3 id="钩子函数："><a href="#钩子函数：" class="headerlink" title="钩子函数："></a>钩子函数：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 相对于 指令定义对象可以提供如下几个钩子函数</span></span><br><span class="line">bind (el) &#123;</span><br><span class="line">    <span class="comment">// 只调用一次 指令第一次绑定到元素上（加载到内存上）时调用，初始化指令时使用。拿不到父结点</span></span><br><span class="line">    <span class="comment">// 和样式相关 放到这里</span></span><br><span class="line">    el.timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;;</span><br><span class="line">inserted () &#123;</span><br><span class="line">    <span class="comment">// 被绑定元素插入父结点时（渲染到页面上时）调用。可以拿到父节点。</span></span><br><span class="line">    <span class="comment">// 和 JS 行为相关，放到这里</span></span><br><span class="line">&#125;;</span><br><span class="line">update () &#123;</span><br><span class="line">   <span class="comment">// Vue 管理的模板中的 DOM 更新前调用，若需要改变之前的数据</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">componentUpdated () &#123;</span><br><span class="line">   <span class="comment">// Vue 管理的模板中的 DOM 更新后调用，若需要改变之后的数据 </span></span><br><span class="line">&#125;;</span><br><span class="line">unbind () &#123; <span class="comment">// 只调用一次</span></span><br><span class="line">   <span class="comment">// 解绑时使用，及元素移除时。移除其他生命周期中的函数，定时器等。（防止内存泄漏？）</span></span><br><span class="line">    <span class="built_in">window</span>.clearInterval(el.timer)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">可以传四个参数：</span></span><br><span class="line"><span class="comment">1. el 作用于该指令的 DOM 对象。</span></span><br><span class="line"><span class="comment">2. binding 一个对象,可以获取指令的值等信息，就可以拿指令值和DOM进行比较判断。</span></span><br><span class="line"><span class="comment">3. vnode</span></span><br><span class="line"><span class="comment">4. oldVnode</span></span><br><span class="line"><span class="comment"> **/</span></span><br></pre></td></tr></table></figure><h4 id="手动实现-v-show"><a href="#手动实现-v-show" class="headerlink" title="手动实现 v-show:"></a>手动实现 v-show:</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//html</span></span><br><span class="line">... v-my-show = <span class="string">"seen"</span> ...</span><br><span class="line"><span class="comment">// new Vue</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        seen:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br><span class="line"><span class="comment">// 手动实现 v-show 效果</span></span><br><span class="line">Vue.directive(<span class="string">'my-show'</span>,&#123;</span><br><span class="line">    bind (el,binding) &#123;  <span class="comment">// 只能调用一次，也可以绑到其他生命周期上</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'my-show bind'</span>,el,binding);</span><br><span class="line">        <span class="keyword">if</span> (binding.value) &#123;</span><br><span class="line">            el.style.display = <span class="string">'block'</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            el.style.display = <span class="string">'none'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    update (el,binding) &#123; <span class="comment">// 更新时调用</span></span><br><span class="line">        <span class="keyword">if</span> (binding.value) &#123;</span><br><span class="line">            el.style.display = <span class="string">'block'</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            el.style.display = <span class="string">'none'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 若只关心 bind 和 update 可以简写，直接写函数</span></span><br><span class="line">Vue.directive(<span class="string">'my-show'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">    el.style.display = binding.value</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="手动实现-v-bind"><a href="#手动实现-v-bind" class="headerlink" title="手动实现 v-bind:"></a>手动实现 v-bind:</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现 v-bind:title="message" 效果</span></span><br><span class="line">Vue.directive(<span class="string">'my-bind'</span>,&#123;</span><br><span class="line">    bind (el,binding) &#123;</span><br><span class="line">        el.setAttribute(binding.arg,binding.value)</span><br><span class="line">    &#125;,</span><br><span class="line">    update (el, binding) &#123;</span><br><span class="line">        el.setAttribute(binding.arg,binding.value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 或简写</span></span><br><span class="line">Vue.directive(<span class="string">'my-bind'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">    el.setAttribute(binding.arg,binding.value)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 进一步实现 v-bind:class = "&#123;&#125;"</span></span><br><span class="line">Vue.directive(<span class="string">'my-bind'</span>,&#123;</span><br><span class="line">    bind (el, binding) &#123;</span><br><span class="line">        <span class="keyword">if</span> (binding.arg === <span class="string">'class'</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> binding.value) &#123;</span><br><span class="line">                <span class="keyword">if</span> (binding.value[key]) &#123;</span><br><span class="line">                    el.classList.add(key)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    el.classList.remove(key)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            el.setAttribute(binding.arg,binding.value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        message:<span class="string">"myTitle"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="vue-resource-之请求"><a href="#vue-resource-之请求" class="headerlink" title="vue-resource 之请求:"></a>vue-resource 之请求:</h2><blockquote><p>vue-resource: <a href="https://github.com/pagekit/vue-resource" target="_blank" rel="noopener">https://github.com/pagekit/vue-resource</a></p></blockquote><p>也可以用 <strong>axios</strong></p><blockquote><p>测试请求资源，我用的是 <a href="https://douban-api-docs.zce.me/movie.html" target="_blank" rel="noopener">豆瓣API</a> </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">methods: &#123;</span><br><span class="line">    fnName () &#123;  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// res 成功回调必须要传，err 可选</span></span><br><span class="line">        <span class="keyword">this</span>.$http.get(<span class="regexp">/url/</span>...,[options]).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res)</span><br><span class="line">        &#125;,err=&gt;&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err)</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// [body] 提交给服务器的内容，</span></span><br><span class="line">        <span class="comment">// [option]提交的内容格式，数据类型，</span></span><br><span class="line">        <span class="comment">// 一般为 application/x-www-form-unlencoded</span></span><br><span class="line">        <span class="keyword">this</span>.$http.post(<span class="regexp">/url/</span>...,[body],[options]).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// 比如添加数据，添加完成后手动调用一下获取列表方法刷新数据</span></span><br><span class="line">            <span class="keyword">if</span> (res.body.status ===<span class="number">0</span>) &#123;</span><br><span class="line">                getList()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'失败了'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,err=&gt;&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="全局配置数据接口的根域名："><a href="#全局配置数据接口的根域名：" class="headerlink" title="全局配置数据接口的根域名："></a>全局配置数据接口的根域名：</h3><p>vue-resource:  <a href="https://github.com/pagekit/vue-resource/blob/develop/docs/config.md" target="_blank" rel="noopener">Set default values using the global</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为了避免根域名过多重复，不易维护</span></span><br><span class="line">Vue.http.options.root = <span class="string">'/root'</span>;</span><br><span class="line"><span class="comment">// 使用时必须是以相对路径开头</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 POST 提交的内容格式</span></span><br><span class="line">Vue.http.options.enulateJSON = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><h3 id="跨域："><a href="#跨域：" class="headerlink" title="跨域："></a>跨域：</h3><h4 id="JSONP："><a href="#JSONP：" class="headerlink" title="JSONP："></a>JSONP：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 前端页面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(data)</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://127.0.0.1:3000/getscript?callback=showInfo"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 后端代码 node.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> urlModule = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">pathname</span>:url, query &#125; = req.urlModule.parse(req.url, <span class="literal">true</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (url === <span class="string">'/getscript'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> scriptStr = <span class="string">`<span class="subst">$&#123;query.callback&#125;</span>(<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>)`</span></span><br><span class="line">        res.end(scriptStr)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.end(<span class="string">'404'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'server listen at http://127.0.0.1:3000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="动画："><a href="#动画：" class="headerlink" title="动画："></a>动画：</h2><h3 id="过度的类名："><a href="#过度的类名：" class="headerlink" title="过度的类名："></a>过度的类名：</h3><table><thead><tr><th>过度类名</th><th>时机</th></tr></thead><tbody><tr><td>v-enter</td><td>定义进入过渡的开始状态。</td></tr><tr><td>v-enter-active</td><td>定义进入过渡生效时的状态。</td></tr><tr><td>v-enter-to</td><td>定义进入过渡的结束状态。</td></tr><tr><td>v-leave</td><td>定义离开过渡的开始状态。</td></tr><tr><td>v-leave-active</td><td>定义离开过渡生效时的状态</td></tr><tr><td>v-leave-to</td><td>定义离开过渡的结束状态。</td></tr></tbody></table><h3 id="transition-（单个）元素："><a href="#transition-（单个）元素：" class="headerlink" title="transition （单个）元素："></a>transition （单个）元素：</h3><p>Vue 官方提供的元素。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.v-enter</span>,<span class="selector-class">.v-leave-to</span>&#123; <span class="comment">/* 由于起始状态 样式相同，故写在同一样式中 */</span></span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(150px);       <span class="comment">/*transform:位移*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.v-enter-active</span>,<span class="selector-class">.v-leave-active</span>&#123; <span class="comment">/* 入场离场的动画的时间段：对象，速度，曲线 */</span></span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.4s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mark-enter</span>,<span class="selector-class">.mark-leave-to</span>&#123; <span class="comment">/* 由于起始状态 样式相同，故写在同一样式中 */</span></span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(150px);       <span class="comment">/*transform:位移*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mark-enter-active</span>,<span class="selector-class">.mark-leave-active</span>&#123; <span class="comment">/* 入场离场的动画的时间段：对象，速度，曲线 */</span></span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.4s</span> ease;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"toggle控制动画的控制模块"</span> @<span class="attr">click</span>=<span class="string">"flag=!flag"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"flag"</span>&gt;</span>我是原始动画模块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">"mark"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"flag1"</span>&gt;</span>我使用的是mark标识的动画样式<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">data: &#123;</span><br><span class="line">    flag:<span class="literal">true</span>,</span><br><span class="line">    flag1:<span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="animate-css-三方类实现："><a href="#animate-css-三方类实现：" class="headerlink" title="animate.css 三方类实现："></a>animate.css 三方类实现：</h3><p><a href="https://daneden.github.io/animate.css/" target="_blank" rel="noopener">animate.css 三方类库</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">enter-active-class</span>=<span class="string">"animated bounceIn"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">leave-active-class</span>=<span class="string">"animated bounceOut"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"flag2"</span>&gt;</span></span><br><span class="line">        1. animate直接在标签上de属性上add类</span><br><span class="line">        2. animated 是基础类</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">enter-active-class</span>=<span class="string">"bounceIn"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">leave-active-class</span>=<span class="string">"bounceOut"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:duration</span>=<span class="string">"800"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"flag3"</span> <span class="attr">class</span>=<span class="string">"animated"</span>&gt;</span></span><br><span class="line">        1. animated也可以直接放在元素上</span><br><span class="line">        2. :duration="毫秒值" 入场离场总共花费的时间</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">enter-active-class</span>=<span class="string">"bounceIn"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">leave-active-class</span>=<span class="string">"bounceOut"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:duration</span>=<span class="string">"800"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"flag3"</span> <span class="attr">class</span>=<span class="string">"animated"</span>&gt;</span></span><br><span class="line">        1. animated也可以直接放在元素上</span><br><span class="line">        2. :duration="&#123;enter:200, leave:400&#125;" 传入对象 入场离场各自时长</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="钩子函数，半程动画："><a href="#钩子函数，半程动画：" class="headerlink" title="钩子函数，半程动画："></a>钩子函数，半程动画：</h3><p>这里的钩子指的是动画的<a href="https://cn.vuejs.org/v2/guide/transitions.html#JavaScript-%E9%92%A9%E5%AD%90" target="_blank" rel="noopener">生命周期</a>，半程动画需要借助 动画钩子函数。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 如果写半程动画，只需要定义 上或下 函数即可 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span> @<span class="attr">before-enter</span>=<span class="string">"beforeEnter"</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">enter</span>=<span class="string">"enter"</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">after-enter</span>=<span class="string">"afterEnter"</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">enter-cancelled</span>=<span class="string">"enterCancelled"</span></span></span><br><span class="line"><span class="tag">            </span></span><br><span class="line"><span class="tag">            @<span class="attr">before-leave</span>=<span class="string">"beforeLeave"</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">leave</span>=<span class="string">"leave"</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">after-leave</span>=<span class="string">"afterLeave"</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">leave-cancelled</span>=<span class="string">"leaveCancelled"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ball"</span> <span class="attr">v-show</span>=<span class="string">"flag"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...  el 控制的元素</span></span><br><span class="line">methods: &#123;</span><br><span class="line">    beforeEnter (el) &#123;  <span class="comment">// 起始样式</span></span><br><span class="line">        el.style.transform = <span class="string">"translate(0,0)"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    enter (el,done) &#123; </span><br><span class="line">        el.offsetWidth  <span class="comment">// 强制动画刷新，显示过渡效果</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 起始后的样式，这里可以设置结束状态 </span></span><br><span class="line">        el.style.transform = <span class="string">"translate(150px, 150px)"</span></span><br><span class="line">        el.style.transition = <span class="string">'all 1s ease'</span></span><br><span class="line">        </span><br><span class="line">        done() <span class="comment">// 这里的 done 就是指 afterEnter函数 的应用</span></span><br><span class="line">    &#125;,</span><br><span class="line">    after-enter (el) &#123; <span class="comment">// 动画完成之后</span></span><br><span class="line">        <span class="keyword">this</span>.flag = !<span class="keyword">this</span>.flag   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ... leave () 和 enter () 中写 done()</span></span><br></pre></td></tr></table></figure><h3 id="列表transition-group（多个元素）动画："><a href="#列表transition-group（多个元素）动画：" class="headerlink" title="列表transition-group（多个元素）动画："></a>列表transition-group（多个元素）动画：</h3><ol><li>当列表是用 v-for 循环渲染的，使用 transition-group 代替 transition元素。</li><li>不仅有 transition 的进入和出时的过渡类，另外添加了新的 <strong>.v-move</strong> 类。可以在元素改变定位的<strong>过程中</strong>使用。</li><li>注意：在 v-for 添加 key 属性<code>:key=&quot;item.id&quot;</code>。</li><li>需要平缓过渡除了添加 <strong>.v-move</strong> 类，还要设置  <strong>.v-leave-active</strong> 类 <code>position:absolute</code>。</li><li>transition-group 上的 <strong>appear属性</strong> 增添入场效果。</li><li>transition-group 上的 <strong>tag属性</strong> ，将 transition-group 渲染为什么属性，如果没有默认为 span标签。</li></ol><h3 id="组件过渡-动画-："><a href="#组件过渡-动画-：" class="headerlink" title="组件过渡(动画)："></a>组件过渡(动画)：</h3><h2 id="组件："><a href="#组件：" class="headerlink" title="组件："></a>组件：</h2><p><strong>模块化：</strong>从代码逻辑划分，保证功能模块职能单一。</p><p><strong>组件化：</strong>从UI界面划分，方便 UI 重用。</p><h3 id="基础："><a href="#基础：" class="headerlink" title="基础："></a>基础：</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>组件，在 VUE 中即一个特殊（可复用）的 Vue 实例。</span><br><span class="line">  - 组件的 data 是一个 data函数 返回的对象的形式。使得重复使用，也互不影响。</span><br><span class="line">  - 组件是独立作用域。</span><br><span class="line">  - 组件里 根元素 唯一。</span><br><span class="line">  - 全局注册（Vue.component()）。可以在任意组件中（子兄）使用。</span><br><span class="line">  - 局部注册（components:&#123;&#125;）。组件实例选项 components 选项。只能在本组件使用。</span><br></pre></td></tr></table></figure><h3 id="全局注册"><a href="#全局注册" class="headerlink" title="全局注册:"></a>全局注册:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种方式：内部定义</span></span><br><span class="line">Vue.component(<span class="string">'my-component'</span>, &#123; <span class="comment">// 此处若命名 驼峰，使用时用 - 连接</span></span><br><span class="line">    template: <span class="string">`&lt;div&gt;&#123;&#123;message&#125;&#125;&lt;/div&gt;`</span>,</span><br><span class="line">    data () &#123;      <span class="comment">// 组件中使用 data选项 特有形式，保证可重复使用</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            message: <span class="string">'...'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;&#125;,</span><br><span class="line">    ...,</span><br><span class="line">    components: &#123;</span><br><span class="line">        hello: &#123; <span class="comment">// 键名就是组件名称，值是一个对象，对象中配置组件选项</span></span><br><span class="line">            template: <span class="string">`&lt;div&gt;&#123;&#123;message2&#125;&#125;&lt;/div&gt;`</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种方式：Vue.extend</span></span><br><span class="line"><span class="keyword">var</span> vm = Vue.extend(&#123;</span><br><span class="line">    template: <span class="string">'&lt;h3&gt;这是创建Vue组件的第二种方式&lt;/h3&gt;'</span></span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'my-component'</span>, vm);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第三种方：外部定义 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">"tmpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>这是创建组件的第三种方式<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    Vue.component(<span class="string">'my-template'</span>, &#123;</span></span><br><span class="line"><span class="javascript">        template: <span class="string">'#tmpl'</span></span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="局部组件："><a href="#局部组件：" class="headerlink" title="局部组件："></a>局部组件：</h3><p>使用 Vue 实例中的 components 选项。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">components: &#123;</span><br><span class="line">    my-component: &#123;             <span class="comment">// 内部定义</span></span><br><span class="line">        template: <span class="string">'&lt;div&gt;我仅在定义内的实例中使用&lt;/div&gt;'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">'#mycomponentid'</span>  <span class="comment">// 外部定义</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">"mycomponentid"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        我是局部组件外部定义</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="组件切换："><a href="#组件切换：" class="headerlink" title="组件切换："></a>组件切换：</h3><p><code>&lt;component :is=&quot;mycomponentflag&quot;&gt;&lt;/component&gt;</code></p><h3 id="组件通信："><a href="#组件通信：" class="headerlink" title="组件通信："></a>组件通信：</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>父子关系</span><br><span class="line">  * 属性（prop）向下传递（父传子）。Pass Props</span><br><span class="line">  * 事件（event）向上传递 （子传父）。Emit Events</span><br><span class="line"><span class="bullet">2. </span>非父子关系</span><br><span class="line">  * Event Bus</span><br><span class="line"><span class="bullet">3. </span>专业组件通信</span><br><span class="line">  * Vuex 状态管理</span><br></pre></td></tr></table></figure><h4 id="prop"><a href="#prop" class="headerlink" title="prop:"></a>prop:</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">todo-list</span> <span class="attr">message</span>=<span class="string">"message"</span> <span class="attr">v-bind:foo</span>=<span class="string">"todos"</span>&gt;</span> 父 <span class="tag">&lt;/<span class="name">todo-list</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子用 props 选项声明，当做子组件的数据使用</span></span><br><span class="line">...,</span><br><span class="line">props:[<span class="string">'message'</span>,<span class="string">'foo'</span>], <span class="comment">// 自己组件声明的变量</span></span><br><span class="line">...,</span><br><span class="line"><span class="comment">// 1. 第一个是字符串形式。</span></span><br><span class="line"><span class="comment">// 2. 第二个只有 v-bind 传输是动态数据形式。且为单项数据流，不能修改，只能使用。</span></span><br><span class="line"><span class="comment">// 3. 如果是引用类型（对象和数组）则可以修改（不能重新赋值），但是不推荐使用。</span></span><br><span class="line"><span class="comment">// 4. 但是子可以用事件（event）把数据给父亲，由父亲改。</span></span><br></pre></td></tr></table></figure><h4 id="event-emit"><a href="#event-emit" class="headerlink" title="event / $emit():"></a>event / $emit():</h4><p>子组件内部调用父组件的方法，可以顺便传值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 在 父组件 中定义一个方法。</span></span><br><span class="line">    ...,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        addTodo (titleText) &#123;</span><br><span class="line">            titleText = titleText.trim()</span><br><span class="line">            <span class="keyword">if</span> (!title.Text.length) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> todos = <span class="keyword">this</span>.todos</span><br><span class="line">            todos.push(&#123;</span><br><span class="line">                id: todos[todos.length - <span class="number">1</span>].id + <span class="number">1</span>,</span><br><span class="line">                title: titleText,</span><br><span class="line">                completed: <span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ...,</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 在 子组件 内部调用父组件的方法 </span></span><br><span class="line">...,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleKeyDown (e) &#123;</span><br><span class="line">            <span class="keyword">const</span> target = e.target</span><br><span class="line">            <span class="keyword">const</span> value = target.value.trim()</span><br><span class="line">            <span class="keyword">if</span> (!value.length) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.$emit(<span class="string">'newTodo'</span>,value)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">...,</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">todo-header</span> <span class="attr">v-on:newTodo</span>=<span class="string">"addTodo"</span>&gt;</span> 父组件标签 <span class="tag">&lt;/<span class="name">todo-header</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ref-引用："><a href="#ref-引用：" class="headerlink" title="$ref 引用："></a>$ref 引用：</h4><p><em>ref [ reference : 引用 ]</em></p><h5 id="ref-获取-DOM-元素："><a href="#ref-获取-DOM-元素：" class="headerlink" title="$ref / 获取 DOM 元素："></a>$ref / 获取 DOM 元素：</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取DOM元素内容"</span> @<span class="attr">click</span>=<span class="string">"getElement"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myId"</span> <span class="attr">ref</span>=<span class="string">"myId"</span>&gt;</span></span><br><span class="line">   Vue 中推荐用 this.$refs 获取我</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">methods: &#123;</span><br><span class="line">    getElement () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.$refs.myId.innerText)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h5 id="ref-组件引用："><a href="#ref-组件引用：" class="headerlink" title="$ref / 组件引用："></a>$ref / 组件引用：</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取DOM元素内容"</span> @<span class="attr">click</span>=<span class="string">"getElement"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">my-template</span> <span class="attr">ref</span>=<span class="string">"mytemlate"</span>&gt;</span> 子组件的data：&#123;&#123; sondata &#125;&#125; <span class="tag">&lt;/<span class="name">my-template</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line">...</span><br><span class="line">data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        sondata: <span class="string">'我代表子组件数据'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">methodes: &#123;</span><br><span class="line">    show () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'我代表子组件的方法'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根实例</span></span><br><span class="line">...</span><br><span class="line">methods: &#123;</span><br><span class="line">    getElement () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.$refs.mytemplate.sondata)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.$refs.mytemplate.show()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="路由-vue-router"><a href="#路由-vue-router" class="headerlink" title="路由 vue-router:"></a>路由 vue-router:</h2><p>后端路由是： <strong>url</strong> 对应 <strong>后端资源</strong>。</p><p>前端路由是： 单页面程序用 <strong><a href="https://www.cnblogs.com/joyho/articles/4430148.html" target="_blank" rel="noopener">hash</a></strong> 实现页面跳转，不会涉及到页面的刷新。</p><h3 id="安装使用："><a href="#安装使用：" class="headerlink" title="安装使用："></a>安装使用：</h3><blockquote><p>官方入口 : <a href="https://router.vuejs.org/installation.html#direct-download-cdn" target="_blank" rel="noopener">https://router.vuejs.org/installation.html#direct-download-cdn</a></p></blockquote><h3 id="基本使用："><a href="#基本使用：" class="headerlink" title="基本使用："></a>基本使用：</h3><p><em>在导入 vue-router 包之后，会在 window 全局对象中创建一个 路由的构造函数 VueRouter。</em></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件</span></span><br><span class="line"><span class="keyword">var</span> mytpl = Vue.extend(&#123;</span><br><span class="line">    template:<span class="string">'&lt;div&gt; 我是组件1，组件2省略 &lt;/div&gt;'</span></span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'template-name1'</span>, mytpl)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造路由器 配置对象（路由规则配置）</span></span><br><span class="line"><span class="keyword">var</span> routerObj = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    routes: [</span><br><span class="line">        <span class="comment">// component 值只能是组件模板对象，不能是组件名称</span></span><br><span class="line">        &#123;<span class="attr">path</span>: <span class="string">'/templateUrl1'</span>, <span class="attr">component</span>: mytpl&#125;,</span><br><span class="line">        &#123;<span class="attr">path</span>: <span class="string">'/templateUrl2'</span>, <span class="attr">component</span>: mytpl2&#125;,</span><br><span class="line">        &#123;<span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">redirect</span>: <span class="string">'/login'</span>&#125;</span><br><span class="line">        <span class="comment">// refirect 仅修改hash值的 "重定向"</span></span><br><span class="line">    ],</span><br><span class="line">    linkActiveClass: <span class="string">'myactive'</span>  <span class="comment">// 修改给予的link-active-class类名</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 根实例 router 选项挂载，用来监听 url 地址变化</span></span><br><span class="line">...</span><br><span class="line">router: routerObj</span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面组件导航 &lt;a href="#/templateUrl1"&gt;&lt;/a&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 默认为 a标签 可以用 tag属性 修改--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/templateUrl1"</span>&gt;</span><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/templateUrl2"</span> <span class="attr">tag</span>=<span class="string">"span"</span>&gt;</span><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 页面组件入口 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">mode</span>=<span class="string">"out-in"</span>&gt;</span>  <span class="comment">&lt;!-- 动画元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* router提供 CSS 类名 */</span></span><br><span class="line"><span class="selector-class">.router-link-active</span>,<span class="selector-class">.myactive</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 动画效果 */</span></span><br><span class="line"><span class="selector-class">.v-enter</span>,<span class="selector-class">.v-leave-to</span> &#123;&#125;</span><br><span class="line"><span class="selector-class">.v-enter-active</span>,<span class="selector-class">.v-leave-active</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="路由传参-router："><a href="#路由传参-router：" class="headerlink" title="路由传参 / $router："></a>路由传参 / $router：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mytpl = &#123;</span><br><span class="line">    template: <span class="string">'&lt;div&gt;&#123;&#123; $route.query.id &#125;&#125;&amp;&amp;&#123;&#123; $route.params.id &#125;&#125;&lt;/div&gt;'</span></span><br><span class="line">    created () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.$route) <span class="comment">// console 路径信息</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> routerObj = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    routes: [</span><br><span class="line">        &#123;<span class="attr">path</span>: <span class="string">'/templateUrl1?id=10&amp;name=zs'</span>, <span class="attr">component</span>: mytpl&#125;,</span><br><span class="line">        &#123;<span class="attr">path</span>: <span class="string">'/templateUrl2/:id'</span>, <span class="attr">component</span>: mytpl2&#125;, </span><br><span class="line">        &#123;<span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">redirect</span>: <span class="string">'/login'</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">    linkActiveClass: <span class="string">'myactive'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/* query 方式传递参数：</span></span><br><span class="line"><span class="comment">  1. 如果在路由中使用 ?查询字符串 不需要修改 path 属性，在 query 里</span></span><br><span class="line"><span class="comment">  2. :id 是经 matchd 正则解析过得id值，在 params 里</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="route-path-监听路由："><a href="#route-path-监听路由：" class="headerlink" title="$route.path 监听路由："></a>$route.path 监听路由：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> watch: &#123;</span><br><span class="line">     <span class="string">'this.$route.path'</span>:<span class="function"><span class="keyword">function</span> (<span class="params">newVal, oldVal</span>) </span>&#123;</span><br><span class="line">         <span class="keyword">if</span> (newVal === <span class="string">'/login'</span>) &#123;</span><br><span class="line">             alert(<span class="string">'欢迎登录'</span>)</span><br><span class="line">         &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newVal === <span class="string">'/register'</span>) &#123;</span><br><span class="line">             alert(<span class="string">'欢迎注册'</span>)</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="路由嵌套-children项："><a href="#路由嵌套-children项：" class="headerlink" title="路由嵌套/children项："></a>路由嵌套/children项：</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/mytpl/child1"</span>&gt;</span><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> routerObj = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    routes: [</span><br><span class="line">        &#123;</span><br><span class="line">            path: <span class="string">'/templateUrl1?id=10&amp;name=zs'</span>, </span><br><span class="line">            component: mytpl,</span><br><span class="line">            <span class="comment">// path前面不要带 / 否则会以根路径开始请求，不方便用户理解用户地址</span></span><br><span class="line">            children: &#123;</span><br><span class="line">                &#123;<span class="attr">path</span>:<span class="string">'child1'</span>,<span class="attr">component</span>: child1&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    linkActiveClass: <span class="string">'myactive'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="路由布局-router-view-name属性："><a href="#路由布局-router-view-name属性：" class="headerlink" title="路由布局/router-view name属性："></a>路由布局/router-view name属性：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> routerObj = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    routes: [</span><br><span class="line">        &#123;</span><br><span class="line">            path: <span class="string">'/'</span>, </span><br><span class="line">            component: &#123;</span><br><span class="line">                <span class="string">'default'</span>: header,</span><br><span class="line">                <span class="string">'left'</span>: leftBox,</span><br><span class="line">                <span class="string">'main'</span>: mainBox</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    linkActiveClass: <span class="string">'myactive'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">name</span>=<span class="string">"header"</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> <span class="attr">name</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> <span class="attr">name</span>=<span class="string">"main"</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="基本项目结构："><a href="#基本项目结构：" class="headerlink" title="基本项目结构："></a>基本项目结构：</h3><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index.html    首页</span><br><span class="line"><span class="code">    |</span></span><br><span class="line"> main.js      组件化应用启动入口</span><br><span class="line"><span class="code">    |</span></span><br><span class="line"> app.js       APP.js 根组件</span><br><span class="line"><span class="code">    |</span></span><br><span class="line">   ...        各个组件</span><br></pre></td></tr></table></figure><h2 id="webpack之Vue："><a href="#webpack之Vue：" class="headerlink" title="webpack之Vue："></a>webpack之Vue：</h2><h3 id="render："><a href="#render：" class="headerlink" title="render："></a>render：</h3><p>使用 render 方法渲染组件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mytemplate = &#123;</span><br><span class="line">    template: <span class="string">'&lt;div&gt;我是一个组件&lt;div&gt;'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    ...</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span> (<span class="params">createElement</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> html = createElements(mytemplate)</span><br><span class="line">        <span class="keyword">return</span> html</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>return 的结果会替换 el 指定的容器。但是之中只能放一个组件。</p><h3 id="webpack配置："><a href="#webpack配置：" class="headerlink" title="webpack配置："></a>webpack配置：</h3><p>在webpack构建的项目中进行vue开发。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue -S  # 将vue安装到项目运行阶段</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>  <span class="comment">// 此处的vue功能不完整，只提供了 runtime-only</span></span><br><span class="line"><span class="keyword">import</span> Vue form <span class="string">'../node_modules/vue/dist/vue.js'</span> <span class="comment">// 比较全</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el:<span class="string">'#app'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>注意：在VUE中package.json文件中查找 main 属性来查找node import导入的包。</p></blockquote><p>如果使用第一种导入方式需要在<code>webpack.config.js</code> 中配置 <code>resolve</code>属性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line">resolve:&#123;</span><br><span class="line">    alias: &#123; <span class="comment">// 设置（修改） Vue 被导入包的路径</span></span><br><span class="line">        <span class="string">"vue$"</span>: <span class="string">"vue/dist/vue.js"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>runtime-only 不提供传统创建组件模式，此时将引入 <code>.vue</code> 格式文件。</p><h3 id="VUE："><a href="#VUE：" class="headerlink" title=".VUE："></a>.VUE：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mytemplate --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;p&gt;一个组件只能有一个根元素（div）&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // 这里写组件的业务逻辑 用ES6规范 export default 导出</span><br><span class="line">    export default &#123;</span><br><span class="line">        data () &#123; // 这里组件中的 data 必须是 function</span><br><span class="line">            return &#123;</span><br><span class="line">                msg: &quot;234&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</span><br><span class="line">    /*1. scoped 指定作用域（给div块自动添加属性） 2. lang=&quot;****&quot; 启用 预编译*/</span><br><span class="line">    body&#123;</span><br><span class="line">      div &#123;</span><br><span class="line">        color: red;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><blockquote><p>向外暴露成员的方式 ES6 和 node.js：</p><ol><li>node中是 <code>module.exports={}`</code>exports.a=’’<code>向外暴露成员，</code>var 名称 = require(‘模块标识符’)` 加载模块，详细参考 <a href="https://f-lancer.github.io/2019/03/27/Node/#more" target="_blank" rel="noopener">node</a> 中3.5.1 CommonJS 模块规范。</li><li>ES6 中 <code>import 模块名称 form &#39;模块标识符&#39;</code>、<code>import &#39;标识路径&#39;</code> 导入模块，使用 <code>export default</code>（只允许向外暴露一次，类似于 <code>module.exports</code>） 和 <code>export</code>（<code>import {模块名1，模块名2 as 别名...} form &#39;标识路径&#39;</code> 按需导出）向外暴露成员（两者可以同时使用）。</li><li>注意不要混用。</li></ol></blockquote><p>webpack 无法打包 .vue 文件，需要用到相关的第三方</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-loader vue-template-compiler -D # 前者内部依赖后者</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rule: [</span><br><span class="line">        ... <span class="comment">// 处理 .vue 文件 loader</span></span><br><span class="line">        &#123; <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>, <span class="attr">use</span>: <span class="string">'vue-loader'</span>&#125;</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>然后使用 render 实现组件渲染</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> mytemplate <span class="keyword">from</span> <span class="string">'./mytemplate.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        msg:<span class="string">'123'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    render: <span class="function"><span class="params">c</span> =&gt;</span> c(mytemplate)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>总结：</p><ol><li>安装配置 vue 及 webpack打包vue的三方包。</li><li>导入 vue 模块</li><li>创建<code>.vue</code>组件文件并导入</li><li>创建实例使用 render</li><li>创建实例控制区域…</li></ol><h3 id="webpack-结合-vue-router："><a href="#webpack-结合-vue-router：" class="headerlink" title="webpack 结合 vue-router："></a>webpack 结合 vue-router：</h3><p>根据 <a href="https://router.vuejs.org/zh/installation.html" target="_blank" rel="noopener">官网</a> 模块化导入安装：</p><ol><li><code>npm i vue-router -S</code> 安装。</li><li><code>import VueRouter from &#39;vue-router&#39;</code> 导入。</li><li><code>Vue.use(VueRouter)</code> 手动安装。</li><li><code>import app form &#39;./main/app.vue&#39;</code> 导入组件。</li><li><code>var router = new VueRouter({...})</code> 创建路由对象。</li><li>将 其他组件 router-view 写到 根组件 里去</li><li>抽离组件模块，将2 4（除根组件外）5的内容抽出 export default router 并在 main.js 接收</li></ol><h2 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h2><p>为了保存组件之间共享的数据而诞生的，是一个公共数据管理工具，方便整个项目调用。</p><h3 id="导入使用"><a href="#导入使用" class="headerlink" title="导入使用"></a>导入使用</h3><blockquote><p>官网: <a href="https://vuex.vuejs.org/zh/installation.html" target="_blank" rel="noopener">https://vuex.vuejs.org/zh/installation.html</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果在模块化构建系统中，请确保在开头调用了 Vue.use(Vuex)</span></span><br><span class="line"><span class="comment">//0. 导入</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.声明</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;                          <span class="comment">// 相当于 data</span></span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;                      <span class="comment">// 负责修改数据 相当于 methods </span></span><br><span class="line">    increment (state,...) &#123;         <span class="comment">// 自增方法 最多可传两个参数，但可以是对象，数组。。。</span></span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;                        <span class="comment">// 负责对外提供数据</span></span><br><span class="line">    optCount: <span class="function"><span class="keyword">function</span> (<span class="params">state</span>)</span>&#123;     <span class="comment">// 相当于组建中的过滤器,都不修改原数据</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'当前最新count：'</span>+ state.count  </span><br><span class="line">    &#125;    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.挂载到实例</span></span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el:<span class="string">'#app'</span>,</span><br><span class="line">    store</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.1 组件中使用</span></span><br><span class="line">v-model=<span class="string">"$store.state.count"</span> </span><br><span class="line"><span class="comment">// 3.2 组建中使用方法</span></span><br><span class="line">  <span class="comment">//this.$store.commit('方法名') 类似于 this.$emit('父组件中的方法名')</span></span><br><span class="line"><span class="keyword">this</span>.$store.commit(<span class="string">'increment'</span>,...) </span><br><span class="line"><span class="comment">// 3.3 组建中调用getters  调用又类似 计算属性</span></span><br><span class="line"><span class="keyword">this</span>.$store.getters.optCount</span><br></pre></td></tr></table></figure><h3 id="采坑注意"><a href="#采坑注意" class="headerlink" title="采坑注意"></a>采坑注意</h3><ol><li>不推荐直接在组件中操作 state 中的数据，容易导致数据紊乱。通过调用 mutations 提供的方法操作。</li><li>vuex 中方法第一个参数永远都是 state</li></ol><h2 id="小技巧："><a href="#小技巧：" class="headerlink" title="小技巧："></a>小技巧：</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>Console</span><br><span class="line">   * <span class="code">`console.dir()`</span> 在控制台可以将传入的元素展开。</span><br><span class="line">   * 控制台输入 document.body.classList.(...) 可查看操作 className 的方法。</span><br><span class="line">   </span><br><span class="line"><span class="bullet">2. </span>JSON</span><br><span class="line">   *  <span class="code">`JSON.Stringify(&#123;key:"value"&#125;);`</span> 对象转为字符串，某些参数只能是字符串。</span><br><span class="line">   * <span class="code">`JSON.parse(JSON.Stringify(&#123;key:"value"&#125;));`</span> 在将字符串转为 JSON。</span><br><span class="line">   * <span class="code">`JSON.parse('[]');`</span> // [] JSON格式数组 转为 数组</span><br><span class="line">   </span><br><span class="line"><span class="bullet">3. </span>H5 新增</span><br><span class="line">   * window.localStorage</span><br><span class="line"><span class="code">     - `window.localStorage.setItem("key","String")`</span></span><br><span class="line"><span class="code">     - `window.localStorage.getItem("key")`</span></span><br><span class="line">   * autofocus H5新特性在 Vue 中不稳定（因为虚拟 Dom 问题），需要自定义</span><br><span class="line"><span class="code">     - focus 在多个列表时，仅在第一个生效。</span></span><br><span class="line"><span class="code">     </span></span><br><span class="line"><span class="bullet">4. </span>hash </span><br><span class="line">   * <span class="code">`window.onhashchange = function()&#123;&#125;`</span> 注册hash的改变事件</span><br><span class="line">   * <span class="code">`window.location.hash`</span> 获取hash</span><br><span class="line">   </span><br><span class="line"><span class="bullet">5. </span>Vue</span><br><span class="line">  * 自定义 v-my-focus 指令必须写在 inserted 钩子函数中。</span><br><span class="line">  * 双击事件 ondblclick,在 vue 中为 <span class="code">`@dblclick`</span>。</span><br><span class="line">  * vue 提供的标签一共四个 component, template, transition, transitionGroup</span><br><span class="line">  * 标签中 <span class="code">`&lt;input name="string"&gt;`</span> 字符串，js中带引号。</span><br><span class="line">  * <span class="code">`&lt;input :value="'value'"&gt;`</span>注意区分变量和值，表值，js中不带引号。</span><br><span class="line">  </span><br><span class="line"><span class="bullet">6. </span>涉及的 ES6：</span><br><span class="line">   * 可以使用 ES6 简写 省去 function 写为 <span class="code">`handleCountClick () &#123; ... &#125;`</span>。</span><br><span class="line">   * ES6 语法 当键和值一样的时候，可以简写，只写一个。</span><br><span class="line">   * ES6 新添加的操作数组的方法 forEach some filter findIndex</span><br><span class="line"><span class="code">     - some() 中返回 true 会立即终止循环</span></span><br><span class="line"><span class="code">     - 当循环遍历删除元素的时候不要用 forEach() 用 for 循环,循环结尾 i--。</span></span><br><span class="line">   * ES6操作字符串</span><br><span class="line"><span class="code">     + 新添加includes()</span></span><br><span class="line"><span class="code">       - 判断数组名字里里是否包含 keywords：</span></span><br><span class="line"><span class="code">       - `if (item.name.indexOf(keywords) != -1)`</span></span><br><span class="line"><span class="code">       - `if (item.name.includes(keywords))` </span></span><br><span class="line"><span class="code">     + 头尾填充字符串</span></span><br><span class="line"><span class="code">       - String.prototype.padStart(maxLength,fillString="")</span></span><br><span class="line"><span class="code">       - String.prototype.padEnd(maxLength,fillString="")</span></span><br><span class="line">   * 箭头函数 this 指向外部</span><br><span class="line"><span class="code">     - 定时器内部使用箭头函数可指向外部。</span></span><br><span class="line">   * 模板字符串变量用 $&#123;&#125; 包裹</span><br><span class="line">   * 参数可设置默认值 <span class="code">`function (pattern="") &#123;&#125;`</span></span><br><span class="line"> 7. JS</span><br><span class="line">   * replace() 第一个参数是需要替换的内容，可以是字符串，也可以是正则。</span><br></pre></td></tr></table></figure><h2 id="回顾概念："><a href="#回顾概念：" class="headerlink" title="回顾概念："></a>回顾概念：</h2><h3 id="M-V-VM："><a href="#M-V-VM：" class="headerlink" title="M V VM："></a>M V VM：</h3><p>M V VM 是前端的视图层的分层开发思想，主要把每个页面分成了 M，V，VM。VM 是两者的桥梁。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>M 是保存每个页面的中的单独的数据。 （Vue中的选项 data）</span><br><span class="line"><span class="bullet">2. </span>V 是每个页面中的 HTML 结构。  （DOM 元素）</span><br><span class="line"><span class="bullet">3. </span>VM 是一个调度者，分割了 M 和 V，V 和 M 的通信即是通过 VM。（new 出来的 app实例对象 就是 VM 调度者）</span><br><span class="line"></span><br><span class="line">注：VM 提供了数据的双向绑定</span><br></pre></td></tr></table></figure><h3 id="M-V-C"><a href="#M-V-C" class="headerlink" title="M V C :"></a>M V C :</h3><p>MVC 其实是后端的 模块化分层/分发开发 的概念。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>M Model 层，负责操作数据库，执行对应的 SQL 语句，进行数据的 CRUD。</span><br><span class="line"><span class="bullet">2. </span>C Controller 层，router.js 路由模块分发，业务逻辑处理，若涉及数据，调用 Model 层。</span><br><span class="line"><span class="bullet">3. </span>V 通过入口文件的调度整合，整个形成的结果就是 View 视图层。</span><br><span class="line"></span><br><span class="line">注：模块化，是一种思想，使得各个模块职能单一，易于维护。参考本博客 NODE.JS。</span><br></pre></td></tr></table></figure><h2 id="工具"><a href="#工具" class="headerlink" title="工具:"></a>工具:</h2><p>涉及用到的工具。</p><ol><li><p>Chrome 浏览器插件工具 <a href="https://github.com/vuejs/vue-devtools" target="_blank" rel="noopener">Vue Devtools</a>。</p></li><li><p><a href="http://todomvc.com/" target="_blank" rel="noopener">todoMVC 模板仓库 </a>。<br>（1）<code>--depth=1</code> 表示只下载最后一次的 commit,不要其历史记录，可以提高下载速度<br><code>git clone https://github.com/tastejs/todomvc-app-template.git todomvc-vue --depth=1</code>。<br>（2）<code>npm install</code></p></li><li><p>浏览器同步测试工具 <a href="http://www.browsersync.cn/docs/" target="_blank" rel="noopener">browser-sync</a>。<br>（1）<code>npm install --save-dev browser-sync</code>   （<code>npm install --production</code>）。<br>（2）配置 package.json 中的 script。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>:&#123;  </span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"browser-sync start --server --files \"*.html,css/*.css,js/*.js"</span><span class="string">",</span></span><br><span class="line"><span class="string">    "</span>start<span class="string">": "</span>npm run dev<span class="string">"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>（3）启动开发服务 <code>npm run start</code>。</p></li><li><p>团队协作类工具 Worktile / teambition</p></li><li><p>vscode</p><ul><li><p>插件</p><p>Debugger for Chrome  本地调试</p><p>Bootstrap 4 Snippets   bootstrap代码块提示</p></li><li><p>便捷指令</p><ul><li>Ctrl + T 搜索文件标签</li><li>Alt + 鼠标点击 选中列</li></ul></li><li><p>VUE 提示工具</p><ul><li>Vetur</li><li>Vue 2 Snippets</li></ul></li></ul></li><li><p><a href="https://element.eleme.cn/#/zh-CN/component/installation" target="_blank" rel="noopener">element-ui</a></p></li><li><p>进行手机 App 开发，需借助 Weex。</p></li><li><p>nrm工具 nrm维护了一些常用的 npm包镜像  <code>npm i nrm -g</code>，<code>nrm ls</code>，<code>nrm use taobao</code></p></li><li><p>webpack 见 webpack 文档</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介：&quot;&gt;&lt;a href=&quot;#简介：&quot; class=&quot;headerlink&quot; title=&quot;简介：&quot;&gt;&lt;/a&gt;简介：&lt;/h2&gt;&lt;p&gt;此处的 Vue 指的是 Vue2…
    
    </summary>
    
      <category term="技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="前端技术" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="vue" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/vue/"/>
    
    
      <category term="前端框架" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
      <category term="Vue" scheme="http://yoursite.com/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>webpack笔记</title>
    <link href="http://yoursite.com/2019/03/21/webpack/"/>
    <id>http://yoursite.com/2019/03/21/webpack/</id>
    <published>2019-03-21T14:59:00.000Z</published>
    <updated>2020-02-26T07:34:37.538Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h2><blockquote><p>该文基于 nodejs</p></blockquote><p><strong>网页中手写的常用的静态资源：</strong></p><ol><li><p><em>JS（.js .jsx .coffee .ts）</em> </p></li><li><p>CSS（.css .less <a href="https://www.sass.hk/" target="_blank" rel="noopener">.sass</a> .scss）                              </p></li><li><p>Images（.jpg .png .gif .bmp .svg）        </p></li><li><p><em>Fonts （.svg .ttf .eot .woff .woff2）</em><a id="more"></a></p></li><li><p><em>模板文件 （.ejs .jade .vue）</em></p></li><li><em>…等等</em></li></ol><p><em>这些东西会使得网页速度变慢，其中一些会<strong>发起二次请求</strong>，以及<strong>复杂的依赖关系</strong>。</em></p><p><em>解决这些问题需要 合并压缩、精灵图、Base64(适合小图) 、requireJS、webpack（解决依赖问题）。</em></p><p><strong>webpack 和 gulp 的区别：</strong></p><p><em>gulp：基于 task 任务。</em></p><p><em>webpack：基于整个项目，主要用于资源的合并打包、压缩等。</em></p><blockquote><p><em>webpack官网：<a href="https://www.webpackjs.com/" target="_blank" rel="noopener">https://www.webpackjs.com/</a></em></p></blockquote><h2 id="安装："><a href="#安装：" class="headerlink" title="安装："></a>安装：</h2><p><em>正常安装，注意官网说的事项即可</em></p><ol><li><p><em>nodejs 版本要和 webpack 某种程度上的匹配。（这里有<strong>坑</strong>）</em></p></li><li><p><em>webpack4+，还需要安装 webpack-cli。</em></p></li></ol><blockquote><p>安装：<a href="https://www.webpackjs.com/guides/installation/" target="_blank" rel="noopener">https://www.webpackjs.com/guides/installation/</a></p></blockquote><h2 id="基本使用："><a href="#基本使用：" class="headerlink" title="基本使用："></a>基本使用：</h2><h3 id="示例项目基本结构："><a href="#示例项目基本结构：" class="headerlink" title="示例项目基本结构："></a>示例项目基本结构：</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">* </span>dist 文件夹    放着我们所有要交付的代码</span><br><span class="line"><span class="bullet">* </span>src 文件夹         放着我们的源代码  </span><br><span class="line"> - CSS 文件夹</span><br><span class="line"> - images 文件夹</span><br><span class="line"> - js 文件夹</span><br><span class="line"><span class="bullet">* </span>index.html    首页</span><br><span class="line"><span class="bullet">* </span>main.js       项目 js 入口文件</span><br><span class="line"><span class="bullet">* </span>package.json  导入包时创建的</span><br><span class="line"><span class="bullet">* </span>webpack.config.js 手动创建 webpack 配置文件</span><br><span class="line"><span class="bullet">* </span>bundle.js     打包好的文件</span><br><span class="line"><span class="bullet">* </span>.babelrc      babel 配置文件</span><br></pre></td></tr></table></figure><h3 id="基本功能-JS-打包："><a href="#基本功能-JS-打包：" class="headerlink" title="基本功能 / JS 打包："></a>基本功能 / JS 打包：</h3><h4 id="处理依赖-及-兼容语法："><a href="#处理依赖-及-兼容语法：" class="headerlink" title="处理依赖 及 兼容语法："></a>处理依赖 及 兼容语法：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> npm 导入包</span><br><span class="line">npm i jquire</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用包，例如JQuery，使用的是 ES6 导入模块的语法</span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 有些浏览器无法解析 ES6 需要 webpack 处理</span><br><span class="line">webpack .\src\main.js .\dist\bundle.js</span><br><span class="line"><span class="meta">#</span> 将处理后的放入到指定文件下的 bundle.js 文件</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../dist/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置文件简化打包命令："><a href="#配置文件简化打包命令：" class="headerlink" title="配置文件简化打包命令："></a>配置文件简化打包命令：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="comment">// 使用 node 语法中的模块语法  导入 path 模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// node中向外暴露配置对象</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口，表示要使用 webpack 打包哪个文件</span></span><br><span class="line">    entry: path.join(__dirname,<span class="string">'./src/main.js'</span>), <span class="comment">// 字符串形式</span></span><br><span class="line">    <span class="comment">// entry: ['./src/index.js','./src/a.js'], // 数组形式打包多个js</span></span><br><span class="line">    <span class="comment">// entry:&#123;&#125; // 对象形式打包多页应用 参考进阶篇</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 出口，输出文件相关的配置</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 指定路径</span></span><br><span class="line">        path: path.join(__dirname,<span class="string">'./dist'</span>) </span><br><span class="line">        <span class="comment">// 指定输出的文件名称</span></span><br><span class="line">        filename: <span class="string">'bundle.js'</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 直接使用 webpack 即可</span><br><span class="line">webpack</span><br><span class="line"><span class="meta">#</span> 未指定 入口 出口 会直接去 'webpack.config.js' 中找</span><br></pre></td></tr></table></figure><h4 id="webpack-dev-server-："><a href="#webpack-dev-server-：" class="headerlink" title="webpack-dev-server ："></a>webpack-dev-server ：</h4><p><em>自动打包编译。</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> -D 安装到本地开发依赖</span><br><span class="line">npm i webpack-dev-server -D</span><br></pre></td></tr></table></figure><p><em>由于无法直接执行非全局安装的 webpack-dev-server，所以需在 package.json 中配置一下</em>。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// package.json 文件</span><br><span class="line">...</span><br><span class="line">"scripts": &#123;</span><br><span class="line">    ...</span><br><span class="line">    "dev": "webpack-dev-server"  // 使用 npm run dev 即可代替</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><p><em>注意：</em></p><ol><li><em>即使在全局安装过 webpack 也要在<strong>本地</strong>再安装一次<strong>（坑）</strong>。</em></li><li><em>引入标签修改为：</em><code>&lt;script src=&quot;/bundle.js&quot;&gt;&lt;/script&gt;</code> 。</li><li>打包生成的 bundle.js 并没有存放到 实际的 物理磁盘 上，而是直接托管到了电脑的内存中，因此在项目根目录中找不到。可以当做是一种虚拟的形式托管。这个机制是因为处理速度会更快。</li></ol><h5 id="webpack-dev-server-常用参数："><a href="#webpack-dev-server-常用参数：" class="headerlink" title="webpack-dev-server 常用参数："></a>webpack-dev-server 常用参数：</h5><p><strong><em>第一种方式：</em></strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// package.json 文件</span><br><span class="line">...</span><br><span class="line">"scripts": &#123;</span><br><span class="line">    ...</span><br><span class="line">    "dev": "webpack-dev-server --open --port 3000 --contentBase src --hot"  </span><br><span class="line">    /* 设置参数：</span><br><span class="line">        1. 自动打开浏览器</span><br><span class="line">        2. 设置端口号</span><br><span class="line">        3. 直接打开首页</span><br><span class="line">        4. 热启动，只更新局部打入补丁，可异步刷新，即不用手动刷新浏览器 </span><br><span class="line">    */</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong><em>第二种方式：（比较麻烦，不推荐）</em></strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// package.json 文件</span><br><span class="line">...</span><br><span class="line">"scripts": &#123;</span><br><span class="line">    ...</span><br><span class="line">    "dev": "webpack-dev-server“</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>) <span class="comment">// 2.启用热更新需要导入，配置 plugins</span></span><br><span class="line">...</span><br><span class="line">devServer: &#123;  <span class="comment">// 配置 dev-server 命令参数</span></span><br><span class="line">    open: <span class="literal">true</span>, <span class="comment">// 自动打开浏览器</span></span><br><span class="line">    port: <span class="number">3000</span>, <span class="comment">// 指定端口</span></span><br><span class="line">    contentBase: <span class="string">'src'</span>, <span class="comment">// 指定托管根目录</span></span><br><span class="line">    hot: <span class="literal">true</span>,  <span class="comment">// 1.启用热更新</span></span><br><span class="line">    compress:<span class="literal">true</span>, <span class="comment">// 启动服务器压缩 </span></span><br><span class="line">&#125;,</span><br><span class="line">plugins: [ <span class="comment">// 配置插件节点</span></span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin() <span class="comment">// 3.new 一个热更新模块对象，启用热更新</span></span><br><span class="line">]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="基本功能-HTML-："><a href="#基本功能-HTML-：" class="headerlink" title="基本功能 / HTML ："></a>基本功能 / HTML ：</h3><h4 id="html-webpack-plugin-插件："><a href="#html-webpack-plugin-插件：" class="headerlink" title="html-webpack-plugin 插件："></a>html-webpack-plugin 插件：</h4><ol><li><p><em>在内存中生成 HTML 页面的插件。</em></p></li><li><p><em>自动追加缺失未引入的打包好的（bundle.js）js文件。</em></p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="comment">// 导入插件使用的包，放入到 plugins 节点中去</span></span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">plugins: [ <span class="comment">// 配置插件节点</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">new</span> htmlWebpackPlugin(&#123;  </span><br><span class="line">        template: path.join(__dirname, <span class="string">'./src/index.html'</span>), <span class="comment">// 指定模板页面</span></span><br><span class="line">        filename: <span class="string">'index.html'</span>, <span class="comment">// 指定生成页面的名称</span></span><br><span class="line">        title: <span class="string">'webpack架构'</span>, <span class="comment">// title标签内容</span></span><br><span class="line">        hash: <span class="literal">true</span>, <span class="comment">// 清缓存</span></span><br><span class="line">        minify: &#123; <span class="comment">// 压缩 html</span></span><br><span class="line">            removeAttributeQuotes:<span class="literal">true</span>, <span class="comment">// 删除html标签属性的双引号</span></span><br><span class="line">            collapseWhitespace:<span class="literal">true</span>, <span class="comment">// 从删除空行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    ...</span><br><span class="line">]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--index.html EJS模板配置title--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span> <span class="tag">&lt;<span class="name">%=htmlWebpackPlugin.options.title%</span>&gt;</span> <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="CSS处理-loader："><a href="#CSS处理-loader：" class="headerlink" title="CSS处理/loader："></a>CSS处理/loader：</h3><p><code>&lt;link&gt;</code> <strong><em>导入 CSS 会引起二次请求。</em></strong></p><h4 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h4><ol><li><em>处理 非 JS 类型的文件，需手动安装合适的第三方 loader 加载器。这里分别为 style-loader css-loader。</em></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i style style-loader css-loader -D</span><br></pre></td></tr></table></figure><ol start="2"><li><em>在 webpack配置文件中新增 module对象，以及存放着所有的三方文件的匹配和处理规则的rules属性。</em></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./css/index.css'</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">module</span>: &#123;    <span class="comment">// 所有三方加载器</span></span><br><span class="line">    rule: [  <span class="comment">// 所有三方加载器匹配规则 </span></span><br><span class="line">        <span class="comment">// test 来源于正则方法 reg.test()</span></span><br><span class="line">        &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>] &#125;, </span><br><span class="line">        <span class="comment">// 匹配 .css 结尾的文件，用 所写三方规则打包 处理</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><blockquote><p>注：查找到对应的规则从后向前调用，即先css-loader处理再交给style-loader再webpack打包</p></blockquote><h4 id="less"><a href="#less" class="headerlink" title="less"></a>less</h4><p><em>同理。</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i less-loader -D  # less-loader 内部依赖于 less</span><br><span class="line">npm i less -D</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./css/index.css'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./css/someone.less'</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rule: [</span><br><span class="line">        &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>] &#125;, </span><br><span class="line">        <span class="comment">// 先 less-loader 处理</span></span><br><span class="line">        &#123; <span class="attr">test</span>: <span class="regexp">/\.less$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>, <span class="string">'less-loader'</span>] &#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="scss"><a href="#scss" class="headerlink" title="scss"></a>scss</h4><p><em>同理。</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm i sass-loader -D  # sass 是 scss 的前身</span><br><span class="line">cnpm i sass -D      # cnpm镜像比较好装</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>, <span class="string">'sass-loader'</span>] &#125;,</span><br><span class="line">...</span><br><span class="line"><span class="comment">// -loader 在webpack1.x之后都必须带上</span></span><br></pre></td></tr></table></figure><h3 id="url（图片、字体库）-loader"><a href="#url（图片、字体库）-loader" class="headerlink" title="url（图片、字体库）/loader"></a>url（图片、字体库）/loader</h3><p><em>默认情况下，webpack 无法处理 CSS 文件中的 <strong>url 地址</strong>的<strong>图片</strong>、<strong>字体库</strong>，需要三方 loader。</em></p><h4 id="url-图片"><a href="#url-图片" class="headerlink" title="url / 图片"></a>url / 图片</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;</span><br><span class="line">    .box&#123;</span><br><span class="line">        background：url('./images/miao.jpg');</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i url-loader file-loader # url 内部依赖 file-loader</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.(jpg|png|gif|jpeg|bmp)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader'</span> &#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><em>以上可以，</em></p><ol><li><em>将图片转成 bace64 格式，适用于小图片。如果需要按图片大小判断是否需要，则如下传参：</em></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.(jpg|png|gif|jpeg|bmp)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader?limit=7632'</span> &#125;,</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 如果图片大于或等于 7632byte（字节）则不会转为 base64 格式</span></span><br></pre></td></tr></table></figure><ol start="2"><li><em>未编码的图片会被强行修改图片名称，防止重名。但有些地方会用到同一张图片，则如下传参：</em></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.(jpg|png|gif|jpeg|bmp)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader?limit=7632&amp;name=[name].[ext]'</span> &#125;,</span><br><span class="line">...</span><br><span class="line"><span class="comment">// [name]表示不改名称，[ext]表示不改后缀名</span></span><br></pre></td></tr></table></figure><ol start="3"><li><em>当遇到放在不同文件夹下相同名称的图片会出现渲染错误，通过截取hash传参，如下：</em></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.(jpg|png|gif|jpeg|bmp)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader?limit=7632&amp;name=[hash:8][name].[ext]'</span> &#125;,</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 截取 hash 前 8 位（总长 32 位）拼接名称</span></span><br></pre></td></tr></table></figure><h4 id="url-字体库"><a href="#url-字体库" class="headerlink" title="url / 字体库"></a>url / 字体库</h4><p><em>以 bootstrap 字体库图标为例：</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i bootstrap -D</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> <span class="string">'bootstrap/dist/css/bootstrap.css'</span></span><br><span class="line"><span class="comment">// 引入 node_modules 中的文件 可以不写 ./node_modules，默认会去这里找</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.(ttf|eot|svg|woff|woff2)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader'</span> &#125;,</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 处理字体文件loader模块</span></span><br></pre></td></tr></table></figure><h2 id="进阶使用："><a href="#进阶使用：" class="headerlink" title="进阶使用："></a>进阶使用：</h2><h3 id="babel配置："><a href="#babel配置：" class="headerlink" title="babel配置："></a>babel配置：</h3><blockquote><p>babel：<a href="https://babeljs.io/" target="_blank" rel="noopener">https://babeljs.io</a></p></blockquote><p><em>webpack中只能处理一部分ES6新语法，一些更高级的ES6或ES7需要借助第三方loader降维。</em></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js   ES6简单 Class 类 示例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> info = &#123;<span class="attr">name</span>: <span class="string">'amiao'</span>, <span class="attr">age</span>:<span class="number">20</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> per = <span class="keyword">new</span> Person()</span><br></pre></td></tr></table></figure><blockquote><p>注1：static定义静态属性，即通过类名直接访问的属性。相对的，实例属性，通过类的实例访问。</p></blockquote><p>安装如下：</p><p>第一套：（转换器）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i babel-core babel-loader babel-plugin-transform-runtime -D</span><br></pre></td></tr></table></figure><p>第二套：（字典）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i babel-preset-env babel-preset-stage-0 -D</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rule: [</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// 需要把 node_modules 目录，通过exclude选项将其排除掉</span></span><br><span class="line">        &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">use</span>: <span class="string">'babel-loader'</span>,<span class="attr">exclude</span>:<span class="regexp">/node_modules/</span> &#125;</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>在项目根目录中新建 .babelrc 文件，是Babel 配置文件，属于 JSON 格式（不能写注释，字符串必须带双引号）。其中 presets（语法） 和 plugins（插件） 必需配置。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// .babelrc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"presets"</span>: [<span class="string">"env"</span>, <span class="string">"stage-0"</span>],</span><br><span class="line">    <span class="attr">"plugins"</span>: [<span class="string">"transform-runtime"</span>]   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="多页应用打包配置"><a href="#多页应用打包配置" class="headerlink" title="多页应用打包配置"></a>多页应用打包配置</h3><p>打包出两个js文件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js </span></span><br><span class="line">...</span><br><span class="line">entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    a: <span class="string">'./src/a.js'</span></span><br><span class="line">&#125;,</span><br><span class="line">output: &#123;</span><br><span class="line">     filename: <span class="string">'[name].[hash:8].js'</span> ,</span><br><span class="line">     path: path.resolve(<span class="string">'./build'</span>)    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对应两个html</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">plugin:[</span><br><span class="line">    <span class="keyword">new</span> htmlWebpackPlugin(&#123;  </span><br><span class="line">        template: path.join(__dirname, <span class="string">'./src/index.html'</span>), <span class="comment">// 指定模板页面</span></span><br><span class="line">        filename: <span class="string">'index.html'</span>, <span class="comment">// 指定生成页面的名称</span></span><br><span class="line">        title: <span class="string">'webpack架构'</span>, <span class="comment">// title标签内容</span></span><br><span class="line">        hash: <span class="literal">true</span>, </span><br><span class="line">        chunks: [<span class="string">'index'</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> htmlWebpackPlugin(&#123;  </span><br><span class="line">        template: path.join(__dirname, <span class="string">'./src/index.html'</span>), <span class="comment">// 指定模板页面</span></span><br><span class="line">        filename: <span class="string">'a.html'</span>, <span class="comment">// 指定生成页面的名称</span></span><br><span class="line">        title: <span class="string">'webpack架构'</span>, <span class="comment">// title标签内容</span></span><br><span class="line">        hash: <span class="literal">true</span>, </span><br><span class="line">        chunks: [<span class="string">'a'</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="指定热更新"><a href="#指定热更新" class="headerlink" title="指定热更新"></a>指定热更新</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js </span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rules"><a href="#rules" class="headerlink" title="rules"></a>rules</h3><p>rules 的 use 用对象方便传参。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: [</span><br><span class="line">                &#123;<span class="attr">loader</span>: <span class="string">'style-loader'</span>, <span class="attr">options</span>:<span class="string">'...'</span>&#125;, </span><br><span class="line">                &#123;<span class="attr">loader</span>: <span class="string">'css-loadder'</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="抽离样式"><a href="#抽离样式" class="headerlink" title="抽离样式"></a>抽离样式</h3><p>借助三方插件。但是该配置影响了热更新，仅在上线时使用比较好。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 抽离样式 抽离到一个CSS文件 通过css文件的方式引用</span><br><span class="line"><span class="meta">  #</span> webpack3.0 </span><br><span class="line">npm i extract-text-webpack-plugin -D</span><br><span class="line"><span class="meta">  #</span> webpack4.0</span><br><span class="line">npm i extract-text-webpack-plugin@next -D</span><br><span class="line"><span class="meta">  #</span> 取代版</span><br><span class="line">npm i mini-css-extract-plugin -D</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">let</span> ExtractTextWebpackPlugin = <span class="built_in">require</span>(<span class="string">'extract-trxt-webpack-plugin'</span>)</span><br><span class="line"><span class="comment">// new两次分别抽离，同时要将rules里的use改成此处的名称LessExtract、CssExtract</span></span><br><span class="line"><span class="keyword">let</span> LessExtract = <span class="keyword">new</span> ExtractTextWebpackPlugin(&#123;</span><br><span class="line">    filename: <span class="string">'css/less.css'</span>,</span><br><span class="line">    disable: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> CssExtract = <span class="keyword">new</span> ExtractTextWebpackPlugin(&#123;</span><br><span class="line">    filename: <span class="string">'css/css.css'</span></span><br><span class="line">    disable: <span class="literal">true</span>  <span class="comment">// 暂时先禁用</span></span><br><span class="line">&#125;);</span><br><span class="line">...</span><br><span class="line">plugins:[</span><br><span class="line">    <span class="keyword">new</span> ExtractTextWebpackPlugin(&#123; </span><br><span class="line">        filename:<span class="string">'css/index.css'</span> <span class="comment">// 抽离后的文件</span></span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br><span class="line">...</span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">                fallback: <span class="string">'style-loader'</span> <span class="comment">// 不生效时进入这个打包</span></span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">// &#123;loader: 'style-loader'&#125;, 上线是 link 形式插入，故去掉它</span></span><br><span class="line">                    &#123;<span class="attr">loader</span>: <span class="string">'css-loadder'</span>&#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; </span><br><span class="line">            test: <span class="regexp">/\.scss$/</span>, <span class="attr">use</span>: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">// &#123;loader:'style-loader'&#125;,</span></span><br><span class="line">                    &#123;<span class="attr">loader</span>:<span class="string">'css-loader'</span>&#125;,</span><br><span class="line">                    &#123;<span class="attr">loader</span>:<span class="string">'sass-loader'</span>&#125;</span><br><span class="line">                ] </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><blockquote><p>mini-css-extract-plugin用法参考：<a href="https://webpack.docschina.org/plugins/mini-css-extract-plugin/" target="_blank" rel="noopener">https://webpack.docschina.org/plugins/mini-css-extract-plugin/</a></p></blockquote><h3 id="webpack-构建-vue-项目"><a href="#webpack-构建-vue-项目" class="headerlink" title="webpack 构建 vue 项目"></a>webpack 构建 vue 项目</h3><p>参照本博 <a href="https://f-lancer.github.io/2019/03/21/VueDetail/#more" target="_blank" rel="noopener">VUE篇</a>。</p><h2 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h2><p>关于webpack 和 npm：</p><ol><li>package.json  json文件中不能写注释。</li><li>’不是内外部命令‘，可能是环境变量或未安装的问题。</li></ol><h2 id="Webpack-4-0补充"><a href="#Webpack-4-0补充" class="headerlink" title="Webpack 4.0补充"></a>Webpack 4.0补充</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>按照官网安装，注意要多安装个 webpack-cli。</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h4 id="npx"><a href="#npx" class="headerlink" title="npx"></a>npx</h4><p>在 webpack 中所有文件都是模块：js模块、模块化（AMD CMD es6Module commonjs）。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.新出的 npx 可以执行 node_module 对应的 bin 下的 webpack.cmd 文件</span><br><span class="line">npx webpack  #（node8.5以上会有）</span><br><span class="line"><span class="meta">#</span> 2.紧接着会找 webpack.cmd 下定义的 webpack.js 执行</span><br></pre></td></tr></table></figure><p>这样直接运行的话是进行默认打包，但通常情况下我们会使用 webpack.config.js 对其进行配置定义。</p><h4 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><p>该文件是基于 node 的，需要尊循 commonjs 规范</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config.js 常用配置</span></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">''</span>, <span class="comment">// 入口</span></span><br><span class="line">    output: &#123;  <span class="comment">// 出口</span></span><br><span class="line">        filename: <span class="string">'build.[hash:8].js'</span>, <span class="comment">// 配置hash为了清缓存</span></span><br><span class="line">        path: path.resolve()    </span><br><span class="line">        <span class="comment">// 这个路径必须是绝对路径所以使用path模块 resolve() 方法解析</span></span><br><span class="line">    &#125;, </span><br><span class="line">    devServer: &#123;&#125;, <span class="comment">// 开发服务器</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;&#125;, <span class="comment">// 插件的配置</span></span><br><span class="line">    plugins: [], <span class="comment">// 插件配置</span></span><br><span class="line">    mode: <span class="string">'development'</span>, <span class="comment">// 可以更改模式</span></span><br><span class="line">    resolve: &#123;&#125;, <span class="comment">// 配置解析</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>更多webpack.config.js解析可以参考：<a href="https://webpack.docschina.org/configuration" target="_blank" rel="noopener">https://webpack.docschina.org/configuration</a></p></blockquote><h3 id="build-js"><a href="#build-js" class="headerlink" title="build.js"></a>build.js</h3><h4 id="打包文件"><a href="#打包文件" class="headerlink" title="打包文件"></a>打包文件</h4><p>此处假设是打包好的文件 </p><p>上半部分是 自定义函数 是webpack的启动函数，下半部分是执行的参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap webpack的启动函数</span></span><br><span class="line">    <span class="comment">// The module cache  缓存模块对象，放着模块de缓存</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// The require function </span></span><br><span class="line">    ...</span><br><span class="line">        <span class="comment">// Check if module is in cache 先检查模块是否存在缓存中</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="comment">// Execute the module function  调用方法 执行模块功能</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// Flag the module as loaded  将模块标记为已加载</span></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>这个文件记录一些版本信息等。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123; </span><br><span class="line">    "build": "webpack", </span><br><span class="line">    "dev": "webpack-dev-server“, </span><br><span class="line">    "...":"...."</span><br><span class="line">&#125;</span><br><span class="line"> // 其中 这个字段可以配置一些我们自定义的脚本</span><br><span class="line"> // build 一般为上线打包</span><br><span class="line"> // dev 一般为开发打包</span><br></pre></td></tr></table></figure><h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p>补充介绍插件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 带hash时清缓存的插件</span><br><span class="line">npm install clean-webpack-plugin -D</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 清除未使用到的样式 注意升级问题</span><br><span class="line">npm i purifycss-webpack purify-css glob -D</span><br></pre></td></tr></table></figure><blockquote><p>npm purifycss-webpack：<a href="https://www.npmjs.com/package/purifycss-webpack" target="_blank" rel="noopener">https://www.npmjs.com/package/purifycss-webpack</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 自动加前缀 -webkit- 等</span><br><span class="line">npm install postcss-loader autoprefixer -D</span><br></pre></td></tr></table></figure><blockquote><p>npm postcss-loader：<a href="https://www.npmjs.com/package/postcss-loader" target="_blank" rel="noopener">https://www.npmjs.com/package/postcss-loader</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> copy 插件</span><br><span class="line">npm i copy-webpack-plugin -D</span><br></pre></td></tr></table></figure><blockquote><p>npm copy-webpack-plugin：<a href="https://www.npmjs.com/package/copy-webpack-plugin" target="_blank" rel="noopener">https://www.npmjs.com/package/copy-webpack-plugin</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 引入一个模块既可以全局使用，又想import引入</span><br><span class="line"><span class="meta">#</span> 可以使用 ProvidePlugin 或 暴露模块的插件</span><br><span class="line">npm i export-loader -D</span><br></pre></td></tr></table></figure><blockquote><p>ProvidePlugin：<a href="https://www.webpackjs.com/plugins/provide-plugin/" target="_blank" rel="noopener">https://www.webpackjs.com/plugins/provide-plugin/</a></p></blockquote><blockquote><p>export-loader：<a href="https://www.npmjs.com/package/export-loader" target="_blank" rel="noopener">https://www.npmjs.com/package/export-loader</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 分析webpack打包内容 性能分析</span><br><span class="line">npm install --save-dev webpack-bundle-analyzer</span><br></pre></td></tr></table></figure><blockquote><p>webpack-bundle-analyzer：<a href="https://www.npmjs.com/package/webpack-bundle-analyzer" target="_blank" rel="noopener">https://www.npmjs.com/package/webpack-bundle-analyzer</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介：&quot;&gt;&lt;a href=&quot;#简介：&quot; class=&quot;headerlink&quot; title=&quot;简介：&quot;&gt;&lt;/a&gt;简介：&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;该文基于 nodejs&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;网页中手写的常用的静态资源：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;JS（.js .jsx .coffee .ts）&lt;/em&gt; &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CSS（.css .less &lt;a href=&quot;https://www.sass.hk/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;.sass&lt;/a&gt; .scss）                              &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Images（.jpg .png .gif .bmp .svg）        &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;Fonts （.svg .ttf .eot .woff .woff2）&lt;/em&gt;
    
    </summary>
    
      <category term="技术 - 前端构建工具" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF-%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="前端工具" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E5%85%B7/"/>
    
      <category term="构建工具" scheme="http://yoursite.com/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>积小流</title>
    <link href="http://yoursite.com/2019/03/21/%E5%AD%A6%E4%B9%A0%E5%B7%A5%E4%BD%9C%E7%A7%AF%E7%B4%AF/"/>
    <id>http://yoursite.com/2019/03/21/学习工作积累/</id>
    <published>2019-03-21T14:59:00.000Z</published>
    <updated>2020-03-03T08:22:03.729Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>不积小流，无以成江海。<a id="more"></a></p><h1 id="javaScript"><a href="#javaScript" class="headerlink" title="javaScript"></a>javaScript</h1><h2 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h2><blockquote><p>参考：<a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/10/event-loop.html</a></p></blockquote><h2 id="闭包-引用类型对象"><a href="#闭包-引用类型对象" class="headerlink" title="闭包/引用类型对象"></a>闭包/引用类型对象</h2><ol><li>举例：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i++);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f1 = Foo(),</span><br><span class="line">    f2 = Foo();</span><br><span class="line">f1();  <span class="comment">// 0</span></span><br><span class="line">f1();  <span class="comment">// 1</span></span><br><span class="line">f2();  <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><ol start="2"><li>涉及知识点：</li></ol><ul><li><p>Function 是引用类型，保存在<strong>堆</strong>中，变量保存在<strong>栈</strong>中。</p></li><li><p>闭包：一个函数（产生新的作用域）定义的局部变量、子函数的作用域在函数内部，一旦离开该函数，局部变量就无法访问。通过闭包，即一个函数中定义了一个新的函数，通过此函数使得局部变量得以访问。 </p></li><li><p>过程：</p><p>（1）执行 Foo() ,返回新的函数 fn，i++ 及先输出 i=0，继而 i+1。</p><p>（2）再次执行 f1() 时，i 值已被 i+1 覆盖为 1。即闭包有延续变量的作用。</p><p>（3）执行 f2 时，f2 指向堆中新的函数对象，i=0。</p></li></ul><h2 id="深拷贝及浅拷贝"><a href="#深拷贝及浅拷贝" class="headerlink" title="深拷贝及浅拷贝"></a>深拷贝及浅拷贝</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>深拷贝、浅拷贝这个概念讨论是对于 Object 和 Array 复杂类型的。简单来说，</p><p><strong>浅拷贝</strong>：就是指把一个对象的地址给了另一个对象，他们的指向相同，两个对象之间有共同的属性或者方法。改变其中一个的值，另一个值也会改变。</p><p><strong>深拷贝</strong>：在另一个对象中开辟相应的空间，一个一个的存储到另一个对象中。</p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="原生方法"><a href="#原生方法" class="headerlink" title="原生方法"></a>原生方法</h4><p><strong>浅拷贝</strong>：简单的 赋值行为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1=&#123;</span><br><span class="line">    age:<span class="number">10</span>,</span><br><span class="line">    sex:<span class="string">"男"</span>,</span><br><span class="line">    car:[<span class="string">"浅拷贝"</span>,<span class="string">"拷贝"</span>,<span class="string">"地址"</span>,<span class="string">"属性"</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = obj1;</span><br><span class="line">obj1.age = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj2.age); <span class="comment">// 随之改变为 20</span></span><br></pre></td></tr></table></figure><p><strong>深拷贝</strong>：<code>jQuery.extend()</code> 函数用于将一个或多个对象的内容合并到目标对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法：$.extend( [deep], target, object1 [, objectN ] )。</span></span><br><span class="line"><span class="comment">// [deep] 表示是否进行深拷贝</span></span><br><span class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> options, name, src, copy, copyIsArray, </span><br><span class="line">        clone,target = <span class="built_in">arguments</span>[ <span class="number">0</span> ] || &#123;&#125;,</span><br><span class="line">        i = <span class="number">1</span>,</span><br><span class="line">        length = <span class="built_in">arguments</span>.length, </span><br><span class="line">        deep = <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Handle a deep copy situation</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> target === <span class="string">"boolean"</span> ) &#123;</span><br><span class="line">        deep = target;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Skip the boolean and the target</span></span><br><span class="line">        target = <span class="built_in">arguments</span>[ i ] || &#123;&#125;;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Handle case when target is a string or something (possible in deep copy)</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction( target ) ) &#123;</span><br><span class="line">        target = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Extend jQuery itself if only one argument is passed</span></span><br><span class="line">    <span class="keyword">if</span> ( i === length ) &#123;</span><br><span class="line">        target = <span class="keyword">this</span>;</span><br><span class="line">        i--;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Only deal with non-null/undefined values</span></span><br><span class="line">        <span class="keyword">if</span> ( ( options = <span class="built_in">arguments</span>[ i ] ) != <span class="literal">null</span> ) &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// Extend the base object</span></span><br><span class="line">            <span class="keyword">for</span> ( name <span class="keyword">in</span> options ) &#123;</span><br><span class="line">                src = target[ name ];</span><br><span class="line">                copy = options[ name ];</span><br><span class="line"> </span><br><span class="line">                <span class="comment">// Prevent never-ending loop</span></span><br><span class="line">                <span class="keyword">if</span> ( target === copy ) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"> </span><br><span class="line">                <span class="comment">// Recurse if we're merging plain objects or arrays</span></span><br><span class="line">                <span class="keyword">if</span> (deep&amp;&amp;copy&amp;&amp;(jQuery.isPlainObject(copy) || (copyIsArray = <span class="built_in">Array</span>.isArray( copy ))))&#123;</span><br><span class="line"> </span><br><span class="line">                    <span class="keyword">if</span> ( copyIsArray ) &#123;</span><br><span class="line">                        copyIsArray = <span class="literal">false</span>;</span><br><span class="line">                        clone = src &amp;&amp; <span class="built_in">Array</span>.isArray( src ) ? src : [];</span><br><span class="line"> </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        clone = src &amp;&amp; jQuery.isPlainObject( src ) ? src : &#123;&#125;;</span><br><span class="line">                    &#125;</span><br><span class="line"> </span><br><span class="line">                    <span class="comment">// Never move original objects, clone them</span></span><br><span class="line">                    target[ name ] = jQuery.extend( deep, clone, copy );</span><br><span class="line"> </span><br><span class="line">                <span class="comment">// Don't bring in undefined values</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( copy !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">                    target[ name ] = copy;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Return the modified object</span></span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="跨域请求"><a href="#跨域请求" class="headerlink" title="跨域请求"></a>跨域请求</h2><ol><li><p>相同的域是指，域名、协议、端口号完全相同。</p></li><li><p>跨域请求的方法：</p><p>（1）CORS</p><p>（2）document.domain</p><p>（3）图像Ping</p><p>（4）Jsonp</p><p>（5）Comet</p><p>（6）WebSocket</p></li></ol><h2 id="call-和apply-的区别"><a href="#call-和apply-的区别" class="headerlink" title="call()和apply()的区别"></a><code>call()</code>和<code>apply()</code>的区别</h2><ol><li>相同点：作用相同，即，在特定的作用域调用函数，等于设置<strong>this</strong>对象的值，以扩充函数赖以运行的作用域。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 与apply()效果相同，此处仅以 call() 为例</span></span><br><span class="line"><span class="built_in">window</span>.color = <span class="string">"red"</span>;</span><br><span class="line"><span class="keyword">var</span> o=&#123;<span class="attr">color</span>:<span class="string">"blue"</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.color)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">getColor.call(<span class="keyword">this</span>);      <span class="comment">// red</span></span><br><span class="line">getColor.call(<span class="built_in">window</span>);    <span class="comment">// red</span></span><br><span class="line">getColor.call(o);         <span class="comment">// blue</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>不同点：</p><p>接收参数的方式不同：</p><p>（1）<code>call()</code>：第一个参数是运行函数的作用域 ，后面的参数依次传入函数。</p><p>（2）<code>apply()</code>：第一个参数是运行函数的作用域 ，另一个参数是参数数组,可以是Array实例或arguments对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">c, d</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.a + <span class="keyword">this</span>.b + c + d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line">add.call(o, <span class="number">5</span>, <span class="number">7</span>);      <span class="comment">// 1 + 3 + 5 + 7 = 16</span></span><br><span class="line">add.apply(o, [<span class="number">10</span>, <span class="number">20</span>]);      <span class="comment">// 1 + 3 + 10 + 20 = 34</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="阻止默认事件"><a href="#阻止默认事件" class="headerlink" title="阻止默认事件"></a>阻止默认事件</h2><ol><li>阻止表单默认行为</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"add_form"</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"保存"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#add_form'</span>).on(<span class="string">'submit'</span>,handleAddSubmit)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleAddSubmit</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    e.preventDefault() <span class="comment">// 阻止表单默认行为</span></span><br><span class="line">    $.post(<span class="string">'http://...'</span>,$(<span class="keyword">this</span>).serialize(),<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原因：（1）需要处理逻辑再提交（2）防止跳转链接 ，仅将数据提交给某个url，不需跳转</p><h1 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h1><h2 id="经典布局"><a href="#经典布局" class="headerlink" title="经典布局"></a>经典布局</h2><h3 id="双飞翼布局"><a href="#双飞翼布局" class="headerlink" title="双飞翼布局"></a>双飞翼布局</h3><p><strong>步骤：</strong></p><ol><li>两栏和自适应元素都设置统一方向的浮动（如 <code>float: left;</code> )；</li><li>middle-wrap 元素设置宽度为100%；</li><li>middle元素设置左右<code>margin</code>值，值为左右两栏的宽度。</li><li>左边栏<code>margin-left</code>为负100%；</li><li>右边栏<code>margin-left</code>为负自身宽度。</li></ol><p><strong>代码：</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.middle-wrap</span>&#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.middle</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>:yellowgreen;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span>, <span class="selector-class">.right</span>&#123;</span><br><span class="line">   <span class="attribute">float</span>: left;</span><br><span class="line">   <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">   <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>:-<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">     <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">     <span class="attribute">margin-left</span>:-<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"middle-wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"middle"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>理解：</strong>（关键点对于margin的理解）</p><p><code>margin-left:-100%</code> 是指：<strong>子元素</strong>（left）的左边框距离<strong>父元素</strong>（body）右边框的距离。</p><blockquote><p>参考链接：<a href="https://segmentfault.com/a/1190000014546205?utm_source=tag-newest" target="_blank" rel="noopener">https://segmentfault.com/a/1190000014546205?utm_source=tag-newest</a></p></blockquote><h2 id="border-none-border-0-的区别"><a href="#border-none-border-0-的区别" class="headerlink" title="border:none; / border:0; 的区别"></a><code>border:none; / border:0;</code> 的区别</h2><p><code>border:none;</code>：表示无边框。</p><p><code>border:0;</code>：表示边框宽度为 0。</p><ol><li><p>性能差异：</p><p><code>border:宽度 样式 颜色;</code>顺序不能错，渲染颜色前先获得边框。</p><p><code>border:none;</code>浏览器不进行渲染，不占用内存。</p><p><code>border:0;</code>浏览器对 border-with、border-color进行渲染，占用内存。</p></li><li><p>浏览器兼容：</p><p>IE-7不支持<code>border:none;</code></p></li></ol><h2 id="Sprites精灵图优缺点"><a href="#Sprites精灵图优缺点" class="headerlink" title="Sprites精灵图优缺点"></a>Sprites精灵图优缺点</h2><p>优点：</p><ol><li>减少图片字节；</li><li>减少http请求；</li><li>不同场景下可维护性高（比如只改变图片颜色）；</li></ol><p>缺点：（为了性能，繁杂工序的缺点都不构成缺点）</p><ol><li>合并麻烦</li><li>适应性差</li><li>定位繁琐</li><li>不同场景下可维护性差，（高边其中图片内容）</li></ol><h1 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h1><h2 id="lt-a-gt-标签中的-target-属性"><a href="#lt-a-gt-标签中的-target-属性" class="headerlink" title="&lt;a&gt; 标签中的 target 属性"></a><code>&lt;a&gt;</code> 标签中的 target 属性</h2><table><thead><tr><th>属性值</th><th>描述</th></tr></thead><tbody><tr><td>_blank</td><td>在新窗口中打开被连接文档。</td></tr><tr><td>_self</td><td>默认。在相同的框架中打开被连接文档。</td></tr><tr><td>_parent</td><td>将链接的文件载入含有该链接框架的父框架集或父窗口中。如果含有该链接的框架不是嵌套的，则在浏览器全屏窗口中载入链接的文件，和_self参数效果一样。</td></tr><tr><td>_top</td><td>在整个窗口中打开被链接文档。</td></tr><tr><td>framename</td><td>在指定的框架中打开被链接文档。</td></tr></tbody></table><p>_top 和 _partent 不常用，区别为：</p><p>比如网<strong>A</strong>中镶嵌 iframe 了网页<strong>B</strong>，网页<strong>B</strong>镶嵌 iframe 了网页<strong>C</strong>：如果网页<strong>C</strong>中连接设置target=parent，则将网页<strong>B</strong>去掉，直接跳入<strong>A</strong>中嵌入网页<strong>C</strong>中链接的页面;而如果网页<strong>C</strong>中target=top ，则直接跳出所有iframe框架，直接转向C中链接页面。  </p><p><strong>注意：</strong>任何其他用一个下划线作为开头的窗口或者目标都会被浏览器忽略，因此，不要将<code>_</code><strong>下划线</strong>作为文档中定义的任何框架 name 或 id 的第一个字符。</p><h1 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h1><h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><ol><li><p><code>export default name</code> 只能导一个，不能写成 <code>export default {name}</code> 的形式 ， 接收时 <code>import name from &#39;./path&#39;</code>，不能写为<code>import {name} from &#39;./path&#39;</code>。</p></li><li><p><code>export {name,...}</code> 可以导出多个，但是导出导入都必须加 <code>{ }</code>， <code>import {name,...} from &#39;./path&#39;</code>。</p></li></ol><h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><h2 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h2><p>xss攻击，大致原理就是 代码注入，利用漏洞注入代码进行攻击</p><blockquote><p>参考链接：<a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener">https://tech.meituan.com/2018/09/27/fe-security.html</a></p></blockquote><h1 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h1><h2 id="渲染机制"><a href="#渲染机制" class="headerlink" title="渲染机制"></a>渲染机制</h2><p><strong>重绘：</strong>当render tree中的一些元素需要更新属性，而这些属性只是影响元素的外观、风格，而不会影响布局的，比如background-color。</p><p><strong>回流：</strong>当render tree中的一部分(或全部)因为元素的规模尺寸、布局、隐藏等改变而需要重新构建。</p><blockquote><p>参考：<a href="https://blog.fundebug.com/2019/01/03/understand-browser-rendering/" target="_blank" rel="noopener">https://blog.fundebug.com/2019/01/03/understand-browser-rendering/</a></p></blockquote><h1 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h1><h2 id="组件封装"><a href="#组件封装" class="headerlink" title="组件封装"></a>组件封装</h2><p>待更…….</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;不积小流，无以成江海。
    
    </summary>
    
      <category term="前端积累" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E7%A7%AF%E7%B4%AF/"/>
    
      <category term="学习积累" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E7%A7%AF%E7%B4%AF/%E5%AD%A6%E4%B9%A0%E7%A7%AF%E7%B4%AF/"/>
    
    
      <category term="前端积累" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E7%A7%AF%E7%B4%AF/"/>
    
  </entry>
  
  <entry>
    <title>美好事物</title>
    <link href="http://yoursite.com/2019/03/21/%E7%BE%8E%E5%A5%BD%E4%BA%8B%E7%89%A9/"/>
    <id>http://yoursite.com/2019/03/21/美好事物/</id>
    <published>2019-03-21T14:59:00.000Z</published>
    <updated>2019-03-25T13:44:34.787Z</updated>
    
    <content type="html"><![CDATA[<p>我望向幽谷，<br>惶恐又欣喜。<a id="more"></a><br>我试着想象，<br>那里暗藏着的，<br>是一枝花，<br>一团火，<br>还是一颗坠落的星辰。<br>我把经过修饰的想象扔向那里，<br>回声中，<br>溅起了些许涟漪。<br>你问我那里究竟是些什么？<br>可我终究是无法形容的，<br>那些回忆中带着的情绪，<br>那些不甘心的幸运。<br>——王佚——<br>————————————————————<br>谢谢自己走过深渊，穿过黑暗<br>也谢谢你在光亮处翘首以盼</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我望向幽谷，&lt;br&gt;惶恐又欣喜。
    
    </summary>
    
      <category term="poem - 美好事物" scheme="http://yoursite.com/categories/poem-%E7%BE%8E%E5%A5%BD%E4%BA%8B%E7%89%A9/"/>
    
    
      <category term="poem" scheme="http://yoursite.com/tags/poem/"/>
    
      <category term="美好事物" scheme="http://yoursite.com/tags/%E7%BE%8E%E5%A5%BD%E4%BA%8B%E7%89%A9/"/>
    
  </entry>
  
</feed>
